!function(e){function t(i){if(l[i])return l[i].exports;var a=l[i]={exports:{},id:i,loaded:!1};return e[i].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var l={};return t.m=e,t.c=l,t.p="",t(0)}([function(e,t,l){e.exports=l(26)},function(e,t,l){"use strict";function i(e,t){this.helpers=e||{},this.partials=t||{},a(this)}function a(e){e.registerHelper("helperMissing",function(e){if(2===arguments.length)return void 0;throw new s("Missing helper: '"+e+"'")}),e.registerHelper("blockHelperMissing",function(t,l){var i=l.inverse||function(){},a=l.fn;return h(t)&&(t=t.call(this)),t===!0?a(this):t===!1||null==t?i(this):c(t)?t.length>0?e.helpers.each(t,l):i(this):a(t)}),e.registerHelper("each",function(e,t){var l,i=t.fn,a=t.inverse,r=0,n="";if(h(e)&&(e=e.call(this)),t.data&&(l=_(t.data)),e&&"object"==typeof e)if(c(e))for(var s=e.length;s>r;r++)l&&(l.index=r,l.first=0===r,l.last=r===e.length-1),n+=i(e[r],{data:l});else for(var o in e)e.hasOwnProperty(o)&&(l&&(l.key=o,l.index=r,l.first=0===r),n+=i(e[o],{data:l}),r++);return 0===r&&(n=a(this)),n}),e.registerHelper("if",function(e,t){return h(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||n.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,l){return e.helpers["if"].call(this,t,{fn:l.inverse,inverse:l.fn,hash:l.hash})}),e.registerHelper("with",function(e,t){return h(e)&&(e=e.call(this)),n.isEmpty(e)?void 0:t.fn(e)}),e.registerHelper("log",function(t,l){var i=l.data&&null!=l.data.level?parseInt(l.data.level,10):1;e.log(i,t)})}function r(e,t){p.log(e,t)}var n=l(3),s=l(2)["default"],o="1.3.0";t.VERSION=o;var d=4;t.COMPILER_REVISION=d;var u={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};t.REVISION_CHANGES=u;var c=n.isArray,h=n.isFunction,f=n.toString,v="[object Object]";t.HandlebarsEnvironment=i,i.prototype={constructor:i,logger:p,log:r,registerHelper:function(e,t,l){if(f.call(e)===v){if(l||t)throw new s("Arg not supported with multiple helpers");n.extend(this.helpers,e)}else l&&(t.not=l),this.helpers[e]=t},registerPartial:function(e,t){f.call(e)===v?n.extend(this.partials,e):this.partials[e]=t}};var p={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){if(p.level<=e){var l=p.methodMap[e];"undefined"!=typeof console&&console[l]&&console[l].call(console,t)}}};t.logger=p,t.log=r;var _=function(e){var t={};return n.extend(t,e),t};t.createFrame=_},function(e,t){"use strict";function l(e,t){var l;t&&t.firstLine&&(l=t.firstLine,e+=" - "+l+":"+t.firstColumn);for(var a=Error.prototype.constructor.call(this,e),r=0;r<i.length;r++)this[i[r]]=a[i[r]];l&&(this.lineNumber=l,this.column=t.firstColumn)}var i=["description","fileName","lineNumber","message","name","number","stack"];l.prototype=new Error,t["default"]=l},function(e,t,l){"use strict";function i(e){return o[e]||"&amp;"}function a(e,t){for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l])}function r(e){return e instanceof s?e.toString():e||0===e?(e=""+e,u.test(e)?e.replace(d,i):e):""}function n(e){return e||0===e?f(e)&&0===e.length?!0:!1:!0}var s=l(4)["default"],o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},d=/[&<>"'`]/g,u=/[&<>"'`]/;t.extend=a;var c=Object.prototype.toString;t.toString=c;var h=function(e){return"function"==typeof e};h(/x/)&&(h=function(e){return"function"==typeof e&&"[object Function]"===c.call(e)});var h;t.isFunction=h;var f=Array.isArray||function(e){return e&&"object"==typeof e?"[object Array]"===c.call(e):!1};t.isArray=f,t.escapeExpression=r,t.isEmpty=n},function(e,t){"use strict";function l(e){this.string=e}l.prototype.toString=function(){return""+this.string},t["default"]=l},function(e,t,l){t=e.exports=l(7)(),t.push([e.id,".fn-relative{position:relative}.fn-toolbar{position:absolute;top:4px;right:10px}.jl-comb-btn-group>.btn{height:30px}.jl-msg-button{line-height:1}.jl-overlay{background-color:#000}.panel-title{display:inline}.options{width:100%;display:inline-block}",""])},function(e,t,l){var i=l(10);e.exports=(i["default"]||i).template(function(e,t,l,i,a){function r(e,t){var i,a="";return a+='\r\n		<div class="options form-horizontal">\r\n			',i=l.each.call(e,(i=e&&e.options,null==i||i===!1?i:i.inputs),{hash:{},inverse:v.noop,fn:v.program(2,n,t),data:t}),(i||0===i)&&(a+=i),a+="\r\n			",i=l.each.call(e,(i=e&&e.options,null==i||i===!1?i:i.buttons),{hash:{},inverse:v.noop,fn:v.program(4,s,t),data:t}),(i||0===i)&&(a+=i),a+="\r\n		</div>\r\n		"}function n(e,t){var l="";return l+='\r\n				<label class="col-sm-1 control-label">'+f(typeof e===h?e.apply(e):e)+'</label>\r\n				<div class="col-sm-3">\r\n					<input type="text" class="form-control" id='+f(typeof e===h?e.apply(e):e)+"Option>\r\n				</div>\r\n			"}function s(e,t){var l="";return l+='\r\n				<div class="col-sm-3">\r\n					<button class="btn btn-default" id="'+f(typeof e===h?e.apply(e):e)+'Btn">'+f(typeof e===h?e.apply(e):e)+"</button>\r\n				</div>\r\n			"}function o(e,t){var l="";return l+='\r\n				<button class="btn btn-default" id="'+f(typeof e===h?e.apply(e):e)+'Btn">'+f(typeof e===h?e.apply(e):e)+"</button>\r\n			"}this.compilerInfo=[4,">= 1.0.0"],l=this.merge(l,e.helpers),a=a||{};var d,u,c="",h="function",f=this.escapeExpression,v=this;return c+='<div class="panel panel-default">\r\n\r\n	<div class="panel-heading fn-relative">\r\n\r\n		<div class="panel-title">',(u=l.title)?d=u.call(t,{hash:{},data:a}):(u=t&&t.title,d=typeof u===h?u.call(t,{hash:{},data:a}):u),c+=f(d)+"</div>\r\n\r\n		",d=l["if"].call(t,t&&t.options,{hash:{},inverse:v.noop,fn:v.program(1,r,a),data:a}),(d||0===d)&&(c+=d),c+='\r\n\r\n		<div class="btn-group fn-toolbar">\r\n			',d=l.each.call(t,t&&t.toolbar,{hash:{},inverse:v.noop,fn:v.program(6,o,a),data:a}),(d||0===d)&&(c+=d),c+='\r\n		</div>\r\n\r\n	</div>\r\n\r\n	<div class="panel-body">\r\n		',(u=l.bodyTpl)?d=u.call(t,{hash:{},data:a}):(u=t&&t.bodyTpl,d=typeof u===h?u.call(t,{hash:{},data:a}):u),(d||0===d)&&(c+=d),c+="\r\n	</div>\r\n\r\n</div>"})},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var l=this[t];l[2]?e.push("@media "+l[2]+"{"+l[1]+"}"):e.push(l[1])}return e.join("")},e.i=function(t,l){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},a=0;a<this.length;a++){var r=this[a][0];"number"==typeof r&&(i[r]=!0)}for(a=0;a<t.length;a++){var n=t[a];"number"==typeof n[0]&&i[n[0]]||(l&&!n[2]?n[2]=l:l&&(n[2]="("+n[2]+") and ("+l+")"),e.push(n))}},e}},function(e,t,l){"use strict";var i=l(1),a=l(4)["default"],r=l(2)["default"],n=l(3),s=l(9),o=function(){var e=new i.HandlebarsEnvironment;return n.extend(e,i),e.SafeString=a,e.Exception=r,e.Utils=n,e.VM=s,e.template=function(t){return s.template(t,e)},e},d=o();d.create=o,t["default"]=d},function(e,t,l){"use strict";function i(e){var t=e&&e[0]||1,l=c;if(t!==l){if(l>t){var i=h[l],a=h[t];throw new u("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+a+").")}throw new u("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function a(e,t){if(!t)throw new u("No environment passed to template");var l=function(e,l,i,a,r,n){var s=t.VM.invokePartial.apply(this,arguments);if(null!=s)return s;if(t.compile){var o={helpers:a,partials:r,data:n};return r[l]=t.compile(e,{data:void 0!==n},t),r[l](i,o)}throw new u("The partial "+l+" could not be compiled when running in runtime-only mode")},i={escapeExpression:d.escapeExpression,invokePartial:l,programs:[],program:function(e,t,l){var i=this.programs[e];return l?i=n(e,t,l):i||(i=this.programs[e]=n(e,t)),i},merge:function(e,t){var l=e||t;return e&&t&&e!==t&&(l={},d.extend(l,t),d.extend(l,e)),l},programWithDepth:t.VM.programWithDepth,noop:t.VM.noop,compilerInfo:null};return function(l,a){a=a||{};var r,n,s=a.partial?a:t;a.partial||(r=a.helpers,n=a.partials);var o=e.call(i,s,l,r,n,a.data);return a.partial||t.VM.checkRevision(i.compilerInfo),o}}function r(e,t,l){var i=Array.prototype.slice.call(arguments,3),a=function(e,a){return a=a||{},t.apply(this,[e,a.data||l].concat(i))};return a.program=e,a.depth=i.length,a}function n(e,t,l){var i=function(e,i){return i=i||{},t(e,i.data||l)};return i.program=e,i.depth=0,i}function s(e,t,l,i,a,r){var n={partial:!0,helpers:i,partials:a,data:r};if(void 0===e)throw new u("The partial "+t+" could not be found");return e instanceof Function?e(l,n):void 0}function o(){return""}var d=l(3),u=l(2)["default"],c=l(1).COMPILER_REVISION,h=l(1).REVISION_CHANGES;t.checkRevision=i,t.template=a,t.programWithDepth=r,t.program=n,t.invokePartial=s,t.noop=o},function(e,t,l){e.exports=l(8)},function(module,exports){if(!jslet.rootUri){var ohead=document.getElementsByTagName("head")[0],uri=ohead.lastChild.src;uri&&(uri=uri.substring(0,uri.lastIndexOf("/")+1),jslet.rootUri=uri)}jslet.global={version:"3.0.0",changeStateField:"rs",selectStateField:"_sel_",valueSeparator:",",defaultRecordClass:null,defaultFocusKeyCode:9,defaultCharWidth:12,debugMode:!0},jslet.global.serverErrorHandler=function(e,t){return!1},jslet.global.beforeSubmit=function(e){return e},jslet.toArray=function(e){if(!e)return[];if("toArray"in Object(e))return e.toArray();for(var t=e.length||0,l=new Array(t);t--;)l[t]=e[t];return l},jslet.extend=function(e,t){for(var l in t)e[l]=t[l];return e},jslet.emptyFunction=function(){},jslet.keys=function(e){if("object"!=typeof e)return[];var t=[];for(var l in e)e.hasOwnProperty(l)&&t.push(l);return t},jslet.extend(Function.prototype,function(){function e(e,t){for(var l=e.length,i=t.length;i--;)e[l+i]=t[i];return e}function t(t,l){return t=u.call(t,0),e(t,l)}function l(){var e=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return 1!=e.length||e[0]?e:[]}function i(e){if(arguments.length<2&&"undefined"==typeof arguments[0])return this;var l=this,i=u.call(arguments,1);return function(){var a=t(i,arguments);return l.apply(e,a)}}function a(t){var l=this,i=u.call(arguments,1);return function(a){var r=e([a||window.event],i);return l.apply(t,r)}}function r(){if(!arguments.length)return this;var e=this,l=u.call(arguments,0);return function(){var i=t(l,arguments);return e.apply(this,i)}}function n(e){var t=this,l=u.call(arguments,1);return e=1e3*e,window.setTimeout(function(){return t.apply(t,l)},e)}function s(){var t=e([.01],arguments);return this.delay.apply(this,t)}function o(t){var l=this;return function(){var i=e([l.bind(this)],arguments);return t.apply(this,i)}}function d(){if(this._methodized)return this._methodized;var t=this;return this._methodized=function(){var l=e([this],arguments);return t.apply(null,l)},this._methodized}var u=Array.prototype.slice;return{argumentNames:l,bind:i,bindAsEventListener:a,curry:r,delay:n,defer:s,wrap:o,methodize:d}}()),jslet.Class=function(){function e(){}function t(){function t(){this.initialize.apply(this,arguments)}var l=null,i=jslet.toArray(arguments);jQuery.isFunction(i[0])&&(l=i.shift()),jslet.extend(t,jslet.Class.Methods),t.superclass=l,t.subclasses=[],l&&(e.prototype=l.prototype,t.prototype=new e,l.subclasses.push(t));for(var a=0,r=i.length;r>a;a++)t.addMethods(i[a]);return t.prototype.initialize||(t.prototype.initialize=jslet.emptyFunction),t.prototype.constructor=t,t}function l(e){var t=this.superclass&&this.superclass.prototype,l=jslet.keys(e);i&&(e.toString!=Object.prototype.toString&&l.push("toString"),e.valueOf!=Object.prototype.valueOf&&l.push("valueOf"));for(var a=0,r=l.length;r>a;a++){var n=l[a],s=e[n];if(t&&jQuery.isFunction(s)&&"$super"==s.argumentNames()[0]){var o=s;s=function(e){return function(){return t[e].apply(this,arguments)}}(n).wrap(o),s.valueOf=o.valueOf.bind(o),s.toString=o.toString.bind(o)}this.prototype[n]=s}return this}var i=function(){for(var e in{toString:1})if("toString"===e)return!1;return!0}();return{create:t,Methods:{addMethods:l}}}(),(void 0===window.jslet||void 0===jslet)&&(jslet=window.jslet=function(e){var t=jQuery(e)[0];return t&&t.jslet?t.jslet:null}),jslet._AUTOID=0,jslet.nextId=function(){return"jslet"+jslet._AUTOID++},jslet.data||(jslet.data={}),jslet.locale||(jslet.locale={}),jslet.temp||(jslet.temp={}),Array.indexOf||(Array.prototype.indexOf=function(e){for(var t=0,l=this.length;l>t;t++)if(this[t]==e)return t;return-1}),!Object.deepClone,String.prototype.trim||(String.prototype.trim=function(){this.replace(/^\s+/,"").replace(/\s+$/,"")}),String.prototype.startsWith||(String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),String.prototype.endsWith||(String.prototype.endsWith=function(e){var t=this.length-e.length;return t>=0&&this.indexOf(e,t)===t}),jslet.debounce=function(e,t,l){var i;return function(){var l=this,a=arguments;if(!t)return void e.apply(l,a);var r=function(){i=null,e.apply(l,a)};i&&clearTimeout(i),i=setTimeout(r,t)}},jslet.deepClone=function(e){var t;t=e.constructor==Object?new e.constructor:new e.constructor(e.valueOf());for(var l in e)t[l]!=e[l]&&("object"==typeof e[l]?t[l]=e[l].deepClone():t[l]=e[l]);return t.toString=e.toString,t.valueOf=e.valueOf,t},jslet.SimpleMap=function(){var e=[],t=[];this.get=function(l){for(var i=e.length,a=0;i>a;a++)if(l==e[a])return t[a];return null},this.set=function(l,i){var a=e.indexOf(l);a>=0?t[a]=i:(e.push(l),t.push(i))},this.clear=function(){e.length=0,t.length=0},this.unset=function(l){for(var i=e.length,a=0;i>a;a++)if(e[a]==l)return e.splice(a,1),void t.splice(a,1)},this.count=function(){return e.length},this.keys=function(){return e},this.values=function(){return t}},jslet.formatString=function(e,t){if(jslet.Checker.test("jslet.formatString#msg",e).required().isString(),void 0===t||null===t)return e;t===!1&&(t="false"),t===!0&&(t="true");var l,i,a=e;if(jslet.isArray(t))for(l=t.length,i=0;l>i;i++)a=a.replace("{"+i+"}",t[i]);else{if(!t.keys)return e.replace("{0}",t);var r,n=t.keys();for(l=n.length,i=0;l>i;i++)r=n[i],a=a.replace("{"+r+"}",t.get(r))}return a},jslet._SCALEFACTOR="100000000000000000000000000000000000",jslet.formatNumber=function(e,t){if(!t)return e;if(!e&&0!==e)return"";var l,i,a="";for(i=0;i<t.length;i++)if(l=t.substr(i,1),"#"==l||"0"==l||","==l){i>0&&(a=t.substr(0,i),t=t.substr(i));break}var r="";for(i=t.length-1;i>=0;i--)if(l=t.substr(i,1),"#"==l||"0"==l||","==l){i>0&&(r=t.substr(i+1),t=t.substr(0,i+1));break}var n=t?t.split("."):[""],s=0;n.length>1&&(s=n[1].length);var o=e?e.toString().split("."):["0"],d=0;if(o.length>1&&(d=o[1].length),d>s){var u=parseInt(jslet._SCALEFACTOR.substring(0,s+1));e=Math.round(e*u)/u,o=e?e.toString().split("."):["0"]}var c,h="",f=o[0],v=n[0],p=!1,_=f.length-1;for(c=v.length-1;c>=0;c--)switch(v.substr(c,1)){case"#":_>=0&&(h=f.substr(_--,1)+h);break;case"0":h=_>=0?f.substr(_--,1)+h:"0"+h;break;case",":p=!0,h=","+h}if(_>=0)if(p)for(var g=f.length;_>=0;_--)h=f.substr(_,1)+h,_>0&&(g-_)%3===0&&(h=","+h);else h=f.substr(0,_+1)+h;for(h+=".",f=o.length>1?o[1]:"",v=n.length>1?n[1]:"",_=0,c=0;c<v.length;c++)switch(v.substr(c,1)){case"#":_<f.length&&(h+=f.substr(_++,1));break;case"0":h+=_<f.length?f.substr(_++,1):"0"}return a+h.replace(/^,+/,"").replace(/\.$/,"")+r},jslet.formatDate=function(e,t){if(!e)return"";jslet.Checker.test("jslet.formatDate#date",e).isDate(),jslet.Checker.test("jslet.formatDate#format",t).required().isString();var l={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in l)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?l[i]:("00"+l[i]).substr((""+l[i]).length)));return t},jslet.parseDate=function(e,t){if(!e)return null;jslet.Checker.test("jslet.parseDate#strDate",e).isString(),jslet.Checker.test("jslet.parseDate#format",t).required().isString();for(var l,i,a=null,r=-1,n=0,s={y:0,M:0,d:0,h:0,m:0,s:0,S:0},o=0,d=t.length;d>o;o++)l=t.charAt(o),l!=a&&(a&&void 0!==s[a]&&r>=0&&(n=o,i=parseInt(e.substring(r,n)),s[a]=isNaN(i)?0:i),r=o,a=l);r>=0&&(i=parseInt(e.substring(r)),s[l]=isNaN(i)?0:i);var u=s.y;100>u&&(u+=2e3);var c=new Date(u,s.M-1,s.d,s.h,s.m,s.s,s.S);return c},Date.prototype.toJSON=function(){return jslet.formatDate(this,"yyyy-MM-ddThh:mm:ss")},jslet.convertISODate=function(e){if(!e)return null;if(jslet.isDate(e))return e;var t=e.substr(10,1);if("T"==t){var l=e.substr(0,4),i=e.substr(5,2),a=e.substr(8,2),r=e.substr(11,2),n=e.substr(14,2),s=e.substr(17,2);return"Z"==e.substr(-1,1)?new Date(Date.UTC(+l,+i-1,+a,+r,+n,+s)):new Date(+l,+i-1,+a,+r,+n,+s)}return e},jslet._currentPattern={},jslet._convertToJsPattern=function(e,t){if(jslet._currentPattern.pattern==e&&jslet._currentPattern.escapeChar==t)return jslet._currentPattern.result;jslet._currentPattern.pattern=e,jslet._currentPattern.escapeChar=t;var l,i,a=[],r=e.length-1,n=0,s=r,o=!1,d=!1;"%"==e.charAt(0)&&(n=1,o=!0),"%"==e.charAt(r)&&(s=r-1,d=!0),o&&d?a.push(".*"):d&&a.push("^");for(var u=n;s>=u;u++)if(l=e.charAt(u),"\\"==l&&r>u){if(i=e.charAt(u+1),"%"==i||"_"==i){a.push(i),u++;continue}}else"_"==l?a.push("."):(("."==l||"*"==l||"["==l||"]"==l||"{"==l||"}"==l||"+"==l||"("==l||")"==l||"\\"==l||"?"==l||"$"==l||"^"==l)&&a.push("\\"),a.push(l));return o&&d||d?a.push(".*"):o&&a.push("$"),jslet._currentPattern.result=new RegExp(a.join(""),"ig"),jslet._currentPattern.result},jslet.like=like=window.like=function(e,t,l){if(!e||!t)return!1;if(0===t.length)return!1;l||(l="\\");var i=jslet._convertToJsPattern(t,l);return jslet.isString(e)||(e+=""),null!==e.match(i)},jslet.between=between=window.between=function(e,t,l){return 3!=arguments.length?!1:e>=t&&l>=e},jslet.inlist=inlist=window.inlist=function(e,t){var l=arguments.length;if(2>=l)return!1;for(var i=1;l>i;i++)if(e==arguments[i])return!0;return!1},jslet.isArray=function(e){return!e||"[object Array]"===Object.prototype.toString.apply(e)},jslet.isDate=function(e){return!e||e.constructor==Date},jslet.isString=function(e){return null===e||void 0===e||"string"==typeof e},jslet.isObject=function(e){return null===e||void 0===e||"object"!==jQuery.type(this.varValue)},jslet.setTimeout=function(e,t,l){jslet.delayFunc=function(){t.call(e)},setTimeout(jslet.delayFunc,l)},jslet.htmlEncode=function(e){return e?jQuery("<div />").text(e).html():""},jslet.htmlDecode=function(e){return e?jQuery("<div />").html(e).text():""},jslet.getArrayValue=function(e,t){if(!e)return null;if(jslet.isArray(e)){var l=e.length;return l>t?e[t]:null}return 0===t?e:null},jslet.Checker={varName:null,varValue:null,test:function(e,t){return this.varName=e,this.varValue=t,this},testValue:function(e){return this.varValue=e,this},required:function(){if(null===this.varValue||void 0===this.varValue||""===this.varValue)throw new Error("["+this.varName+"] is Required!");return this},isBoolean:function(){if(null!==this.varValue&&void 0!==this.varValue&&""!==this.varValue&&0!==this.varValue&&this.varValue!==!0&&this.varValue!==!1)throw new Error("["+this.varName+"] must be a boolean value!");return this},isString:function(){if(null!==this.varValue&&void 0!==this.varValue&&this.varValue!==!1&&!jslet.isString(this.varValue))throw new Error("["+this.varName+":"+this.varValue+"] must be a String!");return this},isDate:function(){if(null!==this.varValue&&void 0!==this.varValue&&this.varValue!==!1&&!jslet.isDate(this.varValue))throw new Error("["+this.varName+"] must be a Date!");return this},isNumber:function(){if(null!==this.varValue&&void 0!==this.varValue&&this.varValue!==!1&&!jQuery.isNumeric(this.varValue))throw new Error("["+this.varName+":"+this.varValue+"] must be a Numberic!");return this},isGTZero:function(){if(this.isNumber(),this.varValue<=0)throw new Error("["+this.varName+":"+this.varValue+"] must be great than zero!")},isGTEZero:function(){if(this.isNumber(),this.varValue<0)throw new Error("["+this.varName+":"+this.varValue+"] must be great than or equal zero!")},between:function(e,t){var l=null!==e&&void 0!==e,i=null!==t&&void 0!==t;if(l&&i&&(this.varValue<e||this.varValue>t))throw new Error("["+this.varName+":"+this.varValue+"] must be between ["+e+"] and ["+t+"]!");if(!l&&i&&this.varValue>t)throw new Error("["+this.varName+":"+this.varValue+"] must be less than ["+t+"]!");if(l&&!i&&this.varValue<e)throw new Error("["+this.varName+":"+this.varValue+"] must be great than ["+e+"]!")},isArray:function(){if(null!==this.varValue&&void 0!==this.varValue&&this.varValue!==!1&&!jslet.isArray(this.varValue))throw new Error("["+this.varName+"] must be an Array!");return this},isObject:function(){if(null!==this.varValue&&void 0!==this.varValue&&this.varValue!==!1&&"object"!==jQuery.type(this.varValue))throw new Error("["+this.varName+"] must be a Object!");return this},isPlanObject:function(){if(null!==this.varValue&&void 0!==this.varValue&&this.varValue!==!1&&!jQuery.isPlainObject(this.varValue))throw new Error("["+this.varName+"] must be a plan object!");return this},isFunction:function(){if(null!==this.varValue&&void 0!==this.varValue&&this.varValue!==!1&&!jQuery.isFunction(this.varValue))throw new Error("["+this.varName+"] must be a Function!");return this},isClass:function(e){if(this.isObject(),null!==this.varValue&&void 0!==this.varValue&&this.varValue!==!1&&this.varValue.className!=e)throw new Error("["+this.varName+"] must be instance of ["+e+"]!");return this},isDataType:function(e){return"S"==e&&this.isString(),"N"==e&&this.isNumber(),"D"==e&&this.isDate(),this},inArray:function(e){if(null!==this.varValue&&void 0!==this.varValue&&this.varValue!==!1&&e.indexOf(this.varValue)<0)throw new Error("["+this.varName+":"+this.varValue+"] must be one of ["+e.join(",")+"]!");return this}},jslet.JSON={normalize:function(e){var t,l=[],i=!1,a=!1,r=!0,n="",s=null,t=e.charAt(0),o=!1;"{"!=t&&"["!=t&&(l.push('{"'),o=!0);for(var d=0,u=e.length;u>d;d++)t=e.charAt(d),s?t==s?(s=null,l.push('"'),n='"'):l.push(t):("["==t&&(a=!0,r=!1),("]"==t||"{"==t)&&(a=!1,r=!0),(!i||" "!=t&&"\b"!=t)&&(!r||"{"!=t&&","!=t?(("{"==n||","==n)&&l.push('"'),i&&"'"==t?l.push('"'):(":"==t&&(i=!1,'"'!=n&&l.push('"')),i||"'"!=t&&'"'!=t?(n=t,l.push(t)):(s=t,l.push('"')))):(i=!0,l.push(t),n=t)));return o&&l.push("}"),l.join("")},parse:function(e){try{return JSON.parse(e)}catch(t){throw new Error(jslet.formatString(jslet.locale.Common.jsonParseError,[e]))}},stringify:function(e,t,l){return JSON.stringify(e,t,l)}},jslet.getFunction=function(e,t){if(!e)return null;if(jQuery.isFunction(e))return e;t||(t=window);var l=t[e];return l||console.warn("NOT found function:"+e),l},jslet.getRemainingString=function(e,t){return e&&t?e.replace(t,""):e},jslet.showError=function(e,t,l){var i;i="string"==typeof e?e:e.message,jslet.ui&&jslet.ui.MessageBox?jslet.ui.MessageBox.error(i,null,t):alert(i)},jslet.showInfo=function(e,t,l){var i;i="string"==typeof e?e:e.message,jslet.ui&&jslet.ui.MessageBox?jslet.ui.MessageBox.alert(i,jslet.locale.MessageBox.Info,t,l):alert(i)},jslet.Clipboard=function(){var e=document.getElementById("jsletClipboard");e||(jQuery('<textarea id="jsletClipboard" style="position:absolute;top:-1000px" tabindex="-1"></textarea>').appendTo(document.body),window.addEventListener("copy",function(e){var t=jQuery("#jsletClipboard").val();return t?(e.clipboardData?e.clipboardData.setData("text/plain",t):window.clipboardData.setData("text",t),jQuery("#jsletClipboard").val(null),e.preventDefault(),!1):void 0}))},jslet.Clipboard.putText=function(e){var t=jQuery("#jsletClipboard").val(e);t[0].select()},jslet.Clipboard(),jslet.getCookie||(jslet.getCookie=function(e){var t=document.cookie.indexOf(e+"="),l=t+e.length+1;if(!t&&e!=document.cookie.substring(0,e.length))return null;if(-1==t)return null;var i=document.cookie.indexOf(";",l);return-1==i&&(i=document.cookie.length),unescape(document.cookie.substring(l,i))}),jslet.setCookie||(jslet.setCookie=function(e,t,l,i,a,r){var n=new Date;n.setTime(n.getTime()),l&&(l=1e3*l*60*60*24);var s=new Date(n.getTime()+l);document.cookie=e+"="+escape(t)+(l?";expires="+s.toGMTString():"")+(i?";path="+i:"")+(a?";domain="+a:"")+(r?";secure":"")}),jslet.deleteCookie||(jslet.deleteCookie=function(e,t,l){getCookie(e)&&(document.cookie=e+"="+(t?";path="+t:"")+(l?";domain="+l:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT")}),jslet.MessageBus=function(){var e={};e[jslet.MessageBus.SIZECHANGED]=[];var t=[];this.sendMessage=function(l,i,a){if(e[l]){var r=t[l];r&&window.clearTimeout(r),r=setTimeout(function(){t[l]=null;for(var a,r=e[l],n=0,s=r.length;s>n;n++)a=r[n],a&&a.onReceiveMessage&&a.onReceiveMessage(l,i)},30),t[l]=r}},this.subscribe=function(t,l){if(!t||!l)throw new Error("MessageName and ctrlObj required!");var i=e[t];i||(i=[],e[t]=i),i.push(l)},this.unsubscribe=function(t,l){var i=e[t];if(i){var a=i.indexOf(l);a>=0&&i.splice(a,1)}}},jslet.MessageBus.SIZECHANGED="SIZECHANGED",jslet.messageBus=new jslet.MessageBus,jQuery(window).on("resize",function(){jslet.messageBus.sendMessage(jslet.MessageBus.SIZECHANGED,null,window)}),jslet.data.ContextRule=function(){var e=this;e._name="",e._description="",e._status=void 0,e._condition=void 0,e._rules=[]},jslet.data.ContextRule.className="jslet.data.ContextRule",jslet.data.ContextRule.prototype={className:jslet.data.ContextRule.className,dataStatus:["insert","update","other"],name:function(e){return void 0===e?this._name:(jslet.Checker.test("ContextRule.name",e).isString(),this._name=jQuery.trim(e),this)},status:function(e){if(void 0===e)return this._status;if(jslet.Checker.test("ContextRule.status",e).isArray(),e)for(var t,l,i=0,a=e.length;a>i;i++)t=jQuery.trim(e[i]),l=jslet.Checker.test("ContextRule.status"+i,t).isString().required(),t=t.toLowerCase(),l.testValue(t).inArray(this.dataStatus),e[i]=t;return this._status=e,this},condition:function(e){return void 0===e?this._condition:(jslet.Checker.test("ContextRule.status",e).isString(),this._condition=jQuery.trim(e),this)},rules:function(e){return void 0===e?this._rules:(jslet.Checker.test("ContextRule.rules",e).isArray(),this._rules=e,this)}},jslet.data.ContextRuleItem=function(e){var t=this;jslet.Checker.test("ContextRule.field",e).isString(),e=jQuery.trim(e),jslet.Checker.test("ContextRule.field",e).required(),t._field=e,t._meta=void 0,t._value=void 0,t._lookup=void 0},jslet.data.ContextRuleItem.className="jslet.data.ContextRuleItem",jslet.data.ContextRuleItem.prototype={className:jslet.data.ContextRuleItem.className,field:function(){return this._field},meta:function(e){return void 0===e?this._meta:(jslet.Checker.test("ContextRuleItem.meta",e).isClass(jslet.data.ContextRuleMeta.className),this._meta=e,this)},lookup:function(e){return void 0===e?this._lookup:(jslet.Checker.test("ContextRuleItem.lookup",e).isClass(jslet.data.ContextRuleLookup.className),this._lookup=e,this)},value:function(e){return void 0===e?this._value:(this._value=e,this)}},jslet.data.ContextRuleMeta=function(){var e=this;e._label=void 0,e._tip=void 0,e._nullText=void 0,e._required=void 0,e._disabled=void 0,e._readOnly=void 0,e._visible=void 0,e._formula=void 0,e._scale=void 0,e._defaultValue=void 0,e._displayFormat=void 0,e._editMask=void 0,e._editControl=void 0,e._range=void 0,e._regularExpr=void 0,e._valueCountLimit=void 0,e._validChars=void 0,e._customValidator=void 0},jslet.data.ContextRuleMeta.className="jslet.data.ContextRuleMeta",jslet.data.ContextRuleMeta.prototype={className:jslet.data.ContextRuleMeta.className,properties:["label","tip","nullText","required","disabled","readOnly","visible","formula","scale","defaultValue","displayFormat","editMask","editControl","range","regularExpr","valueCountLimit","validChars","customValidator"],label:function(e){return void 0===e?this._label:(jslet.Checker.test("ContextRuleMeta.label",e).isString(),this._label=e,this)},tip:function(e){return void 0===e?this._tip:(jslet.Checker.test("ContextRuleMeta.tip",e).isString(),this._tip=e,this)},nullText:function(e){return void 0===e?this._nullText:(jslet.Checker.test("ContextRuleMeta.nullText",e).isString(),this._nullText=jQuery.trim(e),this)},required:function(e){var t=this;return void 0===e?t._required:(t._required=e?!0:!1,this)},visible:function(e){var t=this;return void 0===e?t._visible:(t._visible=e?!0:!1,this)},disabled:function(e){var t=this;return void 0===e?t._disabled:(t._disabled=e?!0:!1,this)},readOnly:function(e){var t=this;return void 0===e?t._readOnly:(t._readOnly=e?!0:!1,this)},editMask:function(e){var t=this;return void 0===e?t._editMask:(t._editMask=e,this)},scale:function(e){var t=this;return void 0===e?t._scale:(jslet.Checker.test("ContextRuleMeta.scale",e).isNumber(),t._scale=parseInt(e),this)},formula:function(e){var t=this;return void 0===e?t._formula:(jslet.Checker.test("ContextRuleMeta.formula",e).isString(),t._formula=jQuery.trim(e),this)},displayFormat:function(e){var t=this;return void 0===e?t._displayFormat:(jslet.Checker.test("ContextRuleMeta.format",e).isString(),t._displayFormat=jQuery.trim(e),this)},editControl:function(e){var t=this;return void 0===e?t._editControl:void(t._editControl="string"==typeof e?{type:e}:e)},defaultValue:function(e){var t=this;return void 0===e?t._defaultValue:(t._defaultValue=e,this)},range:function(e){var t=this;return void 0===e?t._range:(jslet.isString(e)?t._range=new Function("return "+e):t._range=e,this)},regularExpr:function(e){var t=this;return void 0===e?t._regularExpr:(jslet.isString(e)?t._range=new Function("return "+e):t._regularExpr=e,this)},valueCountLimit:function(e){var t=this;return void 0===e?t._valueCountLimit:(jslet.Checker.test("ContextRuleMeta.valueCountLimit",e).isNumber(),t._valueCountLimit=parseInt(e),this)},customValidator:function(e){var t=this;return void 0===e?t._customValidator:(jslet.Checker.test("ContextRuleMeta.customValidator",e).isFunction(),t._customValidator=e,this)},validChars:function(e){var t=this;return void 0===e?t._validChars:(jslet.Checker.test("ContextRuleMeta.validChars",e).isString(),void(t._validChars=jQuery.trim(e)))}},jslet.data.ContextRuleLookup=function(){var e=this;e._dataset=void 0,e._filter=void 0,e._fixedFilter=void 0,e._criteria=void 0,e._displayFields=void 0,e._onlyLeafLevel=void 0},jslet.data.ContextRuleLookup.className="jslet.data.ContextRuleLookup",jslet.data.ContextRuleLookup.prototype={className:jslet.data.ContextRuleLookup.className,properties:["dataset","filter","fixedFilter","criteria","displayFields","onlyLeafLevel"],dataset:function(e){var t=this;return void 0===e?t._dataset:(jslet.Checker.test("ContextRuleLookup.dataset",e).isString(),void(t._dataset=jQuery.trim(e)))},filter:function(e){var t=this;return void 0===e?t._filter:(jslet.Checker.test("ContextRuleLookup.filter",e).isString(),void(t._filter=jQuery.trim(e)))},fixedFilter:function(e){var t=this;return void 0===e?t._fixedFilter:(jslet.Checker.test("ContextRuleLookup.fixedFilter",e).isString(),void(t._fixedFilter=jQuery.trim(e)))},criteria:function(e){var t=this;return void 0===e?t._criteria:(jslet.Checker.test("ContextRuleLookup.criteria",e).isString(),void(t._criteria=jQuery.trim(e)))},displayFields:function(e){var t=this;return void 0===e?t._displayFields:(jslet.Checker.test("ContextRuleLookup.displayFields",e).isString(),void(t._displayFields=jQuery.trim(e)))},onlyLeafLevel:function(e){var t=this;return void 0===e?t._onlyLeafLevel:void(t._onlyLeafLevel=e?!0:!1)}},jslet.data.createContextRule=function(e){function t(e){var t=new jslet.data.ContextRuleItem(e.field);return void 0!==e.meta&&t.meta(l(e.meta)),void 0!==e.value&&t.value(e.value),void 0!==e.lookup&&t.lookup(i(e.lookup)),t}function l(e){var t=new jslet.data.ContextRuleMeta;return void 0!==e.label&&t.label(e.label),void 0!==e.tip&&t.tip(e.tip),void 0!==e.nullText&&t.nullText(e.nullText),void 0!==e.required&&t.required(e.required),void 0!==e.disabled&&t.disabled(e.disabled),void 0!==e.readOnly&&t.readOnly(e.readOnly),void 0!==e.visible&&t.visible(e.visible),void 0!==e.formula&&t.formula(e.formula),void 0!==e.scale&&t.scale(e.scale),void 0!==e.required&&t.required(e.required),
void 0!==e.displayFormat&&t.displayFormat(e.displayFormat),void 0!==e.editMask&&t.editMask(e.editMask),void 0!==e.editControl&&t.editControl(e.editControl),void 0!==e.range&&t.range(e.range),void 0!==e.regularExpr&&t.regularExpr(e.regularExpr),void 0!==e.valueCountLimit&&t.valueCountLimit(e.valueCountLimit),void 0!==e.validChars&&t.validChars(e.validChars),void 0!==e.customValidator&&t.customValidator(e.customValidator),t}function i(e){var t=new jslet.data.ContextRuleLookup;return void 0!==e.dataset&&t.dataset(e.dataset),void 0!==e.filter&&t.filter(e.filter),void 0!==e.fixedFilter&&t.fixedFilter(e.fixedFilter),void 0!==e.criteria&&t.criteria(e.criteria),void 0!==e.displayFields&&t.displayFields(e.displayFields),void 0!==e.onlyLeafLevel&&t.onlyLeafLevel(e.onlyLeafLevel),t}if(!e)return null;var a=new jslet.data.ContextRule;if(void 0!==e.status&&a.status(e.status),void 0!==e.condition&&a.condition(e.condition),void 0!==e.rules){jslet.Checker.test("ContextRule.rules",r).isArray();var r=[];a.rules(r);for(var n=0,s=e.rules.length;s>n;n++)r.push(t(e.rules[n]))}return a},jslet.data.ContextRuleEngine=function(e){this._dataset=e,this._matchedRules=[],this._ruleEnv={}},jslet.data.ContextRuleEngine.prototype={compile:function(){for(var e=this._dataset.contextRules(),t=0,l=e.length;l>t;t++)this._compileOneRule(e[t])},evalStatus:function(){var e=this._dataset.contextRules(),t="other",l=this._dataset.changedStatus();l==jslet.data.DataSetStatus.INSERT?t="insert":l==jslet.data.DataSetStatus.UPDATE&&(t="update"),this._matchedRules=[];for(var i,a,r=0,n=e.length;n>r;r++)i=e[r],a=i.status(),a&&a.indexOf(t)>=0&&this._evalRuleItems(i.rules(),"insert"==t||"update"==t);this._syncMatchedRules()},evalRule:function(e){var t,l=this._dataset.contextRules();this._matchedRules=[],this._ruleEnv={};for(var i=0,a=l.length;a>i;i++)t=l[i],t.status()||this._evalOneRule(t,e);this._syncMatchedRules()},_compileOneRule:function(e){e.condition;this._compileExpr(e,"condition",!0);for(var t=e.rules(),l=0,i=t.length;i>l;l++)this._compileRuleItem(t[l])},_compileRuleItem:function(e){this._compileExpr(e,"value");var t,l,i,a,r=e.meta();if(r)for(t=r.properties,a=t.length,i=0;a>i;i++)l=t[i],this._compileExpr(r,l);var n=e.lookup();if(n)for(t=n.properties,a=t.length,i=0;a>i;i++)l=t[i],this._compileExpr(n,l)},_compileExpr:function(e,t,l){var i=e[t].call(e),a=t+"Expr";null!==i&&void 0!==i&&jslet.isString(i)&&(0===i.indexOf("expr:")&&(i=i.substring(5),l=!0),l&&(e[a]=new jslet.Expression(this._dataset,i)))},_evalOneRule:function(e,t){var l=!1,i=e.conditionExpr,a=null;if(i){if(a=i.mainFields(),t&&a&&a.indexOf(t)<0)return;l=e.conditionExpr.eval()}else l=e.condition();if(l){if(a)for(var r,n=0,s=a.length;s>n;n++)r=a[n],void 0===this._ruleEnv[r]&&(this._ruleEnv[r]=this._dataset.getFieldValue(r));this._evalRuleItems(e.rules(),t?!0:!1)}},_evalRuleItems:function(e,t){for(var l,i,a,r=0,n=e.length;n>r;r++){i=e[r],l=i.field(),a=this._findMatchedRule(l),a||(a=new jslet.data.ContextRuleItem(l));var s=i.meta();s&&(a.meta(new jslet.data.ContextRuleMeta),this._copyProperties(s,a.meta()));var o=i.lookup();o&&(a.lookup(new jslet.data.ContextRuleLookup),this._copyProperties(o,a.lookup())),t&&void 0!==i.value()&&a.value(this._evalExpr(i,"value")),this._matchedRules.push(a)}},_copyProperties:function(e,t){for(var l,i,a=e.properties,r=0,n=a.length;n>r;r++)l=a[r],i=this._evalExpr(e,l),void 0!==i&&t[l].call(t,i)},_evalExpr:function(e,t){var l=e[t+"Expr"];return l?l.eval():e[t].call(e)},_findMatchedRule:function(e){for(var t,l=0,i=this._matchedRules.length;i>l;l++)if(t=this._matchedRules[l],e==t.field())return t;return null},_syncMatchedRules:function(){for(var e,t,l,i=this._matchedRules,a=0,r=i.length;r>a;a++)e=i[a],t=e.field(),l=this._dataset.getField(t),l&&(this._syncMatchedRuleMeta(l,e.meta()),this._syncMatchedRuleLookup(l,e.lookup()),this._syncMatchedRuleValue(l,e.value()))},_syncMatchedRuleMeta:function(e,t){if(t)for(var l,i,a=t.properties,r=0,n=a.length;n>r;r++)l=a[r],i=t[l].call(t),void 0!==i&&e[l].call(e,i)},_syncMatchedRuleLookup:function(e,t){if(t){var l=e.lookup();if(l){var i=t.dataset();i&&l.dataset(i);var a=l.dataset();a.autoRefreshHostDataset(!0);var r=t.filter();if(void 0!==r){for(var n in this._ruleEnv)r=r.replace("${"+n+"}",this._ruleEnv[n]);a.filter(r),a.filtered(!0)}var r=t.fixedFilter();if(void 0!==r){for(var n in this._ruleEnv)r=r.replace("${"+n+"}",this._ruleEnv[n]);a.fixedFilter(r),a.filtered(!0)}var s=t.criteria();void 0!==s&&a.query(s);var o=t.displayFields();void 0!==o&&l.displayFields(o);var d=t.onlyLeafLevel();void 0!==d&&l.onlyLeafLevel(d)}}},_syncMatchedRuleValue:function(e,t){void 0!==t&&e.setValue(t)}},jslet.data.dataModule=new jslet.SimpleMap,jslet.data.getDataset=function(e){return jslet.data.dataModule.get(e)},jslet.data.DatasetType={NORMAL:0,LOOKUP:1,DETAIL:2},jslet.data.onCreatingDataset=function(e,t,l,i){},jslet.data.DataType={NUMBER:"N",STRING:"S",DATE:"D",TIME:"T",BOOLEAN:"B",DATASET:"V",CROSS:"C"},jslet.data.FieldValueStyle={NORMAL:0,BETWEEN:1,MULTIPLE:2},jslet.data.EditMask=function(e,t,l){this.mask=e,this.keepChar=void 0!==t?t:!0,this.transform=l,this.clone=function(){return new jslet.data.EditMask(this.mask,this.keepChar,this.transform)}},jslet.data.DatasetEvent={BEFORESCROLL:"beforeScroll",AFTERSCROLL:"afterScroll",BEFOREINSERT:"beforeInsert",AFTERINSERT:"afterInsert",BEFOREUPDATE:"beforeUpdate",AFTERUPDATE:"afterUpdate",BEFOREDELETE:"beforeDelete",AFTERDELETE:"afterDelete",BEFORECONFIRM:"beforeConfirm",AFTERCONFIRM:"afterConfirm",BEFORECANCEL:"beforeCancel",AFTERCANCEL:"afterCancel",BEFORESELECT:"beforeSelect",AFTERSELECT:"afterSelect"},jslet.data.DataSetStatus={BROWSE:0,INSERT:1,UPDATE:2,DELETE:3},jslet.data.RefreshEvent={updateRecordEvent:function(e){return{eventType:jslet.data.RefreshEvent.UPDATERECORD,fieldName:e}},updateColumnEvent:function(e){return{eventType:jslet.data.RefreshEvent.UPDATECOLUMN,fieldName:e}},updateAllEvent:function(){return this._updateAllEvent},changeMetaEvent:function(e,t,l){var i={eventType:jslet.data.RefreshEvent.CHANGEMETA,metaName:e,fieldName:t};return void 0!==l&&(i.changeAllRows=l),i},beforeScrollEvent:function(e){return{eventType:jslet.data.RefreshEvent.BEFORESCROLL,recno:e}},scrollEvent:function(e,t){return{eventType:jslet.data.RefreshEvent.SCROLL,prevRecno:t,recno:e}},insertEvent:function(e,t,l){return{eventType:jslet.data.RefreshEvent.INSERT,prevRecno:e,recno:t,updateAll:l}},deleteEvent:function(e){return{eventType:jslet.data.RefreshEvent.DELETE,recno:e}},selectRecordEvent:function(e,t){return{eventType:jslet.data.RefreshEvent.SELECTRECORD,recno:e,selected:t}},selectAllEvent:function(e){return{eventType:jslet.data.RefreshEvent.SELECTALL,selected:e}},changePageEvent:function(){return this._changePageEvent},errorEvent:function(e){return{eventType:jslet.data.RefreshEvent.ERROR,message:e}},lookupEvent:function(e,t){return{eventType:jslet.data.RefreshEvent.UPDATELOOKUP,fieldName:e,recno:t}},aggradedEvent:function(){return{eventType:jslet.data.RefreshEvent.AGGRADED}}},jslet.data.RefreshEvent.CHANGEMETA="changeMeta",jslet.data.RefreshEvent.UPDATEALL="updateAll",jslet.data.RefreshEvent.UPDATERECORD="updateRecord",jslet.data.RefreshEvent.UPDATECOLUMN="updateColumn",jslet.data.RefreshEvent.BEFORESCROLL="beforescroll",jslet.data.RefreshEvent.SCROLL="scroll",jslet.data.RefreshEvent.SELECTRECORD="selectRecord",jslet.data.RefreshEvent.SELECTALL="selectAll",jslet.data.RefreshEvent.INSERT="insert",jslet.data.RefreshEvent.DELETE="delete",jslet.data.RefreshEvent.CHANGEPAGE="changePage",jslet.data.RefreshEvent.UPDATELOOKUP="updateLookup",jslet.data.RefreshEvent.AGGRADED="aggraded",jslet.data.RefreshEvent.ERROR="error",jslet.data.RefreshEvent._updateAllEvent={eventType:jslet.data.RefreshEvent.UPDATEALL},jslet.data.RefreshEvent._changePageEvent={eventType:jslet.data.RefreshEvent.CHANGEPAGE},jslet.data.FieldValidator=function(){},jslet.data.FieldValidator.prototype={intRegular:{expr:/^(-)?[1-9]*\d+$/gi},floatRegular:{expr:/((^-?[1-9])|\d)\d*(\.[0-9]*)?$/gi},checkInputChar:function(e,t,l,i){var a=e.validChars(),r=!0;if(a&&t){var n=t.charAt(0);r=a.indexOf(n)>=0}if(l&&r&&e.getType()==jslet.data.DataType.NUMBER){var s=e.scale(),o=l.lastIndexOf(".");if("."==t)return o>=0?!1:!0;if(s>0&&o>=0&&l.length-o-1===s&&i-1>o)return!1}return r},checkInputText:function(e,t){var l=this.checkRequired(e,t);if(l)return l;if(""===t)return null;var i=e.getType(),a=e.regularExpr();if(a||(i==jslet.data.DataType.DATE?a=e.dateRegular():i==jslet.data.DataType.NUMBER&&(this.intRegular.message||(this.intRegular.message=jslet.locale.Dataset.invalidInt,this.floatRegular.message=jslet.locale.Dataset.invalidFloat),a=e.scale()?this.floatRegular:this.intRegular)),a){var r=a.expr;if("string"==typeof r&&(r=new RegExp(a.expr,"ig")),r.lastIndex=0,!r.test(t))return a.message}var n=t;if(!e.lookup()){if(i==jslet.data.DataType.NUMBER){var s=e.scale()||0,o=e.length();if(0===s)n=parseInt(t);else{var d=t.indexOf("."),u=d>0?d:t.length,c=o-s;if(u>c)return jslet.formatString(jslet.locale.Dataset.invalidIntegerPart,[c,u]);if(u=d>0?t.length-d-1:0,u>s)return jslet.formatString(jslet.locale.Dataset.invalidDecimalPart,[s,u]);n=parseFloat(t)}}i==jslet.data.DataType.DATE&&(n=jslet.parseDate(t,e.displayFormat()))}return this.checkValue(e,n)},checkRequired:function(e,t){if(e.required()){var l=!0;return(null===t||void 0===t)&&(l=!1),l&&jslet.isString(t)&&0===jQuery.trim(t).length&&(l=!1),l&&jslet.isArray(t)&&0===t.length&&(l=!1),e.getType()!==jslet.data.DataType.BOOLEAN||t||(l=!1),l?null:jslet.formatString(jslet.locale.Dataset.fieldValueRequired,[e.label()])}return null},checkValue:function(e,t){var l=e.getType(),i=e.dataRange(),a=e.lookup()?!0:!1;if(a&&(t=e.dataset().getFieldText(e.name(),!0)),i){var r=i.min,n=r,s=i.max,o=s,d=e.displayFormat();if(l==jslet.data.DataType.DATE&&(r&&(n=jslet.formatDate(r,d)),s&&(o=jslet.formatDate(s,d))),a||l!=jslet.data.DataType.NUMBER||(n=jslet.formatNumber(r,d),o=jslet.formatNumber(s,d)),void 0!==r&&void 0!==s&&(r>t||t>s))return jslet.formatString(jslet.locale.Dataset.notInRange,[n,o]);if(void 0!==r&&void 0===s&&r>t)return jslet.formatString(jslet.locale.Dataset.moreThanValue,[n]);if(void 0===r&&void 0!==s&&t>s)return jslet.formatString(jslet.locale.Dataset.lessThanValue,[o])}if(e.unique()){var u=e.dataset(),c=u.dataList();if(null!==t&&void 0!==t&&c&&c.length>1)for(var h,f=u.getRecord(),v=e.name(),p=0,_=c.length;_>p;p++)if(h=c[p],h!==f&&h[v]==t)return jslet.locale.Dataset.notUnique}return e.customValidator()?e.customValidator().call(e.dataset(),e,t):null}},jslet.data.FieldValueConverter=jslet.Class.create({className:"jslet.data.FieldValueConverter",textToValue:function(e,t){var l=t;return l},valueToText:function(e,t,l){var i=t;return i}}),jslet.data.FieldValueConverter.className="jslet.data.FieldValueConverter",jslet.data.NumberValueConverter=jslet.Class.create(jslet.data.FieldValueConverter,{textToValue:function(e,t){var l=null;return t&&(l=0===e.scale()?parseInt(t):parseFloat(t)),l},valueToText:function(e,t,l){var i=this;if(e.unitConverted()&&(t*=i._unitConvertFactor),l)return t;var a=jslet.formatNumber(t,e.displayFormat());return e.unitConverted()&&i._unitName&&(a+=i._unitName),a}}),jslet.data.DateValueConverter=jslet.Class.create(jslet.data.FieldValueConverter,{textToValue:function(e,t){var l=jslet.parseDate(t,e.displayFormat());return l},valueToText:function(e,t,l){if(!(t instanceof Date))throw new Error(jslet.formatString(jslet.locale.Dataset.invalidDateFieldValue,[e.name()]));return t?jslet.formatDate(t,e.displayFormat()):""}}),jslet.data.StringValueConverter=jslet.Class.create(jslet.data.FieldValueConverter,{textToValue:function(e,t){var l=t;return e.antiXss()&&(l=jslet.htmlEncode(l)),l}}),jslet.data.BooleanValueConverter=jslet.Class.create(jslet.data.FieldValueConverter,{textToValue:function(e,t){return t?"true"==t.toLowerCase():!1},valueToText:function(e,t,l){return t?e.trueText():e.falseText()}}),jslet.data.LookupValueConverter=jslet.Class.create(jslet.data.FieldValueConverter,{textToValue:function(e,t,l){if(!t)return null;var i="",a=e.lookup(),r=a.dataset();if(i=r._convertFieldValue(a.codeField(),t,a.keyField()),null===i){var n=jslet.formatString(jslet.locale.Dataset.valueNotFound);return e.dataset().setFieldError(e.name(),n,l,t),void r.first()}if(e.valueStyle()===jslet.data.FieldValueStyle.NORMAL){var s=a.returnFieldMap(),o=a.dataset();if(mainDs=this,o.findByKey(i)){var d,u;for(var d in s)u=s[d],mainDs.setFieldValue(d,o.getFieldValue(u))}}return i},valueToText:function(e,t,l){var i,a=e.lookup(),r=a.dataset();return i=l?r._convertFieldValue(a.keyField(),t,"["+a.codeField()+"]"):r._convertFieldValue(a.keyField(),t,a.displayFields())}}),jslet.data._valueConverters={},jslet.data._valueConverters[jslet.data.DataType.NUMBER]=new jslet.data.NumberValueConverter,jslet.data._valueConverters[jslet.data.DataType.STRING]=new jslet.data.StringValueConverter,jslet.data._valueConverters[jslet.data.DataType.DATE]=new jslet.data.DateValueConverter,jslet.data._valueConverters[jslet.data.DataType.BOOLEAN]=new jslet.data.BooleanValueConverter,jslet.data._valueConverters.lookup=new jslet.data.LookupValueConverter,jslet.data.getValueConverter=function(e){return e.lookup()?jslet.data._valueConverters.lookup:jslet.data._valueConverters[e.getType()]},jslet.data.record2Json=function(e,t){function l(e,l){if("_jl_"==e)return void 0;if(t)for(var i,a=0,r=t.length;r>a;a++)if(i=t[a],e==i)return void 0;return l}return window.JSON&&JSON?(t&&jslet.Checker.test("record2Json#excludeFields",t).isArray(),JSON.stringify(e,l)):void alert("Your browser does not support JSON!")},jslet.data.getRecInfo=function(e){if(!e)return null;var t=e._jl_;return t||(t={},e._jl_=t),t},jslet.data.FieldValueCache={put:function(e,t,l,i){var a=jslet.data.getRecInfo(e),r=a.cache;if(r||(r={},e._jl_.cache=r),i||0===i){var n=r[t];n&&jslet.isObject(n)||(n={},r[t]=n),n[i+""]=l}else r[t]=l},get:function(e,t,l){var i=jslet.data.getRecInfo(e),a=i.cache;if(a){if(l||0===l){var r=a[t];return r&&jslet.isObject(r)?r[l+""]:void 0}return a[t]}return void 0},clear:function(e,t){var l=jslet.data.getRecInfo(e),i=l.cache;i&&delete i[t]},clearAll:function(e,t){var l=e.dataList();if(l)for(var i,a,r,n=0,s=l.length;s>n;n++){i=l[n];var r=jslet.data.getRecInfo(i),a=r.cache;a&&delete a[t]}},removeCache:function(e){var t=jslet.data.getRecInfo(e);delete t.cache},removeAllCache:function(e){var t=e.dataList();if(t)for(var l,i,a=0,r=t.length;r>a;a++)l=t[a],l&&(i=jslet.data.getRecInfo(l),delete i.cache)}},jslet.data.FieldError={put:function(e,t,l,i,a){if(!l)return void jslet.data.FieldError.clear(e,t,i);var r=jslet.data.getRecInfo(e),n=r.error;n||(n={},r.error=n);var s=n[t];s||(s={},n[t]=s);var o={message:l};void 0!==a&&(o.inputText=a),i||(i=0),s[i+""]=o},putDetailError:function(e,t,l){var i=jslet.data.getRecInfo(e),a=i.error;a||(a={},i.error=a);var r=a[t];r||(r={},a[t]=r),valueIndex||(valueIndex=0);var n=r[valueIndex+""];n||(n={errorCount:0},r[valueIndex+""]=n),n.errorCount+=l,n.errorCount<=0&&jslet.data.FieldError.clear(e,t)},get:function(e,t,l){var i=jslet.data.getRecInfo(e),a=i.error;if(a){var r=a[t];return r?(l||(l=0),r[l+""]):null}return null},clear:function(e,t,l){var i=jslet.data.getRecInfo(e),a=i.error;if(a){var r=a[t];if(!r)return;l||(l=0),delete r[l+""];var n=!1;for(var s in r){foutnd=!0;break}n||delete a[t]}},existFieldError:function(e,t,l){var i=jslet.data.getRecInfo(e),a=i.error;if(a){var r=a[t];return r?(l||(l=0),r[l+""]?!0:!1):!1}return!1},existRecordError:function(e){var t=jslet.data.getRecInfo(e);if(!t)return!1;var l=t.error;if(l)for(var i in l)if(l[i])return!0;return!1},clearFieldError:function(e,t){var l=e.dataList();if(l)for(var i,a,r,n=0,s=l.length;s>n;n++){i=l[n];var r=jslet.data.getRecInfo(i),a=r.error;a&&delete a[t]}},clearRecordError:function(e){var t=jslet.data.getRecInfo(e);t&&delete t.error},clearDatasetError:function(e){var t=e.dataList();if(t)for(var l,i,a=0,r=t.length;r>a;a++)l=t[a],i=jslet.data.getRecInfo(l),delete i.error}},jslet.data.DatasetRelationManager=function(){var e=[];this.addRelation=function(t,l,i,a){for(var r=0,n=e.length;n>r;r++){var s=e[r];if(s.hostDataset==t&&s.hostField==l&&s.lookupDataset==i)return}if(e.push({hostDataset:t,hostField:l,lookupOrDetailDataset:i,relationType:a}),a==jslet.data.DatasetType.DETAIL){var o=jslet.data.getDataset(i);if(o){var d=this.getHostFieldObject(i);d&&o.datasetField(d)}}},this.removeRelation=function(t,l,i){for(var a=e.length-1;a>=0;a--){var r=e[a];r.hostDataset==t&&r.hostField==l&&r.lookupOrDetailDataset==i&&e.splice(a,1)}},this.removeDataset=function(t){for(var l=e.length-1;l>=0;l--){var i=e[l];(i.hostDataset==t||i.lookupOrDetailDataset==t)&&e.splice(l,1)}},this.changeDatasetName=function(t,l){if(t&&l)for(var i=0,a=e.length;a>i;i++){var r=e[i];r.hostDataset==t&&(r.hostDataset=l),r.lookupOrDetailDataset==t&&(r.lookupOrDetailDataset=l)}},this.refreshLookupHostDataset=function(t){for(var l,i,a=0,r=e.length;r>a;a++)if(l=e[a],l.lookupOrDetailDataset==t&&l.relationType==jslet.data.DatasetType.LOOKUP){if(i=jslet.data.getDataset(l.hostDataset),!i)throw new Error("NOT found Host dataset: "+l.hostDataset);i.handleLookupDatasetChanged(l.hostField)}},this.getHostFieldObject=function(t){for(var l,i,a=0,r=e.length;r>a;a++)if(l=e[a],l.lookupOrDetailDataset==t&&l.relationType==jslet.data.DatasetType.DETAIL){if(i=jslet.data.getDataset(l.hostDataset))return i.getField(l.hostField);throw new Error("NOT found Host dataset: "+l.hostDataset)}}},jslet.data.datasetRelationManager=new jslet.data.DatasetRelationManager,jslet.data.convertDateFieldValue=function(e,t){var l=e;if(t||(t=l.dataList()),t&&0!==t.length){for(var i,a=[],r=[],n=l.getNormalFields(),s=0,o=n.length;o>s;s++)i=n[s],i.getType()==jslet.data.DataType.DATE&&a.push(i.name()),i.getType()==jslet.data.DataType.DATASET&&r.push(i);if(0!==a.length||0!==r.length)for(var d,u,c,h=a.length,f=r.length,s=0,v=t.length;v>s;s++){d=t[s];for(var p=0;h>p;p++)if(u=a[p],c=d[u],!jslet.isDate(c)){if(c=jslet.parseDate(c,"yyyy-MM-ddThh:mm:ss"),!c)throw new Error(jslet.formatString(jslet.locale.Dataset.invalidDateFieldValue,[fldName]));d[u]=c}for(var p=0;f>p;p++)i=r[p],u=i.name(),jslet.data.convertDateFieldValue(i.subDataset(),d[u])}}},jslet.emptyPromise={done:function(e){return e&&e(),this},fail:function(e){return e&&e(),this},always:function(e){return e&&e(),this}},jslet.data.displayOrderComparator=function(e,t){return e.displayOrder()-t.displayOrder()},jslet.data.DataSelection=function(e){this._dataset=e,this._selection=[],this._onChanged},jslet.data.DataSelection.prototype={selectAll:function(e,t){if(jslet.Checker.test("DataSelection.add#fields",e).isArray(),this.removeAll(),!e){var l,i=this._dataset.getNormalFields();e=[];for(var a=0,r=i.length;r>a;a++)l=i[a].name(),e.push(l)}this.add(0,this._dataset.recordCount()-1,e,t)},removeAll:function(){this._selection=[]},add:function(e,t,l,i){jslet.Checker.test("DataSelection.add#startRecno",e).required().isNumber(),jslet.Checker.test("DataSelection.add#endRecno",t).required().isNumber(),jslet.Checker.test("DataSelection.add#fields",l).required().isArray(),void 0===t&&(t=e);for(var a,r=e;t>=r;r++)for(var n=0,s=l.length;s>n;n++)a=l[n],this._selectCell(r,a,!0);i&&this._onChanged&&this._onChanged(e,t,l,!0)},remove:function(e,t,l,i){if(jslet.Checker.test("DataSelection.remove#startRecno",e).required().isNumber(),jslet.Checker.test("DataSelection.remove#endRecno",t).required().isNumber(),jslet.Checker.test("DataSelection.remove#fields",l).required().isArray(),void 0===t&&(t=e),e>t){var a=e;e=t,t=a}for(var r,n=e;t>=n;n++)for(var s=0,o=l.length;o>s;s++)r=l[s],this._selectCell(n,r,!1);i&&this._onChanged&&this._onChanged(e,t,l,!1)},onChanged:function(e){return void 0===e?this._onChanged:(jslet.Checker.test("DataSelection.onChanged",e).isFunction(),void(this._onChanged=e))},isSelected:function(e,t){jslet.Checker.test("DataSelection.isSelected#recno",e).required().isNumber(),jslet.Checker.test("DataSelection.isSelected#fldName",t).required().isString();for(var l,i=0,a=this._selection.length;a>i;i++)if(l=this._selection[i],l._recno_===e&&l[t])return!0;return!1},getSelectionText:function(e){e||(e="	");var t,l,i,a=this._dataset,r=[],n=a.startSilenceMove(),s=a.getNormalFields(),o=s.length,d="";try{for(a.first();!a.isEof();){for(var u=0;o>u;u++)l=s[u],t=l.name(),this.isSelected(a.recno(),t)&&("N"!==l.getType()||l.lookup()?(i=a.getFieldText(t),(null===i||void 0===i)&&(i="")):i=l.getValue(),d+=i+e);d&&r.push(d),d="",a.next()}}finally{a.endSilenceMove(n)}return r.length>0?r.join("\n"):null},_selectCell:function(e,t,l){var i;found=!1;for(var a=0,r=this._selection.length;r>a;a++)i=this._selection[a],i._recno_===e&&(found=!0,i[t]=l);l&&!found&&(i={_recno_:e},i[t]=!0,this._selection.push(i))}},jslet.data.GlobalDataHandler=function(){var e=this;e._datasetMetaChanged=null,e._fieldMetaChanged=null,e._fieldValueChanged=null},jslet.data.GlobalDataHandler.prototype={datasetCreated:function(e){var t=this;return void 0===e?t._datasetCreated:(jslet.Checker.test("globalDataHandler.datasetCreated",e).isFunction(),void(t._datasetCreated=e))},datasetMetaChanged:function(e){var t=this;return void 0===e?t._datasetMetaChanged:(jslet.Checker.test("globalDataHandler.datasetMetaChanged",e).isFunction(),void(t._datasetMetaChanged=e))},fieldMetaChanged:function(e){var t=this;return void 0===e?t._fieldMetaChanged:(jslet.Checker.test("globalDataHandler.fieldMetaChanged",e).isFunction(),void(t._fieldMetaChanged=e))},fieldValueChanged:function(e){var t=this;return void 0===e?t._fieldValueChanged:(jslet.Checker.test("globalDataHandler.fieldValueChanged",e).isFunction(),void(t._fieldValueChanged=e))}},jslet.data.globalDataHandler=new jslet.data.GlobalDataHandler,jslet.data.Dataset=function(e){var t=this;t._name=null,t._recordClass=jslet.global.defaultRecordClass,t._dataList=null,t._oriDataList=null,t._fields=[],t._oriFields=null,t._normalFields=[],t._recno=-1,t._filteredRecnoArray=null,t._unitConvertFactor=1,t._unitName=null,t._aborted=!1,t._status=0,t._subDatasetFields=null,t._fixedFilter=null,t._filter=null,t._filtered=!1,t._innerFilter=null,t._findCondition=null,t._innerFindCondition=null,t._innerFormularFields=null,t._bof=!1,t._eof=!1,t._igoreEvent=!1,t._logChanges=!0,t._modiObject=null,t._inputtingRecord={},t._lockCount=0,t._fixedIndexFields=null,t._innerFixedIndexFields=[],t._indexFields="",t._innerIndexFields=[],t._sortingFields=null,t._convertDestFields=null,t._innerConvertDestFields=null,t._masterDataset=null,t._detailDatasets=null,t._datasetField=null,t._linkedControls=[],t._linkedLabels=[],t._silence=0,t._keyField=null,t._codeField=null,t._nameField=null,t._parentField=null,t._levelOrderField=null,t._selectField=null,t._contextRules=null,t._contextRuleEngine=null,t._contextRuleEnabled=!1,t._dataProvider=jslet.data.DataProvider?new jslet.data.DataProvider:null,t._queryCriteria=null,t._queryUrl=null,t._submitUrl=null,t._pageSize=500,t._pageNo=0,t._pageCount=0,t._ignoreFilter=!1,t._ignoreFilterRecno=0,t._fieldValidator=new jslet.data.FieldValidator,t._onFieldChanged=null,t._onCheckSelectable=null,t._datasetListener=null,t._designMode=!1,t._autoShowError=!0,t._autoRefreshHostDataset=!1,t._readOnly=!1,t._aggradedValues=null,t._afterScrollDebounce=jslet.debounce(t._innerAfterScrollDebounce,30),t._onlyChangedSubmitted=!1,t.selection=new jslet.data.DataSelection(t),t._changeLog=new jslet.data.ChangeLog(t),t._dataTransformer=new jslet.data.DataTransformer(t),t._followedValue=null,t._lastFindingValue=null,t._inContextRule=!1,t._errRecordCount=0,this.name(e)},jslet.data.Dataset.className="jslet.data.Dataset",jslet.data.Dataset.prototype={className:jslet.data.Dataset.className,name:function(e){var t=this;if(void 0===e)return t._name;jslet.Checker.test("Dataset.name",e).required().isString(),e=jQuery.trim(e);var l=this._name;return l&&(jslet.data.dataModule.unset(l),jslet.data.datasetRelationManager.changeDatasetName(l,e)),jslet.data.dataModule.unset(e),jslet.data.dataModule.set(e,this),this._name=e,t._datasetField=jslet.data.datasetRelationManager.getHostFieldObject(e),this},recordClass:function(e){var t=this;return void 0===e?t._recordClass:(jslet.Checker.test("Dataset.recordClass",e).isString(),t._recordClass=e?e.trim():null,this)},clone:function(e,t){var l=this;e||(e=l._name+"_clone");var i=new jslet.data.Dataset(e);i._datasetListener=l._datasetListener,i._unitConvertFactor=l._unitConvertFactor,i._unitName=l._unitName,i._fixedFilter=l._fixedFilter,i._filter=l._filter,i._filtered=l._filtered,i._logChanges=l._logChanges,i._fixedIndexFields=l._fixedIndexFields,i._indexFields=l._indexFields,i._onlyChangedSubmitted=l._onlyChangedSubmitted;var a=l._keyField,r=l._codeField,n=l._nameField,s=l._parentField,o=l._levelOrderField,d=l._selectField;t&&(a=a&&t.indexOf(a)>=0?a:null,r=r&&t.indexOf(r)>=0?r:null,n=n&&t.indexOf(n)>=0?n:null,s=s&&t.indexOf(s)>=0?s:null,o=o&&t.indexOf(o)>=0?o:null,d=d&&t.indexOf(d)>=0?d:null),i._keyField=a,i._codeField=r,i._nameField=n,i._parentField=s,i._levelOrderField=o,i._selectField=d,i._contextRules=l._contextRules;for(var u,c,h=0,f=l._fields.length;f>h;h++)u=l._fields[h],c=u.name(),t&&t.indexOf(c)<0||i.addField(u.clone(c,i));return i},cloneRecord:function(e,t){for(var l,i,a,r,n=t||{},s=this.getNormalFields(),o=0,d=s.length;d>o;o++)if(i=s[o],l=i.name(),a=e[l],void 0!==a){if(a&&jslet.isArray(a)){r=[];for(var u=0,c=a.length;c>u;u++)r.push(a[u])}else r=a;n[l]=r}return jslet.data.FieldValueCache.removeCache(n),n},addFieldFromDataset:function(e,t){jslet.Checker.test("Dataset.addFieldFromDataset#srcDataset",e).required().isClass(jslet.data.Dataset.className),jslet.Checker.test("Dataset.addFieldFromDataset#fieldNames",t).isArray();for(var l,i,a=e.getFields(),r=0,n=a.length;n>r;r++)l=a[r],i=l.name(),t&&t.indexOf(i)<0||this.addField(l.clone(i,this))},readOnly:function(e){var t=this;if(void 0===e)return t._readOnly;t._readOnly=e?!0:!1;for(var l,i=t.getNormalFields(),a=0,r=i.length;r>a;a++)l=i[a],l._fireMetaChangedEvent("readOnly",!0);return this},onlyChangedSubmitted:function(e){return void 0===e?this._onlyChangedSubmitted:void(this._onlyChangedSubmitted=e?!0:!1)},pageSize:function(e){return void 0===e?this._pageSize:(jslet.Checker.test("Dataset.pageSize#pageSize",e).isGTZero(),this._pageSize=e,this)},pageNo:function(e){return void 0===e?this._pageNo:(jslet.Checker.test("Dataset.pageNo#pageNo",e).isGTZero(),this._pageNo=e,this)},pageCount:function(){return this._pageCount},designMode:function(e){return void 0===e?this._designMode:(this._designMode=e?!0:!1,this)},autoShowError:function(e){return void 0===e?this._autoShowError:(this._autoShowError=e?!0:!1,this)},autoRefreshHostDataset:function(e){return void 0===e?this._autoRefreshHostDataset:(this._autoRefreshHostDataset=e?!0:!1,this)},unitConvertFactor:function(e,t){var l=this;if(0===arguments.length)return l._unitConvertFactor;jslet.Checker.test("Dataset.unitConvertFactor#factor",e).isGTZero(),jslet.Checker.test("Dataset.unitConvertFactor#unitName",t).isString(),e>0?l._unitConvertFactor=e:l._unitConvertFactor=1,l._unitName=t;for(var i,a=0,r=l._normalFields.length;r>a;a++)if(i=l._normalFields[a],i.getType()==jslet.data.DataType.NUMBER&&i.unitConverted()){var n=i.name();jslet.data.FieldValueCache.clearAll(l,n);var s=jslet.data.RefreshEvent.updateColumnEvent(n);l.refreshControl(s)}return l},datasetListener:function(e){return 0===arguments.length?this._datasetListener:(this._datasetListener=e,this)},onCheckSelectable:function(e){return void 0===e?this._onCheckSelectable:(this._onCheckSelectable=e,this)},fieldValidator:function(){return this._fieldValidator},onFieldChanged:function(e){return void 0===e?this._onFieldChanged:(this._onFieldChanged=e,this)},onFieldChange:function(e){return void 0===e?this._onFieldChanged:(this._onFieldChanged=e,this)},getFields:function(){return this._fields},getNormalFields:function(){return this._normalFields},getEditableFields:function(){for(var e,t=this._normalFields,l=[],i=0,a=t.length;a>i;i++)e=t[i],!e.visible()||e.disabled()||e.readOnly()||l.push(e.name());return l},setVisibleFields:function(e){if(jslet.Checker.test("Dataset.setVisibleFields#fieldNameArray",e).isArray(),this._travelField(this._fields,function(e){return e.visible(!1),!1}),e)for(var t=0,l=e.length;l>t;t++){var i=jQuery.trim(e[t]),a=this.getField(i);a&&a.visible(!0)}},_travelField:function(e,t){if(t&&e){for(var l=!1,i=0,a=e.length;a>i;i++){var r=e[i];if(l=t(r))break;var n=r.children();if(n&&n.length>0&&(l=this._travelField(r.children(),t)))break}return l}},_cacheNormalFields:function(){var e=this._normalFields=[];this._travelField(this._fields,function(t){var l=t.children();return l&&0!==l.length||e.push(t),!1})},datasetField:function(e){return void 0===e?this._datasetField:(jslet.Checker.test("Dataset.datasetField#fldObj",e).isClass(jslet.data.Field.className),this._datasetField=e,this)},addField:function(e){function t(e){var i=e.children();if(!i||0===i.length)return void l.addInnerFormulaField(e.name(),e.formula());for(var a=0,r=i.length;r>a;a++)t(i[a])}jslet.Checker.test("Dataset.addField#fldObj",e).required().isClass(jslet.data.Field.className);var l=this,i=e.name();l.getField(i)&&l.removeField(i),l._fields.push(e),e.dataset(l);var a=e.displayOrder();return a?l._fields.sort(jslet.data.displayOrderComparator):e.displayOrder(l._fields.length-1),e.getType()==jslet.data.DataType.DATASET&&(l._subDatasetFields||(l._subDatasetFields=[]),l._subDatasetFields.push(e)),l._cacheNormalFields(),t(e),l},refreshDisplayOrder:function(){this._fields.sort(jslet.data.displayOrderComparator),this._cacheNormalFields()},moveField:function(e,t){var l=this,i=l.getField(e),a=l.getField(t),r=i.parent(),n=a.parent();if(i&&a&&r==n){var s;s=r?r.children():l._fields;var o,d=(i.displayOrder(),a.displayOrder(),s.indexOf(i)),u=s.indexOf(a),c=l.designMode();l.designMode(!1);try{if(i.displayOrder(a.displayOrder()),u>d)for(var h=d+1;u>=h;h++)o=s[h],o.displayOrder(o.displayOrder()-1);else for(var h=u;d>h;h++)o=s[h],o.displayOrder(o.displayOrder()+1)}finally{l.designMode(c)}if(l.refreshDisplayOrder(),l.designMode()){var f=jslet.data.globalDataHandler.fieldMetaChanged();f&&f.call(this,l,null,"displayOrder")}}},removeField:function(e){function t(e){var i=e.children();if(!i||0===i.length)return void l.removeInnerFormulaField(e.name());for(var a=0,r=i.length;r>a;a++)t(i[a])}jslet.Checker.test("Dataset.removeField#fldName",e).required().isString(),e=jQuery.trim(e);var l=this,i=l.getField(e);if(i){if(i.getType()==jslet.data.DataType.DATASET){var a=l._subDatasetFields.indexOf(i);a>=0&&l._subDatasetFields.splice(a,1)}var r=l._fields.indexOf(i);l._fields.splice(r,1),i.dataset(null),l.removeInnerFormulaField(e),l._cacheNormalFields(),jslet.data.FieldValueCache.clearAll(l,e),t(i)}return l},getField:function(e){jslet.Checker.test("Dataset.getField#fldName",e).isString().required(),e=jQuery.trim(e);var t=e.split("."),l=t[0],i=null;if(this._travelField(this._fields,function(e){var t=!1;return e.name()==l&&(i=e,t=!0),t}),!i)return null;if(1==t.length)return i;t.splice(0,1);var a=i.lookup();if(a){var r=a.dataset();if(r)return r.getField(t.join("."))}else{var n=i.subDataset();if(n)return n.getField(t.join("."))}return null},getTopField:function(e){jslet.Checker.test("Dataset.getField#fldName",e).isString().required(),e=jQuery.trim(e);var t=this.getField(e);if(t)for(;;){if(null===t.parent())return t;t=t.parent()}return null},sortFunc:function(e,t){for(var l,i,a=jslet.temp.sortDataset,r=a._sortingFields,n=[],s=0,o=r.length;o>s;s++)i=r[s],l=i.fieldName,(i.useTextToSort||a.getField(l).getType()===jslet.data.DataType.STRING)&&n.push(l);for(var d,u,c=1,s=0,o=r.length;o>s;s++)if(i=r[s],l=i.fieldName,i.useTextToSort?(d=a.getFieldTextByRecord(e,l),u=a.getFieldTextByRecord(t,l)):(d=a.getFieldValueByRecord(e,l),u=a.getFieldValueByRecord(t,l)),d!=u)return null!==d&&null!==u?n.indexOf(l)>=0?(d=d.toLowerCase(),u=u.toLowerCase(),c=d.localeCompare(u)<0?-1:1):c=u>d?-1:1:null===d&&null!==u?c=-1:null!==d&&null===u&&(c=1),c*i.order;return 0},fixedIndexFields:function(e){var t=this;if(void 0===e)return t._fixedIndexFields;jslet.Checker.test("Dataset.fixedIndexFields",e).isString(),
t._fixedIndexFields=e,t._innerFixedIndexFields=e?t._parseIndexFields(e):[];for(var l,i,a=t._innerIndexFields.length-1;a>=0;a--){l=t._innerIndexFields[a];for(var r=0,n=t._innerFixedIndexFields.length;n>r;r++)i=t._innerFixedIndexFields[r],l.fieldName===i.fieldName&&t._innerIndexFields.splice(a,1)}return t._sortByFields(),this},indexFields:function(e){var t=this;if(void 0===e)return t._indexFields;if(jslet.Checker.test("Dataset.indexFields",e).isString(),e=jQuery.trim(e),!e&&!t._indexFields&&!t._fixedIndexFields)return this;t._indexFields=e,t._innerIndexFields=e?t._parseIndexFields(e):[];for(var l,i,a=t._innerIndexFields.length-1;a>=0;a--){l=t._innerIndexFields[a];for(var r=0,n=t._innerFixedIndexFields.length;n>r;r++)i=t._innerFixedIndexFields[r],l.fieldName===i.fieldName&&(i.order=l.order,t._innerIndexFields.splice(a,1))}return t._sortByFields(),this},mergedIndexFields:function(){for(var e=this,t=[],l=0,i=e._innerFixedIndexFields.length;i>l;l++)t.push(e._innerFixedIndexFields[l]);for(var l=0,i=e._innerIndexFields.length;i>l;l++)t.push(e._innerIndexFields[l]);return t},toggleIndexField:function(e,t){for(var l,i=this,a=!1,r=i._innerFixedIndexFields.length-1;r>=0;r--)if(l=i._innerFixedIndexFields[r],l.fieldName===e){l.order=1===l.order?-1:1,a=!0;break}if(a)return t&&(i._innerIndexFields=[]),void i._sortByFields();a=!1;for(var r=i._innerIndexFields.length-1;r>=0;r--)if(l=i._innerIndexFields[r],l.fieldName===e){l.order=1===l.order?-1:1,a=!0;break}a?t&&(i._innerIndexFields=[],i._innerIndexFields.push(l)):(t&&(i._innerIndexFields=[]),l={fieldName:e,order:1},i._innerIndexFields.push(l)),i._sortByFields()},_parseIndexFields:function(e){var t,l,a=e.split(","),r=1,n=[];for(i=0,cnt=a.length;i<cnt;i++)t=jQuery.trim(a[i]),l=t.split(" "),r=1==l.length?1:"asce"==l[1].toLowerCase()?1:-1,n.push({fieldName:l[0],order:r});return n},_sortByFields:function(){var e=this;if(e.hasRecord()){e.selection.removeAll(),e._sortingFields=[];for(var t,l=0,i=e._innerFixedIndexFields.length;i>l;l++)t=e._innerFixedIndexFields[l],e._createIndexCfg(t.fieldName,t.order);for(var l=0,i=e._innerIndexFields.length;i>l;l++)t=e._innerIndexFields[l],e._createIndexCfg(t.fieldName,t.order);var a=e.getRecord(),r=e.isContextRuleEnabled();r&&e.disableContextRule(),e.disableControls(),jslet.temp.sortDataset=e;try{e.dataList().sort(e.sortFunc),e._refreshInnerRecno()}finally{jslet.temp.sortDataset=null,e.moveToRecord(a),r&&e.enableContextRule(),e.enableControls()}}},_createIndexCfg:function(e,t){var l=this,i=e;if(jslet.isString(e)&&(i=l.getField(e)),i){if(i.dataset()!==l)return void l._combineIndexCfg(e,t);var a=i.children();if(a&&0!==a.length)for(var r=0,n=a.length;n>r;r++)l._createIndexCfg(a[r],t);else{var s=!0;"N"!==i.getType()||i.lookup()||(s=!1),l._combineIndexCfg(i.name(),t,s)}}},_combineIndexCfg:function(e,t,l){for(var i=0,a=this._sortingFields.length;a>i;i++)this._sortingFields[i].fieldName==e&&this._sortingFields.splice(i,1);var r={fieldName:e,order:t,useTextToSort:l};this._sortingFields.push(r)},_getWholeFilter:function(){var e=this,t=e._fixedFilter;if(t){if(e._filter)return"("+t+") && ("+e._filter+")"}else t=e._filter;return t},fixedFilter:function(e){var t=this;if(void 0===e)return t._fixedFilter;jslet.Checker.test("dataset.fixedFilter",e).isString(),e&&(e=jQuery.trim(e));var l=t._getWholeFilter();t._fixedFilter=e;var i=t._getWholeFilter();if(i){if(l==i)return this;t._innerFilter=new jslet.Expression(t,i)}else t._innerFilter=null,t._filtered=!1,t._filteredRecnoArray=null;return t._doFilterChanged(),this},filter:function(e){var t=this;if(void 0===e)return t._filter;jslet.Checker.test("dataset.filter#filterExpr",e).isString(),e&&(e=jQuery.trim(e));var l=t._getWholeFilter();t._filter=e;var i=t._getWholeFilter();if(i){if(l==i)return this;t._innerFilter=new jslet.Expression(t,i)}else t._innerFilter=null,t._filtered=!1,t._filteredRecnoArray=null;return t._doFilterChanged(),this},filtered:function(e){var t=this;if(void 0===e)return t._filtered;var l=t._getWholeFilter(),i=t._filtered;return e&&!l?t._filtered=!1:t._filtered=e?!0:!1,i==t._filtered?this:(this._doFilterChanged(),this)},_doFilterChanged:function(){var e=this;e.selection.removeAll(),e.disableControls();try{e._filtered?e._refreshInnerRecno():e._filteredRecnoArray=null,e.first(),e.calcAggradedValue()}finally{e.enableControls()}return e.refreshLookupHostDataset(),this},_filterData:function(){var e=this,t=e._getWholeFilter();if(!e._filtered||!t||e._status==jslet.data.DataSetStatus.INSERT||e._status==jslet.data.DataSetStatus.UPDATE)return!0;var l=e._innerFilter.eval();return l},_refreshInnerRecno:function(){var e=this;if(!e.hasData())return void(e._filteredRecnoArray=null);e._filteredRecnoArray=null;var t=[],l=e._recno;try{for(var i=0,a=e.dataList().length;a>i;i++)e._recno=i,e._filterData()&&t.push(i)}finally{e._recno=l}e._filteredRecnoArray=t},_innerAfterScrollDebounce:function(){var e=this,t=jslet.getFunction(e._datasetListener);t&&t.call(e,jslet.data.DatasetEvent.AFTERSCROLL)},_fireDatasetEvent:function(e){var t=this;if(!t._silence&&!t._igoreEvent&&t._datasetListener)if(e==jslet.data.DatasetEvent.AFTERSCROLL)t._afterScrollDebounce.call(t);else{var l=jslet.getFunction(t._datasetListener);l&&l.call(t,e)}},recordCount:function(){var e=this.dataList();return e?this._filteredRecnoArray?this._filteredRecnoArray.length:e.length:0},hasRecord:function(){return this.recordCount()>0},hasData:function(){var e=this.dataList();return e&&e.length>0},recno:function(e){var t=this;return void 0===e?t._recno:(jslet.Checker.test("dataset.recno#recno",e).isGTEZero(),e=parseInt(e),t.hasRecord()?e==t._recno?!0:(t.confirm(),t._gotoRecno(e),t._bof=t._eof=!1,!0):(t._bof=t._eof=!0,!0))},recnoSilence:function(e){var t=this;return void 0===e?t._recno:(t._recno=e,this)},_gotoRecno:function(e){var t=this,l=t.recordCount();if(0==l)return!1;if(e>=l?e=l-1:0>e&&(e=0),t._recno==e)return!1;var i;if(!t._silence){t._aborted=!1;try{if(t._fireDatasetEvent(jslet.data.DatasetEvent.BEFORESCROLL),t._aborted)return!1}finally{t._aborted=!1}t._lockCount||(i=jslet.data.RefreshEvent.beforeScrollEvent(t._recno),t.refreshControl(i))}var a=t._recno;if(t._recno=e,t._recno!=a&&t._subDatasetFields&&t._subDatasetFields.length>0)for(var r,n,s=0,o=t._subDatasetFields.length;o>s;s++)r=t._subDatasetFields[s],n=r.subDataset(),n&&n._initialize(!0);return t._silence||(t._contextRuleEnabled&&this.calcContextRule(),t._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSCROLL),t._lockCount||(i=jslet.data.RefreshEvent.scrollEvent(t._recno,a),t.refreshControl(i))),!0},abort:function(){this._aborted=!0},aborted:function(){return this._aborted},_moveCursor:function(e){var t=this;t.confirm(),t._gotoRecno(e)},moveToRecord:function(e){var t=this;if(t.confirm(),!t.hasRecord()||!e)return!1;jslet.Checker.test("dataset.moveToRecord#recordObj",e).isObject();var l=t.dataList().indexOf(e);return 0>l?!1:t._filteredRecnoArray&&(l=t._filteredRecnoArray.indexOf(l),0>l)?!1:(t._gotoRecno(l),!0)},startSilenceMove:function(e){var t=this,l={};return e?l.recno=-999:l.recno=t._recno,t._silence++,l},endSilenceMove:function(e){var t=this;-999!=e.recno&&e.recno!=t._recno&&t._gotoRecno(e.recno),t._silence--},isBof:function(){return this._bof},isEof:function(){return this._eof},first:function(){var e=this;return e.hasRecord()?(e._moveCursor(0),void(e._bof=e._eof=!1)):void(e._bof=e._eof=!0)},next:function(){var e=this,t=e.recordCount();return 0===t?void(e._bof=e._eof=!0):e._recno==t-1?(e._bof=!1,void(e._eof=!0)):(e._bof=e._eof=!1,void e._moveCursor(e._recno+1))},prior:function(){var e=this;return e.hasRecord()?0===e._recno?(e._bof=!0,void(e._eof=!1)):(e._bof=e._eof=!1,void e._moveCursor(e._recno-1)):void(e._bof=e._eof=!0)},last:function(){var e=this;return e.hasRecord()?(e._bof=e._eof=!1,e._moveCursor(e.recordCount()-1),void(e._bof=e._eof=!1)):void(e._bof=e._eof=!0)},checkStatusByCancel:function(){this._status!=jslet.data.DataSetStatus.BROWSE&&this.cancel()},insertChild:function(e){var t=this;if(!t._parentField||!t.keyField())throw new Error("parentField and keyField not set,use insertRecord() instead!");if(!t.hasRecord())return void t.innerInsert();var l=t.startSilenceMove(!0);try{if(t.expanded(!0),e){if(!t.findByKey(e))return}else e=t.keyValue();for(var i=t.parentField(),a=t.getFieldValue(i);;){if(t.next(),t.isEof())break;if(a==t.getFieldValue(i)){t.prior();break}}}finally{t.endSilenceMove(l)}t.innerInsert(function(l){l[t._parentField]=e})},insertSibling:function(){var e=this;if(!e._parentField||!e._keyField)throw new Error("parentField and keyField not set,use insertRecord() instead!");if(!e.hasRecord())return void e.innerInsert();var t,l=e.getFieldValue(e.parentField()),i=e.startSilenceMove(!0),a=!1,r=[],n=prePKey=e.keyValue();try{for(e.next();!e.isEof();){if(t=e.parentValue(),t==prePKey)r.push(prePKey),n=prePKey;else if(n!=t&&r.indexOf(t)<0){e.prior(),a=!0;break}prePKey=t,e.next()}a||e.last()}finally{e.endSilenceMove(i)}e.innerInsert(function(t){t[e._parentField]=l})},insertRecord:function(){var e=this;e.confirm(),e.innerInsert()},appendRecord:function(){var e=this;e.confirm(),e._silence++;try{e.last()}finally{e._silence--}e.insertRecord()},status:function(e){return void 0===e?this._status:(this._status=e,this)},expanded:function(e){this.expandedByRecno(this.recno(),e)},expandedByRecno:function(e,t){jslet.Checker.test("dataset.expandedByRecno",e).required().isNumber();var l=this.getRecord(e),i=jslet.data.getRecInfo(l);if(void 0===t){var a=i&&i.expanded;return a?!0:!1}return null==i?this:(i.expanded=t,this)},changedStatus:function(e){var t=this.getRecord();if(!t)return null;var l=jslet.data.getRecInfo(t);if(void 0===e)return l?l.status:jslet.data.DataSetStatus.BROWSE;var i=l.status;return e===jslet.data.DataSetStatus.DELETE?void(l.status=e):void(i!==jslet.data.DataSetStatus.INSERT&&i!=e&&(this._contextRuleEngine&&this._contextRuleEngine.evalStatus(),l.status=e))},innerInsert:function(e){var t=this;t.confirm(),t.selection.removeAll();var l=t._datasetField,i=null;if(l){if(i=l.dataset(),!i.hasRecord())throw new Error(jslet.locale.Dataset.insertMasterFirst);i.editRecord()}t._aborted=!1;try{if(t._fireDatasetEvent(jslet.data.DatasetEvent.BEFOREINSERT),t._aborted)return}finally{t._aborted=!1}var a=t.dataList();null===a&&(a=[],t.dataList(a));var r,n=t.recno();r=t.hasRecord()?a.indexOf(this.getRecord())+1:0;var s={};if(a.splice(r,0,s),t._filteredRecnoArray&&t._filteredRecnoArray.length>0)for(var o=t._filteredRecnoArray.length-1;o>=0;o--){if(t._filteredRecnoArray[o]<r){t._filteredRecnoArray.splice(o+1,0,r),t._recno=r;break}t._filteredRecnoArray[o]+=1}else t._recno=r;t.status(jslet.data.DataSetStatus.INSERT),t.changedStatus(jslet.data.DataSetStatus.INSERT),t._calcDefaultValue(),e&&e(s),t._contextRuleEnabled&&t.calcContextRule(),t._fireDatasetEvent(jslet.data.DatasetEvent.AFTERINSERT),t._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSCROLL);var d=jslet.data.RefreshEvent.insertEvent(n,t.recno(),t._recno<t.recordCount()-1);t.refreshControl(d)},insertDataset:function(e){var t=this,l=t.filtered(),i=t.startSilenceMove(!0),a=e.startSilenceMove(!0);try{for(t.filtered(!1),e.first();!e.isEof();)t.insertRecord(),t.cloneRecord(e.getRecord(),t.getRecord()),t.confirm(),e.next()}finally{e.endSilenceMove(a),t.filtered(l),t.endSilenceMove(i)}},appendDataset:function(e){var t=this;t._silence++;try{t.last()}finally{t._silence--}t.insertDataset(e)},batchAppendRecords:function(e,t){jslet.Checker.test("dataset.records",e).required().isArray();var l=this;l.confirm(),l.selection.removeAll(),l.disableControls();try{for(var i,a,r,n=l.keyField(),s=0,o=e.length;o>s;s++)if(i=e[s],a=!1,n&&(r=i[n],r&&l.findByKey(r)&&(a=!0)),a){if(!t)continue;l.editRecord(),l.cloneRecord(i,l.getRecord()),l.confirm()}else l.appendRecord(),l.cloneRecord(i,l.getRecord()),l.confirm()}finally{l.enableControls(),l.refreshControl(jslet.data.RefreshEvent._updateAllEvent),l.refreshLookupHostDataset()}},_calcDefaultValue:function(){for(var e,t,l,i,a=this,r=0,n=a._normalFields.length;n>r;r++)if(e=a._normalFields[r],i=e.name(),e.getType()!=jslet.data.DataType.DATASET){if(e.valueFollow()&&a._followedValue){var s=a._followedValue[i];if(void 0!==s){e.setValue(s);continue}}if(l=e.defaultValue(),void 0===l||null===l||""===l){if(t=e.defaultExpr(),!t)continue;l=window.eval(t)}else e.getType()===jslet.data.DataType.NUMBER&&(l=e.scale()>0?parseFloat(l):parseInt(l));var o=e.valueStyle();l&&jslet.isDate(l)&&(l=new Date(l.getTime())),o==jslet.data.FieldValueStyle.BETWEEN?l=l?[l,l]:[null,null]:o==jslet.data.FieldValueStyle.MULTIPLE&&(l=[l]),a.setFieldValue(i,l)}},checkAggraded:function(e){var t,l=this;if(e)return t=l.getField(e),t.aggraded();for(var i=l.getNormalFields(),a=0,r=i.length;r>a;a++)if(t=i[a],t.aggraded())return!0;return!1},calcAggradedValue:function(e){function t(e){if(e.indexOf(",")<0)return a.getFieldValue(e);for(var t=e.split(","),l=[],i=0,r=t.length;r>i;i++)l.push(a.getFieldValue(t[i]));return l.join(",")}function l(e){for(var l,i,a,r=0,n=e.length;n>r;r++)l=e[r],a=l.values,i=t(l.aggradedBy),a.indexOf(i)<0?(a.push(i),l.exists=!1):l.exists=!0}function i(e,t){for(var l,i=0,a=e.length;a>i;i++)if(l=e[i],l.aggradedBy==t)return l.exists;return console.warn("Not found aggradedBy value!"),!1}var a=this;if(a.checkAggraded(e)){for(var r,n,s=a.getNormalFields(),o=[],d=[],u=null,c=0,h=s.length;h>c;c++)r=s[c],r.aggraded()&&(n=r.aggradedBy(),r.getType()===jslet.data.DataType.NUMBER||n?o.push(r):(u||(u={}),u[r.name()]={count:a.recordCount(),sum:0}),n&&-1===d.indexOf(n)&&d.push({aggradedBy:n,values:[],exists:!1}));if(0===o.length)return void a.aggradedValues(u);u||(u={});var e,f,v,p=a.recnoSilence(),_=o.length;try{for(var g=0,m=a.recordCount();m>g;g++){a.recnoSilence(g),l(d);for(var c=0;_>c;c++)if(r=o[c],e=r.name(),n=r.aggradedBy(),!(n&&i(d,n)||(v=u[e],v||(v={count:0,sum:0},u[e]=v),v.count=v.count+1,r.getType()!==jslet.data.DataType.NUMBER))){if(f=a.getFieldValue(e)||0,jslet.isString(f))throw new Error("Field: "+e+" requires Number value!");v.sum=v.sum+f}}}finally{a.recnoSilence(p)}for(var j,c=0;_>c;c++){r=o[c],e=r.name(),j=r.scale()||0,v=u[e],v||(v={count:0,sum:0},u[e]=v);var C=v.sum;if(C){var y=Math.pow(10,j);C=Math.round(C*y)/y,v.sum=C}}a.aggradedValues(u)}},aggradedValues:function(e){var t=this;if(void 0===e)return t._aggradedValues;var t=this;t._aggradedValues=e,(t._aggradedValues||e)&&(evt=jslet.data.RefreshEvent.aggradedEvent(),t.refreshControl(evt))},getRecord:function(e){var t,l=this;if(!l.hasData())return null;var i=l.dataList();if(l._ignoreFilter)return i[l._ignoreFilterRecno||0];if(0===l.recordCount())return null;if(void 0===e||null===e)e=l._recno>=0?l._recno:0;else if(0>e||e>=l.recordCount())return null;return t=l._filteredRecnoArray?l._filteredRecnoArray[e]:e,i[t]},getRelativeRecord:function(e){return this.getRecord(this._recno+e)},isSameAsPrevious:function(e){var t=this,l=t.getRelativeRecord(-1);if(!l)return!1;var i=t.getRecord(),a=l[e],r=i[e],n=!1;if(a||0===a||r||0===r?a&&r&&(n=jslet.isDate(a)?a.getTime()==r.getTime():a==r):n=!0,!n)return n;var s=t.getField(e),o=s.mergeSameBy();if(o)for(var d,u=o.split(","),c=0,h=u.length;h>c;c++)if(d=jQuery.trim(u[c]),l[d]!=i[d])return!1;return n},hasChildren:function(){var e=this;if(!e._parentField)return!1;var t=e.startSilenceMove(),l=e.keyValue();try{if(e.next(),!e.isEof()){var i=e.parentValue();if(i==l)return!0}return!1}finally{e.endSilenceMove(t)}},iterateChildren:function(){},editRecord:function(){var e=this;if(e._status!=jslet.data.DataSetStatus.UPDATE&&e._status!=jslet.data.DataSetStatus.INSERT)if(e.selection.removeAll(),e.hasRecord()){e._aborted=!1;try{if(e._fireDatasetEvent(jslet.data.DatasetEvent.BEFOREUPDATE),e._aborted)return}finally{e._aborted=!1}e._modiObject={},jQuery.extend(e._modiObject,e.getRecord());var t=e._datasetField;t&&t.dataset()&&t.dataset().editRecord(),e.status(jslet.data.DataSetStatus.UPDATE),e._fireDatasetEvent(jslet.data.DatasetEvent.AFTERUPDATE)}else e.insertRecord()},deleteRecord:function(){var e=this,t=e.recordCount();if(0!==t&&e.changedStatus()!==jslet.data.DataSetStatus.DELETE){if(e.selection.removeAll(),e._status==jslet.data.DataSetStatus.INSERT)return void e.cancel();e._silence++;try{e.checkStatusByCancel()}finally{e._silence--}if(e.hasChildren())return void jslet.showInfo(jslet.locale.Dataset.cannotDelParent);e._aborted=!1;try{if(e._fireDatasetEvent(jslet.data.DatasetEvent.BEFOREDELETE),e._aborted)return}finally{e._aborted=!1}var l=e.recno(),i=l==t-1,a=e._recno;e.changedStatus()===jslet.data.DataSetStatus.INSERT?e._changeLog.unlog():(e.changedStatus(jslet.data.DataSetStatus.DELETE),e._changeLog.log()),e.dataList().splice(a,1),e._refreshInnerRecno();var r=e._datasetField;if(r&&r.dataset()&&r.dataset().editRecord(),e.status(jslet.data.DataSetStatus.BROWSE),i){e._silence++;try{e.prior()}finally{e._silence--}}e.calcAggradedValue();var n=jslet.data.RefreshEvent.deleteEvent(l);e.refreshControl(n),e._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSCROLL),e.refreshLookupHostDataset();var s=e._subDatasetFields;if(s)for(var o,d,u=0,c=s.length;c>u;u++)o=s[u],d=o.subDataset(),d&&d.refreshControl();e.isBof()&&e.isEof()||(n=jslet.data.RefreshEvent.scrollEvent(e._recno),e.refreshControl(n))}},deleteSelected:function(){var e,t=this,l=t.selectedRecords();t.disableControls();try{for(var i=l.length-1;i>=0;i--)e=l[i],t.moveToRecord(e),t.deleteRecord()}finally{t.enableControls()}},_innerValidateData:function(){var e=this;if(e._status!=jslet.data.DataSetStatus.BROWSE&&0!==e.recordCount()){for(var t,l,i,a,r=null,n=0,s=e._normalFields.length;s>n;n++)if(t=e._normalFields[n],!t.disabled()&&!t.readOnly()&&t.visible())if(l=t.name(),i=e.getFieldValue(l),t.valueStyle()==jslet.data.FieldValueStyle.NORMAL&&e.existFieldError(l))a=e._fieldValidator.checkRequired(t,i),a=a||e._fieldValidator.checkValue(t,i),a&&(e.setFieldError(l,a),r||(r=l));else{if(a=e._fieldValidator.checkRequired(t,i),a&&(e.setFieldError(l,a),r||(r=l)),t.valueStyle()==jslet.data.FieldValueStyle.BETWEEN){var o=null,d=null;i&&2===i.length&&(o=i[0],d=i[1]),o&&d&&(a=null,(jslet.isDate(o)&&o.getTime()>d.getTime()||o>d)&&(a=jslet.locale.Dataset.betwwenInvalid),a&&(e.setFieldError(l,a,0),r||(r=l)))}if(i)for(var u=(e.getRecord(),0),c=i.length;c>u;u++)e.existFieldError(l,u)&&(a=a||e._fieldValidator.checkValue(t,i),a&&(e.setFieldError(l,a,u),r||(r=l)))}r&&e.focusEditControl(r)}},errorMessage:function(e){var t=jslet.data.RefreshEvent.errorEvent(e||"");this.refreshControl(t)},addFieldError:function(e,t,l,i){jslet.data.FieldError.put(this.getRecord(),e,t,l,i)},addDetailFieldError:function(e,t){jslet.data.putDetailError.put(this.getRecord(),e,t)},existRecordError:function(e){return jslet.data.FieldError.existRecordError(this.getRecord(e))},checkAndShowError:function(){var e=this;return e.existDatasetError()?(e._autoShowError?jslet.showError(jslet.locale.Dataset.cannotConfirm,null,2e3):console.warn(jslet.locale.Dataset.cannotConfirm),!0):!1},existDatasetError:function(){var e=this,t=!1,l=e.dataList();if(!l)return!1;for(var i=0,a=l.length;a>i;i++)if(t=jslet.data.FieldError.existRecordError(l[i]))return!0;return!1},confirm:function(){var e=this;if(e._status==jslet.data.DataSetStatus.BROWSE)return!0;e._fireDatasetEvent(jslet.data.DatasetEvent.BEFORECONFIRM),e._innerValidateData(),e._confirmSubDataset(),e.status()==jslet.data.DataSetStatus.UPDATE&&e.changedStatus(jslet.data.DataSetStatus.UPDATE);var t,l=e.existRecordError();e.getRecord();e._modiObject=null,e.status(jslet.data.DataSetStatus.BROWSE),l||e._changeLog.log(),e._fireDatasetEvent(jslet.data.DatasetEvent.AFTERCONFIRM),e.calcAggradedValue(),t=jslet.data.RefreshEvent.updateRecordEvent(),e.refreshControl(t),l?e.errorMessage(jslet.locale.Dataset.cannotConfirm):(jslet.data.FieldError.clearRecordError(e.getRecord()),e.errorMessage());var i=e._datasetField;if(i){var a=i.dataset(),r=i.name();l?a.addFieldError(r,"Detail Dataset Error"):a.addFieldError(r,null),a.refreshControl(t)}return!l},_confirmSubDataset:function(){for(var e,t=this,l=[],i=[],a=0,r=t._normalFields.length;r>a;a++)e=t._normalFields[a],e.getType()===jslet.data.DataType.DATASET&&(l.push(e.subDataset()),i.push(e.name()));for(var n,a=0,r=l.length;r>a;a++)n=l[a],n.confirm(),n.existDatasetError()?t.addFieldError(i[a],"Detail Dataset Error"):t.addFieldError(i[a],null)},cancel:function(){var e=this;if(e._status!=jslet.data.DataSetStatus.BROWSE&&0!==e.recordCount()){e._aborted=!1;try{if(e._fireDatasetEvent(jslet.data.DatasetEvent.BEFORECANCEL),e._aborted)return}finally{e._aborted=!1}e._cancelSubDataset();var t,l=e._recno,i=e.dataList();if(e._status==jslet.data.DataSetStatus.INSERT){e.selection.removeAll();var a=e.recno();return i.splice(l,1),e._refreshInnerRecno(),a>=e.recordCount()&&(e._recno=e.recordCount()-1),e.calcAggradedValue(),t=jslet.data.RefreshEvent.deleteEvent(a),e.refreshControl(t),e.status(jslet.data.DataSetStatus.BROWSE),e._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSCROLL),t=jslet.data.RefreshEvent.scrollEvent(e._recno),void e.refreshControl(t)}e._filteredRecnoArray&&(l=e._filteredRecnoArray[e._recno]),i[l]=e._modiObject,e._modiObject=null,e.calcAggradedValue(),e.status(jslet.data.DataSetStatus.BROWSE),e._fireDatasetEvent(jslet.data.DatasetEvent.AFTERCANCEL),t=jslet.data.RefreshEvent.updateRecordEvent(),e.refreshControl(t)}},restore:function(){},_cancelSubDataset:function(){for(var e,t=this,l=[],i=0,a=t._normalFields.length;a>i;i++)e=t._normalFields[i],e.getType()===jslet.data.DataType.DATASET&&l.push(e.subDataset());for(var r,i=0,a=l.length;a>i;i++)r=l[i],r.cancel()},logChanges:function(e){return void 0===e?this._logChanges:void(this._logChanges=e)},disableControls:function(){this._lockCount++;for(var e,t,l=0,i=this._normalFields.length;i>l;l++)e=this._normalFields[l],t=e.subDataset(),null!==t&&t.disableControls()},enableControls:function(e){this._lockCount>0&&this._lockCount--,e||this.refreshControl();for(var t,l,i=0,a=this._normalFields.length;a>i;i++)t=this._normalFields[i],l=t.subDataset(),null!==l&&l.enableControls()},existFieldError:function(e,t){if(0===this.recordCount())return!1;var l=this.getRecord();return l?jslet.data.FieldError.existFieldError(l,e,t):!1},getFieldError:function(e,t){return this.getFieldErrorByRecno(null,e,t)},getFieldErrorByRecno:function(e,t,l){if(0===this.recordCount())return null;var i=this.getRecord(e);return i?jslet.data.FieldError.get(i,t,l):null},setFieldError:function(e,t,l,i){var a=this;if(0===a.recordCount())return a;var r=a.getRecord();return r?(jslet.data.FieldError.put(r,e,t,l,i),this):a},getFieldValueByRecno:function(e,t,l){var i=this.getRecord(e);return i?this.getFieldValueByRecord(i,t,l):null},getFieldValueByRecord:function(e,t,l){var i=this;if(0===i.recordCount())return null;e||(e=i.getRecord());var a,r,n,s=t.indexOf("."),o=null,d=i.getField(t);if(s>0){a=t.substr(0,s),d=i.getField(a);var u=d.lookup(),c=d.subDataset();if(!u&&!c)throw new Error(jslet.formatString(jslet.locale.Dataset.lookupNotFound,[a]));if(u)if(r=e[a],n=u.dataset(),void 0===r||null===r||""===r)o=null;else{if(!n.findByField(n.keyField(),r))throw new Error(jslet.formatString(jslet.locale.Dataset.valueNotFound,[n.name(),n.keyField(),r]));o=n.getFieldValue(t.substr(s+1))}else o=c.getFieldValue(t.substr(s+1))}else{if(!d)throw new Error(jslet.formatString(jslet.locale.Dataset.fieldNotFound,[t]));var h=d.formula();h&&void 0===e[t]?(o=i._calcFormula(e,t),e[t]=o):(r=e[t],o=void 0!==r?r:null)}return d.valueStyle()&&void 0!==l?jslet.getArrayValue(o,l):d.getType()===jslet.data.DataType.BOOLEAN?o===d.trueValue():o},getFieldValue:function(e,t){if(0===this.recordCount())return null;var l=this.getRecord();return l?this.getFieldValueByRecord(l,e,t):null},setFieldValue:function(e,t,l){var i=this,a=i.getField(e);i._status==jslet.data.DataSetStatus.BROWSE&&i.editRecord();var r=i.getRecord();if(a.valueStyle()&&void 0!==l){var n=r[e];n&&jslet.isArray(n)||(n=[],r[e]=n);var s=n.length;if(s>l)n[l]=t;else{for(var o=s;l>o;o++)n.push(null);n.push(t)}}else{t&&a.getType()===jslet.data.DataType.NUMBER&&!jslet.isArray(t)&&(t=a.scale()>0?parseFloat(t):parseInt(t));var d=t;if(a.getType()===jslet.data.DataType.BOOLEAN&&(d=t?a.trueValue():a.falseValue()),r[e]=d,a.getType()==jslet.data.DataType.DATASET)return this}if(i.setFieldError(e,null,l),i._onFieldChanged){var u=jslet.getFunction(i._onFieldChanged);u&&u.call(i,e,t,l)}var c=jslet.data.globalDataHandler.fieldValueChanged();c&&c.call(i,i,e,t,l),a.valueFollow()&&(i._followedValue||(i._followedValue={}),i._followedValue[e]=t),i._contextRuleEnabled&&i.calcContextRule(e),jslet.data.FieldValueCache.clear(i.getRecord(),e);var h=jslet.data.RefreshEvent.updateRecordEvent(e);return i.refreshControl(h),i.updateFormula(e),i.calcAggradedValue(e),this},_calcFormulaRelation:function(){var e=this;if(e._innerFormularFields){for(var t,l,i=e._innerFormularFields.keys(),a=new jslet.SimpleMap,r=0,n=i.length;n>r;r++){t=i[r];var s=e._innerFormularFields.get(t);l=s.mainFields(),a.set(t,l)}e._innerFormulaRelation=a.count()>0?a:null}},addInnerFormulaField:function(e,t){var l=this;t&&(l._innerFormularFields||(l._innerFormularFields=new jslet.SimpleMap),evaluator=new jslet.Expression(l,t),l._innerFormularFields.set(e,evaluator),l._calcFormulaRelation())},removeInnerFormulaField:function(e){this._innerFormularFields&&(this._innerFormularFields.unset(e),this._calcFormulaRelation())},_calcFormula:function(e,t){var l=this,i=l._innerFormularFields.get(t),a=null;return i&&(i.context.dataRec=e,a=i.eval()),a},updateFormula:function(e){var t=this;if(t._innerFormulaRelation)for(var l,i,a,r=t._innerFormulaRelation.keys(),n=this.getRecord(),s=0,o=r.length;o>s;s++)if(l=r[s],i=t._innerFormulaRelation.get(l),a=t.getField(l),i&&0!==i.length){for(var d=!1,u=0,c=i.length;c>u;u++)if(i[u]==e){d=!0;break}d&&a.setValue(t._calcFormula(n,l))}else a.setValue(t._calcFormula(n,l))},getFieldText:function(e,t,l){if(0===this.recordCount())return null;var i=this.getRecord();return i?this.getFieldTextByRecord(i,e,t,l):null},getFieldTextByRecno:function(e,t,l,i){var a=this.getRecord(e);return a?this.getFieldTextByRecord(a,t,l,i):null},getFieldTextByRecord:function(e,t,l,i){var a=this;if(0===a.recordCount())return"";var r,n,s=e,o=t.indexOf(".");if(o>0){var d=t.substr(0,o);if(t=t.substr(o+1),r=a.getField(d),!r)throw new Error(jslet.formatString(jslet.locale.Dataset.fieldNotFound,[t]));var u=r.lookup(),c=r.subDataset();if(!u&&!c)throw new Error(jslet.formatString(jslet.locale.Dataset.lookupNotFound,[t]));if(u){if(n=s[d],null===n||void 0===n)return"";var h=u.dataset();if(h.findByField(h.keyField(),n))return t.indexOf(".")>0?h.getFieldValue(t):h.getFieldText(t,l,i);throw new Error(jslet.formatString(jslet.locale.Dataset.valueNotFound,[h.name(),h.keyField(),n]))}return c.getFieldText(t,l,i)}if(r=a.getField(t),!r)throw new Error(jslet.formatString(jslet.locale.Dataset.lookupNotFound,[t]));if(r.getType()==jslet.data.DataType.DATASET)return"[dataset]";var f=r.valueStyle(),v=[];if(f==jslet.data.FieldValueStyle.BETWEEN&&void 0===i){var p=a.getFieldTextByRecord(s,t,l,0),_=a.getFieldTextByRecord(s,t,l,1);return l||p||_?(v.push(p),l?v.push(jslet.global.valueSeparator):v.push(jslet.locale.Dataset.betweenLabel),v.push(_),v.join("")):""}if(f==jslet.data.FieldValueStyle.MULTIPLE&&void 0===i){var g=a.getFieldValue(t),m=0;g&&jslet.isArray(g)&&(m=g.length-1);for(var j=0;m>=j;j++)v.push(a.getFieldTextByRecord(s,t,l,j)),m>j&&v.push(jslet.global.valueSeparator);return v.join("")}if(!l){var C=jslet.data.FieldValueCache.get(s,t,i);if(void 0!==C)return C}if(n=a.getFieldValueByRecord(s,t,i),null===n||void 0===n){var y=r.fixedValue();return y?y:""}var b=r.customValueConverter()||jslet.data.getValueConverter(r);if(!b)throw new Error("Can't find any field value converter!");var x=b.valueToText.call(a,r,n,l);return l||jslet.data.FieldValueCache.put(s,t,x,i),x},setFieldValueLength:function(e,t){if(e.valueStyle()){var l=this.getFieldValue(e.name());l&&jslet.isArray(l)&&(l.length=t)}},setFieldText:function(e,t,l){var i=this,a=i.getField(e);if(null===a)throw new Error(jslet.formatString(jslet.locale.Dataset.fieldNotFound,[e]));var r=a.getType();if(r==jslet.data.DataType.DATASET)throw new Error(jslet.formatString(jslet.locale.Dataset.datasetFieldNotBeSetValue,[e]));var n=a.customValueConverter()||jslet.data.getValueConverter(a);if(!n)throw new Error("Can't find any field value converter!");var s=i._textToValue(a,t,l);void 0!==s&&i.setFieldValue(e,s,l)},_textToValue:function(e,t,l){var i=this;e.getType();if((e.valueStyle()===jslet.data.FieldValueStyle.BETWEEN||e.valueStyle()===jslet.data.FieldValueStyle.MULTIPLE)&&void 0===l){jslet.isArray(t)||(t=t.split(jslet.global.valueSeparator));for(var a,r=t.length,n=[],s=!1,o=0;r>o;o++)a=i._textToValue(e,t[o],o),void 0===a?s=!0:s||n.push(a);return s?void 0:n}var d=i._fieldValidator.checkInputText(e,t);if(d)return void i.setFieldError(e.name(),d,l,t);i.setFieldError(e.name(),null,l);var u=e.customValueConverter()||jslet.data.getValueConverter(e),a=u.textToValue.call(i,e,t,l);return a},keyValue:function(){return this._keyField&&0!==this.recordCount()?this.getFieldValue(this._keyField):null},parentValue:function(){return this._parentField&&0!==this.recordCount()?this.getFieldValue(this._parentField):null},find:function(e,t){var l=this;if(0===l.recordCount())return!1;if(l.confirm(),null===e)return l._findCondition=null,l._innerFindCondition=null,!1;if(e!=l._findCondition&&(l._innerFindCondition=new jslet.Expression(this,e)),l._innerFindCondition.eval())return!0;l._silence++;var i=-1,a=l._recno;try{for(t||l.first();!l.isEof();){if(l._innerFindCondition.eval()){i=l._recno;break}l.next()}}finally{l._silence--,l._recno=a}return i>=0?(l._gotoRecno(i),!0):!1},findByField:function(e,t,l,i,a){function r(e,t,l){return e?"first"==e?jslet.like(t,l+"%"):"any"==e?jslet.like(t,"%"+l+"%"):"last"==e?jslet.like(t,"%"+l):void 0:t==l}var n=this,s=n.getField(e);if(!s)throw new Error("Field name: "+e+" NOT Found!");n.confirm();var o=!0;"N"!==s.getType()||s.lookup()||(o=!1);var d,u;if(n._ignoreFilter){if(!n.hasData())return!1;var c,h=n.dataList(),f=h.length,v=0;if(l){var p=n.getRecord();n._lastFindingValue&&n._lastFindingValue===t&&(v=h.indexOf(p)+1),n._lastFindingValue=t}for(u=v;f>u;u++)if(c=h[u],d=i&&o?n.getFieldTextByRecord(c,e):n.getFieldValueByRecord(c,e),r(a,d,t))return n._ignoreFilterRecno=u,!0;return!1}if(0===n.recordCount())return!1;var _=-1,g=n.recno();try{var m=n.recordCount(),v=0;for(l&&(v=n.recno(),n._lastFindingValue&&n._lastFindingValue===t&&(v=n.recno()+1),n._lastFindingValue=t),u=v;m>u;u++)if(n.recnoSilence(u),d=i&&o?n.getFieldText(e):n.getFieldValue(e),r(a,d,t)){_=n._recno;break}}finally{n.recnoSilence(g)}return _>=0?(n._gotoRecno(_),!0):!1},findByKey:function(e){var t=this.keyField();return t?this.findByField(t,e):!1},lookup:function(e,t,l){return this.findByField(e,t)?this.getFieldValue(l):null},lookupByKey:function(e,t){return this.findByKey(e)?this.getFieldValue(t):null},copyDataset:function(e){var t=this;if(0===t.recordCount())return null;var l=[];if(!e||!t._filtered)return t.dataList().slice(0);var i=t._recno,a=t._filtered;e||(t._filtered=!1),t._silence++;try{for(t.first();!t.isEof();)l.push(t.getRecord()),t.next()}finally{t._silence--,t._recno=i,e||(t._filtered=a)}return l},keyField:function(e){return void 0===e?this._keyField:(jslet.Checker.test("Dataset.keyField",e).isString(),this._keyField=jQuery.trim(e),this)},codeField:function(e){return void 0===e?this._codeField:(jslet.Checker.test("Dataset.codeField",e).isString(),this._codeField=jQuery.trim(e),this)},nameField:function(e){return void 0===e?this._nameField:(jslet.Checker.test("Dataset.nameField",e).isString(),this._nameField=jQuery.trim(e),this)},parentField:function(e){return void 0===e?this._parentField:(jslet.Checker.test("Dataset.parentField",e).isString(),this._parentField=jQuery.trim(e),this)},levelOrderField:function(e){return void 0===e?this._levelOrderField:(jslet.Checker.test("Dataset.levelOrderField",e).isString(),this._levelOrderField=jQuery.trim(e),this)},selectField:function(e){return void 0===e?this._selectField:(jslet.Checker.test("Dataset.selectField",e).isString(),this._selectField=jQuery.trim(e),
this)},_convertFieldValue:function(e,t,l){var i=this;if(null===l)throw new Error("NOT set destFields in method: ConvertFieldValue");var a=l.indexOf("[")>-1;a&&l!=i._convertDestFields&&(i._innerConvertDestFields=new jslet.Expression(this,l),i._convertDestFields=l),"string"!=typeof t&&(t+="");var r=jslet.global.valueSeparator,n=t.split(r),s=n.length-1;i._ignoreFilter=!0;try{if(0===s)return i.findByField(e,n[0])?a?i._innerConvertDestFields.eval():i.getFieldValue(l):null;for(var o="",d=0;s>=d;d++){if(!i.findByField(e,n[d]))return null;o+=a?i._innerConvertDestFields.eval():i.getFieldValue(l),d!=s&&(o+=r)}return o}finally{i._ignoreFilter=!1}},contextRules:function(e){if(void 0===e)return this._contextRules;if(jslet.isString(e)&&(e=e?jslet.JSON.parse(e):null),jslet.Checker.test("Dataset.contextRules",e).isArray(),e&&0!==e.length){for(var t,l=0,i=e.length;i>l;l++)t=e[l],t.className&&t.className==jslet.data.ContextRule.className||(jslet.Checker.test("Dataset.contextRules#ruleObj",t).isPlanObject(),e[l]=jslet.data.createContextRule(t));this._contextRules=e,this._contextRuleEngine=new jslet.data.ContextRuleEngine(this),this._contextRuleEngine.compile(),this.enableContextRule()}else this._contextRules=null,this._contextRuleEngine=null;return this},disableContextRule:function(){this._contextRuleEnabled=!1},enableContextRule:function(){this._contextRuleEnabled=!0,this.calcContextRule()},isContextRuleEnabled:function(){return this._contextRuleEnabled},calcContextRule:function(e){var t=this;if(0!==t.recordCount()&&t._contextRuleEngine){t._inContextRule=!0;try{e||t._contextRuleEngine.evalStatus(),t._contextRuleEngine.evalRule(e)}finally{t._inContextRule=!1}}},checkSelectable:function(e){if(0===this.recordCount())return!1;if(this._onCheckSelectable){var t=jslet.getFunction(this._onCheckSelectable);if(t)return t.call(this,e)}return!0},selected:function(e){var t=this,l=t._selectField||jslet.global.selectStateField,i=t.getRecord();if(void 0===e)return i&&i[l];if(i&&t.checkSelectable()){t._aborted=!1;try{if(t._fireDatasetEvent(jslet.data.DatasetEvent.BEFORESELECT),t._aborted)return t}finally{t._aborted=!1}i[l]=e,t._fireDatasetEvent(jslet.data.DatasetEvent.AFTERSELECT)}return t},selectedByRecno:function(e){var t=this,l=t._selectField||jslet.global.selectStateField,i=t.getRecord(e);return i&&i[l]},selectAll:function(e,t,l){var i=this;if(0!==i.recordCount()){jslet.Checker.test("Dataset.selectAll#onSelectAll",t).isFunction();var a=i.recno();try{for(var r=0,n=i.recordCount();n>r;r++){if(i.recnoSilence(r),t){var s=t(this,e);if(void 0!==s&&!s)continue}i.selected(e)}}finally{i.recnoSilence(a)}if(!l){var o=jslet.data.RefreshEvent.selectAllEvent(e);i.refreshControl(o)}}},selectByKeyValue:function(e,t,l){var i,a=this,r=a.recno(),n=a.recordCount(),s=[];try{for(var o=0;n>o;o++)if(a.recnoSilence(o),i=a.getFieldValue(a._keyField),i==t){a.selected(e),s.push(o);break}}finally{a.recnoSilence(r)}if(!l){var d=jslet.data.RefreshEvent.selectRecordEvent(s,e);a.refreshControl(d)}},select:function(e,t){var l=this;if(0!==l.recordCount()){var i=[];if(t){var a,r=t.split(","),n=[],s=r.length;for(a=0;s>a;a++)n[a]=l.getFieldValue(r[a]);var o,d,u=l.recno();try{for(var c=0,h=l.recordCount();h>c;c++){for(l.recnoSilence(c),d=1,a=0;s>a;a++)if(o=l.getFieldValue(r[a]),o!=n[a]){d=0;break}d&&(l.selected(e),i.push(l.recno()))}}finally{l.recnoSilence(u)}}else l.selected(e),i.push(l.recno());var f=jslet.data.RefreshEvent.selectRecordEvent(i,e);l.refreshControl(f)}},dataProvider:function(e){return void 0===e?this._dataProvider:(this._dataProvider=e,this)},_checkDataProvider:function(){if(!this._dataProvider)throw new Error("DataProvider required, use: yourDataset.dataProvider(yourDataProvider);")},selectedRecords:function(){var e=this;if(!e.hasRecord())return null;var t=e.recno(),l=[];try{for(var i=0,a=e.recordCount();a>i;i++)e.recnoSilence(i),e.selected()&&l.push(e.getRecord())}finally{e.recnoSilence(t)}return l},selectedKeyValues:function(){var e=this.recno(),t=[];try{for(var l=0,i=this.recordCount();i>l;l++){this.recnoSilence(l);var a=this.selected();a&&2!==a&&t.push(this.getFieldValue(this._keyField))}}finally{this.recnoSilence(e)}return t.length>0?t:null},queryUrl:function(e){return void 0===e?this._queryUrl:(jslet.Checker.test("Dataset.queryUrl",e).isString(),this._queryUrl=jQuery.trim(e),this)},query:function(e){if(e&&e instanceof jslet.data.Dataset){var t=e;if(t.confirm(),t.checkAndShowError())return jslet.emptyPromise;e=t.getRecord()}return this._queryCriteria=e,this.requery()},_doQuerySuccess:function(e,t){var l=t;if(!e)return l.dataList([]),void(e&&e.info&&jslet.showInfo(e.info));var i=e.main;i&&l.dataList(i);var a=e.extraEntities;if(a){var r,n;for(var r in a)n=jslet.data.getDataset(r),n?n.dataList(a[r]):console.warn(r+" is returned from server, but this datase does not exist!")}e.pageNo&&(l._pageNo=e.pageNo),e.pageCount&&(l._pageCount=e.pageCount);var s=jslet.data.RefreshEvent.changePageEvent();l.refreshControl(s),e&&e.info&&jslet.showInfo(e.info)},_doApplyError:function(e,t){var l=t,i=e.errorCode,a=e.errorMessage;if(jslet.global.serverErrorHandler){var r=jslet.global.serverErrorHandler(i,a);if(r)return}a=a+"["+i+"]",l.errorMessage(a),l._autoShowError&&jslet.showError(a)},requery:function(){var e=this;if(e._checkDataProvider(),!this._queryUrl)throw new Error("QueryUrl required! Use: yourDataset.queryUrl(yourUrl)");if(!e._querying){e._querying=!0;try{var t={};e._pageNo>0&&(t.pageNo=e._pageNo,t.pageSize=e._pageSize);var l=e._queryCriteria;l&&(jslet.isArray(l)?t.criteria=l:t.simpleCriteria=l),e.csrfToken&&(t.csrfToken=e.csrfToken);var t=jslet.data.record2Json(t),i=e._queryUrl;return e._dataProvider.sendRequest(e,i,t).done(e._doQuerySuccess).fail(e._doApplyError).always(function(){e._querying=!1})}catch(a){e._querying=!1}}},_setChangedState:function(e,t,l){if(t&&0!==t.length)for(var i=this._addRecordClassFlag(t,e,this._recordClass||jslet.global.defaultRecordClass),a=0,r=i.length;r>a;a++)l.push(i[a])},_addRecordClassFlag:function(e,t,l){for(var i,a=this.getFields(),r=null,n=0,s=a.length;s>n;n++)i=a[n],i.getType()===jslet.data.DataType.DATASET&&(r||(r={}),r[i.name()]=i.subDataset().recordClass());for(var o,d,u,c=[],n=0,h=e.length;h>n;n++){o=e[n],d={},l&&(d["@type"]=l),o[jslet.global.changeStateField]=t+n;var f;for(var v in o)f=o[v],f&&r&&(u=r[v],u&&(f=this._addRecordClassFlag(f,t,u))),d[v]=f;c.push(d)}return c},_doSaveSuccess:function(e,t){if(!e)return void(e&&e.info&&jslet.showInfo(e.info));var l=e.main,i=t;i._dataTransformer.refreshSubmittedData(l),i.calcAggradedValue(),i.selection.removeAll(),i.refreshControl(),i.refreshLookupHostDataset(),e&&e.info&&jslet.showInfo(e.info)},submitUrl:function(e){return void 0===e?this._submitUrl:(jslet.Checker.test("Dataset.submitUrl",e).isString(),this._submitUrl=jQuery.trim(e),this)},hasChangedData:function(){var e=this;e.confirm();var t,l,i=e.dataList();if(!i)return!1;for(var a=0,r=i.length;r>a;a++)return t=i[a],l=jslet.data.getRecInfo(t),l&&l.status&&l.status!==jslet.data.DataSetStatus.BROWSE;return!1},submit:function(e,t){var l=this;if(l.confirm(),l.checkAndShowError())return jslet.emptyPromise;if(l._checkDataProvider(),!l._submitUrl)throw new Error("SubmitUrl required! Use: yourDataset.submitUrl(yourUrl)");var i=l._dataTransformer.getSubmittingChanged();if(!i||0===i.length)return jslet.showInfo(jslet.locale.Dataset.noDataSubmit),jslet.emptyPromise;if(!l._submitting){l._submitting=!0;try{var a={main:i};e&&(a.extraInfo=e),l.csrfToken&&(a.csrfToken=l.csrfToken),a=jslet.data.record2Json(a,t);var r=l._submitUrl;return l._dataProvider.sendRequest(l,r,a).done(l._doSaveSuccess).fail(l._doApplyError).always(function(){l._submitting=!1})}catch(n){l._submitting=!1}}},_doSubmitSelectedSuccess:function(e,t){if(e){var l=e.main;if(!l||0===l.length)return void(e.info&&jslet.showInfo(e.info));var i,a,r=t,n=r._deleteOnSuccess_,s=r.selectedRecords()||[],o=r.dataList();if(r.selection.removeAll(),n){for(i=s.length;i>=0;i--)rec=s[i],a=o.indexOf(rec),o.splice(a,1);r._refreshInnerRecno()}else{r._dataTransformer.refreshSubmittedData(l)}r.calcAggradedValue(),r.refreshControl(),r.refreshLookupHostDataset(),e&&e.info&&jslet.showInfo(e.info)}},submitSelected:function(e,t,l,i){var a=this;if(a.confirm(),a.checkAndShowError())return jslet.emptyPromise;if(a._checkDataProvider(),!e)throw new Error("Url required! Use: yourDataset.submitSelected(yourUrl)");if(!a._submitting){a._submitting=!0;try{var r=a._dataTransformer.getSubmittingSelected()||[];a._deleteOnSuccess_=t;var n={main:r};return a.csrfToken&&(n.csrfToken=a.csrfToken),l&&(n.extraInfo=l),n=jslet.data.record2Json(n,i),a._dataProvider.sendRequest(a,e,n).done(a._doSubmitSelectedSuccess).fail(a._doApplyError).always(function(){a._submitting=!1})}catch(s){a._submitting=!1}}},_refreshInnerControl:function(e){var t,l,i;if(e.eventType==jslet.data.RefreshEvent.UPDATEALL||e.eventType==jslet.data.RefreshEvent.CHANGEMETA)for(l=this._linkedLabels.length,t=0;l>t;t++)i=this._linkedLabels[t],i.refreshControl&&i.refreshControl(e);for(l=this._linkedControls.length,t=0;l>t;t++)i=this._linkedControls[t],i.refreshControl&&i.refreshControl(e)},focusEditControl:function(e){for(var t,l,i,a=this,r=a._linkedControls.length-1;r>=0;r--)if(t=a._linkedControls[r],t.field&&t.field()==e){if(i=a.getField(e),!i||!i.visible()||i.disabled()||!t.isActiveRecord())continue;if(l=t.el,l.focus)try{return l.focus(),void(t.selectText&&t.selectText())}catch(n){console.warn("Can' focus into a disabled control!")}}},refreshField:function(e){this.refreshControl(jslet.data.RefreshEvent.updateColumnEvent(e))},refreshLookupField:function(e,t){var l;l=void 0===t?jslet.data.RefreshEvent.lookupEvent(e):jslet.data.RefreshEvent.lookupEvent(e,t),this.refreshControl(l)},refreshControl:function(e){this._lockCount||(e||(e=jslet.data.RefreshEvent.updateAllEvent()),this._refreshInnerControl(e))},addLinkedControl:function(e){e.isLabel?this._linkedLabels.push(e):this._linkedControls.push(e)},removeLinkedControl:function(e){var t=e.isLabel?this._linkedLabels:this._linkedControls,l=t.indexOf(e);l>=0&&t.splice(l,1)},refreshLookupHostDataset:function(){this._autoRefreshHostDataset&&jslet.data.datasetRelationManager.refreshLookupHostDataset(this._name)},handleLookupDatasetChanged:function(e){var t=this;t._inContextRule?t.refreshLookupField(e,t.recno()):(jslet.data.FieldValueCache.clearAll(t,e),t.refreshLookupField(e))},exportCsv:function(e){var t=this;t.confirm(),t.existDatasetError()&&console.warn(jslet.locale.Dataset.cannotConfirm);var l=!0,i=!0,a=!1,r=null,n=null;e&&jQuery.isPlainObject(e)&&(void 0!==e.exportHeader&&(l=e.exportHeader?!0:!1),void 0!==e.exportDisplayValue&&(i=e.exportDisplayValue?!0:!1),void 0!==e.onlySelected&&(a=e.onlySelected?!0:!1),void 0!==e.includeFields&&(r=e.includeFields,jslet.Checker.test("Dataset.exportCsv#exportOption.includeFields",r).isArray()),void 0!==e.excludeFields&&(n=e.excludeFields,jslet.Checker.test("Dataset.exportCsv#exportOption.excludeFields",n).isArray()));var s=",",o='"',d=t.startSilenceMove();try{t.first();var u,c,h,f,v,p=[],_=t._normalFields.length,g=[];for(v=0;_>v;v++){if(c=t._normalFields[v],h=c.name(),r&&r.length>0){if(r.indexOf(h)<0)continue}else if(!c.visible())continue;n&&n.length>0&&n.indexOf(h)>=0||g.push(c)}if(_=g.length,l){for(u=[],v=0;_>v;v++)c=g[v],h=c.label()||c.name(),h=o+h+o,u.push(h);p.push(u.join(s))}for(;!t.isEof();)if(!a||t.selected()){for(u=[],v=0;_>v;v++)c=g[v],h=c.name(),f=i&&("N"!==c.getType()||c.lookup())?t.getFieldText(h):t.getFieldValue(h),f||0===f?f+="":f="",f=f.replace(/"/,""),f=o+f+o,u.push(f);p.push(u.join(s)),t.next()}else t.next();return p.join("\n")}finally{t.endSilenceMove(d)}},exportCsvFile:function(e,t,l,i,a){jslet.Checker.test("Dataset.exportCsvFile#fileName",e).required().isString();var r=this.exportCsv(t,l,i,a),n=document.createElement("a"),s=new Blob([r],{type:"text/csv"});n.href=window.URL.createObjectURL(s),n.download=e,n.click()},filteredDataList:function(){var e=this,t=[],l=e.recnoSilence();e.confirm();try{for(var i=0,a=e.recordCount();a>i;i++)e.recnoSilence(i),t.push(e.getRecord())}finally{e.recnoSilence(l)}return t},iterate:function(e,t,l){jslet.Checker.test("Dataset.iterate#callBackFn",e).required().isFunction();var i=this,a=[],r=i.startSilenceMove();try{t=t||0,0===l||l||(l=i.recordCount()-1);for(var n=t;l>=n;n++)i.recno(n),e&&e.call(i)}finally{i.endSilenceMove(r)}return a},dataList:function(e){var t=this;if(void 0===e)return t._datasetField?t._datasetField.getValue():t._dataList;jslet.Checker.test("Dataset.dataList",e).isArray(),t._datasetField?(null===e&&(e=[]),t._datasetField.setValue(e)):t._dataList=e,t._initialize();var l=t._subDatasetFields;if(l)for(var i,a,r=0,n=l.length;n>r;r++)i=l[r],a=i.subDataset(),a&&(a.confirm(),a._initialize());return this},_initialize:function(e){var t=this;e||(jslet.data.FieldValueCache.removeAllCache(t),jslet.data.FieldError.clearDatasetError(t),jslet.data.convertDateFieldValue(t),t._changeLog.clear()),t.status(jslet.data.DataSetStatus.BROWSE),t._recno=-1,t.indexFields(t.indexFields()),t.filter(null),(t.filtered()||t.fixedFilter())&&t._doFilterChanged(),t.first(),t.calcAggradedValue(),t.refreshControl(jslet.data.RefreshEvent._updateAllEvent),t.refreshLookupHostDataset()},textList:function(){var e=this;e.confirm();var t,l,i,a,r=e.recno(),n=[],s=e._normalFields.length;try{for(var o=0,d=e.recordCount();d>o;o++){e.recnoSilence(o),a={};for(var u=0;s>u;u++)t=e._normalFields[u],l=t.name(),i=e.getFieldText(l),a[l]=i;n.push(a)}return n}finally{this.recnoSilence(r)}},exportSnapshot:function(){var e=this,t={name:e.name(),recno:e.recno(),status:e.status(),dataList:e.dataList(),changedRecords:e._changeLog._changedRecords},l=e.indexFields();l&&(t.indexFields=l);var i=e.filter();i&&(t.filter=i,t.filtered=e.filtered());var a,r={master:t},n=null,s=e._subDatasetFields;if(s)for(var o,d,u=0,c=s.length;c>u;u++)o=s[u],d=o.subDataset(),d&&(n||(n=[]),a={name:d.name(),recno:d.recno(),status:d.status()},l=d.indexFields(),l&&(d.indexFields=l),i=d.filter(),i&&(d.filter=i,d.filtered=d.filtered()),n.push(a));return n&&(r.details=n),r},importSnapshot:function(e){jslet.Checker.test("Dataset.importSnapshot#snapshot",e).required().isPlanObject();var t=e.master;jslet.Checker.test("Dataset.importSnapshot#snapshot.master",t).required().isPlanObject();var l=this,i=t.name;if(i!=l._name)throw new Error("Snapshot does not match the current dataset name!");if(l._dataList=t.dataList,l._changeLog._changedRecords=t.changedRecords,void 0!==t.indexFields&&l.indexFields(t.indexFields),void 0!=t.filter&&(l.filter(t.filter),l.filtered(t.filtered)),t.recno>=0){l._silence++;try{l.recno(t.recno)}finally{l._silence--}}l.refreshControl();var a=e.details;if(a&&0!==a.length)for(var r,n,s=0,o=a.length;o>s;s++)if(r=a[s],n=jslet.data.getDataset(r.name)){if(void 0!==r.indexFields&&n.indexFields(r.indexFields),void 0!==r.filter&&(n.filter(r.filter),n.filtered(r.filtered)),r.recno>=0){n._silence++;try{n.recno(r.recno)}finally{n._silence--}}n.refreshControl()}},destroy:function(){var e=this;e._masterDataset=null,e._detailDatasets=null,e._fields=null,e._linkedControls=null,e._innerFilter=null,e._innerFindCondition=null,e._sortingFields=null,e._innerFormularFields=null,e._datasetField=null,jslet.data.dataModule.unset(e._name),jslet.data.datasetRelationManager.removeDataset(e._name)}},jslet.data.createEnumDataset=function(e,t){jslet.Checker.test("createEnumDataset#enumStrOrObj",t).required();var l=new jslet.data.Dataset(e);l.addField(jslet.data.createStringField("code",10)),l.addField(jslet.data.createStringField("name",20)),l.keyField("code"),l.codeField("code"),l.nameField("name");var i=[];if(jslet.isString(t))for(var a,r=jQuery.trim(t),n=r.split(","),s=0,o=n.length;o>s;s++)a=jQuery.trim(n[s]),rec=a.split(":"),i[i.length]={code:jQuery.trim(rec[0]),name:jQuery.trim(rec[1])};else for(var d in t)i[i.length]={code:d,name:t[d]};return l.dataList(i),l.indexFields("code"),l},jslet.data.createDataset=function(e,t,l){function i(e){var t=l[e];void 0===t&&(t=l[e.toLowerCase()]),void 0!==t&&o[e](t)}function a(e){var t=l[e];void 0===t&&(t=l[e.toLowerCase()]),void 0!==t&&o[e](parseInt(t))}function r(e){var t=l[e];void 0===t&&(t=l[e.toLowerCase()]),void 0!==t&&(jslet.isString(t)&&t&&(t="0"!=t&&"false"!=t),o[e](t?!0:!1))}jslet.Checker.test("createDataset#fieldConfig",t).required().isArray(),jslet.Checker.test("Dataset.createDataset#datasetCfg",l).isPlanObject();for(var n,s,o=new jslet.data.Dataset(e),d=0,u=t.length;u>d;d++)s=t[d],jslet.Checker.test("Dataset.createDataset#fieldCfg",s).isPlanObject(),s.dsName=e,n=jslet.data.createField(s),o.addField(n);l&&(i("keyField"),i("codeField"),i("nameField"),i("parentField"),i("levelOrderField"),i("selectField"),i("recordClass"),i("queryUrl"),i("submitUrl"),a("pageNo"),a("pageSize"),i("fixedIndexFields"),i("indexFields"),i("fixedFilter"),i("filter"),r("filtered"),r("autoShowError"),r("autoRefreshHostDataset"),r("readOnly"),r("logChanges"),i("datasetListener"),i("onFieldChange"),i("onCheckSelectable"),i("contextRules"));var c=jslet.data.globalDataHandler.datasetCreated();return c&&c(o),o},jslet.data.ChangeLog=function(e){this._dataset=e,this._changedRecords=null},jslet.data.ChangeLog.prototype={changedRecords:function(e){return void 0===e?this._changedRecords:void(this._changedRecords=e)},log:function(e){if(this._dataset.logChanges()){e||(e=this._dataset.getRecord());var t=jslet.data.getRecInfo(e);if(t.status){var l=this._getChangedRecords();l.indexOf(e)<0&&l.push(e)}}},unlog:function(e){if(this._dataset.logChanges()){e||(e=this._dataset.getRecord());var t=this._getChangedRecords(e),l=t.indexOf(e);l>=0&&t.splice(l,1)}},clear:function(){this._changedRecords=null},_getChangedRecords:function(){var e,t=this._dataset,l=t.datasetField();if(l){var i=l.name(),a=l.dataset();masterRecInfo=jslet.data.getRecInfo(a.getRecord()),masterRecInfo.subLog||(masterRecInfo.subLog={}),e=masterRecInfo.subLog[i],e||(e=[],masterRecInfo.subLog[i]=e)}else this._changedRecords||(this._changedRecords=[]),e=this._changedRecords;return e}},jslet.data.DataTransformer=function(e){this._dataset=e},jslet.data.DataTransformer.prototype={hasChangedData:function(){var e=this._dataset._changeLog._changedRecords;return e&&0!==e.length?!0:!1},getSubmittingChanged:function(){var e=this._dataset._changeLog._changedRecords;if(!e||0===e.length)return null;var t=this._convert(this._dataset,e);return t},getSubmittingSelected:function(){var e=this._dataset.selectedRecords();if(!e||0===e.length)return null;var t=this._convert(this._dataset,e,!0);return t},_convert:function(e,t,l){if(!t||0===t.length)return null;for(var i,a,r,n,s=e._recordClass||jslet.global.defaultRecordClass,o=[],d=0,u=t.length;u>d;d++){i=t[d],a=jslet.data.getRecInfo(i),r={},s&&(r["@type"]=s),n=a.subLog,i[jslet.global.changeStateField]=this._getStatusPrefix(a.status)+d;var c,h;for(var f in i)if("_jl_"!==f)if(c=e.getField(f),c&&c.getType()===jslet.data.DataType.DATASET){var v=c.subDataset();void 0===l&&(l=!v._onlyChangedSubmitted);var p=i[f];if(!l){var _=n?n[f]:null;if(_)for(var g,m,j=0,C=_.length;C>j;j++)g=_[j],m=jslet.data.getRecInfo(g),m&&m.status===jslet.data.DataSetStatus.DELETE&&p.push(g)}h=this._convert(v,p),h&&(r[f]=h)}else r[f]=i[f];o.push(r)}return o},_getStatusPrefix:function(e){return e===jslet.data.DataSetStatus.INSERT?"i":e===jslet.data.DataSetStatus.UPDATE?"u":e===jslet.data.DataSetStatus.DELETE?"d":"s"},refreshSubmittedData:function(e){e&&0!==e.length&&this._refreshDataset(this._dataset,e)},_refreshDataset:function(e,t,l){if(t&&0!==t.length){l||jslet.data.convertDateFieldValue(e,t);var i,a=e.datasetField();if(a){var r=a.dataset().getRecord(),n=jslet.data.getRecInfo(r);i=n.subLog?n.subLog[a.name()]:null}else i=e._changeLog._changedRecords;for(var s,o=0,d=t.length;d>o;o++)s=t[o],s?this._refreshRecord(e,s,i):console.warn("The return record exists null. Please check it.")}},_refreshRecord:function(e,t,l){var i=t[jslet.global.changeStateField];if(i)if(l&&"d"==i.charAt(0)){for(var a=0,r=l.length;r>a;a++)if(i==l[a][jslet.global.changeStateField]){l.splice(a,1);break}}else for(var n,s,o=e.dataList()||[],a=o.length-1;a>=0;a--)if(n=o[a],n[jslet.global.changeStateField]==i){for(var d in t)d&&(s=e.getField(d),s&&s.subDataset()?this._refreshDataset(s.subDataset(),t[d],!0):n[d]=t[d]);if(l)for(var a=0,r=l.length;r>a;a++)if(i==l[a][jslet.global.changeStateField]){l.splice(a,1);break}n[jslet.global.changeStateField]=null;var u=jslet.data.getRecInfo(n);u&&u.status&&(u.status=0),jslet.data.FieldValueCache.removeCache(n)}}},jslet.Expression=function(e,t){if(jslet.Checker.test("jslet.Expression#dataset",e).required(),jslet.Checker.test("jslet.Expression#expr",t).required().isString(),this._fields=[],this._otherDatasetFields=[],this._expr=t,this._parsedExpr="","string"==typeof e){if(this._dataset=jslet.data.getDataset(e),!this._dataset)throw new Error(jslet.formatString(jslet.locale.Dataset.datasetNotFound,[dsName]))}else jslet.Checker.test("jslet.Expression#dataset",e).isClass(jslet.data.Dataset.className),this._dataset=e;this.context={mainds:e},this.parse()},jslet.Expression.prototype={_ParserPattern:/\[[_a-zA-Z][\.!\w]*(,\d){0,1}]/gim,parse:function(){var e,t,l,i,a,r,n,s=0,o=[],d=null;for(this._ParserPattern.lastIndex=0;null!==(r=this._ParserPattern.exec(this._expr));)if(i=r[0],i&&!i.endsWith("(")){if(l=null,i=i.substr(1,i.length-2),t=i.indexOf(","),t>0&&(d=parseInt(i.substr(t+1)),isNaN(d)&&(d=null),i=i.substr(0,t)),t=i.indexOf("!"),t>0&&(l=i.substr(0,t),i=i.substr(t+1)),e=r.index,n=this._dataset,l){if(a=jslet.data.dataModule.get(l),!a)throw new Error(jslet.formatString(jslet.locale.Dataset.datasetNotFound,[l]));this.context[l]=a,n=a}l?(o.push(this._expr.substring(s,e)),o.push("context."),o.push(l),o.push('.getFieldValue("'),this._otherDatasetFields.push({dataset:l,fieldName:i})):(o.push(this._expr.substring(s,e)),o.push('context.mainds.getFieldValueByRecord(context.dataRec, "'),this._fields.push(i)),o.push(i),o.push('"'),null!==d&&(o.push(","),o.push(d)),o.push(")"),s=e+r[0].length}o.push(this._expr.substr(s)),this._parsedExpr=o.join("")},mainFields:function(){return this._fields},otherDatasetFields:function(){return this._otherDatasetFields},eval:function(){var context=this.context;return context.mainds=this._dataset,eval(this._parsedExpr)},destroy:function(){this._dataset=null,this._fields=null,this._otherDatasetFields=[],this._parsedExpr=null,this._expr=null,this.context=null}},jslet.data.Field=function(e,t){jslet.Checker.test("Field#fieldName",e).isString(),e=jQuery.trim(e),jslet.Checker.test("Field#fieldName",e).required(),jslet.Checker.test("Field#dataType",t).isString().required();var l=this;l._dataset=null,l._dsName=null,l._displayOrder=0,l._tabIndex=null,l._fieldName=e,l._dataType=t,l._length=0,l._scale=0,l._unique=!1,l._defaultExpr=null,l._defaultValue=null,l._label=null,l._tip=null,l._message=null,l._displayWidth=0,l._editMask=null,l._displayFormat=null,l._dateFormat=null,l._formula=null,l._readOnly=!1,l._visible=!0,l._disabled=!1,l._customValueConverter=null,l._unitConverted=!1,l._lookup=null,l._displayControl=null,l._editControl=null,l._subDataset=null,l._urlExpr=null,l._innerUrlExpr=null,l._urlTarget=null,l._valueStyle=jslet.data.FieldValueStyle.NORMAL,l._valueCountLimit=0,l._required=!1,l._nullText=jslet.locale.Dataset.nullText,l._dataRange=null,l._regularExpr=null,l._antiXss=!0,l._customValidator=null,l._validChars=null,l._dateChar=null,l._dateRegular=null,l._parent=null,l._children=null,l._trueValue=!0,l._falseValue=!1,l._trueText=null,l._falseText=null,l._mergeSame=!1,l._mergeSameBy=null,l._fixedValue=null,l._valueFollow=!1,l._aggraded=!1,l._aggradedBy=null,l._crossSource=null},jslet.data.Field.className="jslet.data.Field",jslet.data.Field.prototype={className:jslet.data.Field.className,dataset:function(e){var t=this;return void 0===e?t._parent?t._parent.dataset():t._dataset:(jslet.isString(e)?e=jslet.data.getDataset(e):jslet.Checker.test("Field.dataset",e).isClass(jslet.data.Dataset.className),e&&(t._dsName=e.name()),t._removeRelation(),t._dataset=e,t._clearFieldCache(),t._addRelation(),this)},name:function(){return arguments.length>0&&alert("Can't change field name!"),this._fieldName},label:function(e){var t=this;return void 0===e?t._label||t._fieldName:(jslet.Checker.test("Field.label",e).isString(),t._label=e,t._fireMetaChangedEvent("label"),t._fireGlobalMetaChangedEvent("label"),this)},tip:function(e){var t=this;return void 0===e?t._tip:(jslet.Checker.test("Field.tip",e).isString(),t._tip=e,t._fireMetaChangedEvent("tip"),t._fireGlobalMetaChangedEvent("tip"),this)},getType:function(){return this._dataType},parent:function(e){var t=this;return void 0===e?t._parent:(jslet.Checker.test("Field.parent",e).isClass(this.className),t._parent=e,this)},children:function(e){var t=this;if(void 0===e)return t._children;jslet.Checker.test("Field.children",e).isArray();for(var l=0,i=e.length;i>l;l++)jslet.Checker.test("Field.children#childField",e[l]).isClass(this.className);return t._children=e,this},displayOrder:function(e){var t=this;return void 0===e?t._displayOrder:(jslet.Checker.test("Field.displayOrder",e).isNumber(),t._displayOrder=parseInt(e),t._fireGlobalMetaChangedEvent("displayOrder"),this)},tabIndex:function(e){var t=this;return void 0===e?t._tabIndex:(jslet.Checker.test("Field.tabIndex",e).isNumber(),t._tabIndex=parseInt(e),t._fireMetaChangedEvent("tabIndex"),t._fireGlobalMetaChangedEvent("tabIndex"),this)},length:function(e){var t=this;return void 0===e?t._length:(jslet.Checker.test("Field.length",e).isGTEZero(),t._length=parseInt(e),t._fireGlobalMetaChangedEvent("length"),this)},getEditLength:function(){var e=this;if(e._lookup){var t=e._lookup.codeField(),l=e._lookup.dataset();if(l&&t){var i=l.getField(t);if(i)return i.getEditLength()}}return e._dataType===jslet.data.DataType.NUMBER&&e._scale>0?e._length+1:e._length>0?e._length:10},scale:function(e){var t=this;return void 0===e?t._scale:(jslet.Checker.test("Field.scale",e).isGTEZero(),t._scale=parseInt(e),t._fireGlobalMetaChangedEvent("scale"),this)},alignment:function(e){var t=this;return void 0===e?t._alignment?t._alignment:t._lookup?"left":t._dataType==jslet.data.DataType.NUMBER?"right":t._dataType==jslet.data.DataType.BOOLEAN?"center":"left":(jslet.Checker.test("Field.alignment",e).isString(),t._alignment=jQuery.trim(e),t._fireColumnUpdatedEvent(),t._fireGlobalMetaChangedEvent("alignment"),this)},nullText:function(e){var t=this;return void 0===e?t._nullText:(jslet.Checker.test("Field.nullText",e).isString(),e=jQuery.trim(e),t._nullText=e,t._clearFieldCache(),t._fireColumnUpdatedEvent(),t._fireGlobalMetaChangedEvent("nullText"),this)},displayWidth:function(e){var t=this;return void 0===e?t._displayWidth<=0?t._length>0?t._length:12:t._displayWidth:(jslet.Checker.test("Field.displayWidth",e).isGTEZero(),t._displayWidth=parseInt(e),t._fireGlobalMetaChangedEvent("displayWidth"),this)},defaultExpr:function(e){var t=this;return void 0===e?t._defaultExpr:(jslet.Checker.test("Field.defaultExpr",e).isString(),t._defaultExpr=e,t._fireGlobalMetaChangedEvent("defaultExpr"),this)},displayFormat:function(e){var t=this;return void 0===e?t._displayFormat?t._displayFormat:t._dataType==jslet.data.DataType.DATE?jslet.locale.Date.format:t._displayFormat:(jslet.Checker.test("Field.displayFormat",e).isString(),t._displayFormat=jQuery.trim(e),t._dateFormat=null,t._dateChar=null,t._dateRegular=null,t._clearFieldCache(),t._fireColumnUpdatedEvent(),t._fireGlobalMetaChangedEvent("displayFormat"),this)},defaultValue:function(e){var t=this;return void 0===e?t._defaultValue:(jslet.Checker.test("Field.defaultValue",t.dftValue).isDataType(t._dateType),t._defaultValue=e,t._fireGlobalMetaChangedEvent("defaultValue"),this)},unique:function(e){var t=this;return void 0===e?t._unique:(t._unique=e?!0:!1,t._fireGlobalMetaChangedEvent("unique"),this)},required:function(e){var t=this;return void 0===e?t._required:(t._required=e?!0:!1,t._fireMetaChangedEvent("required"),t._fireGlobalMetaChangedEvent("required"),this)},editMask:function(e){var t=this;return void 0===e?t._editMask:(e?jslet.isString(e)&&(e={mask:e,keepChar:!0}):e=null,t._editMask=e,t._clearFieldCache(),t._fireMetaChangedEvent("editMask"),t._fireGlobalMetaChangedEvent("required"),this)},dateFormat:function(){var e=this;if(e._dateFormat)return e._dateFormat;if(this.getType()!=jslet.data.DataType.DATE)return null;var t=this.displayFormat().toUpperCase();e._dateFormat="";for(var l,i=0,a=t.length;a>i;i++)l=t.charAt(i),"YMD".indexOf(l)<0||e._dateFormat.indexOf(l)<0&&(e._dateFormat+=l);return e._dateFormat},dateSeparator:function(){var e=this;if(e._dateChar)return e._dateChar;if(this.getType()!=jslet.data.DataType.DATE)return null;for(var t,l=this.displayFormat().toUpperCase(),i=0,a=l.length;a>i;i++)if(t=l.charAt(i),"YMD".indexOf(t)<0)return e._dateChar=t,t},dateRegular:function(){var e=this;if(e._dateRegular)return e._dateRegular;for(var t,l=this.dateFormat(),i=this.dateSeparator(),a=["^"],r=0;r<l.length;r++)r>0&&(a.push("\\"),a.push(i)),t=l.charAt(r),"Y"==t?a.push("(\\d{4}|\\d{2})"):"M"==t?a.push("(0?[1-9]|1[012])"):a.push("(0?[1-9]|[12][0-9]|3[01])");return a.push("(\\s+\\d{2}:\\d{2}:\\d{2}(\\.\\d{3}){0,1}){0,1}"),a.push("$"),e._dateRegular={expr:new RegExp(a.join(""),"gim"),message:jslet.locale.Dataset.invalidDate},e._dateRegular},formula:function(e){var t=this;if(void 0===e)return t._formula;jslet.Checker.test("Field.formula",e).isString(),t._formula=jQuery.trim(e),t._clearFieldCache();var l=t.dataset();return l&&(l.removeInnerFormulaField(t._fieldName),l.addInnerFormulaField(t._fieldName,t._formula),t._fireColumnUpdatedEvent()),t._fireGlobalMetaChangedEvent("formula"),this},visible:function(e){var t=this;if(void 0===e){if(t._visible)for(var l=this.parent();l;){if(!l.visible())return!1;l=l.parent()}return t._visible}return t._visible=e?!0:!1,t._fireMetaChangedEvent("visible"),t._fireGlobalMetaChangedEvent("visible"),this},disabled:function(e){var t=this;return void 0===e?t._disabled:(t._disabled=e?!0:!1,t._fireMetaChangedEvent("disabled"),t._fireGlobalMetaChangedEvent("disabled"),this)},readOnly:function(e){var t=this;if(void 0===e){if(t._dataType==jslet.data.DataType.DATASET)return!0;var l=t.children();return l&&0===l.length?!0:t._readOnly||t._dataset.readOnly()}return t._readOnly=e?!0:!1,t._fireMetaChangedEvent("readOnly"),t._fireGlobalMetaChangedEvent("readOnly"),this},fieldReadOnly:function(){var e=this;if(e._dataType==jslet.data.DataType.DATASET)return!0;var t=e.children();return t&&0===t.length?!0:e._readOnly},fieldDisabled:function(){return this._disabled},_fireGlobalMetaChangedEvent:function(e){var t=this.dataset();if(t&&t.designMode()){var l=jslet.data.globalDataHandler.fieldMetaChanged();l&&l.call(this,t,this._fieldName,e)}},_fireMetaChangedEvent:function(e,t){var l=this.dataset();if(l){var i=jslet.data.RefreshEvent.changeMetaEvent(e,this._fieldName,t);l.refreshControl(i)}},_fireColumnUpdatedEvent:function(){var e=this.dataset();if(e){var t=jslet.data.RefreshEvent.updateColumnEvent(this._fieldName);e.refreshControl(t)}},unitConverted:function(e){var t=this;if(void 0===e)return t._dataType==jslet.data.DataType.NUMBER?t._unitConverted:!1;t._unitConverted=e?!0:!1;var l=this.dataset();return t._clearFieldCache(),t._dataType==jslet.data.DataType.NUMBER&&l&&1!=l.unitConvertFactor()&&t._fireColumnUpdatedEvent(),t._fireGlobalMetaChangedEvent("unitConverted"),this},valueStyle:function(e){var t=this;return void 0===e?t._dataType==jslet.data.DataType.DATASET||t._children&&t._children.length>0?jslet.data.FieldValueStyle.NORMAL:t._valueStyle:(e=e?parseInt(e):0,jslet.Checker.test("Field.valueStyle",e).isNumber().inArray([0,1,2]),t._valueStyle=e,t._clearFieldCache(),t._fireColumnUpdatedEvent(),t._fireGlobalMetaChangedEvent("valueStyle"),this)},valueCountLimit:function(e){var t=this;return void 0===e?t._valueCountLimit:(e?jslet.Checker.test("Field.valueCountLimit",e).isNumber():e=0,t._valueCountLimit=parseInt(e),t._fireGlobalMetaChangedEvent("valueCountLimit"),this)},displayControl:function(e){var t=this;return void 0===e?t._dataType!=jslet.data.DataType.BOOLEAN||t._displayControl?t._displayControl:{
type:"dbcheckbox"}:(t._displayControl="string"==typeof t._fieldName?{type:e}:e,t._fireGlobalMetaChangedEvent("displayControl"),this)},editControl:function(e){var t=this;return void 0===e?t._editControl?t._editControl:t._dataType==jslet.data.DataType.BOOLEAN?{type:"dbcheckbox"}:t._dataType==jslet.data.DataType.DATE?{type:"dbdatepicker"}:null!==t._lookup?{type:"dbselect"}:{type:"dbtext"}:("string"==typeof e&&(e=jQuery.trim(e),e=e?e.indexOf(":")>0?jslet.JSON.parse(e):{type:e}:null),t._editControl=e,t._fireMetaChangedEvent("editControl"),t._fireGlobalMetaChangedEvent("editControl"),this)},onCustomFormatFieldText:null,_addRelation:function(){var e,t=this;if(t._dataset&&(t.getType()==jslet.data.DataType.DATASET||t._lookup)){var l,i=t._dataset.name(),a=t._fieldName;t.getType()==jslet.data.DataType.DATASET?t._subDataset&&(e=t._getDatasetName(t._subDataset),l=jslet.data.DatasetType.DETAIL,jslet.data.datasetRelationManager.addRelation(i,a,e,l)):(e=t._getDatasetName(t._lookup._dataset),l=jslet.data.DatasetType.LOOKUP,jslet.data.datasetRelationManager.addRelation(i,a,e,l))}},_removeRelation:function(){var e=this;if(e._dataset&&(e._subDataset||e._lookup)){var t=e._dataset.name(),l=e._fieldName;e._subDataset?lkDsName=e._getDatasetName(e._subDataset):lkDsName=e._getDatasetName(e._lookup._dataset),jslet.data.datasetRelationManager.removeRelation(t,l,lkDsName)}},lookup:function(e){var t=this;return void 0===e?t._lookup:(jslet.Checker.test("Field.lookup",e).isClass(jslet.data.FieldLookup.className),t._removeRelation(),t._lookup=e,e&&(e.hostField(t),t._addRelation()),t._clearFieldCache(),t._fireColumnUpdatedEvent(),this)},_getDatasetName:function(e){return jslet.isString(e)?e:e.name()},_subDsParsed:!1,subDataset:function(e){var t=this;if(void 0===e){if(!t._subDsParsed&&t._subDataset&&(t.subDataset(t._subDataset),!t._subDsParsed))throw new Error(jslet.formatString(jslet.locale.Dataset.datasetNotFound,[t._subDataset]));return t._subDataset}var l=t._getDatasetName(t._subDataset),i=t._getDatasetName(e),a=l!=i,r=e;return jslet.isString(r)&&(r=jslet.data.getDataset(r),!r&&jslet.data.onCreatingDataset&&jslet.data.onCreatingDataset(e,jslet.data.DatasetType.DETAIL,null,t._dsName)),a&&t._removeRelation(),r?(jslet.Checker.test("Field.subDataset",r).isClass(jslet.data.Dataset.className),t._subDataset&&t._subDataset.datasetField&&t._subDataset.datasetField(null),t._subDataset=r,t._subDsParsed=!0):(t._subDataset=e,t._subDsParsed=!1),a&&t._addRelation(),this},urlExpr:function(e){var t=this;return void 0===e?t._urlExpr:(jslet.Checker.test("Field.urlExpr",e).isString(),t._urlExpr=jQuery.trim(e),t._innerUrlExpr=null,t._clearFieldCache(),t._fireColumnUpdatedEvent(),t._fireGlobalMetaChangedEvent("urlExpr"),this)},urlTarget:function(e){var t=this;return void 0===e?t._urlTarget?t._urlTarget:jslet.data.Field.URLTARGETBLANK:(jslet.Checker.test("Field.urlTarget",e).isString(),t._urlTarget=jQuery.trim(e),t._clearFieldCache(),t._fireColumnUpdatedEvent(),t._fireGlobalMetaChangedEvent("urlTarget"),this)},calcUrl:function(){var e=this;return this.dataset()&&e._urlExpr?(e._innerUrlExpr||(e._innerUrlExpr=new jslet.Expression(this.dataset(),e._urlExpr)),e._innerUrlExpr.eval()):null},antiXss:function(e){var t=this;return void 0===e?t._antiXss:(t._antiXss=e?!0:!1,t._fireGlobalMetaChangedEvent("antiXss"),this)},dataRange:function(e){var t=this;return void 0===e?t._dataRange:(e&&jslet.isString(e)&&(e=jslet.JSON.parse(e)),e&&(jslet.Checker.test("Field.dataRange",e).isObject(),e.min&&jslet.Checker.test("Field.dataRange.min",e.min).isDataType(t._dateType),e.max&&jslet.Checker.test("Field.dataRange.max",e.max).isDataType(t._dateType)),t._dataRange=e,t._fireGlobalMetaChangedEvent("dataRange"),this)},regularExpr:function(e,t){var l=this,i=arguments.length;return 0===i?l._regularExpr:(1==i?l._regularExpr=e:l._regularExpr={expr:e,message:t},l._fireGlobalMetaChangedEvent("regularExpr"),this)},customValueConverter:function(e){var t=this;return void 0===e?t._customValueConverter:(t._customValueConverter=e,t._clearFieldCache(),t._fireColumnUpdatedEvent(),t._fireGlobalMetaChangedEvent("customValueConverter"),this)},customValidator:function(e){var t=this;return void 0===e?t._customValidator:(e&&jslet.Checker.test("Field.customValidator",e).isFunction(),t._customValidator=e,t._fireGlobalMetaChangedEvent("customValidator"),this)},validChars:function(e){var t=this;if(void 0===e){if(t._validChars)return t._validChars;if(t._dataType==jslet.data.DataType.NUMBER)return t._scale?"+-0123456789.":"+-0123456789";if(t._dataType==jslet.data.DataType.DATE){for(var l=t.displayFormat(),e="0123456789",i=0,a=l.length;a>i;i++){var r=l.charAt(i);"y"!==r&&"M"!==r&&"d"!==r&&"h"!==r&&"m"!==r&&"s"!==r&&(e+=r)}return e}return null}return t._validChars=e,t._fireGlobalMetaChangedEvent("validChars"),this},trueValue:function(e){var t=this;return void 0===e?t._trueValue:(t._trueValue=e,this)},falseValue:function(e){var t=this;return void 0===e?t._falseValue:(t._falseValue=e,this)},trueText:function(e){var t=this;return void 0===e?t._trueText||jslet.locale.Dataset.trueText:(t._trueText=e,this)},falseText:function(e){var t=this;return void 0===e?t._falseText||jslet.locale.Dataset.falseText:(t._falseText=e,this)},mergeSame:function(e){var t=this;return void 0===e?t._mergeSame:(t._mergeSame=e?!0:!1,t._fireGlobalMetaChangedEvent("mergeSame"),this)},mergeSameBy:function(e){var t=this;return void 0===e?t._mergeSameBy:(jslet.Checker.test("Field.mergeSameBy",e).isString(),t._mergeSameBy=jQuery.trim(e),t._fireGlobalMetaChangedEvent("mergeSameBy"),this)},valueFollow:function(e){var t=this;return void 0===e?t._valueFollow:(t._valueFollow=e?!0:!1,!t._valueFollow&&t._dataset&&(t._dataset._followedValue=null),t._fireGlobalMetaChangedEvent("valueFollow"),this)},aggraded:function(e){var t=this;return void 0===e?t._aggraded:(t._aggraded=e?!0:!1,t._fireGlobalMetaChangedEvent("aggraded"),this)},aggradedBy:function(e){var t=this;return void 0===e?t._aggradedBy:(jslet.Checker.test("Field.aggradedBy",e).isString(),t._aggradedBy=jQuery.trim(e),t._fireGlobalMetaChangedEvent("aggradedBy"),this)},crossSource:function(e){var t=this;return void 0===e?t._crossSource:(jslet.Checker.test("Field.crossSource",e).isClass(jslet.data.CrossFieldSource.className),t._crossSource=e,this)},fixedValue:function(e){var t=this;return void 0===e?t._fixedValue:(jslet.Checker.test("Field.fixedValue",e).isString(),t._fixedValue=jQuery.trim(e),t._fireGlobalMetaChangedEvent("fixedValue"),this)},getValue:function(e){return this._dataset.getFieldValue(this._fieldName,e)},setValue:function(e,t){this._dataset.setFieldValue(this._fieldName,e,t)},getTextValue:function(e,t){return this._dataset.getFieldText(this._fieldName,e,t)},setTextValue:function(e,t){this._dataset.setFieldText(this._fieldName,inputText,t)},clone:function(e,t){var l=this;jslet.Checker.test("Field.clone#fldName",e).required().isString();var i=new jslet.data.Field(e,l._dataType);if(i.dataset(t?t:this.dataset()),i.length(l._length),i.scale(l._scale),i.alignment(l._alignment),i.defaultExpr(l._defaultExpr),i.defaultValue(l._defaultValue),i.label(l._label),i.tip(l._tip),i.displayWidth(l._displayWidth),l._editMask&&i.editMask(l._editMask.clone()),i.displayOrder(l._displayOrder),i.tabIndex(l._tabIndex),i.displayFormat(l._displayFormat),i.dateFormat(l._dateFormat),i.formula(l._formula),i.unique(l._unique),i.required(l._required),i.readOnly(l._readOnly),i.visible(l._visible),i.disabled(l._disabled),i.unitConverted(l._underted),l._lookup&&i.lookup(l._lookup.clone()),i.displayControl(l._displayControl),i.editControl(l._editControl),i.urlExpr(l._urlExpr),i.urlTarget(l._urlTarget),i.valueStyle(l._valueStyle),i.valueCountLimit(l._valueCountLimit),i.nullText(l._nullText),i.dataRange(l._dataRange),l._regularExpr&&i.regularExpr(l._regularExpr),i.antiXss(l._antiXss),i.customValidator(l._customValidator),i.customValueConverter(l._customValueConverter),i.validChars(l._validChars),l._parent&&i.parent(l._parent.clone(t)),l._children&&l._children.length>0){for(var a=[],r=0,n=l._children.length;n>r;r++)a.push(l._children[r].clone(t));i.children(a)}return i.mergeSame(l._mergeSame),i.mergeSameBy(l._mergeSameBy),i.fixedValue(l._fixedValue),i.valueFollow(l._valueFollow),i.aggraded(l._aggraded),i.aggradedBy(l._aggradedBy),i.trueValue(l._trueValue),i.falseValue(l._falseValue),i.trueText(l._trueText),i.falseText(l._falseText),i},_clearFieldCache:function(){var e=this;e._dataset&&e._fieldName&&jslet.data.FieldValueCache.clearAll(e._dataset,e._fieldName)}},jslet.data.Field.URLTARGETBLANK="_blank",jslet.data.createField=function(e,t){function l(e){var t=i[e];void 0!==t&&r[e](t)}jslet.Checker.test("createField#fieldConfig",e).required().isObject();var i=e;if(!i.name)throw new Error("Property: name required!");var a=i.type;null===a?a=jslet.data.DataType.STRING:(a=a.toUpperCase(),a!=jslet.data.DataType.STRING&&a!=jslet.data.DataType.NUMBER&&a!=jslet.data.DataType.DATE&&a!=jslet.data.DataType.BOOLEAN&&a!=jslet.data.DataType.CROSS&&a!=jslet.data.DataType.DATASET&&(a=jslet.data.DataType.STRING));var r=new jslet.data.Field(i.shortName||i.name,a);if(e.dsName&&(r._dsName=e.dsName),r.parent(t),t&&r.dataset(t.dataset()),i.crossSource){var n=jslet.data.createCrossFieldSource(i.crossSource);r.crossSource(n)}if(l("tabIndex"),l("displayOrder"),l("label"),l("tip"),a==jslet.data.DataType.DATASET){var s=i.subDataset||i.subdataset;if(!s)throw new Error("subDataset NOT set when field data type is Dataset");return r.subDataset(s),r.visible(!1),r}l("visible"),l("unique"),l("required"),l("readOnly"),l("disabled"),l("length"),l("scale"),l("alignment"),l("formula"),l("defaultExpr"),l("defaultValue"),l("displayWidth"),l("editMask"),l("displayFormat"),l("nullText"),l("unitConverted"),l("editControl"),l("urlExpr"),l("urlTarget"),l("valueStyle"),l("valueCountLimit"),l("dataRange"),l("customValidator"),l("customValueConverter"),l("trueValue"),l("falseValue"),l("mergeSame"),l("mergeSameBy"),l("aggraded"),l("valueFollow"),l("aggradedBy"),l("mergeSameBy"),l("fixedValue"),l("antiXss"),l("validChars"),l("trueValue"),l("falseValue"),l("trueText"),l("falseText");var o=i.regularExpr,d=i.regularMessage;o&&r.regularExpr(o,d);var u=i.lookup;if(void 0===u){var c=i.lookupSource||i.lookupsource||i.lookupDataset||i.lookupdataset;lkParam=i.lookupParam||i.lookupparam,realDataset=i.realSource||i.realsource||i.realDataset||i.realdataset,c&&(u=lkParam?jslet.isString(lkParam)?jslet.JSON.parse(lkParam):lkParam:{},u.dataset=c,realDataset&&(u.realDataset=realDataset))}if(void 0!==u&&u&&(jslet.isString(u)&&(u=u.trim(),u&&(u=u.trim().startsWith("{")?jslet.JSON.parse(u):{dataset:u})),r.lookup(jslet.data.createFieldLookup(u,r._dsName))),i.children){for(var h,f=[],v=0,p=i.children.length;p>v;v++)h=jslet.data.createField(i.children[v],r),h.displayOrder(v),f.push(h);r.children(f),r.alignment("center")}return r},jslet.data.createStringField=function(e,t,l){var i=new jslet.data.Field(e,jslet.data.DataType.STRING,l);return i.length(t),i},jslet.data.createNumberField=function(e,t,l,i){var a=new jslet.data.Field(e,jslet.data.DataType.NUMBER,i);return a.length(t),a.scale(l),a},jslet.data.createBooleanField=function(e,t){return new jslet.data.Field(e,jslet.data.DataType.BOOLEAN,t)},jslet.data.createDateField=function(e,t){var l=new jslet.data.Field(e,jslet.data.DataType.DATE,t);return l},jslet.data.createDatasetField=function(e,t,l){if(!t)throw new Error("expected property:dataset in DatasetField!");var i=new jslet.data.Field(e,jslet.data.DataType.DATASET,l);return i.subDataset(t),i.visible(!1),i},jslet.data.createCrossField=function(e,t,l){var i=new jslet.data.Field(e,jslet.data.DataType.CROSS,l);i.crossSource(t)},jslet.data.FieldLookup=function(){var e=this;e._hostDatasetName=null,e._hostField=null,e._dataset=null,e._realDataset=null,e._dsParsed=!1,e._keyField=null,e._codeField=null,e._nameField=null,e._codeFormat=null,e._displayFields=null,e._innerdisplayFields=null,e._parentField=null,e._onlyLeafLevel=!0,e._returnFieldMap=null,e._editFilter=null,e._editItemDisabled=!1},jslet.data.FieldLookup.className="jslet.data.FieldLookup",jslet.data.FieldLookup.prototype={className:jslet.data.FieldLookup.className,clone:function(){var e=this,t=new jslet.data.FieldLookup;return t.dataset(e._dataset),t.keyField(e._keyField),t.codeField(e._codeField),t.nameField(e._nameField),t.displayFields(e._displayFields),t.parentField(e._parentField),t.onlyLeafLevel(e._onlyLeafLevel),t.returnFieldMap(e._returnFieldMap),t.editFilter(e._editFilter),t.editItemDisabled(e._editItemDisabled),t},hostField:function(e){var t=this;return void 0===e?t._hostField:(jslet.Checker.test("FieldLookup.hostField",e).isClass(jslet.data.Field.className),t._hostField=e,this)},dataset:function(e){var t=this;if(void 0===e){if(!t._dsParsed&&(t.dataset(t._dataset),!t._dsParsed))throw new Error("Not found lookup dataset: "+t._dataset);return t._dataset}var l;if(e&&(l="string"==typeof e?e:e.name(),l==t._hostDatasetName))throw new Error(jslet.locale.Dataset.LookupDatasetNotSameAsHost);var i=e;return"string"==typeof i&&(i=jslet.data.getDataset(i),!i&&jslet.data.onCreatingDataset&&jslet.data.onCreatingDataset(e,jslet.data.DatasetType.LOOKUP,t._realDataset,t._hostDatasetName)),i?(t._dataset=i,t._dsParsed=!0):(t._dataset=e,t._dsParsed=!1),this},realDataset:function(e){var t=this;return void 0===e?t._realDataset:(jslet.Checker.test("FieldLookup.realDataset",e).isString(),t._realDataset=e,this)},keyField:function(e){var t=this;return void 0===e?t._keyField||t.dataset().keyField():(jslet.Checker.test("FieldLookup.keyField",e).isString(),t._keyField=jQuery.trim(e),this)},codeField:function(e){var t=this;return void 0===e?t._codeField||t.dataset().codeField():(jslet.Checker.test("FieldLookup.codeField",e).isString(),t._codeField=jQuery.trim(e),this)},codeFormat:function(e){var t=this;return void 0===e?t._codeFormat:(jslet.Checker.test("FieldLookup.codeFormat",e).isString(),t._codeFormat=jQuery.trim(e),this)},nameField:function(e){var t=this;return void 0===e?t._nameField||t.dataset().nameField():(jslet.Checker.test("FieldLookup.nameField",e).isString(),t._nameField=jQuery.trim(e),this)},parentField:function(e){var t=this;return void 0===e?t._parentField||t.dataset().parentField():(jslet.Checker.test("FieldLookup.parentField",e).isString(),t._parentField=jQuery.trim(e),this)},displayFields:function(e){var t=this;return void 0===e?t._displayFields?t._displayFields:this.getDefaultDisplayFields():(jslet.Checker.test("FieldLookup.displayFields",e).isString(),e=jQuery.trim(e),t._displayFields!=e&&(t._displayFields=e,t._innerdisplayFields=null,t._hostField&&t._hostField._clearFieldCache()),this)},returnFieldMap:function(e){return void 0===e?this._returnFieldMap:(jslet.Checker.test("FieldLookup.returnFieldMap",e).isObject(),void(this._returnFieldMap=e))},getDefaultDisplayFields:function(){var e="["+this.nameField()+"]";return e},getCurrentDisplayValue:function(){var e=this;return null===e._displayFields&&this.displayFields(this.getDefaultDisplayFields()),e._innerdisplayFields||(e._innerdisplayFields=new jslet.Expression(e.dataset(),e.displayFields())),e._innerdisplayFields.eval()},onlyLeafLevel:function(e){var t=this;return void 0===e?t._onlyLeafLevel:(t._onlyLeafLevel=e?!0:!1,this)},editFilter:function(e){var t=this;return void 0===e?t._editFilter:(jslet.Checker.test("FieldLookup.editFilter",e).isString(),t._editFilter!=e&&(t._editFilter=e),this)},editItemDisabled:function(e){var t=this;return void 0===e?t._editItemDisabled:(t._editItemDisabled=e?!0:!1,this)}},jslet.data.createFieldLookup=function(e,t){jslet.Checker.test("createFieldLookup#param",e).required().isObject();var l=e.dataset;if(!l)throw new Error("Property: dataset required!");var i=new jslet.data.FieldLookup;return i._hostDatasetName=t,void 0!==e.realDataset&&i.realDataset(e.realDataset),i.dataset(l),void 0!==e.keyField&&i.keyField(e.keyField),void 0!==e.codeField&&i.codeField(e.codeField),void 0!==e.nameField&&i.nameField(e.nameField),void 0!==e.codeFormat&&i.codeFormat(e.codeFormat),void 0!==e.displayFields&&i.displayFields(e.displayFields),void 0!==e.parentField&&i.parentField(e.parentField),void 0!==e.onlyLeafLevel&&i.onlyLeafLevel(e.onlyLeafLevel),void 0!==e.returnFieldMap&&i.returnFieldMap(e.returnFieldMap),void 0!==e.editFilter&&i.editFilter(e.editFilter),void 0!==e.editItemDisabled&&i.editItemDisabled(e.editItemDisabled),i},jslet.data.CrossFieldSource=function(){var e=this;e._sourceType=0,e._sourceField=null,e._lookupLevel=1,e._labels=null,e._values=null,e._matchExpr=null,e._hideEmptyValue=!1,e._hasSubtotal=!0,e._subtotalPosition=1,e._subtotalLabel=null},jslet.data.CrossFieldSource.className="jslet.data.CrossFieldSource",jslet.data.CrossFieldSource.prototype={className:jslet.data.CrossFieldSource.className,clone:function(){var e=this,t=new jslet.data.CrossFieldSource;return t.sourceType(e._sourceType),t.sourceField(e._sourceField),t.lookupLevel(e._lookupLevel),t.labels(e._labels),t.values(e._values),t.matchExpr(e._matchExpr),t.hideEmptyValue(e._hideEmptyValue),t.hasSubtotal(e._hasSubtotal),t.subtotalPosition(e._subtotalPosition),t.subtotalLabel(e._subtotalLabel),t},sourceType:function(e){var t=this;return void 0===e?t._sourceType:(jslet.Checker.test("CrossFieldSource.sourceType",e).isNumber(),t._sourceType=e,this)},sourceField:function(e){var t=this;return void 0===e?t._sourceField:(jslet.Checker.test("CrossFieldSource.sourceField",e).isString(),t._sourceField=e,this)},labels:function(e){var t=this;return void 0===e?t._labels:(jslet.Checker.test("CrossFieldSource.labels",e).isArray(),t._labels=e,this)},values:function(e){var t=this;return void 0===e?t._values:(jslet.Checker.test("CrossFieldSource.values",e).isArray(),t._values=e,this)},matchExpr:function(e){var t=this;return void 0===e?t._matchExpr:(jslet.Checker.test("CrossFieldSource.matchExpr",e).isString(),t._matchExpr=e,this)},hasSubtotal:function(e){var t=this;return void 0===e?t._hasSubtotal:(jslet.Checker.test("CrossFieldSource.hasSubtotal",e).isString(),t._hasSubtotal=e,this)},subtotalPosition:function(e){var t=this;return void 0===e?t._subtotalPosition:(jslet.Checker.test("CrossFieldSource.subtotalPosition",e).isNumber(),t._subtotalPosition=e,this)},subtotalLabel:function(e){var t=this;return void 0===e?t._subtotalLabel:(jslet.Checker.test("CrossFieldSource.subtotalLabel",e).isString(),t._subtotalLabel=e,this)}},jslet.data.createCrossFieldSource=function(e){var t=new jslet.data.CrossFieldSource,l=e.sourceType||0;return t.sourceType(l),void 0!==e.hasSubtotal&&t.hasSubtotal(e.hasSubtotal),void 0!==e.subtotalPosition&&t.subtotalPosition(e.subtotalPosition),void 0!==e.subtotalLabel&&t.subtotalLabel(e.subtotalLabel),0===l?t.sourceField(e.sourceField):(t.labels(e.labels),t.values(e.values),t.matchExpr(e.matchExpr)),t},jslet.data||(jslet.data={}),jslet.data.ApplyAction={QUERY:"query",SAVE:"save",SELECTED:"selected"},jslet.data.DataProvider=function(){this.sendRequest=function(e,t,l){var i;if(jslet.global.beforeSubmit&&(i=jslet.global.beforeSubmit({url:t})),i||(i={}),i.type="POST",i.contentType="application/json",i.mimeType="application/json",i.dataType="json",i.data=l,i.context=e,e.csrfToken){var a=i.headers||{};a.csrfToken=e.csrfToken,i.headers=a}var r=jQuery.Deferred();return jQuery.ajax(t,i).done(function(e,t,l){if(e){e.csrfToken&&(this.csrfToken=e.csrfToken);var i=e.errorCode;if(i)return void r.reject(e,this)}r.resolve(e,this)}).fail(function(e,t,l){var i,a=e.responseJSON;a&&a.errorCode?i={errorCode:a.errorCode,errorMessage:a.errorMessage}:("error"==t&&(errorCode="0000",errorMessage=jslet.locale.Common.ConnectError),i={errorCode:errorCode,errorMessage:errorMessage}),r.reject(i,this)}).always(function(e,t,l){if(jQuery.isFunction(e.done)){var i,a=e.responseJSON;i=a&&a.errorCode?{errorCode:a.errorCode,errorMessage:a.errorMessage}:{errorCode:t,errorMessage:l},r.always(i,this)}else r.always(e,this)}),r.promise()}}},function(e,t){!function(e){"use strict";function t(t,l,a,r){l||(l=document);var n=jQuery(l).find(t);i(n);var s=e(":focus"),o=0,d=null;if(1===s.length){d=s[0];var u=n.index(s);u+1<n.length?o=u+1:a&&(o=0)}var c=!0;if(r&&d&&(c=r(d,!1)),c){var h=n.eq(o);return h.focus(),h[0]}return d}function l(t,l,a,r){l||(l=document);var n=jQuery(l).find(t);i(n);var s=e(":focus"),o=n.length-1,d=null;if(1===s.length){d=s[0];var u=n.index(s);u>0?o=u-1:a&&(o=n.length-1)}var c=!0;if(r&&d&&(c=r(d,!0)),c){var h=n.eq(o);return h.focus(),h[0]}return d}function i(e){if(e)for(var t,l,i,a=1,r=e.length;r>a;a++){t=e[a],i=0;for(var n=a-1;n>=0;n--)if(l=e[n],l.tabIndex<=t.tabIndex){i=n+1;break}a!==i&&(e.splice(a,1),e.splice(i,0,t))}}function a(t){function l(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var i,a,r,n=t.nodeName.toLowerCase(),s=!isNaN(e.attr(t,"tabindex"));return"area"===n?(i=t.parentNode,a=i.name,t.href&&a&&"map"===i.nodeName.toLowerCase()?(r=e("img[usemap=#"+a+"]")[0],!!r&&l(r)):!1):(/input|select|textarea/.test(n)?!t.disabled:"a"===n?t.href||s:s)&&l(t)}e.focusNext=function(e,l,i){t(":focusable",e,l,i)},e.focusPrev=function(e,t,i){return l(":focusable",e,t,i)},e.tabNext=function(e,l,i){return t(":tabbable",e,l,i)},e.tabPrev=function(e,t,i){return l(":tabbable",e,t,i)},e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(l){return!!e.data(l,t)}}):function(t,l,i){return!!e.data(t,i[3])},focusable:function(t){return a(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var l=e.attr(t,"tabindex"),i=isNaN(l);return(i||l>=0)&&a(t,!i)}})}(jQuery),jslet.ui||(jslet.ui={}),jslet.ui.Control=jslet.Class.create({initialize:function(e,t){if(this.el=e,this.allProperties=null,t=jslet.ui._evalParams(t),this.isValidTemplateTag&&!this.isValidTemplateTag(this.el)){var l,i=jslet.ui.getControlClass(t.type);throw l=i?i.htmlTemplate:"",new Error(jslet.formatString(jslet.locale.DBControl.invalidHtmlTag,l))}this._childControls=null,this.setParams(t),this.checkRequiredProperty(),this.el.jslet=this,this.beforeBind(),this.bind(),this.afterBind()},beforeBind:function(){},bind:function(){},afterBind:function(){},setParams:function(e){if(e){var t=e.type;for(var l in e){var i=this[l];if("type"!=l){if(!i||!i.call)throw new Error(t+" NOT support control property: "+l);i.call(this,e[l])}}}},checkRequiredProperty:function(){if(this.requiredProperties)for(var e,t=this.requiredProperties.split(","),l=t.length,i=0;l>i;i++)if(e=t[i].trim(),!this[e])throw new Error(jslet.formatString(jslet.locale.DBControl.expectedProperty,[e]))},addChildControl:function(e){var t=this;t._childControls||(t._childControls=[]),e&&t._childControls.push(e)},removeAllChildControls:function(){var e,t=this;if(t._childControls){for(var l=0,i=t._childControls.length;i>l;l++)e=t._childControls[l],e.destroy();t._childControls=null}},destroy:function(){this.el&&(this.el.jslet=null,this.el=null)}}),jslet.ui.DBControl=jslet.Class.create(jslet.ui.Control,{initialize:function(e,t,l){e(t,l)},_dataset:void 0,dataset:function(e){return void 0===e?this._dataset:(jslet.isString(e)&&(e=jslet.data.dataModule.get(jQuery.trim(e))),jslet.Checker.test("DBControl.dataset",e).required().isClass(jslet.data.Dataset.className),void(this._dataset=e))},setParams:function(e,t){if(e(t),!this._dataset){var l=this.getDatasetInParentElement();this.dataset(l)}},beforeBind:function(e){e(),this._dataset.addLinkedControl(this)},checkRequiredProperty:function(e){jslet.Checker.test("DBControl.dataset",this._dataset).required(),e()},refreshControl:function(e,t){var l=this,i=e.eventType;if(i==jslet.data.RefreshEvent.CHANGEMETA){var a=e.metaName,r=e.changeAllRows;if(l._field&&l._field==e.fieldName){if(!r&&!t&&!l.isActiveRecord())return!1;l.doMetaChanged(a)}else l._field||"visible"!=a&&"editControl"!=a||l.doMetaChanged(a);return!0}return i==jslet.data.RefreshEvent.UPDATELOOKUP&&e.fieldName==l._field?(l._ctrlRecno>=0&&(e.recno||0===e.recno)?l._ctrlRecno===e.recno&&l.doLookupChanged():l.doLookupChanged(),!0):t||!l.isActiveRecord||l.isActiveRecord()?i==jslet.data.RefreshEvent.SCROLL||i==jslet.data.RefreshEvent.INSERT||i==jslet.data.RefreshEvent.DELETE?(l.doValueChanged(),!0):(i==jslet.data.RefreshEvent.UPDATERECORD||i==jslet.data.RefreshEvent.UPDATECOLUMN)&&void 0===e.fieldName||e.fieldName==l._field?(l.doValueChanged(),!0):i==jslet.data.RefreshEvent.UPDATEALL?(l.doMetaChanged(),l.doLookupChanged(),l.doValueChanged(),!0):!0:!1},doMetaChanged:function(e){},doValueChanged:function(){},doLookupChanged:function(){},getDatasetInParentElement:function(){for(var e=this.el,t=null;;){if(t=jslet.ui.getParentElement(e,1),!t)break;if(t.jslet)return t.jslet.dataset;e=t}return null},destroy:function(e){this.removeAllChildControls(),this._dataset&&this._dataset.removeLinkedControl(this),this._dataset=null,e()}}),jslet.ui.DBFieldControl=jslet.Class.create(jslet.ui.DBControl,{initialize:function(e,t,l){e(t,l)},_field:void 0,_valueIndex:void 0,_enableInvalidTip:!0,_ctrlRecno:-1,_inTableCtrl:!1,field:function(e){if(void 0===e)return this._field;e=jQuery.trim(e),jslet.Checker.test("DBControl.field",e).isString().required();var t=e.lastIndexOf("#");t>0&&(this._fieldMeta=e.substring(t+1),e=e.substring(0,t)),this._field=e},fieldMeta:function(){return this._fieldMeta},valueIndex:function(e){return void 0===e?this._valueIndex:(jslet.Checker.test("DBControl.valueIndex",e).isNumber(),void(this._valueIndex=parseInt(e)))},setParams:function(e,t){e(t),value=t.valueIndex,void 0!==value&&this.valueIndex(value)},checkRequiredProperty:function(e){e(),jslet.Checker.test("DBControl.field",this._field).required(),this.existField(this._field)},doMetaChanged:function(e,t){if(e(t),!t||"tip"==t){var l=this._dataset.getField(this._field);if(!l)throw new Error("Field: "+this._field+" NOT exist!");var i=l.tip();i=i?i:"",this.el.title=i}},setTabIndex:function(e){var t=this;t._inTableCtrl||(0===e||e||(fldObj=t._dataset.getField(t._field),fldObj&&(e=fldObj.tabIndex())),(0===e||e)&&(t.el.tabIndex=e))},existField:function(e){var t=this._dataset.getField(e);return t?!0:!1},ctrlRecno:function(e){return void 0===e?this._ctrlRecno:(jslet.Checker.test("DBFieldControl.ctrlRecno",e).isGTEZero(),this._ctrlRecno=e,void this.doValueChanged())},inTableCtrl:function(e){return void 0===e?this._inTableCtrl:void(this._inTableCtrl=e)},getValue:function(){var e=this;return e._ctrlRecno<0?e._dataset.getFieldValue(e._field,e._valueIndex):e._dataset.getFieldValueByRecno(e._ctrlRecno,e._field,e._valueIndex)},getText:function(e){var t=this;return t._ctrlRecno<0?t._dataset.getFieldText(t._field,e,t._valueIndex):t._dataset.getFieldTextByRecno(t._ctrlRecno,t._field,e,t._valueIndex)},isActiveRecord:function(){return this._ctrlRecno<0||this._ctrlRecno==this._dataset.recno()},forceRefreshControl:function(){this.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(this._field),!0)},getFieldError:function(){var e,t=this;return e=t._ctrlRecno<0?t._dataset.getFieldError(t._field,t._valueIndex):t._dataset.getFieldErrorByRecno(t._ctrlRecno,t._field,t._valueIndex)},renderInvalid:function(e){var t=this;t._field&&(e?(jQuery(t.el).parent().addClass("has-error"),t.el.title=e.message||""):(jQuery(t.el).parent().removeClass("has-error"),t.el.title=""))},destroy:function(e){this._field=null,e()}}),jslet.ui._evalParams=function(e){if(jslet.Checker.test("evalParams#ctrlParams",e).required(),jslet.isString(e)){var t=jQuery.trim(e);!t.startsWith("{")&&t.indexOf(":")>0&&(t="{"+t+"}");try{return e=new Function("return "+t)(),e["var"]&&(e=e["var"]),e}catch(l){throw new Error(jslet.formatString(jslet.locale.DBControl.invalidJsletProp,[e]))}}return e},jslet.ui.controls=new jslet.SimpleMap,jslet.ui.register=function(e,t){jslet.ui.controls.set(e.toLowerCase(),t)},jslet.ui.createControl=function(e,t,l,i,a){var r=document.createElement("div"),n=jslet.ui._evalParams(e),s=n.type;s||(s=jslet.ui.controls.DBTEXT);var o=jslet.ui.controls.get(s.toLowerCase());if(!o)throw new Error("NOT found control type: "+s);r.innerHTML=o.htmlTemplate;var d=r.firstChild;return r.removeChild(d),a&&(d.style.display="none"),t?t.appendChild(d):document.body.appendChild(d),l&&(parseInt(l)==l&&(l+="px"),d.style.width=l),i&&(parseInt(i)==i&&(i+="px"),d.style.height=i),new o(d,n)},jslet.ui.getControlClass=function(e){return jslet.ui.controls.get(e.toLowerCase())},jslet.ui.bindControl=function(e,t){if(t||(t=jQuery(e).attr("data-jslet")),e.jslet)return void console.warn("Control has installed! Don't install it again!");var l=jslet.ui._evalParams(t),i=l.type;if(!i)return void(e.jslet=l);var a=jslet.ui.controls.get(i.toLowerCase());if(!a)throw new Error("NOT found control type: "+i);new a(e,l)},jslet.ui.unbindControl=function(e){e.jslet&&e.jslet.destroy&&e.jslet.destroy(),e.jslet=null},jslet.ui.rebindControl=function(e){jslet.ui.unbindControl(e),jslet.ui.bindControl(e)},jslet.ui.install=function(e,t){if(e&&void 0===t&&jQuery.isFunction(e)&&(t=e,e=null),!e&&jslet.locale.isRtl){var l=jQuery(document.body);l.hasClass("jl-rtl")||l.addClass("jl-rtl")}var i;e||(e=document.body),i=jQuery(e).find("*[data-jslet]");for(var a,r=i.length,n=0;r>n;n++)a=i[n],jslet.ui.bindControl(a);t&&t()},jslet.ui.uninstall=function(e){var t;t=e?jQuery(e).find("*[data-jslet]"):jQuery("*[data-jslet]");for(var l,i=0,a=t.length;a>i;i++)l=t[i],l.jslet&&l.jslet.destroy&&l.jslet.destroy(),l.jslet=null;jslet.ui.menuManager&&jQuery(document).off("mousedown",jslet.ui.menuManager.hideAll)},jslet.ui||(jslet.ui={}),jslet.ui.DnD=function(){var e,t,l,i,a,r,n,s=2,o=!1,d=!0,u=this;this._docMouseDown=function(s){s=jQuery.event.fix(s||window.event),d=!0,a=0,r=0,e=s.pageX,t=s.pageY,o=!1,n&&n._doMouseDown&&n._doMouseDown(e,t,l,i,a,r)},this._docMouseMove=function(u){if(d){if(u=jQuery.event.fix(u||window.event),l=u.pageX,i=u.pageY,!o&&(Math.abs(a)>s||Math.abs(r)>s))return o=!0,e=l,t=i,void(n&&n._doDragStart&&n._doDragStart(e,t));a=l-e,r=i-t,o?n&&n._doDragging&&n._doDragging(e,t,l,i,a,r):(n&&n._doMouseMove&&n._doMouseMove(e,t,l,i,a,r),e=l,t=i)}},this._docMouseUp=function(s){d=!1,o?(o=!1,n&&n._doDragEnd&&n._doDragEnd(e,t,l,i,a,r)):n&&n._doMouseUp&&n._doMouseUp(e,t,l,i,a,r),u.unbindControl()},this._docKeydown=function(e){e=jQuery.event.fix(e||window.event),27==e.which&&o&&(o=!1,n&&n._doDragCancel&&(n._doDragCancel(),u.unbindControl()))},this._docSelectStart=function(e){return e=jQuery.event.fix(e||window.event),e.preventDefault(),!1},this.bindControl=function(e){n=e;var t=jQuery(document);t.on("mousedown",this._docMouseDown),t.on("mouseup",this._docMouseUp),t.on("mousemove",this._docMouseMove),t.on("selectstart",this._docSelectStart),t.on("keydown",this._docKeydown)},this.unbindControl=function(){var e=jQuery(document);e.off("mousedown",this._docMouseDown),e.off("mouseup",this._docMouseUp),e.off("mousemove",this._docMouseMove),e.off("selectstart",this._docSelectStart),e.off("keydown",this._docKeydown),n=null}},jslet.ui.dnd=new jslet.ui.DnD,jslet.ui||(jslet.ui={}),jslet.ui.EditMask=function(){this._mask=null,this._keepChar=!0,this._transform=null,this._literalChars=null,this._parsedMask=null,this._format=null,this._target=null,this._buffer=null},jslet.ui.EditMask.prototype={maskChars:{"#":{regexpr:new RegExp("[0-9\\-]"),required:!1},0:{regexpr:new RegExp("[0-9]"),required:!0},9:{regexpr:new RegExp("[0-9]"),required:!1},L:{regexpr:new RegExp("[A-Za-z]"),required:!0},l:{regexpr:new RegExp("[A-Za-z]"),required:!1},A:{regexpr:new RegExp("[0-9a-zA-Z]"),required:!0},a:{regexpr:new RegExp("[0-9a-zA-Z]"),required:!1},C:{regexpr:null,required:!0},c:{regexpr:null,required:!1}},transforms:["upper","lower"],setMask:function(e,t,l){if(e=jQuery.trim(e),jslet.Checker.test("EditMask#mask",e).isString(),this._mask=e,this._keepChar=t?!0:!1,this._transform=null,l){var i=jslet.Checker.test("EditMask#transform",l).isString();l=jQuery.trim(l),l=l.toLowerCase(),i.inArray(this.transforms),this._transform=l}this._parseMask()},attach:function(e){jslet.Checker.test("EditMask.attach#target",e).required();var t=this,l=jQuery(e);t._target=e,l.on("keypress.editmask",function(e){if(this.readOnly||!t._mask)return!0;var l=e.which;
return 0===l?!0:t._doKeypress(l)?!0:void e.preventDefault()}),l.on("keydown.editmask",function(e){return this.readOnly||!t._mask?!0:t._doKeydown(e.which)?!0:void e.preventDefault()}),l.on("blur.editmask",function(e){return this.readOnly||!t._mask?!0:t._doBur()?!0:(e.preventDefault(),void e.currentTarget.focus())}),l.on("cut.editmask",function(e){return this.readOnly||!t._mask?!0:(t._doCut(e.originalEvent.clipboardData||window.clipboardData),e.preventDefault(),!1)}),l.on("paste.editmask",function(e){return this.readOnly||!t._mask?!0:void(t._doPaste(e.originalEvent.clipboardData||window.clipboardData)||e.preventDefault())})},detach:function(){var e=jQuery(this._target);e.off("keypress.editmask"),e.off("keydown.editmask"),e.off("blur.editmask"),e.off("cut.editmask"),e.off("paste.editmask"),this._target=null},setValue:function(e){if(e=jQuery.trim(e),jslet.Checker.test("EditMask.setValue#value",e).isString(),e=e?e:"",!this._mask)return void(this._target.value=e);var t=this;t._clearBuffer(0);var l,i,a,r,n,s,o=0,d=0,u=0;for(t._parsedMask.length;;){if(s=t._getFixedCharAndPos(o),l=s.pos,r=s.ch,0>l&&(l=o),!r){i=0;var c,h=t._buffer.length;for(a=o;h>a&&(c=e.charAt(d+i),c);a++)t._buffer[a]=c,i++;break}for(u=e.indexOf(r,d),0>u&&(u=e.length),i=-1,a=u-1;a>=d;a--)n=e.charAt(a),t._buffer[i+l]=n,i--;d=u+1,o=l+1}t._showValue()},getValue:function(){var e=this._target.value;if(this._keepChar)return e;for(var t,l=[],i=0,a=e.length;a>i;i++)t=this._parsedMask[i],t.isMask&&l.push(e.charAt(i));return l.join("")},validateValue:function(){for(var e,t=this,l=t._parsedMask.length,i=0;l>i;i++)if(e=t._parsedMask[i],e.isMask&&t.maskChars[e.ch].required&&t._buffer[i]==t._format[i])return!1;return!0},_getFixedCharAndPos:function(e){var t=this;if(!t._literalChars||0===t._literalChars.length)return{pos:0,ch:null};e||(e=0);for(var l,i,a=e,r=t._parsedMask.length;r>a;a++)if(i=t._parsedMask[a],!i.isMask&&(l=i.ch,t._literalChars.indexOf(l)>=0))return{ch:l,pos:a};return{pos:-1,ch:null}},_parseMask:function(){var e=this;if(!e._mask)return void(e._parsedMask=null);e._parsedMask=[],e._format=[];for(var t,l,i=null,a=0,r=e._mask.length;r>a;a++)if(t=e._mask.charAt(a),"\\"!=t){if(l=!1,void 0===e.maskChars[t]?(i&&e._parsedMask.push({ch:i,isMask:l}),e._parsedMask.push({ch:t,isMask:l})):(l=i?!1:!0,e._parsedMask.push({ch:t,isMask:l})),e._keepChar&&!l){e._literalChars||(e._literalChars=[]);for(var n=!0,s=0,o=e._literalChars.length;o>s;s++)if(e._literalChars[s]==t){n=!1;break}n&&e._literalChars.push(t)}i=null,e._format.push(l?"_":t)}else i=t;e._buffer=e._format.slice(0),e._target&&(e._target.value=e._format.join(""))},_validateChar:function(e,t){var l=this.maskChars[e],i=l.regexpr;return i?i.test(t):!0},_getValidPos:function(e,t){var l,i=this,a=i._parsedMask.length;if(e>=a)return a-1;if(t){for(l=e;l>=0;l--)if(i._parsedMask[l].isMask)return l;for(l=e;a>l;l++)if(i._parsedMask[l].isMask)return l}else{for(l=e;a>l;l++)if(i._parsedMask[l].isMask)return l;for(l=e;l>=0;l--)if(i._parsedMask[l].isMask)return l}return-1},_clearBuffer:function(e,t){if(this._buffer){t||(t=this._buffer.length-1);for(var l=e;t>=l;l++)this._buffer[l]=this._format[l]}},_packEmpty:function(e,t){var l,i,a=0,r=this;for(i=e;i>=0;i--)if(l=r._format[i],r._literalChars&&r._literalChars.indexOf(l)>=0){a=i;break}e=a;var n=[];for(i=e;t>i;i++)l=r._buffer[i],l!=r._format[i]&&n.push(l);var s=n.length-1;for(i=t-1;i>=e;i--)s>=0?(r._buffer[i]=n[s],s--):r._buffer[i]=r._format[i]},_updateBuffer:function(e,t){var l=e.begin,i=e.end,a=this;if(l=a._getValidPos(l),0>l)return-1;if(a._clearBuffer(l+1,i),!(a._literalChars&&a._literalChars.indexOf(t)>=0)){var r=a._parsedMask[l];return a._validateChar(r.ch,t)?(a._buffer[l]=t,l):-1}for(var n=l,s=a._parsedMask.length;s>n;n++)if(a._parsedMask[n].ch==t)return a._packEmpty(l,n),n},_moveCursor:function(e,t){e=this._getValidPos(e,t),e>=0&&jslet.ui.textutil.setCursorPos(this._target,e)},_showValue:function(){this._target.value=this._buffer.join("")},_doKeypress:function(e){if(13==e)return!0;var t=String.fromCharCode(e),l=this;"upper"==l._transform?t=t.toUpperCase():"lower"==l._transform&&(t=t.toLowerCase());var i=jslet.ui.textutil.getCursorPos(l._target),a=l._updateBuffer(i,t);return l._showValue(),a>=0?l._moveCursor(a+1):l._moveCursor(i.begin),!1},_doKeydown:function(e){var t=this,l=jslet.ui.textutil.getCursorPos(t._target),i=l.begin,a=l.end;if(229==e){var r=t._parsedMask.legnth>i;if(r){var n=t._parsedMask[i];if(r=n.isMask){var s=n.ch;r="c"==s||"C"==s}}r||window.setTimeout(function(){t._showValue(),t._moveCursor(i)},50)}return 13==e?!0:8==e?(i==a&&(i=t._getValidPos(--i,!0),a=i),t._clearBuffer(i,a),t._showValue(),t._moveCursor(i,!0),!1):27==e?!1:46==e?(t._clearBuffer(i,a-1),t._showValue(),t._moveCursor(i),!1):!0},_doBur:function(){for(var e,t,l=this,i=0,a=l._parsedMask.length;a>i;i++)if(e=l._parsedMask[i],e.isMask&&(t=e.ch,l.maskChars[t].required&&l._buffer[i]==l._format[i]))return!0;return!0},_doCut:function(e){var t=this,l=jslet.ui.textutil.getSelectedText(t._target),i=jslet.ui.textutil.getCursorPos(t._target),a=i.begin;return t._clearBuffer(a,i.end-1),t._showValue(),t._moveCursor(a,!0),e.setData("Text",l),!1},_doPaste:function(e){var t=e.getData("Text");if(!t)return!1;var l,i=jslet.ui.textutil.getCursorPos(this._target),a=0;i.end=i.begin;for(var r=0;r<t.length;r++)l=t.charAt(r),a=this._updateBuffer(i,l),i.begin=r,i.end=i.begin;return this._showValue(),a>=0&&this._moveCursor(a+1),!0}},jslet.ui.textutil={selectText:function(e,t,l){var i=e.value;if(i.length>0)if(t=void 0===t?0:t,l=void 0===l?i.length:l,e.setSelectionRange)e.setSelectionRange(t,l);else if(e.createTextRange){var a=e.createTextRange();a.moveStart("character",t),a.moveEnd("character",l-i.length),a.select()}},getSelectedText:function(e){if(e.setSelectionRange){var t=e.selectionStart,l=e.selectionEnd;return e.value.substring(t,l)}return document.selection&&document.selection.createRange?document.selection.createRange().text:void 0},getCursorPos:function(e){var t={begin:0,end:0};if(e.setSelectionRange)t.begin=e.selectionStart,t.end=e.selectionEnd;else if(document.selection&&document.selection.createRange){var l=document.selection.createRange();t.begin=0-l.duplicate().moveStart("character",-1e5),t.end=t.begin+l.text.length}return t},setCursorPos:function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var l=e.createTextRange();l.collapse(!0),l.moveEnd("character",t),l.moveStart("character",t),l.select()}}},jslet.ResizeEventBus=function(){var e=null;this.resize=function(t){e&&window.clearTimeout(e),e=setTimeout(function(){var l,i,a;l=t?jQuery(t).find("*[data-jslet-resizable]"):jQuery("*[data-jslet-resizable]"),jslet.ui._activePopup&&jslet.ui._activePopup.hide();for(var r=0,n=l.length;n>r;r++)i=l[r],i&&(a=i.jslet,a&&a.checkSizeChanged&&a.checkSizeChanged());e=null},100)},this.subscribe=function(e){if(!e||!e.el)throw new Error("ctrlObj required!");jQuery(e.el).attr(jslet.ResizeEventBus.RESIZABLE,!0)},this.unsubscribe=function(e){if(!e||!e.el)throw new Error("ctrlObj required!");jQuery(e.el).removeAttr(jslet.ResizeEventBus.RESIZABLE)}},jslet.ResizeEventBus.RESIZABLE="data-jslet-resizable",jslet.resizeEventBus=new jslet.ResizeEventBus,jQuery(window).on("resize",function(){jslet.resizeEventBus.resize()}),jslet.ui||(jslet.ui={}),jslet.ui.htmlclass={},jslet.ui.GlobalZIndex=100,jslet.ui.KeyCode={UP:38,DOWN:40,LEFT:37,RIGHT:39,TAB:9,ENTER:13},jslet.ui.PopupPanel=function(){this.onHidePopup=null,this.isShowing=!1,this.documentClickHandler=function(e){e=jQuery.event.fix(e||window.event);var t=e.target;jslet.ui.isChild(jslet.ui.PopupPanel.excludedElement,t)||jslet.ui.inPopupPanel(t)||jslet.ui._activePopup&&jslet.ui._activePopup.hide()},this._stopMouseEvent=function(e){e.stopImmediatePropagation(),e.preventDefault()},this._createPanel=function(){if(!jslet.ui._popupPanel){var e=document.createElement("div");e.style.display="none",e.className="jl-popup-panel jl-opaque jl-border-box dropdown-menu",e.style.position="absolute",e.style.zIndex=99e3,document.body.appendChild(e),jQuery(document).on("click",this.documentClickHandler),jslet.ui._popupPanel=e}},this.show=function(e,t,l,i,a,r){this._createPanel(),e=parseInt(e),t=parseInt(t),i&&(jslet.ui._popupPanel.style.height=parseInt(i)+"px"),l&&(jslet.ui._popupPanel.style.width=parseInt(l)+"px");var n=jQuery(window),s=n.scrollLeft()+n.width(),o=n.scrollTop()+n.height(),d=jQuery(jslet.ui._popupPanel),u=d.outerWidth(),c=d.outerHeight();jslet.locale.isRtl&&(e-=u),e+u>s&&(e+=s-e-u-1),t+c>o&&(t-=c+r),0>e&&(e=1),0>t&&(t=1),t&&(jslet.ui._popupPanel.style.top=t+"px"),e&&(jslet.ui._popupPanel.style.left=e+"px"),jslet.ui._popupPanel.style.display="block";var h=jslet.ui._popupShadow;h&&(h.style.width=u+"px",h.style.height=c+"px",h.style.top=t+2+"px",h.style.left=e+2+"px",h.style.display="block"),jslet.ui._activePopup=this,this.isShowing=!0},this.setContent=function(e,t,l){this._createPanel();var i=jslet.ui._popupPanel.childNodes[0];i&&jslet.ui._popupPanel.removeChild(i),jslet.ui._popupPanel.appendChild(e),e.style.border="none",t&&(e.style.width=t),l&&(e.style.height=l)},this.getPopupPanel=function(){return this._createPanel(),jslet.ui._popupPanel},this.destroy=function(){jslet.ui._popupPanel&&(this.isShowing=!1,document.body.removeChild(jslet.ui._popupPanel),jslet.ui._popupShadow&&document.body.removeChild(jslet.ui._popupShadow),jQuery(this._popupPanel).off(),jslet.ui._popupPanel=null,jslet.ui._popupShadow=null,this.onHidePopup=null,jQuery(document).off("click",this.documentClickHandler))},this.hide=function(){jslet.ui._popupPanel&&(jslet.ui._popupPanel.style.display="none",jslet.ui._popupShadow&&(jslet.ui._popupShadow.style.display="none")),this.onHidePopup&&this.onHidePopup(),this.isShowing=!1,delete jslet.ui._activePopup}},jslet.ui.inPopupPanel=function(e){return e&&e!=document?jQuery(e).hasClass("jl-popup-panel")?!0:jslet.ui.inPopupPanel(e.parentNode):!1},jslet.ui.getParentElement=function(e,t){t||(t=1);for(var l=e.parentElement?!0:!1,i=e,a=0;t>a;a++)if(i=l?i.parentElement:i.parentNode,!i)return null;return i},jslet.ui.findFirstParent=function(e,t,l){var i=e;return i?t?t(i)?i:l&&l(i.parentNode)?null:jslet.ui.findFirstParent(i.parentNode,t,l):i.parentNode:null},jslet.ui.findJsletParent=function(e){return jslet.ui.findFirstParent(e,function(e){return e.jslet?!0:!1})},jslet.ui.isChild=function(e,t){if(!e||!t)return!1;for(var l=t;l;){if(l==e)return!0;l=l.parentNode}return!1},jslet.ui.TextMeasurer=function(){function e(e){a!=e&&(t.innerHTML=e)}var t,l,i=document.body,a=null,r=function(){t||(t=document.createElement("div"),document.body.appendChild(t),t.style.position="absolute",t.style.left="-9999px",t.style.top="-9999px",t.style.display="none",t.style.margin="0px",t.style.padding="0px",t.style.overflow="hidden"),i||(i=document.body)};this.setElement=function(e){i=e,i&&(r(),t.style.fontSize=i.style.fontSize,t.style.fontStyle=i.style.fontStyle,t.style.fontWeight=i.style.fontWeight,t.style.fontFamily=i.style.fontFamily,t.style.lineHeight=i.style.lineHeight,t.style.textTransform=i.style.textTransform,t.style.letterSpacing=i.style.letterSpacing)},this.setElementWidth=function(e){l=e,i&&(e?i.style.width=e:i.style.width="")},this.getSize=function(l){r(),e(l);var i=jQuery(t);return{width:i.width(),height:i.height()}},this.getWidth=function(e){return this.getSize(e).width},this.getHeight=function(e){return this.getSize(e).height}},jslet.ui.textMeasurer=new jslet.ui.TextMeasurer,jslet.ui.getCssValue=function(e,t){var l=document.createElement("div");l.className=e,l.style.display="none",document.body.appendChild(l);var i=jQuery(l).css(t);return document.body.removeChild(l),i},jslet.ui.setEditableStyle=function(e,t,l,i,a){i||(e.disabled=t,e.readOnly=l);var r=jQuery(e);t||l?r.hasClass("jl-readonly")||(r.addClass("jl-readonly"),r.removeClass("jl-ctrl-required")):(r.removeClass("jl-readonly"),a&&r.addClass("jl-ctrl-required"))},jslet.scrollbarSize=function(){var e,t,l;return void 0===l&&(e=jQuery('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),t=e.children(),l=t.innerWidth()-t.height(99).innerWidth(),e.remove()),l},jslet.ui.FocusManager=function(e){this._onChangingFocus=null,this._focusKeyCode=null,this._containerId=e,this.initialize()},jslet.ui.FocusManager.prototype={onChangingFocus:function(e){return void 0===e?this._onChangingFocus:(jslet.Checker.test("FocusManager.onChangingFocus",e).isFunction(),void(this._onChangingFocus=e))},focusKeyCode:function(e){return void 0===e?this._focusKeyCode:(jslet.Checker.test("FocusManager.focusKeyCode",e).isNumber(),void(this._focusKeyCode=e))},initialize:function(){function e(e){var t=e.tagName;if("TEXTAREA"==t||"A"==t||"BUTTON"==t)return!1;if("INPUT"==t){var l=e.type;if("button"==l||"image"==l||"reset"==l||"submit"==l||"url"==l||"file"==l)return!1}return!0}function t(e,t){var l=jslet(e),i=null,r=null,n=null;return l&&(l.dataset&&(i=l.dataset()),l.field&&(r=l.field()),l.valueIndex&&(n=l.valueIndex())),a._onChangingFocus?a._onChangingFocus(e,t,i,r,n):!0}function l(l){var r=a._focusKeyCode||jslet.global.defaultFocusKeyCode||9,n=l.which;if(n===r||9===n){if(9!==n&&!e(l.target))return;if(this._containerId){if(i=jQuery("#"+this._containerId),0===i.length)throw new Error("Not found container: "+this._containerId)}else i=jQuery(document);return l.shiftKey?jQuery.tabPrev(i,!0,t):jQuery.tabNext(i,!0,t),l.preventDefault(),l.stopImmediatePropagation(),!1}}var i,a=this;if(this._containerId){if(i=jQuery("#"+this._containerId),0===i.length)throw new Error("Not found container: "+this._containerId)}else i=jQuery(document);i.keydown(l)}},jslet.ui.rootFocusManager=new jslet.ui.FocusManager,jslet.ui.Accordion=jslet.Class.create(jslet.ui.Control,{initialize:function(e,t,l){var i=this;i.el=t,i.allProperties="selectedIndex,onChanged,items",i._selectedIndex=0,i._onChanged=null,i._items=null,e(t,l)},selectedIndex:function(e){return void 0===e?this._selectedIndex:(jslet.Checker.test("Accordion.selectedIndex",e).isGTEZero(),void(this._selectedIndex=e))},onChanged:function(e){return void 0===e?this._onChanged:(jslet.Checker.test("Accordion.onChanged",e).isFunction(),void(this._onChanged=e))},items:function(e){if(void 0===e)return this._items;jslet.Checker.test("Accordion.items",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("Accordion.items.caption",t.caption).isString().required();this._items=e},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-accordion")||t.addClass("jl-accordion jl-border-box jl-round5");var l,i=t.find(">div"),a=0,r=e._items?e._items.length-1:-1;i.before(function(t){return l=r>=t?e._items[t].caption:"caption"+t,'<button class="btn btn-default jl-accordion-head btn-sm" jsletindex = "'+t+'">'+l+"</button>"});var n=t.find(">.jl-accordion-head");n.click(e._doCaptionClick),a=n.outerHeight()*i.length;var s=t.innerHeight()-a-1;i.wrap('<div class="jl-accordion-body" style="height:'+s+'px;display:none"></div>'),e.setSelectedIndex(e._selectedIndex,!0)},_doCaptionClick:function(e){var t=jQuery(e.currentTarget),l=jslet.ui.findJsletParent(t[0]).jslet,i=parseInt(t.attr("jsletindex"));l.setSelectedIndex(i)},setSelectedIndex:function(e,t){e||(e=0);var l=this,i=jQuery(l.el).find(">.jl-accordion-body"),a=i.length-1;if(!(e>a)){if(l._selectedIndex==e&&a>e)return jQuery(i[e]).slideUp("fast"),(!t||t&&e>0)&&e++,jQuery(i[e]).slideDown("fast"),l._selectedIndex=e,void(l._onChanged&&l._onChanged.call(this,e));l._selectedIndex>=0&&l._selectedIndex!=e&&jQuery(i[l._selectedIndex]).slideUp("fast"),jQuery(i[e]).slideDown("fast"),l._selectedIndex=e,l._onChanged&&l._onChanged.call(this,e)}},destroy:function(e){var t=jQuery(this.el);t.find(">.jl-accordion-head").off(),e()}}),jslet.ui.register("Accordion",jslet.ui.Accordion),jslet.ui.Accordion.htmlTemplate="<div></div>",jslet.ui.Calendar=jslet.Class.create(jslet.ui.Control,{initialize:function(e,t,l){var i=this;i.el=t,i.allProperties="value,onDateSelected,minDate,maxDate",i._value=null,i._onDateSelected=null,i._minDate=null,i._maxDate=null,i._currYear=0,i._currMonth=0,i._currDate=0,e(t,l)},value:function(e){return void 0===e?this._value:(jslet.Checker.test("Calendar.value",e).isDate(),void(this._value=e))},minDate:function(e){return void 0===e?this._minDate:(jslet.Checker.test("Calendar.minDate",e).isDate(),void(this._minDate=e))},maxDate:function(e){return void 0===e?this._maxDate:(jslet.Checker.test("Calendar.maxDate",e).isDate(),void(this._maxDate=e))},onDateSelected:function(e){return void 0===e?this._onDateSelected:(jslet.Checker.test("Calendar.onDateSelected",e).isFunction(),void(this._onDateSelected=e))},bind:function(){this.renderAll()},renderAll:function(){var e=this;jqEl=jQuery(e.el),jqEl.hasClass("jl-calendar")||jqEl.addClass("jl-calendar panel panel-default");var t=['<div class="jl-cal-header">','<a class="jl-cal-btn jl-cal-yprev" title="',jslet.locale.Calendar.yearPrev,'" href="javascript:;">&lt;&lt;</a><a href="javascript:;" class="jl-cal-btn jl-cal-mprev" title="',jslet.locale.Calendar.monthPrev,'">&lt;','</a><a href="javascript:;" class="jl-cal-title"></a><a href="javascript:;" class="jl-cal-btn jl-cal-mnext" title="',jslet.locale.Calendar.monthNext,'">&gt;','</a><a href="javascript:;" class="jl-cal-btn jl-cal-ynext" title="',jslet.locale.Calendar.yearNext,'">&gt;&gt;</a>',"</div>",'<div class="jl-cal-body">','<table cellpadding="0" cellspacing="0">','<thead><tr><th class="jl-cal-weekend">',jslet.locale.Calendar.Sun,"</th><th>",jslet.locale.Calendar.Mon,"</th><th>",jslet.locale.Calendar.Tue,"</th><th>",jslet.locale.Calendar.Wed,"</th><th>",jslet.locale.Calendar.Thu,"</th><th>",jslet.locale.Calendar.Fri,'</th><th class="jl-cal-weekend">',jslet.locale.Calendar.Sat,"</th></tr></thead><tbody>",'<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;" class="jl-cal-disable"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;" class="jl-cal-disable"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','<tr><td class="jl-cal-weekend"><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td><a href="javascript:;"></a></td><td class="jl-cal-weekend"><a href="javascript:;"></a></td></tr>','</tbody></table></div><div class="jl-cal-footer"><a class="jl-cal-today" href="javascript:;">',jslet.locale.Calendar.today,"</a></div>"];jqEl.html(t.join(""));var l=jqEl.find(".jl-cal-body table");e._currYear=-1,l.on("click",e._doTableClick);var i=e._value&&jslet.isDate(e._value)?e._value:new Date;this.setValue(i),jqEl.find(".jl-cal-today").click(function(t){var l=new Date;e.setValue(new Date(l.getFullYear(),l.getMonth(),l.getDate())),e._fireSelectedEvent()}),jqEl.find(".jl-cal-yprev").click(function(t){e.incYear(-1)}),jqEl.find(".jl-cal-mprev").click(function(t){e.incMonth(-1)}),jqEl.find(".jl-cal-ynext").click(function(t){e.incYear(1)}),jqEl.find(".jl-cal-mnext").click(function(t){e.incMonth(1)}),jqEl.on("keydown",function(t){var l=t.ctrlKey,i=t.keyCode;return i==jslet.ui.KeyCode.UP?(l?e.incYear(-1):e.incDate(-7),void t.preventDefault()):i==jslet.ui.KeyCode.DOWN?(l?e.incYear(1):e.incDate(7),void t.preventDefault()):i==jslet.ui.KeyCode.LEFT?(l?e.incMonth(-1):e.incDate(-1),void t.preventDefault()):i==jslet.ui.KeyCode.RIGHT?(l?e.incMonth(1):e.incDate(1),void t.preventDefault()):void 0})},_getNotNullDate:function(){var e=this._value;return e||(e=new Date),e},incDate:function(e){var t=this._getNotNullDate();t.setDate(t.getDate()+e),this.setValue(t)},incMonth:function(e){var t=this._getNotNullDate();t.setMonth(t.getMonth()+e),this.setValue(t)},incYear:function(e){var t=this._getNotNullDate();t.setFullYear(t.getFullYear()+e),this.setValue(t)},setValue:function(e){if(e){var t=this;t._minDate&&e<t._minDate&&(e=new Date(t._minDate.getTime())),t._maxDate&&e>t._maxDate&&(e=new Date(t._maxDate.getTime())),t._value=e;var l=e.getFullYear(),i=e.getMonth();t._currYear==l&&t._currMonth==i?t._setCurrDateCls():t._refreshDateCell(l,i)}},focus:function(){var e=this,t=jQuery(e.el);t.find(".jl-cal-current")[0].focus()},_checkNaviState:function(){var e,t,l=this,i=jQuery(l.el);if(l._minDate){var a=l._minDate.getFullYear(),r=l._minDate.getMonth(),n=i.find(".jl-cal-yprev")[0];e=l._currYear<=a,n.style.visibility=e?"hidden":"visible",e=l._currYear==a&&l._currMonth<=r;var s=i.find(".jl-cal-mprev")[0];s.style.visibility=e?"hidden":"visible",e=l._minDate>new Date,t=i.find(".jl-cal-today")[0],t.style.visibility=e?"hidden":"visible"}if(l._maxDate){var o=l._maxDate.getFullYear(),d=l._maxDate.getMonth(),u=i.find(".jl-cal-ynext")[0];e=l._currYear>=o,u.jslet_disabled=e,u.style.visibility=e?"hidden":"visible",e=l._currYear==o&&l._currMonth>=d;var c=i.find(".jl-cal-mnext")[0];c.jslet_disabled=e,c.style.visibility=e?"hidden":"visible",e=l._maxDate<new Date,t=i.find(".jl-cal-today")[0],t.style.visibility=e?"hidden":"visible"}},_refreshDateCell:function(e,t){var l=this,i=jQuery(l.el),a=jslet.locale.Calendar.monthNames,r=a[t],n=i.find(".jl-cal-title")[0];n.innerHTML=r+","+e;var s=i.find(".jl-cal-body table")[0],o=s.tBodies[0].rows,d=new Date(e,t,1),u=d.getDay(),c=864e5,h=new Date(d.getTime()-(u+1)*c);h=new Date(h.getFullYear(),h.getMonth(),h.getDate());for(var f,v,p,_,g=o.length,m=1;g>=m;m++){f=o[m-1];for(var j=1,C=f.cells.length;C>=j;j++)v=f.cells[j-1],h=new Date(h.getTime()+c),_=v.firstChild,l._minDate&&h<l._minDate||l._maxDate&&h>l._maxDate?(_.innerHTML="",v.jslet_date_value=null):(_.innerHTML=h.getDate(),v.jslet_date_value=h,p=h.getMonth(),p!=t?jQuery(v).addClass("jl-cal-disable"):jQuery(v).removeClass("jl-cal-disable"))}l._currYear=e,l._currMonth=t,l._setCurrDateCls(),l._checkNaviState()},_fireSelectedEvent:function(){var e=this;e._onDateSelected&&e._onDateSelected.call(e,e._value)},_doTableClick:function(e){e=jQuery.event.fix(e||window.event);var t=e.target,l=t.parentNode;if(l&&l.tagName&&"td"==l.tagName.toLowerCase()){if(!l.jslet_date_value)return;var i=jslet.ui.findFirstParent(l,function(e){return e.jslet}),a=i.jslet;a._value=l.jslet_date_value,a._setCurrDateCls();try{l.firstChild.focus()}catch(r){}a._fireSelectedEvent()}},_setCurrDateCls:function(){var e=this;if(jslet.isDate(e._value))for(var t,l,i,a,r,n,s,o=e._value.getMonth(),d=e._value.getFullYear(),u=e._value.getDate(),c=jqEl.find(".jl-cal-body table")[0],h=c.tBodies[0].rows,f=h.length,v=0;f>v;v++){t=h[v];for(var p=0,_=t.cells.length;_>p;p++)if(l=t.cells[p],n=l.jslet_date_value)if(i=n.getMonth(),r=n.getFullYear(),a=n.getDate(),s=jQuery(l.firstChild),r==d&&i==o&&a==u){s.hasClass("jl-cal-current")||s.addClass("jl-cal-current");try{l.firstChild.focus()}catch(g){}}else s.removeClass("jl-cal-current")}},destroy:function(e){var t=jQuery(this.el);t.off(),t.find(".jl-cal-body table").off(),t.find(".jl-cal-today").off(),t.find(".jl-cal-yprev").off(),t.find(".jl-cal-mprev").off(),t.find(".jl-cal-mnext").off(),t.find(".jl-cal-ynext").off(),e()}}),jslet.ui.register("Calendar",jslet.ui.Calendar),jslet.ui.Calendar.htmlTemplate="<div></div>",jslet.ui.FieldSet=jslet.Class.create(jslet.ui.Control,{initialize:function(e,t,l){var i=this;i.el=t,i.allProperties="caption,collapsed",i._caption=null,i._collapsed=!1,e(t,l)},caption:function(e){return void 0===e?this._caption:(jslet.Checker.test("FieldSet.caption",e).isString(),void(this._caption=e))},collapsed:function(e){return void 0===e?this._collapsed:void(this._collapsed=e?!0:!1)},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-fieldset")||t.addClass("jl-fieldset jl-round5");var l=['<legend class="jl-fieldset-legend">'];l.push('<span class="jl-fieldset-title"><i class="fa fa-chevron-circle-up jl-fieldset-btn">'),l.push("<span>"),l.push(e._caption),l.push('</span></span></legend><div class="jl-fieldset-body"></div>');var i,a,r=e.el.childNodes,n=[];for(a=r.length,i=0;a>i;i++)n.push(r[i]);t.html(l.join(""));var s=jQuery(e.el).find(".jl-fieldset-body")[0];for(a=n.length,i=0;a>i;i++)s.appendChild(n[i]);t.find(".jl-fieldset-btn").click(jQuery.proxy(e._doExpandBtnClick,this))},_doExpandBtnClick:function(){var e=this,t=jQuery(e.el),l=t.find(".jl-fieldset-body");e._collapsed?(l.slideDown(),t.removeClass("jl-fieldset-collapse"),t.find(".jl-fieldset-btn").removeClass("fa-chevron-circle-down")):(l.slideUp(),t.addClass("jl-fieldset-collapse"),t.find(".jl-fieldset-btn").addClass("fa-chevron-circle-down")),l[0].focus(),e._collapsed=!e._collapsed},destroy:function(e){var t=jQuery(this.el);t.find("input.jl-fieldset-btn").off(),e()}}),jslet.ui.register("FieldSet",jslet.ui.FieldSet),jslet.ui.FieldSet.htmlTemplate="<fieldset></fieldset>",jslet.ui.menuManager={},jslet.ui.menuManager._menus=[],jslet.ui.menuManager.register=function(e){jslet.ui.menuManager._menus.push(e)},jslet.ui.menuManager.unregister=function(e){for(var t=0,l=this._menus.length;l>t;t++)jslet.ui.menuManager._menus.splice(t,1)},jslet.ui.menuManager.hideAll=function(e){for(var t,l,i=jslet.ui.menuManager._menus,a=0,r=i.length;r>a;a++)t=i[a],l=jslet("#"+t),l&&l.hide();jslet.ui.menuManager.menuBarShown=!1,jslet.ui.menuManager._contextObject=null},jQuery(document).on("mousedown",jslet.ui.menuManager.hideAll),jslet.ui.MenuBar=jslet.Class.create(jslet.ui.Control,{initialize:function(e,t,l){var i=this;i.el=t,i.allProperties="onItemClick,items",i._onItemClick=null,i._items=null,e(t,l)},onItemClick:function(e){return void 0===e?this._onItemClick:(jslet.Checker.test("MenuBar.onItemClick",e).isFunction(),void(this._onItemClick=e))},items:function(e){if(void 0===e)return this._items;jslet.Checker.test("MenuBar.items",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("MenuBar.items.name",t.name).isString().required();this._items=e},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-menubar")||t.addClass("jl-menubar jl-unselectable jl-bgcolor jl-round5"),e._createMenuBar(),t.on("mouseout",function(t){e._preHoverItem&&!jslet.ui.menuManager.menuBarShown&&jQuery(e._preHoverItem).removeClass("jl-menubar-item-hover")})},_createMenuBar:function(){var e=this;if(!e.isPopup)for(var t,l=0,i=e._items.length;i>l;l++)t=e._items[l],e._createBarItem(e.el,t,e._menubarclick)},_showSubMenu:function(e){var t=e.parentNode.jslet,l=e.jsletvar;if(l.items){if(!l.subMenu){var i=document.createElement("div");document.body.appendChild(i),l.subMenu=new jslet.ui.Menu(i,{onItemClick:t._onItemClick,items:l.items})}var a=jQuery(document.body),r=(parseInt(a.css("margin-top")),parseInt(a.css("margin-left")),jQuery(e)),n=r.offset(),s=n.left;jslet.locale.isRtl&&(s+=r.width()+10),l.subMenu.show(s,n.top+r.height()),jslet.ui.menuManager.menuBarShown=!0,t._activeMenuItem=e}},_createBarItem:function(e,t){if(void 0===t.visible||t.visible){var l=document.createElement("div");jQuery(l).addClass("jl-menubar-item"),l.jsletvar=t;var i=this,a=jQuery(l);a.on("click",function(e){var t=this.jsletvar;t.items?i._showSubMenu(this):(t.onClick?t.onClick.call(i,t.id||t.name):i._onItemClick&&i._onItemClick.call(i,t.id||t.name),jslet.ui.menuManager.hideAll()),e.stopPropagation(),e.preventDefault()}),a.on("mouseover",function(e){i._preHoverItem&&jQuery(i._preHoverItem).removeClass("jl-menubar-item-hover"),i._preHoverItem=this,jQuery(this).addClass("jl-menubar-item-hover"),jslet.ui.menuManager.menuBarShown&&(jslet.ui.menuManager.hideAll(),i._showSubMenu(this),jslet.ui.menuManager._inPopupMenu=!0)});var r=[];r.push('<a class="jl-focusable-item" href="javascript:void(0)">'),r.push(t.name),r.push("</a>"),l.innerHTML=r.join(""),e.appendChild(l)}},destroy:function(e){var t=this;t._activeMenuItem=null,t._preHoverItem=null,t._menubarclick=null,t._onItemClick=null;var l=jQuery(t.el);l.off(),l.find(".jl-menubar-item").off(),l.find(".jl-menubar-item").each(function(){var e=this;e.jsletvar&&(e.jsletvar.subMenu=null,e.jsletvar=null)}),e()}}),jslet.ui.register("MenuBar",jslet.ui.MenuBar),jslet.ui.MenuBar.htmlTemplate="<div></div>",jslet.ui.Menu=jslet.Class.create(jslet.ui.Control,{_onItemClick:void 0,_items:void 0,_invoker:null,initialize:function(e,t,l){var i=this;i.el=t,i.allProperties="onItemClick,items,invoker",e(t,l),i._activeSubMenu=null},onItemClick:function(e){return void 0===e?this._onItemClick:(jslet.Checker.test("Menu.onItemClick",e).isFunction(),void(this._onItemClick=e))},items:function(e){if(void 0===e)return this._items;jslet.Checker.test("Menu.items",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("Menu.items.name",t.name).isString().required();this._items=e},invoker:function(e){return void 0===e?this._invoker:void(this._invoker=e)},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el),l=e.el;t.hasClass("jl-menu")||t.addClass("jl-menu"),l.style.display="none",l.id||(l.id=jslet.nextId()),jslet.ui.menuManager.register(l.id),e._createMenuPopup(),t.on("mousedown",function(e){return e=jQuery.event.fix(e||window.event),e.stopPropagation(),e.preventDefault(),!1}),t.on("mouseover",function(e){jslet.ui.menuManager._inPopupMenu=!0,jslet.ui.menuManager.timerId&&window.clearTimeout(jslet.ui.menuManager.timerId)}),t.on("mouseout",function(e){jslet.ui.menuManager._inPopupMenu=!1,jslet.ui.menuManager.timerId=window.setTimeout(function(){jslet.ui.menuManager._inPopupMenu||jslet.ui.menuManager.hideAll(),jslet.ui.menuManager.timerId=null},800)})},show:function(e,t){var l=this,i=jQuery(l.el),a=i.outerWidth(),r=i.outerHeight(),n=jQuery(window),s=n.scrollLeft()+n.width(),o=n.scrollTop()+n.height();e=e||l.left||10,t=t||l.top||10,jslet.locale.isRtl&&(e-=a),e+a>s&&(e+=s-e-a-1),t+r>o&&(t+=o-t-r-1),0>e&&(e=0),0>t&&(t=0),l.el.style.left=e+"px",l.el.style.top=parseInt(t)+"px",l.el.style.display="block",l.shadow||(l.shadow=document.createElement("div"),jQuery(l.shadow).addClass("jl-menu-shadow"),l.shadow.style.width=a+"px",l.shadow.style.height=r+"px",document.body.appendChild(l.shadow)),l.shadow.style.left=e+1+"px",l.shadow.style.top=t+1+"px",l.shadow.style.display="block"},hide:function(){this.ctxElement=null,this.el.style.display="none",this.shadow&&(this.shadow.style.display="none")},showContextMenu:function(e,t){jslet.ui.menuManager.hideAll(),e=jQuery.event.fix(e||window.event),jslet.ui.menuManager._contextObject=t,this.show(e.pageX,e.pageY),e.preventDefault()},_createMenuPopup:function(){var e,t,l,i,a=this.el,r=this._items;for(i=r.length,l=0;i>l;l++)e=r[l],e.name&&(t=e.name.trim(),"-"!=t?this._createMenuItem(a,e):this._createLine(a,e));var n,s=jQuery(a).width()-2+"px",o=a.childNodes;for(i=o.length,l=0;i>l;l++)n=o[l],1==n.nodeType&&(n.style.width=s);document.body.appendChild(a)},_ItemClick:function(e,t){if(t.items)return void this._showSubMenu(e,t);if(!t.disabled){var l=jslet.ui.menuManager._contextObject||this;
t.onClick?t.onClick.call(l,t.id||t.name,t.checked):this._onItemClick&&this._onItemClick.call(l,t.id||t.name,t.checked),("check"==t.itemType||"radio"==t.itemType)&&jslet.ui.Menu.setChecked(e,!t.checked),jslet.ui.menuManager.hideAll()}},_hideSubMenu:function(){var e=this;e._activeSubMenu&&(e._activeSubMenu._hideSubMenu(),e._activeSubMenu.hide(),e._activeSubMenu.el.style.zIndex=parseInt(jQuery(e.el).css("zIndex")))},_showSubMenu:function(e,t,l){var i=this,a=function(){if(i._hideSubMenu(),t.subMenu){var l=jQuery(e),a=l.offset(),r=a.left;jslet.locale.isRtl||(r+=l.width()),t.subMenu.show(r-2,a.top),t.subMenu.el.style.zIndex=parseInt(jQuery(i.el).css("zIndex"))+1,i._activeSubMenu=t.subMenu}};l?window.setTimeout(a,l):a()},_ItemOver:function(e,t){this._activeSubMenu&&this._showSubMenu(e,t,200)},_createMenuItem:function(e,t,l){var i=!1,a=!1,r=t.itemType;r&&(i="check"==r,a="radio"==r),i&&(t.iconClass="jl-menu-check",t.disabledIconClass="jl-menu-check-disabled"),a&&(t.iconClass="jl-menu-radio",t.disabledIconClass="jl-menu-radio-disabled"),t.items&&(t.disabled=!1);var n=document.createElement("div"),s=this,o=jQuery(n);o.addClass("jl-menu-item "+(t.disabled?"jl-menu-disabled":"jl-menu-enabled")),t.id||(t.id=jslet.nextId()),n.id=t.id,n.jsletvar=t,o.on("click",function(e){s._ItemClick(this,this.jsletvar),e.stopPropagation(),e.preventDefault()}),o.on("mouseover",function(e){s._ItemOver(this,this.jsletvar),s._preHoverItem&&jQuery(s._preHoverItem).removeClass("jl-menu-item-hover"),s._preHoverItem=this,this.jsletvar.disabled||jQuery(this).addClass("jl-menu-item-hover")}),o.on("mouseout",function(e){this.jsletvar.subMenu||jQuery(this).removeClass("jl-menu-item-hover")});var d=[];if(d.push('<span class="jl-menu-icon-placeholder '),(!i&&!a||t.checked)&&t.iconClass&&d.push(t.disabled&&t.disabledIconClass?t.disabledIconClass:t.iconClass),d.push('"></span>'),t.items&&d.push('<div class="jl-menu-arrow"></div>'),d.push('<a  href="javascript:void(0)" class="jl-focusable-item jl-menu-content '),d.push(" jl-menu-content-left jl-menu-content-right"),d.push('">'),d.push(t.name),d.push("</a>"),n.innerHTML=d.join(""),e.appendChild(n),t.items){var u=document.createElement("div");document.body.appendChild(u),t.subMenu=new jslet.ui.Menu(u,{onItemClick:s._onItemClick,items:t.items,invoker:n})}},_createLine:function(e,t){var l=document.createElement("div");jQuery(l).addClass("jl-menu-line"),e.appendChild(l)},destroy:function(e){var t=this,l=jQuery(t.el);t._activeSubMenu=null,jslet.ui.menuManager.unregister(t.el.id),l.off(),l.find(".jl-menu-item").each(function(){this.onmouseover=null,this.onclick=null,this.onmouseout=null}),e()}}),jslet.ui.register("Menu",jslet.ui.Menu),jslet.ui.Menu.htmlTemplate="<div></div>",jslet.ui.Menu.setDisabled=function(e,t){var l;l=Object.isString(e)?jQuery("#"+e):jQuery(e);var i=l.context.jsletvar;i.items||(t?(l.removeClass("jl-menu-enabled"),l.addClass("jl-menu-disabled")):(l.removeClass("jl-menu-disabled"),l.addClass("jl-menu-enabled")),i.disabled=t)},jslet.ui.Menu.setChecked=function(e,t){var l;l="string"==typeof e?jQuery("#"+e):jQuery(e);var i=l.context,a=i.jsletvar,r=a.itemType;if("check"==r||"radio"==r){if("radio"==r){if(a.checked&&t||!t)return;for(var n,s,o,d=i.group,u=i.parentNode.childNodes,c=0,h=u.length;h>c;c++)n=u[c],n!=i&&(s=n.jsletvar,s&&"radio"==s.itemType&&s.group==d&&(o=n.childNodes[0],s.disabled?jQuery(o).removeClass(s.disabledIconClass):jQuery(o).removeClass(s.iconClass),s.checked=!1))}var f=jQuery(i.childNodes[0]);a.checked&&!t&&(a.disabled?f.removeClass(a.disabledIconClass):f.removeClass(a.iconClass)),!a.checked&&t&&(a.disabled?f.addClass(a.disabledIconClass):f.addClass(a.iconClass)),a.checked=t}},jslet.ui.OverlayPanel=function(e,t){var l=document.createElement("div");jQuery(l).addClass("jl-overlay").on("click",function(e){e.stopPropagation(),e.preventDefault()}),t&&(l.style.backgroundColor=t);var i,a,r,n;if(e)r=jQuery(e).width(),n=jQuery(e).height();else{var s=jQuery(document.body);i=0,a=0,r=s.width(),n=s.height()}l.style.left="0px",l.style.top="0px",l.style.bottom="0px",l.style.right="0px",e?e.appendChild(l):document.body.appendChild(l),l.style.display="none";var o=null;e?(o=e.onresize,e.onresize=function(){var t=jQuery(e).width()-12,i=jQuery(e).height()-12;l.style.width=t+"px",l.style.height=i+"px"}):(o=window.onresize,window.onresize=function(){l.style.width=document.body.scrollWidth+"px",l.style.height=document.body.scrollHeight+"px"}),this.overlayPanel=l,this.show=function(){return l.style.display="block",l},this.hide=function(){return l.style.display="none",l},this.setZIndex=function(e){this.overlayPanel.style.zIndex=e},this.destroy=function(){this.hide(),e?(e.onresize=o,e.removeChild(l)):(window.onresize=o,document.body.removeChild(l)),jQuery(this.overlayPanel).off()}},jslet.ui.SplitPanel=jslet.Class.create(jslet.ui.Control,{directions:["hori","vert"],initialize:function(e,t,l){var i=this;i.el=t,i.allProperties="direction,floatIndex,onExpanded,onSize",i._direction="hori",i._floatIndex=1,i._onExpanded=null,i._onSize=null,i.panels=null,i.splitter=null,i._oldSize=0,jslet.resizeEventBus.subscribe(i),e(t,l)},floatIndex:function(e){return void 0===e?this._floatIndex:(jslet.Checker.test("SplitPanel.floatIndex",e).isGTEZero(),void(this._floatIndex=e))},direction:function(e){if(void 0===e)return this._direction;e=jQuery.trim(e);var t=jslet.Checker.test("SplitPanel.direction",e).required().isString();e=e.toLowerCase(),t.inArray(this.directions),this._direction=e},onExpanded:function(e){return void 0===e?this._onExpanded:(jslet.Checker.test("SplitPanel.onExpanded",e).isFunction(),void(this._onExpanded=e))},onSize:function(e){return void 0===e?this._onSize:(jslet.Checker.test("SplitPanel.onSize",e).isFunction(),void(this._onSize=e))},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-splitpanel")||t.addClass("jl-splitpanel jl-border-box jl-round5"),e.isHori="hori"==e._direction,e.width=t.innerWidth(),e.height=t.innerHeight(),e._oldSize=e.isHori?e.width:e.height;var l=t.find(">div"),i=l.length-1;(!e._floatIndex||e._floatIndex>i)&&(e._floatIndex=i),e._floatIndex>i&&(e._floatIndex=i),e.panels||(e.panels=[]);var a=e.isHori?e.width:e.height,r=0;l.each(function(t){var i=jQuery(l[t]),a=e.panels[t];a||(a={},e.panels[t]=a);var n=parseInt(i.css(e.isHori?"min-width":"min-height"));a.minSize=n?n:5;var s=parseInt(i.css(e.isHori?"max-width":"max-height"));a.maxSize=s?s:1/0,a.expanded="none"!=i.css("display");var o=a.size;null===o||void 0===o?o=e.isHori?i.outerWidth():i.outerHeight():e.isHori?i.width(o-5):i.height(o-5),t!=e._floatIndex&&(r+=o,a.size=o)}),e.panels[e._floatIndex].size=a-r,e.splitterTracker=document.createElement("div");var n=jQuery(e.splitterTracker);n.addClass("jl-sp-splitter-tracker");var s=0,o=e.isHori?"jl-sp-panel-hori":"jl-sp-panel-vert";e.splitterClsName=e.isHori?"jl-sp-splitter-hori":"jl-sp-splitter-vert",e.el.appendChild(e.splitterTracker),e.isHori?e.splitterTracker.style.height="100%":e.splitterTracker.style.width="100%";var d=parseInt(jslet.ui.getCssValue(e.splitterClsName,e.isHori?"width":"height"));l.after(function(t){var a=l[t],r=jQuery(a),n=e.panels[t].expanded;if(r.addClass(o),t==e._floatIndex?e.floatPanel=a:n?s+=d+e.panels[t].size:(r.css("display","none"),s+=d),t==i)return e.isHori?'<div style="clear:both;width:0px"></div>':"";var u=jslet.nextId(),c=e.isHori?"jl-sp-button-left":"jl-sp-button-top";return(e._floatIndex<=t||!n)&&(c+=e.isHori?" jl-sp-button-right":" jl-sp-button-bottom"),'<div class="'+e.splitterClsName+' jl-unselectable" id = "'+u+'" jsletindex="'+(t>=e._floatIndex?t+1:t)+'"><div class="jl-sp-button '+c+'"'+(n?"":' jsletcollapsed="1"')+"></div></div>"}),e.isHori?jQuery(e.floatPanel).width(t.innerWidth()-s-4):jQuery(e.floatPanel).height(t.innerHeight()-s);var u=t.find("."+e.splitterClsName);u.on("mousedown",e._splitterMouseDown);var c=u.children();c.on("mousedown",function(t){var l=jQuery(t.target),i=l.parent(),a=parseInt(i.attr("jsletindex"));e.expand(a),t.stopPropagation()});for(var h,f=0,v=u.length;v>f;f++)h=u[f],h._doDragStart=e._splitterDragStart,h._doDragging=e._splitterDragging,h._doDragEnd=e._splitterDragEnd,h._doDragCancel=e._splitterDragCancel},floatPanel:function(){return Z.panels[Z._floatIndex]},changeSize:function(e,t){},expand:function(e,t,l){var i,a=this,r=jQuery(a.el),n=r.find("."+a.splitterClsName);if(!(0>e||e>n.length)){var s=jQuery(n[e>=a._floatIndex?e-1:e]),o=s.find(":first-child");if(void 0===t&&(t="1"==o.attr("jsletcollapsed")),i=e<a._floatIndex?s.prev():s.next(),a.isHori?o.hasClass("jl-sp-button-right")?o.removeClass("jl-sp-button-right"):o.addClass("jl-sp-button-right"):o.hasClass("jl-sp-button-bottom")?o.removeClass("jl-sp-button-bottom"):o.addClass("jl-sp-button-bottom"),t?(i.css("display","block"),o.attr("jsletcollapsed","0")):(i.css("display","none"),o.attr("jsletcollapsed","1")),!l){var d=jQuery(a.floatPanel);a.isHori?d.width(d.width()+i.width()*(t?-1:1)):d.height(d.height()+i.height()*(t?-1:1)),a.panels[e].expanded=t,a._onExpanded&&a._onExpanded.call(a,panelIndex),jslet.resizeEventBus.resize(a.el)}}},_splitterMouseDown:function(e){var t=jQuery(this).position(),l=this.parentNode.jslet;l.splitterTracker.style.top=t.top+"px",l.splitterTracker.style.left=t.left+"px",l.draggingId=this.id;var i=jQuery("#"+l.draggingId);return jqBtn=i.find(":first-child"),"1"==jqBtn.attr("jsletcollapsed")?void jqBtn.click():void jslet.ui.dnd.bindControl(this)},_splitterDragStart:function(e,t,l,i,a,r){var n=this.parentNode.jslet,s=jQuery(n.splitterTracker),o=jQuery("#"+n.draggingId),d=parseInt(o.attr("jsletindex")),u=n.panels[d],c=jQuery(n.floatPanel);n.dragRangeMin=u.size-u.minSize,n.dragRangeMax=u.maxSize-u.size;var h=(n.isHori?c.width():c.height())-n.panels[n._floatIndex].minSize;n.dragRangeMax>h&&(n.dragRangeMax=h),s.show()},_splitterDragging:function(e,t,l,i,a,r){var n,s=this.parentNode.jslet,o=jQuery(s.splitterTracker),d=jQuery("#"+s.draggingId),u=parseInt(d.attr("jsletindex")),c=Math.abs(s.isHori?a:r);if(n=s.isHori?u<s._floatIndex&&a>=0||u>s._floatIndex&&0>a:u<s._floatIndex&&r>=0||u>s._floatIndex&&0>r,n&&c>s.dragRangeMax)return void(s.endDelta=s.dragRangeMax);if(!n&&c>s.dragRangeMin)return void(s.endDelta=s.dragRangeMin);s.endDelta=Math.abs(s.isHori?a:r);var h=o.offset();s.isHori?h.left=l:h.top=i,o.offset(h)},_splitterDragEnd:function(e,t,l,i,a,r){var n,s=this.parentNode.jslet,o=jQuery(s.splitterTracker),d=jQuery("#"+s.draggingId),u=parseInt(d.attr("jsletindex")),c=u<s._floatIndex?d.prev():d.next(),h=jQuery(s.floatPanel);n=s.isHori?u<s._floatIndex&&a>=0||u>s._floatIndex&&0>a:u<s._floatIndex&&r>=0||u>s._floatIndex&&0>r;var f=s.endDelta*(n?1:-1),v=s.panels[u].size+f;s.panels[u].size=v,s.isHori?(c.width(v),h.width(h.width()-f)):(c.height(v),h.height(h.height()-f)),s._onSize&&s._onSize.call(s,u,v),jslet.resizeEventBus.resize(s.el),o.hide()},_splitterDragCancel:function(e,t,l,i,a,r){var n=this.parentNode.jslet,s=jQuery(n.splitterTracker);s.hide()},checkSizeChanged:function(){var e=this,t=jQuery(e.el),l=e.isHori?t.width():t.height();if(e._oldSize!=l){var i=l-e._oldSize;e._oldSize=l;var a=e.panels[e._floatIndex],r=jQuery(e.floatPanel),n=i+(e.isHori?r.width():r.height());n<a.minSize&&(n=a.minSize),e.isHori?r.width(n):r.height(n)}jslet.resizeEventBus.resize(e.floatPanel)},destroy:function(e){var t=this,l=jQuery(t.el);t.splitterTracker=null,t.floatPanel=null;var i=l.find("."+t.splitterClsName);i.off("mousedown",t._splitterMouseDown);for(var a,r=0,n=i.length;n>r;r++)a=i[r],jslet.ui.dnd.unbindControl(a),a._doDragStart=null,a._doDragging=null,a._doDragEnd=null,a._doDragCancel=null;jslet.resizeEventBus.unsubscribe(t),e()}}),jslet.ui.register("SplitPanel",jslet.ui.SplitPanel),jslet.ui.SplitPanel.htmlTemplate="<div></div>",jslet.ui.TabControl=jslet.Class.create(jslet.ui.Control,{initialize:function(e,t,l){var i=this;i.el=t,i.allProperties="selectedIndex,newable,closable,items,onAddTabItem,onSelectedChanged,onRemoveTabItem,onCreateContextMenu",i._selectedIndex=0,i._newable=!0,i._closable=!0,i._onSelectedChanged=null,i._onAddTabItem=null,i._onRemoveTabItem=null,i._onCreateContextMenu=null,i._items=[],i._itemsWidth=[],i._containerWidth=0,i._ready=!1,i._leftIndex=0,i._rightIndex=0,i._tabControlWidth=jQuery(i.el).width(),jslet.resizeEventBus.subscribe(this),e(t,l)},selectedIndex:function(e){return void 0===e?this._selectedIndex:(jslet.Checker.test("TabControl.selectedIndex",e).isGTEZero(),void(this._ready?this._chgSelectedIndex(e):this._selectedIndex=e))},newable:function(e){return void 0===e?this._newable:void(this._newable=e?!0:!1)},closable:function(e){return void 0===e?this._closable:void(this._closable=e?!0:!1)},onAddTabItem:function(e){return void 0===e?this._onAddTabItem:(jslet.Checker.test("TabControl.onAddTabItem",e).isFunction(),void(this._onAddTabItem=e))},onSelectedChanged:function(e){return void 0===e?this._onSelectedChanged:(jslet.Checker.test("TabControl.onSelectedChanged",e).isFunction(),void(this._onSelectedChanged=e))},onRemoveTabItem:function(e){return void 0===e?this._onRemoveTabItem:(jslet.Checker.test("TabControl.onRemoveTabItem",e).isFunction(),void(this._onRemoveTabItem=e))},onCreateContextMenu:function(e){return void 0===e?this._onCreateContextMenu:(jslet.Checker.test("TabControl.onCreateContextMenu",e).isFunction(),void(this._onCreateContextMenu=e))},items:function(e){if(void 0===e)return this._items;jslet.Checker.test("TabControl.items",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("TabControl.items.header",t.header).isString().required();this._items=e},bind:function(){this.renderAll()},renderAll:function(){var e=this,t=['<div class="jl-tab-header jl-unselectable"><div class="jl-tab-container jl-unselectable"><ul class="jl-tab-list">',e._newable?'<li><a href="javascript:;" class="jl-tab-inner"><span class="jl-tab-new">+</span></a></li>':"",'</ul></div><a class="jl-tab-left jl-hidden"><span class="jl-nav-btn glyphicon glyphicon-circle-arrow-left"></span></a><a class="jl-tab-right  jl-hidden"><span class="jl-nav-btn glyphicon glyphicon-circle-arrow-right"></span></a></div><div class="jl-tab-items jl-round5"></div>'],l=jQuery(e.el);if(l.hasClass("jl-tabcontrol")||l.addClass("jl-tabcontrol jl-round5"),l.html(t.join("")),e._newable){oul=l.find(".jl-tab-list")[0];var i=oul.childNodes[oul.childNodes.length-1];e._newTabItem=i,i.onclick=function(){var t=null;e._onAddTabItem&&(t=e._onAddTabItem.call(e)),t||(t=new jslet.ui.TabItem,t.header="new tab",t.closable=!0),e.addTabItem(t),e._calcItemsWidth(),e.selectedIndex(e._items.length-1)}}var a=l.find(".jl-tab-left");if(a.on("click",function(t){return e._setVisiTabItems(e._leftIndex-1),t.stopImmediatePropagation(),t.preventDefault(),!1}),a.on("mousedown",function(e){return e.stopImmediatePropagation(),e.preventDefault(),!1}),a=l.find(".jl-tab-right"),a.on("click",function(t){return e._setVisiTabItems(e._leftIndex+1),t.stopImmediatePropagation(),t.preventDefault(),!1}),a.on("mousedown",function(e){return e.stopImmediatePropagation(),e.preventDefault(),!1}),e._items&&e._items.length>0)for(var r,n=e._items.length,s=0;n>s;s++)r=e._items[s],e._renderTabItem(r);e._calcItemsWidth(),e._ready=!0,e._chgSelectedIndex(e._selectedIndex),e._createContextMenu()},addItem:function(e){this._items[this._items.length]=e},tabLabel:function(e,t){jslet.Checker.test("tabLabel#index",e).isGTEZero(),jslet.Checker.test("tabLabel#label",t).required().isString();var l=this,i=l._getTabItemCfg(e);if(i){i.label(t);var a=jQuery(l.el),r=a.find(".jl-tab-items")[0],n=r.childNodes;jQuery(n[e]).find(".jl-tab-title").html(t),l._calcItemsWidth()}},tabDisabled:function(e,t){jslet.Checker.test("tabLabel#index",e).isGTEZero();var l=this,i=l._getTabItemCfg(e);if(i){if(e==l._selectedIndex)return void console.warn("Cannot set current tab item to disabled.");i.disabled(t);var a=jQuery(l.el),r=a.find(".jl-tab-items")[0],n=r.childNodes,s=jQuery(n[e]);t?s.addClass("jl-tab-disabled"):s.removeClass("jl-tab-disabled")}},_chgSelectedIndex:function(e){var t=this,l=t._getTabItemCfg(e);if(l&&!l.disabled){if(t._onSelectedChanged){var i=t._onSelectedChanged.call(t,t._selectedIndex,e);if(void 0!==i&&!i)return}for(var a,r,n=jQuery(t.el),s=n.find(".jl-tab-list")[0],o=s.childNodes,d=o.length-(t._newable?2:1),u=n.find(".jl-tab-items")[0],c=u.childNodes,h=0;d>=h;h++)a=jQuery(o[h]),r=c[h],h==e?(a.addClass("jl-tab-selected"),r.style.display="block"):(a.removeClass("jl-tab-selected"),r.style.display="none");t._selectedIndex=e,(e<t._leftIndex||e>=t._rightIndex)&&t._setVisiTabItems(null,t._selectedIndex)}},_getTabItemCfg:function(e){var t=this;return t._items.length<=e?null:t._items[e]},_calcItemsWidth:function(){var e=this,t=jQuery(e.el),l=t.find(".jl-tab-list").children();e._itemsWidth=[],l.each(function(t){e._itemsWidth[t]=jQuery(this).outerWidth()+5}),e._containerWidth=t.find(".jl-tab-container").innerWidth()},_setVisiTabItems:function(e,t){var l,i=this;if(e||0===e)i._leftIndex=e;else{if(!t)return;i._newable&&t++,l=i._itemsWidth[t],i._leftIndex=t;for(var a=t-1;a>=0;a--){if(l+=i._itemsWidth[a],l>i._containerWidth){i._leftIndex=a+1;break}i._leftIndex=a}e=i._leftIndex}l=0,i._rightIndex=e;for(var a=e,r=i._itemsWidth.length;r>a;a++){if(l+=i._itemsWidth[a],l>i._containerWidth){i._rightIndex=a-1;break}i._rightIndex=a}for(var n=0,a=0;a<i._leftIndex;a++)n+=i._itemsWidth[a];n+=5;var s=jQuery(i.el);s.find(".jl-tab-container").scrollLeft(jslet.locale.isRtl?5e4-n:n),i._setNavBtnVisible()},_setNavBtnVisible:function(){var e=this,t=jQuery(e.el),l=t.find(".jl-tab-left"),i=l.hasClass("jl-hidden");e._leftIndex>0?i&&l.removeClass("jl-hidden"):i||l.addClass("jl-hidden");var a=t.find(".jl-tab-right"),i=a.hasClass("jl-hidden"),r=e._itemsWidth.length;e._rightIndex<r-1?i&&a.removeClass("jl-hidden"):i||a.addClass("jl-hidden")},_createHeader:function(e,t){var l=this,i=l._closable&&t.closable,a=['<a href="javascript:;" class="jl-tab-inner'+(i?" jl-tab-close-loc":"")+'" onclick="javascript:this.blur();"><span class="jl-tab-title '];a.push('">'),a.push(t.header),a.push("</span>"),a.push('<span href="javascript:;" class="close jl-tab-close'+(!i||t.disabled?" jl-hidden":"")+'">x</span>'),a.push("</a>");var r=document.createElement("li");if(t.disabled&&jQuery(r).addClass("jl-tab-disabled"),r.innerHTML=a.join(""),l._newable){var n=e.childNodes[e.childNodes.length-1];e.insertBefore(r,n)}else e.appendChild(r);r.jslet=l,jQuery(r).on("click",l._changeTabItem),i&&jQuery(r).find(".jl-tab-close").click(l._doCloseBtnClick)},_changeTabItem:function(e){for(var t=this.parentNode.childNodes,l=-1,i=0;i<t.length;i++)if(t[i]==this){l=i;break}this.jslet._chgSelectedIndex(l)},_doCloseBtnClick:function(e){for(var t=this.parentNode.parentNode,l=t.parentNode.childNodes,i=-1,a=0;a<l.length;a++)if(l[a]==t){i=a;break}return t.jslet.removeTabItem(i),e.preventDefault(),!1},_createBody:function(e,t){var l=this,i=jQuery(document.createElement("div"));i.hasClass("jl-tab-panel")||i.addClass("jl-tab-panel");var a=i[0];e.appendChild(a);var r=jQuery(l.el),n=(r.find(".jl-tab-header"),t.height);if(n=n?n:300,t.content||t.divId){var s=t.content?t.content:jQuery("#"+t.divId)[0];if(s){var o=s.parentNode;return o&&o!=a&&o.removeChild(s),a.appendChild(s),void(s.style.display="block")}}if(t.url&&t.useIFrame){var d='<iframe scrolling="yes" frameborder="0" src="'+t.url+'" style="width: 100%;height:'+n+'px;"></iframe>';i.html(d)}},addTabItem:function(e,t){var l=this;l._items.push(e),l._renderTabItem(e),t||(l._calcItemsWidth(),l._chgSelectedIndex(l._selectedIndex+1))},_renderTabItem:function(e){var t=this,l=jQuery(t.el),i=l.find(".jl-tab-list")[0],a=l.find(".jl-tab-items")[0];t._createHeader(i,e),t._createBody(a,e)},removeTabItem:function(e){var t,l=this,i=jQuery(l.el),a=i.find(".jl-tab-list")[0],r=a.childNodes,n=r.length-(l._newable?2:1);if(!(e>n||0>e)){t=jQuery(r[e]);var s=t.hasClass("jl-tab-selected");if(l._onRemoveTabItem){var o=l._onRemoveTabItem.call(l,e,s);if(!o)return}a.removeChild(t[0]),l._items.splice(e,1);var d=i.find(".jl-tab-items")[0];r=d.childNodes,d.removeChild(r[e]),l._calcItemsWidth(),s&&(n--,e=l._getNextValidIndex(e,e>=n),e>=0&&l._chgSelectedIndex(e))}},_getNextValidIndex:function(e,t){var l=this;if(t){for(var i=e-1;i>=0;i--)if(!l._items[i].disabled)return i}else for(var i=e+1,a=l._items.length;a>i;i++)if(!l._items[i].disabled)return i;return-1},close:function(){var e=this,t=e._selectedIndex,l=e._items[t];l&&t>=0&&l.closable&&!l.disabled&&(e.removeTabItem(t),e._calcItemsWidth())},closeOther:function(){for(var e,t=this,l=t._items.length-1;l>=0;l--)if(e=t._items[l],e.closable&&!e.disabled){if(t._selectedIndex==l)continue;t.removeTabItem(l)}t._calcItemsWidth()},checkSizeChanged:function(){var e=this,t=jQuery(e.el).width();e._tabControlWidth!=t&&(e._tabControlWidth=t,e._calcItemsWidth(),e._setVisiTabItems(e._leftIndex))},_createContextMenu:function(){var e=this;if(jslet.ui.Menu&&e._closable){var t={type:"Menu",onItemClick:e._menuItemClick,items:[{id:"close",name:jslet.locale.TabControl.close},{id:"closeOther",name:jslet.locale.TabControl.closeOther}]};if(e._onCreateContextMenu&&e._onCreateContextMenu.call(e,t.items),0!==t.items.length){e.contextMenu=jslet.ui.createControl(t);var l=jQuery(e.el).find(".jl-tab-container")[0];l.oncontextmenu=function(t){var l=t||window.event;e.contextMenu.showContextMenu(l,e)}}}},_menuItemClick:function(e,t){"close"==e?this.close():"closeOther"==e&&this.closeOther()},destroy:function(e){var t=this;t._newTabItem&&(t._newTabItem.onclick=null,t._newTabItem=null);var l=jQuery(t.el),i=l.find(".jl-tab-header")[0];l.find(".jl-tab-left").off(),l.find(".jl-tab-right").off(),i.oncontextmenu=null,l.find(".jl-tab-close").off();var a=l.find(".jl-tab-list").find("li");a.off(),a.each(function(){this.jslet=null}),jslet.resizeEventBus.unsubscribe(this),e()}}),jslet.ui.register("TabControl",jslet.ui.TabControl),jslet.ui.TabControl.htmlTemplate="<div></div>",jslet.ui.TabItem=function(){var e=this;e.id=null,e.index=-1,e.header=null,e.closable=!1,e.disabled=!1,e.useIFrame=!1,e.height=100,e.url=null,e.divId=null,e.content=null},jslet.ui.TipPanel=function(){this._hideTimerId=null,this._showTimerId=null,this._oldElement=null;var e=document.createElement("div");jQuery(e).addClass("jl-tip-panel"),document.body.appendChild(e),this._tipPanel=e,this.show=function(e,t,l){var i=this,a=arguments.length,r=!1,n=t;if(2==a){var s=n;s=jQuery.event.fix(s),l=s.pageY+16,n=s.pageX+2;var o=s.currentTarget;r=o===i._oldElement,i._oldElement=o}else n=parseInt(n),l=parseInt(l);i._hideTimerId&&(window.clearTimeout(i._hideTimerId),r)||(this._showTimerId=window.setTimeout(function(){var t=i._tipPanel;t.innerHTML=e,t.style.left=n+"px",t.style.top=l+"px",i._tipPanel.style.display="block",i._showTimerId=null},300))},this.hide=function(){var e=this;return e._showTimerId?void window.clearTimeout(e._showTimerId):void(e._hideTimerId=window.setTimeout(function(){e._tipPanel.style.display="none",e._hideTimerId=null,e._oldElement=null},300))}},jslet.ui.globalTip=new jslet.ui.TipPanel,jslet.ui.WaitingBox=function(e,t,l){var i=new jslet.ui.OverlayPanel(e),a='<div class="jl-waitingbox"><b class="jl-waitingbox-icon"></b>';a+='<span id="tips"></span></div>',jQuery(i.overlayPanel).html(a),this.show=function(e){var t=i.overlayPanel,l=t.firstChild,a=l.childNodes[1];a.innerHTML=e?e:"";var r=jQuery(t),n=r.height(),s=r.width();setTimeout(function(){var e=jQuery(l);l.style.top=Math.round((n-e.height())/2)+"px",l.style.left=Math.round((s-e.width())/2)+"px"},10),i.show()},this.hide=function(){i.hide()},this.destroy=function(){i.overlayPanel.innerHTML="",i.destroy()}},jslet.ui.Window=jslet.Class.create(jslet.ui.Control,{initialize:function(e,t,l){var i=this;i.el=t,i.allProperties="caption,resizable,minimizable,maximizable,closable,iconClass,onSizeChanged,onClosed,onPositionChanged,onActive,width,height,minWidth,maxWidth,minHeight,maxHeight,sizeClass,isCenter,isSmallHeader,stopEventBubbling",i._caption=null,i._resizable=!0,i._minimizable=!0,i._maximizable=!0,i._closable=!0,i._iconClass=null,i._width=0,i._height=0,i._minWidth=20,i._minHeight=30,i._maxWidth=-1,i._maxHeight=-1,i._sizeClass=null,i._isCenter=!1,i._onSizeChanged=null,i._onPositionChanged=null,i._onActive=null,i._onClosed=null,i._stopEventBubbling=!1,i._isModal=!1,i._state=null,e(t,l)},caption:function(e){return void 0===e?this._caption:(jslet.Checker.test("Window.caption",e).isString(),void(this._caption=e))},iconClass:function(e){return void 0===e?this._iconClass:(jslet.Checker.test("Window.iconClass",e).isString(),void(this._iconClass=e))},resizable:function(e){return void 0===e?this._resizable:void(this._resizable=e?!0:!1)},minimizable:function(e){return void 0===e?this._minimizable:void(this._minimizable=e?!0:!1)},maximizable:function(e){return void 0===e?this._maximizable:void(this._maximizable=e?!0:!1)},closable:function(e){return void 0===e?this._closable:void(this._closable=e?!0:!1)},isCenter:function(e){return void 0===e?this._isCenter:void(this._isCenter=e?!0:!1)},stopEventBubbling:function(e){return void 0===e?this._stopEventBubbling:void(this._stopEventBubbling=e?!0:!1)},width:function(e){return void 0===e?this._width:(jslet.Checker.test("Window.width",e).isGTZero(),void(this._width=e))},height:function(e){return void 0===e?this._height:(jslet.Checker.test("Window.height",e).isGTZero(),void(this._height=e))},minWidth:function(e){return void 0===e?this._minWidth:(jslet.Checker.test("Window.minWidth",e).isGTZero(),20>e&&(e=20),void(this._minWidth=e))},minHeight:function(e){return void 0===e?this._minHeight:(jslet.Checker.test("Window.minHeight",e).isGTZero(),30>e&&(e=30),void(this._minHeight=e))},maxWidth:function(e){return void 0===e?this._maxWidth:(jslet.Checker.test("Window.maxWidth",e).isNumber(),void(this._maxWidth=e))},maxHeight:function(e){return void 0===e?this._maxHeight:(jslet.Checker.test("Window.maxHeight",e).isNumber(),void(this._maxHeight=e))},sizeClass:function(e){var t=this;return void 0===e?t.sizeClass:(jslet.Checker.test("Window.sizeClass",e).isString(),void(t.sizeClass=e))},onSizeChanged:function(e){return void 0===e?this._onSizeChanged:(jslet.Checker.test("Window.onSizeChanged",e).isFunction(),void(this._onSizeChanged=e))},onPositionChanged:function(e){return void 0===e?this._onPositionChanged:(jslet.Checker.test("Window.onPositionChanged",e).isFunction(),void(this._onPositionChanged=e))},onActive:function(e){return void 0===e?this._onActive:(jslet.Checker.test("Window.onActive",e).isFunction(),void(this._onActive=e))},onClosed:function(e){return void 0===e?this._onClosed:(jslet.Checker.test("Window.onClosed",e).isFunction(),void(this._onClosed=e))},bind:function(){this.renderAll()},renderAll:function(){var e=this;e._closable||(e._minimizable=!1,e._maximizable=!1);var t=jQuery(e.el);t.hasClass("jl-window")||t.addClass("panel panel-default jl-window"),e._width||(e._width=parseInt(e.el.style.width)),e._height||(e._height=parseInt(e.el.style.height)),e._width||(e._width=300),e._height||(e._height=300),e.el.style.width=e._width+"px",e.el.style.height=e._height+"px";var l=['<div class="panel-heading jl-win-header jl-win-header-sm" style="cursor:move">',e._iconClass?'<span class="jl-win-header-icon '+e._iconClass+'"></span>':"",'<span class="panel-title jl-win-caption">',e._caption?e._caption:"","</span>",'<span class="jl-win-tool jl-unselectable">'];l.push(e._closable?'<button class="close jl-win-close" onfocus="this.blur();">x</button>':""),l.push(e._maximizable?'<button class="close jl-win-max" onfocus="this.blur();">\u25a1</button>':""),l.push(e._minimizable?'<button class="close jl-win-min" onfocus="this.blur();">-</button>':""),l.push("</span></div>"),l.push('<div class="panel-body jl-win-body"></div>'),t.html(l.join("")),t.on("mousemove",e._doWinMouseMove),t.on("mousedown",e._doWinMouseDown),t.on("dblclick",function(e){e.stopPropagation(),e.preventDefault()}),t.on("click",function(t){(e._isModal||e._stopEventBubbling)&&(t.stopPropagation(),t.preventDefault())});var i=t.find(".jl-win-header"),a=i[0];e._headerHeight=i.outerHeight();var r=t.find(".jl-win-body")[0],n=e._height-e._headerHeight-12;if(0>n&&(n=0),r.style.height=n+"px",jqBody=jQuery(r),jqBody.on("mouseenter",function(t){window.setTimeout(function(){jslet.temp_dragging||(e.cursor=null)},300)}),jqBody.on("dblclick",function(e){e.stopPropagation(),e.preventDefault()}),i.on("mousedown",function(t){e.activate(),"max"!=e._state&&(e.cursor=null,jslet.ui.dnd.bindControl(this))}),i.on("dblclick",function(t){t.stopPropagation(),t.preventDefault(),e._maximizable&&("max"!=e._state?e.maximize():e.restore())}),a._doDragStart=function(t,l,i,r,n,s){e._createTrackerMask(a),e.trackerMask.style.cursor=a.style.cursor,jslet.temp_dragging=!0},a._doDragging=function(t,l,i,a,r,n){e.setPosition(e.left+r,e.top+n,!0)},a._doDragEnd=function(t,l,i,a,r,n){var s=parseInt(e.el.style.left),o=parseInt(e.el.style.top);e.setPosition(s,o),e._removeTrackerMask(),e.cursor=null,jslet.temp_dragging=!1},a._doDragCancel=function(t,l,i,a,r,n){e.setPosition(e.left,e.top),e._removeTrackerMask(),e.cursor=null,jslet.temp_dragging=!1},e.el._doDragStart=function(t,l,i,a,r,n){e._createTrackerMask(this),e._createTracker(),e.trackerMask.style.cursor=e.el.style.cursor,jslet.temp_dragging=!0},e.el._doDragging=function(t,l,i,a,r,n){e._changeTrackerSize(r,n)},e.el._doDragEnd=function(t,l,i,a,r,n){if(e.tracker){var s=parseInt(e.tracker.style.left),o=parseInt(e.tracker.style.top),d=parseInt(e.tracker.style.width),u=parseInt(e.tracker.style.height);e.setPosition(s,o),e.changeSize(d,u),e._removeTrackerMask(),e._removeTracker(),e.cursor=null,jslet.temp_dragging=!1}},e.el._doDragCancel=function(t,l,i,a,r,n){e._removeTrackerMask(),e._removeTracker(),e.cursor=null,jslet.temp_dragging=!1},e._closable){var s=t.find(".jl-win-close");s.click(function(t){e.close(),t=jQuery.event.fix(t||window.event),t.stopPropagation(),t.preventDefault()})}if(e._minimizable){var o=t.find(".jl-win-min");o.click(function(t){e.minimize(),t=jQuery.event.fix(t||window.event),t.stopPropagation(),t.preventDefault()})}if(e._maximizable){var d=t.find(".jl-win-max"),u=d[0];d.click(function(t){"max"!=e._state?(u.innerHTML="\u25a0",e.maximize()):(u.innerHTML="\u25a1",e.restore()),t=jQuery.event.fix(t||window.event),t.stopPropagation(),t.preventDefault()})}},show:function(e,t){var l=this;if(l._isCenter){var i=jQuery(l.el).offsetParent()[0],a=jQuery(i),r=a.width(),n=a.height();e=i.scrollLeft+Math.round((r-l._width)/2),t=i.scrollTop+Math.round((n-l._height)/2)}l.top=t?t:0,l.left=e?e:0,l.el.style.left=l.left+"px",l.el.style.top=l.top+"px",l.el.style.display="block",l.activate()},showModal:function(e,t){var l=this;l._isModal=!0,l.overlay||(l.overlay=new jslet.ui.OverlayPanel(l.el.parentNode)),jslet.ui.GlobalZIndex+=10;var i=jslet.ui.GlobalZIndex;l.el.style.zIndex=i,l.show(e,t),l.overlay.setZIndex(i-2),l.overlay.show()},hide:function(){var e=this;e.el.style.display="none",e.overlay&&e.overlay.hide()},close:function(){var e=this;if(e.el){if(e._onClosed){var t=e._onClosed.call(e);if(t&&"hidden"==t.toLowerCase())return void e.hide()}var l=e.el.parentNode;l.removeChild(e.el),e.overlay&&(e.overlay.destroy(),e.overlay=null),jslet.ui.GlobalZIndex-=10,e.destroy()}},minimize:function(){var e=this;return"min"==e._state?void e.restore():("max"==e._state&&e.restore(),e.changeSize(null,e._headerHeight+8,!0),void(e._state="min"))},maximize:function(){var e=this,t=jQuery(e.el).offsetParent(),l=t.width(),i=t.height();e.setPosition(0,0,!0),e.changeSize(l,i,!0),e._state="max"},restore:function(){var e=this;e.setPosition(e.left,e.top,!0),e.changeSize(e._width,e._height,!0),e._state=null},activate:function(){var e=this;e.overlay||e.bringToFront(),e._onActive&&e._onActive.call()},setPosition:function(e,t,l){var i=this;if(l){if(i._onPositionChanged){var a=i._onPositionChanged.call(i,e,t);a&&(a.left&&(e=a.left),a.top&&(t=a.top))}}else i.left=e,i.top=t;i.el.style.left=e+"px",i.el.style.top=t+"px"},changeSize:function(e,t,l){var i=this;e||(e=i._width),t||(t=i._height),i._onSizeChanged&&i._onSizeChanged.call(i,e,t),l||(i._width=e,i._height=t),i.el.style.width=e+"px",i.el.style.height=t+"px";
var a=jQuery(i.el),r=a.find(".jl-win-body")[0],n=t-i._headerHeight-12;0>n&&(n=0),r.style.height=n+"px"},getCaptionDiv:function(){return jQuery(this.el).find(".jl-win-caption")[0]},changeCaption:function(e){this.caption=e;var t=jQuery(this.el).find(".jl-win-caption");t.html(e)},getContentDiv:function(){return jQuery(this.el).find(".jl-win-body")[0]},setContent:function(e){if(!e)return void jslet.showError("Window content cannot be null!");var t=jQuery(this.el).find(".jl-win-body");e&&e.toLowerCase?t.html(e):(t.html(""),e.parentNode.removeChild(e),t[0].appendChild(e),e.style&&"none"==e.style.display&&(e.style.display="block"))},bringToFront:function(){for(var e,t,l=this,i=l.el.parentNode,a=jQuery(l.el),r=0,n=0,s=i.childNodes.length;s>n;n++)e=i.childNodes[n],1==e.nodeType&&e!=l.el?(t=jQuery(e),t.hasClass("jl-window")&&(r<e.style.zIndex&&(r=e.style.zIndex),l._isModal||t.find(".jl-win-header").removeClass("jl-window-active"))):l._isModal||a.find(".jl-win-header").addClass("jl-window-active");(l.el.style.zIndex<r||0===r)&&l.setZIndex(r+3)},setZIndex:function(e){this.el.style.zIndex=e},_checkSize:function(e,t){var l=this;return e&&(e<l._minWidth||l._maxWidth>0&&e>l._maxWidth)?!1:t&&(t<l.minHeight||l._maxHeight>0&&t>l._maxHeight)?!1:!0},_changeTrackerSize:function(e,t){var l=this;if(l.tracker&&l.cursor){var i=l.el.offsetWidth,a=l.el.offsetHeight,r=null,n=null;"nw"==l.cursor?(i=l._width-e,a=l._height-t,r=l.top+t,n=l.left+e):"n"==l.cursor?(a=l._height-t,r=l.top+t):"ne"==l.cursor?(a=l._height-t,i=l._width+e,r=l.top+t):"e"==l.cursor?i=l._width+e:"se"==l.cursor?(i=l._width+e,a=l._height+t):"s"==l.cursor?a=l._height+t:"sw"==l.cursor?(a=l._height+t,i=l._width-e,n=l.left+e):"w"==l.cursor&&(i=l._width-e,n=l.left+e),l._checkSize(i,a)&&(i&&(l.tracker.style.width=i+"px"),a&&(l.tracker.style.height=a+"px"),r&&(l.tracker.style.top=r+"px"),n&&(l.tracker.style.left=n+"px"))}},_doWinMouseMove:function(e){if(!jslet.temp_dragging){e=jQuery.event.fix(e||window.event);var t=e.target,l=jQuery(t);if(l.hasClass("jl-window")){if(!t.jslet._resizable||t.jslet._state)return t.jslet.cursor=null,void(t.style.cursor="default");var i=l.offset(),a=e.pageX-i.left,r=e.pageY-i.top,n=l.width(),s=l.height(),o=8,d=n-o,u=s-o,c=null;o>=a&&o>=r?c="nw":a>o&&d>a&&o>=r?c="n":a>=d&&o>=r?c="ne":a>=d&&r>o&&u>=r?c="e":a>=d&&r>=u?c="se":a>o&&d>a&&r>=u?c="s":o>=a&&r>=u?c="sw":o>=a&&r>o&&u>r&&(c="w"),t.jslet.cursor=c,t.style.cursor=c?c+"-resize":"default"}}},_doWinMouseDown:function(e){var t=this.jslet;t.activate(),t.cursor&&jslet.ui.dnd.bindControl(this)},_createTrackerMask:function(e){var t=this;if(!t.trackerMask){var l=jQuery(document.body);t.trackerMask=document.createElement("div"),jQuery(t.trackerMask).addClass("jl-win-tracker-mask"),t.trackerMask.style.top="0px",t.trackerMask.style.left="0px",t.trackerMask.style.zIndex=99998,t.trackerMask.style.width=l.width()+"px",t.trackerMask.style.height=l.height()+"px",t.trackerMask.style.display="block",t.trackerMask.onmousedown=function(){e&&e._doDragCancel&&e._doDragCancel()},l[0].appendChild(t.trackerMask)}},_removeTrackerMask:function(){var e=this;e.trackerMask&&(e.trackerMask.onmousedown=null,document.body.removeChild(e.trackerMask)),e.trackerMask=null},_createTracker:function(){var e=this;e.tracker||(e.tracker=document.createElement("div"),jQuery(e.tracker).addClass("jl-win-tracker"),e.tracker.style.top=e.top+"px",e.tracker.style.left=e.left+"px",e.tracker.style.zIndex=99999,e.tracker.style.width=e._width+"px",e.tracker.style.height=e._height+"px",e.tracker.style.display="block",e.el.parentNode.appendChild(e.tracker))},_removeTracker:function(){var e=this;e.tracker&&e.el.parentNode.removeChild(e.tracker),e.tracker=null},destroy:function(e){var t=this,l=jQuery(t.el);l.find(".jl-win-max").off(),l.find(".jl-win-min").off(),l.find(".jl-win-close").off();var i=l.find(".jl-win-header"),a=i[0];i.off(),l.find(".jl-win-body").off(),t.trackerMask&&(t.trackerMask.onmousedown=null),t.trackerMask=null,t.el._doDragCancel=null,t.el._doDragEnd=null,t.el._doDragging=null,t.el._doDragStart=null,a._doDragCancel=null,a._doDragEnd=null,a._doDragging=null,a._doDragStart=null,e&&e()}}),jslet.ui.register("Window",jslet.ui.Window),jslet.ui.Window.htmlTemplate="<div></div>",jslet.ui.MessageBox=function(){this.show=function(e,t,l,i,a,r,n,s){jslet.ui.textMeasurer.setElement(document.body);for(var o=e.split("\n"),d=o.length,u=jslet.ui.textMeasurer.getHeight(e),c=0,h=0;d>h;h++)c=Math.max(c,jslet.ui.textMeasurer.getWidth(e[h]));u=u*o.length+100,jslet.ui.textMeasurer.setElement(),200>c&&(c=200),e=e.replace("\n","<br />");var f=parseInt(jslet.ui.getCssValue("jl-msg-button","width")),v=i.length,p=(f+10)*v-10;p>c&&(c=p),c+=100,1==r?u+=25:2==r&&(u+=100);var _={type:"window",caption:t,isCenter:!0,resizable:!1,minimizable:!1,maximizable:!1,stopEventBubbling:!0,height:u,width:c},g=jslet.ui.createControl(_),m="";if(l){switch(m='<div class="jl-msg-icon ',m+="info"==l||"error"==l||"question"==l||"warning"==l?"jl-msg-icon-"+l:l,m+='"><i class="fa ',l){case"info":m+="fa-info";break;case"error":m+="fa-times";break;case"success":m+="fa-check";break;case"warning":m+="fa-exclamation";break;case"question":m+="fa-question";break;default:m+="fa-info"}m+='"></i></div>'}var j,C,h,y=[],b=0;if(jslet.locale.isRtl)for(h=v-1;h>=0;h--)j=i[h],C=b++*(f+10)-10,y.push('<button class="jl-msg-button btn btn-default btn-sm" '),y.push(' data-jsletname="'),y.push(j),y.push('" style="left: '),y.push(C),y.push('px">'),y.push(jslet.locale.MessageBox[j]),y.push("</button>");else for(h=0;v>h;h++)j=i[h],C=h*(f+10)-10,y.push('<button class="jl-msg-button btn btn-default btn-sm" '),y.push('" data-jsletname="'),y.push(j),y.push('" style="left: '),y.push(C),y.push('px">'),y.push(jslet.locale.MessageBox[j]),y.push("</button>");var x=["<br />"];r&&(1==r?x.push('<input type="text"'):x.push('<textarea rows="5"'),x.push(' style="width:'),x.push('98%"'),null!==n&&void 0!==n&&(x.push(' value="'),x.push(n),x.push('"')),1==r?x.push(" />"):x.push("></textarea>"));var F=['<div class="jl-msg-container">',m,'<div class="'+(r?"jl-msg-message-noicon":"jl-msg-message")+'">',e,x.join(""),"</div>","</div>",'<div class="jl-msg-tool"><div style="position:relative;width:',p,'px;margin:0px auto;">',y.join(""),"</div></div>"];g.setContent(F.join(""));var w=jQuery(g.el),k=w.find(".jl-msg-tool")[0].firstChild,D=null;D=1==r?w.find(".jl-msg-container input")[0]:w.find(".jl-msg-container textarea")[0];var S;for(h=0;v>h;h++)S=k.childNodes[h],S.onclick=function(){j=jQuery(this).attr("data-jsletname");var e=null;return r&&"ok"==j&&(e=D.value,s&&!s(e))?void D.focus():(g.close(),void(a&&a(j,e)))};g.onClosed(function(){a&&a(j)}),g.showModal(),g.setZIndex(99981),b=0,jslet.locale.isRtl&&(b=v-1);var T=k.childNodes[b];return T&&T.focus(),g}},jslet.ui.MessageBox.alert=function(e,t,l,i){var a=new jslet.ui.MessageBox;t||(t=jslet.locale.MessageBox.info);var r=a.show(e,t,"info",["ok"],l);i&&(i=parseInt(i),NaN!==i&&window.setTimeout(function(){r.close()},i))},jslet.ui.MessageBox.error=function(e,t,l,i){var a=new jslet.ui.MessageBox;t||(t=jslet.locale.MessageBox.error);var r=a.show(e,t,"error",["ok"],l);i&&(i=parseInt(i),NaN!==i&&window.setTimeout(function(){r.close()},i))},jslet.ui.MessageBox.warn=function(e,t,l){var i=new jslet.ui.MessageBox;t||(t=jslet.locale.MessageBox.warn),i.show(e,t,"warning",["ok"],l)},jslet.ui.MessageBox.confirm=function(e,t,l,i){var a=new jslet.ui.MessageBox;t||(t=jslet.locale.MessageBox.confirm),i?a.show(e,t,"question",["yes","no","cancel"],l):a.show(e,t,"question",["ok","cancel"],l)},jslet.ui.MessageBox.prompt=function(e,t,l,i,a,r){var n=new jslet.ui.MessageBox;t||(t=jslet.locale.MessageBox.prompt),r?n.show(e,t,null,["ok","cancel"],l,2,i,a):n.show(e,t,null,["ok","cancel"],l,1,i,a)},jslet.ui.FindDialog=function(e){function t(){function e(){var e=o.val();e="=*"==e?"first":"*="==e?"last":"*=*"==e?"any":null,i.findByField(r,d.val(),!0,!0,e)}var t={type:"window",caption:"Find",isCenter:!1,resizable:!0,minimizable:!1,maximizable:!1,stopEventBubbling:!0,height:85,width:320};l=jslet.ui.createControl(t,a),l.onClosed(function(){return"hidden"});var n='<div class="form-horizontal"><div class="form-group form-group-sm jl-nogap"><div class="col-sm-9 jl-nogap"><input class="form-control jl-finddlg-value jl-nogap"/></div><div class="col-sm-2 jl-nogap"><select class="form-control jl-finddlg-opt jl-nogap"><option title="'+jslet.locale.findDialog.matchFirst+'">=*</option><option>=</option><option title="'+jslet.locale.findDialog.matchLast+'">*=</option><option title="'+jslet.locale.findDialog.matchAny+'">*=*</option></select></div><div class="col-sm-1 btn-group btn-group-sm jl-nogap"><button class="btn jl-finddlg-find fa fa-search"></button></div></div>';l.setContent(n);var s=l.el,o=jQuery(s).find(".jl-finddlg-opt"),d=jQuery(s).find(".jl-finddlg-value");d.on("keydown",function(t){return 13===t.keyCode?(e(),t.stopImmediatePropagation(),t.preventDefault(),!1):void 0});var u=jQuery(s).find(".jl-finddlg-find");u.on("click",function(t){e()})}var l,i=e.dataset(),a=e.el,r=null;this.show=function(e,t){e=e||0,t=t||0,l.show(e,t)},this.hide=function(){l.hide()},this.findingField=function(e){if(void 0===e)return r;if(r=e){var t=i.getField(r);t&&l.changeCaption(jslet.formatString(jslet.locale.findDialog.caption,[t.label()]))}},t(),this.hide()},jslet.ui.FilterDialog=function(e,t){},jslet.ui.DBChart=jslet.Class.create(jslet.ui.DBControl,{chartTypes:["line","bar","stackbar","pie"],legendPositions:["none","top","bottom","left","right"],initialize:function(e,t,l){var i=this;i.allProperties="dataset,chartType,chartTitle,categoryField,valueFields,legendPos",i.requiredProperties="valueFields,categoryField",i._chartType="line",i._categoryFields=null,i._valueFields=null,i._chartTitle=null,i._legendPos="top",i._fieldValidated=!1,e(t,l)},chartType:function(e){if(void 0===e)return this._chartType;e=jQuery.trim(e);var t=jslet.Checker.test("DBChart.chartType",e).isString().required();t.testValue(e.toLowerCase()).inArray(this.chartTypes),this._chartType=e},categoryField:function(e){return void 0===e?this._categoryField:(jslet.Checker.test("DBChart.categoryField",e).isString().required(),e=jQuery.trim(e),this._categoryField=e,void(this._fieldValidated=!1))},valueFields:function(e){return void 0===e?this._valueFields:(jslet.Checker.test("DBChart.valueFields",e).isString().required(),e=jQuery.trim(e),this._valueFields=e.split(","),void(this._fieldValidated=!1))},chartTitle:function(e){return void 0===e?this._chartTitle:(jslet.Checker.test("DBChart.chartTitle",e).isString(),void(this._chartTitle=e))},legendPos:function(e){if(void 0===e)return this._legendPos;e=jQuery.trim(e);var t=jslet.Checker.test("DBChart.legendPos",e).isString().required();t.testValue(e.toLowerCase()).inArray(this.legendPositions),this._legendPos=e},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){this.el.id||(this.el.id=jslet.nextId()),this.renderAll()},_validateFields:function(){var e=this;if(!e._fieldValidated){var t=e._dataset,l=e._categoryField;if(!t.getField(l))throw new Error(jslet.formatString(jslet.locale.Dataset.fieldNotFound,[l]));for(var i=0,a=e._valueFields.length;a>i;i++)if(l=e._valueFields[i],!t.getField(l))throw new Error(jslet.formatString(jslet.locale.Dataset.fieldNotFound,[l]));e._fieldValidated=!0}},_getLineData:function(){var e=this,t=e._dataset;if(0===t.recordCount())return{xLabels:[],yValues:[]};var l=t.recnoSilence(),i=[],a=[];try{for(var r,n,s=!1,o=e._valueFields.length,d=[],u=0,c=t.recordCount();c>u;u++){t.recnoSilence(u),i.push(t.getFieldText(e._categoryField));for(var h=0;o>h;h++)r=e._valueFields[h],s?n=a[h]:(n=[],a.push(n),d.push(t.getField(r).label())),n.push(t.getFieldValue(r));s=!0}}finally{t.recnoSilence(l)}return{xLabels:i,yValues:a,legendLabels:d}},_getPieData:function(){var e=this,t=e._dataset;if(0===t.recordCount())return[];var l=t.recnoSilence(),i=[];try{for(var a,r,n=e._valueFields[0],s=0,o=t.recordCount();o>s;s++)t.recnoSilence(s),a=t.getFieldText(e._categoryField),r=t.getFieldValue(n),i.push([a,r])}finally{t.recnoSilence(l)}return i},_drawLineChart:function(){var e=this,t=e._getLineData();jQuery.jqplot(e.el.id,t.yValues,{title:e._chartTitle,animate:!jQuery.jqplot.use_excanvas,seriesDefaults:{rendererOptions:{smooth:!0},pointLabels:{show:!0,formatString:"%d"}},legend:{show:!0,labels:t.legendLabels},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:t.xLabels}}})},_drawPieChart:function(){var e=this,t=e._getPieData();jQuery.jqplot(e.el.id,[t],{title:e._chartTitle,animate:!jQuery.jqplot.use_excanvas,seriesDefaults:{renderer:$.jqplot.PieRenderer,pointLabels:{show:!0,formatString:"%d"}},legend:{show:!0}})},_drawBarChart:function(e){var t=this,l=t._getLineData();jQuery.jqplot(t.el.id,l.yValues,{title:t._chartTitle,stackSeries:e,animate:!jQuery.jqplot.use_excanvas,seriesDefaults:{renderer:$.jqplot.BarRenderer,pointLabels:{show:!0,formatString:"%d"}},legend:{show:!0,labels:l.legendLabels},axes:{xaxis:{renderer:$.jqplot.CategoryAxisRenderer,ticks:l.xLabels}},highlighter:{show:!1}})},drawChart:function(){var e=this;e._dataset;return e.el.innerHTML="",e._validateFields(),"pie"==e._chartType?void e._drawPieChart():"line"==e._chartType?void e._drawLineChart():"bar"==e._chartType?void e._drawBarChart(!1):"stackbar"==e._chartType?void e._drawBarChart(!0):void 0},refreshControl:function(e){var t=e.eventType;(t==jslet.data.RefreshEvent.UPDATEALL||t==jslet.data.RefreshEvent.UPDATERECORD||t==jslet.data.RefreshEvent.UPDATECOLUMN||t==jslet.data.RefreshEvent.INSERT||t==jslet.data.RefreshEvent.DELETE)&&this.drawChart()},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},destroy:function(e){this.swf=null,e()}}),jslet.ui.register("DBChart",jslet.ui.DBChart),jslet.ui.DBChart.htmlTemplate="<div></div>",jslet.ui.DBEditPanel=jslet.Class.create(jslet.ui.DBControl,{_totalColumns:12,initialize:function(e,t,l){var i=this;i.allProperties="dataset,columnCount,labelCols,onlySpecifiedFields,fields",i._columnCount=3,i._labelCols=1,i._onlySpecifiedFields=!1,i._fields,i._metaChangedDebounce=jslet.debounce(i.renderAll,10),e(t,l)},columnCount:function(e){return void 0===e?this._columnCount:(jslet.Checker.test("DBEditPanel.columnCount",e).isGTZero(),void(this._columnCount=parseInt(e)))},labelCols:function(e){return void 0===e?this._labelCols:(jslet.Checker.test("DBEditPanel.labelCols",e).isNumber().between(1,3),void(this._labelCols=parseInt(e)))},onlySpecifiedFields:function(e){return void 0===e?this._onlySpecifiedFields:void(this._onlySpecifiedFields=e?!0:!1)},fields:function(e){if(void 0===e)return this._fields;jslet.Checker.test("DBEditPanel.fields",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("DBEditPanel.fields.field",t.field).isString().required(),jslet.Checker.test("DBEditPanel.fields.labelCols",t.colSpan).isNumber().between(1,3),jslet.Checker.test("DBEditPanel.fields.dataCols",t.colSpan).isNumber().between(1,11),t.inFirstCol=t.inFirstCol?!0:!1,t.showLine=t.showLine?!0:!1,t.visible=void 0===t.visible||t.visible?!0:!1;this._fields=e},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){this.renderAll()},_calcLayout:function(){var e,t,l=this,i=l._dataset.getNormalFields();if(l._onlySpecifiedFields)e=l._fields;else{e=[];for(var a,r,n,s,o=l._fields?l._fields.length:0,d=0,u=i.length;u>d;d++){t=i[d],a=t.name(),s=t.visible(),r=!1;for(var c=0;o>c;c++)if(n=l._fields[c],a==n.field){r=!0,(void 0===n.visible||n.visible)&&e.push(n);break}if(!r){if(!s)continue;e.push({field:t.name()})}}}var h=Math.floor((l._totalColumns-l._labelCols*l._columnCount)/l._columnCount);0>=h&&(h=1);for(var f,v,p=0,_=0,d=0,g=e.length;g>d;d++)f=e[d],f.labelCols||(f._innerLabelCols=l._labelCols),f.dataCols?f._innerDataCols=f.dataCols:f._innerDataCols=h,v=f._innerLabelCols+f._innerDataCols,(f.inFirstCol||f.showLine||_+v>l._totalColumns)&&(p++,_=0),f.row=p,_+=v;return e},getEditField:function(e){var t=this;t._fields||(t._fields=[]);for(var l,i=0,a=t._fields.length;a>i;i++)if(l=t._fields[i],l.field==e)return l;var r=t._dataset.getField(e);return r?(l={field:e},t._fields.push(l),l):null},renderAll:function(){var e=this;e.removeAllChildControls();var t=jQuery(e.el);t.hasClass("jl-editpanel")||t.addClass("jl-editpanel form-horizontal"),t.html("");for(var l,i,a,r,n,s,o,d,u,c=e._dataset.getNormalFields(),h=(c.length,e._calcLayout()),f=-1,v=0,p=h.length;p>v;v++){if(layout=h[v],layout.showLine&&(n=document.createElement("hr"),e.el.appendChild(n)),layout.row!=f&&(o=document.createElement("div"),o.className="form-group form-group-sm",e.el.appendChild(o),f=layout.row),a=layout.field,r=e._dataset.getField(a),!r)throw new Error(jslet.formatString(jslet.locale.Dataset.fieldNotFound,[a]));i=r.editControl();var _="dbcheckbox"==i.type.toLowerCase();_?(l=document.createElement("div"),o.appendChild(l),l.className="col-sm-"+layout._innerLabelCols,s=document.createElement("div"),o.appendChild(s),s.className="col-sm-"+layout._innerDataCols,i.dataset=e._dataset,i.field=a,editor=jslet.ui.createControl(i,null),s.appendChild(editor.el),e.addChildControl(editor),l=document.createElement("label"),s.appendChild(l),u=new jslet.ui.DBLabel(l,{type:"DBLabel",dataset:e._dataset,field:a}),d=jslet.nextId(),editor.el.id=d,jQuery(l).attr("for",d),e.addChildControl(u)):(l=document.createElement("label"),o.appendChild(l),l.className="col-sm-"+layout._innerLabelCols,dbctrl=new jslet.ui.DBLabel(l,{type:"DBLabel",dataset:e._dataset,field:a}),e.addChildControl(u),s=document.createElement("div"),o.appendChild(s),s.className="col-sm-"+layout._innerDataCols,r.valueStyle()==jslet.data.FieldValueStyle.BETWEEN&&(i={type:"DBBetweenEdit"}),i.dataset=e._dataset,i.field=a,editor=jslet.ui.createControl(i,null),s.appendChild(editor.el),d=jslet.nextId(),editor.el.id=d,jQuery(l).attr("for",d),e.addChildControl(editor))}},doMetaChanged:function(e,t){!t||"visible"!=t&&"editControl"!=t||this._metaChangedDebounce.call(this)}}),jslet.ui.register("DBEditPanel",jslet.ui.DBEditPanel),jslet.ui.DBEditPanel.htmlTemplate="<div></div>",jslet.ui.DBInspector=jslet.Class.create(jslet.ui.DBControl,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,columnCount,rowHeight,fields",i._columnCount=1,i._rowHeight=30,i._fields=null,i._metaChangedDebounce=jslet.debounce(i.renderAll,10),e(t,l)},columnCount:function(e){return void 0===e?this._columnCount:(jslet.Checker.test("DBInspector.columnCount",e).isGTZero(),void(this._columnCount=parseInt(e)))},rowHeight:function(e){return void 0===e?this._rowHeight:(jslet.Checker.test("DBInspector.rowHeight",e).isGTZero(),void(this._rowHeight=parseInt(e)))},fields:function(e){if(void 0===e)return this._fields;jslet.Checker.test("DBInspector.fields",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("DBInspector.fields.field",t.field).isString().required(),t.visible=t.visible?!0:!1;this._fields=e},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){var e=this,t=e._columnCount;t&&(t=parseInt(t)),t&&t>0?e._columnCount=t:e._columnCount=1,e.renderAll()},renderAll:function(){var e=this,t=jQuery(e.el);e.removeAllChildControls(),t.hasClass("jl-inspector")||t.addClass("jl-inspector jl-round5");var l=t.width(),i=e._dataset.getFields();t.html('<table cellpadding=0 cellspacing=0 style="margin:0;padding:0;table-layout:fixed;width:100%;height:100%"><tbody></tbody></table>');var a,r,n,s,o,d,u=i.length,c=[];for(r=0;u>r;r++){if(a=i[r],o=a.name(),n=!1,e._fields)for(var h=0,f=e._fields.length;f>h;h++)if(d=e._fields[h],o==d.field){n=!0,s=d.visible?!0:!1;break}n||(s=a.visible()),s&&c.push(a)}if(u=c.length,0!==u){var v,p,_=Math.min(u,e._columnCount),g=[];for(r=0;_>r;r++)g[r]=0;var m=jslet.ui.textMeasurer.getWidth("*");for(jslet.ui.textMeasurer.setElement(e.el),r=0;u>r;r++)a=c[r],p=r%_,v=Math.round(jslet.ui.textMeasurer.getWidth(a.label())+m)+5,g[p]<v&&(g[p]=v);jslet.ui.textMeasurer.setElement();var j=0;for(r=0;_>r;r++)j+=g[r];var C,y=(Math.round((l-j)/_),e.el.firstChild),b=y.createTHead(),x=b.insertRow(-1);for(x.style.height="0",r=0;_>r;r++)C=x.insertCell(-1),C.style.width=g[r]+"px",C.style.height="0",C=x.insertCell(-1),C.style.height="0";var F,w,k,o,D,S,T,E=-1;for(e.preRowIndex=-1,r=0;u>r;r++)a=c[r],o=a.name(),F=Math.floor(r/_),p=r%_,E!=F&&(x=y.insertRow(-1),e._rowHeight&&(x.style.height=e._rowHeight+"px"),E=F),C=x.insertCell(-1),C.noWrap=!0,C.className=jslet.ui.htmlclass.DBINSPECTOR.labelColCls,k=document.createElement("label"),C.appendChild(k),T=new jslet.ui.DBLabel(k,{type:"DBLabel",dataset:e._dataset,field:o}),e.addChildControl(T),C=x.insertCell(-1),C.className=jslet.ui.htmlclass.DBINSPECTOR.editorColCls,C.noWrap=!0,C.align="left",w=document.createElement("div"),w.noWrap=!0,C.appendChild(w),S=a.editControl(),S.dataset=e._dataset,S.field=o,D=jslet.ui.createControl(S,w),D.isCheckBox||(D.el.style.width="100%"),e.addChildControl(D)}},doMetaChanged:function(e,t){!t||"visible"!=t&&"editControl"!=t||this._metaChangedDebounce.call(this)}}),jslet.ui.htmlclass.DBINSPECTOR={labelColCls:"jl-inspector-label",editorColCls:"jl-inspector-editor"},jslet.ui.register("DBInspector",jslet.ui.DBInspector),jslet.ui.DBInspector.htmlTemplate="<div></div>",jslet.ui.htmlclass.TABLECLASS={currentrow:"jl-tbl-current",scrollBarWidth:16,selectColWidth:30,hoverrow:"jl-tbl-row-hover",sortAscChar:"&#8593;",sortDescChar:"&#8595;"},jslet.ui.TableColumn=function(){var e=this;e.field=null,e.colNum=null,e.label=null,e.title=null,e.displayOrder=null,e.width=null,e.colSpan=null,e.disableHeadSort=!1,e.mergeSame=!1,e.noRefresh=!1,e.visible=!0,e.cellRender=null},jslet.ui.TableSubgroup=function(){var e=this;e.hasExpander=!0,e.template=null,e.height=0},jslet.ui.TableHead=function(){var e=this;e.label=null,e.title=null,e.id=null,e.rowSpan=0,e.colSpan=0,e.disableHeadSort=!1,e.subHeads=null},jslet.ui.AbstractDBTable=jslet.Class.create(jslet.ui.DBControl,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,fixedRows,fixedCols,hasSeqCol,hasSelectCol,reverseSeqCol,seqColHeader,noborder,readOnly,hideHead,disableHeadSort,onlySpecifiedCol,selectBy,rowHeight,onRowClick,onRowDblClick,onSelect,onSelectAll,onCustomSort,onFillRow,onFillCell,treeField,columns,subgroup,aggraded,autoClearSelection,onCellClick,defaultCellRender,hasFindDialog,hasFilterDialog",i._fixedRows=0,i._fixedCols=0,i._hasSeqCol=!0,i._reverseSeqCol=!1,i._seqColHeader=null,i._hasSelectCol=!1,i._noborder=!1,i._readOnly=!0,i._hideHead=!1,i._onlySpecifiedCol=!1,i._disableHeadSort=!1,i._aggraded=!0,i._autoClearSelection=!0,i._selectBy=null,i._rowHeight=25,i._headRowHeight=25,i._treeField=null,i._columns=null,i._onRowClick=null,i._onRowDblClick=null,i._onCellClick,i._onCustomSort=null,i._onSelect=null,i._onSelectAll=null,i._onFillRow=null,i._onFillCell=null,i._defaultCellRender=null,i._hasFindDialog=!0,i._hasFilterDialog=!1,i._repairHeight=0,i.contentHeight=0,i.subgroup=null,i._sysColumns=null,i._isHoriOverflow=!1,i._oldHeight=null,i._currRow=null,i._currColNum=0,i._editingField=null,i._editorTabIndex=1,i._rowHeightChanged=!1,e(t,l)},fixedRows:function(e){return void 0===e?this._fixedRows:(jslet.Checker.test("DBTable.fixedRows",e).isNumber(),void(this._fixedRows=parseInt(e)))},fixedCols:function(e){return void 0===e?this._fixedCols:(jslet.Checker.test("DBTable.fixedCols",e).isNumber(),void(this._fixedCols=parseInt(e)))},rowHeight:function(e){return void 0===e?this._rowHeight:(jslet.Checker.test("DBTable.rowHeight",e).isGTZero(),this._rowHeight=parseInt(e),void(this._rowHeightChanged=!0))},headRowHeight:function(e){return void 0===e?this._headRowHeight:(jslet.Checker.test("DBTable.headRowHeight",e).isGTZero(),void(this._headRowHeight=parseInt(e)))},hasSeqCol:function(e){return void 0===e?this._hasSeqCol:void(this._hasSeqCol=e?!0:!1)},reverseSeqCol:function(e){return void 0===e?this._reverseSeqCol:void(this._reverseSeqCol=e?!0:!1)},seqColHeader:function(e){return void 0===e?this._seqColHeader:void(this._seqColHeader=e)},hasSelectCol:function(e){return void 0===e?this._hasSelectCol:void(this._hasSelectCol=e?!0:!1)},noborder:function(e){return void 0===e?this._noborder:void(this._noborder=e?!0:!1)},readOnly:function(e){var t=this;return void 0===e?t._readOnly:(t._readOnly=e?!0:!1,void(t._readOnly||t._rowHeightChanged||(t._rowHeight=35)))},hideHead:function(e){return void 0===e?this._hideHead:void(this._hideHead=e?!0:!1)},aggraded:function(e){return void 0===e?this._aggraded:void(this._aggraded=e?!0:!1)},autoClearSelection:function(e){return void 0===e?this._autoClearSelection:void(this._autoClearSelection=e?!0:!1)},disableHeadSort:function(e){return void 0===e?this._disableHeadSort:void(this._disableHeadSort=e?!0:!1)},onlySpecifiedCol:function(e){return void 0===e?this._onlySpecifiedCol:void(this._onlySpecifiedCol=e?!0:!1)},selectBy:function(e){return void 0===e?this._selectBy:(jslet.Checker.test("DBTable.selectBy",e).isString(),void(this._selectBy=e))},treeField:function(e){return void 0===e?this._treeField:(jslet.Checker.test("DBTable.treeField",e).isString(),void(this._treeField=e))},defaultCellRender:function(e){return void 0===e?this._defaultCellRender:(jslet.Checker.test("DBTable.defaultCellRender",e).isObject(),void(this._defaultCellRender=e))},currColNum:function(e){var t=this;if(void 0===e)return t._currColNum;var l=t._currColNum;if(t._currColNum=e,t._adjustCurrentCellPos(l>e),t._showCurrentCell(),t._findDialog){var i=t.innerColumns[e];i.field&&t._findDialog.findingField(i.field)}},onRowClick:function(e){return void 0===e?this._onRowClick:(jslet.Checker.test("DBTable.onRowClick",e).isFunction(),void(this._onRowClick=e))},onRowDblClick:function(e){return void 0===e?this._onRowDblClick:(jslet.Checker.test("DBTable.onRowDblClick",e).isFunction(),void(this._onRowDblClick=e))},onCellClick:function(e){return void 0===e?this._onCellClick:(jslet.Checker.test("DBTable.onCellClick",e).isFunction(),void(this._onCellClick=e))},onSelect:function(e){return void 0===e?this._onSelect:(jslet.Checker.test("DBTable.onSelect",e).isFunction(),void(this._onSelect=e))},onSelectAll:function(e){return void 0===e?this._onSelectAll:(jslet.Checker.test("DBTable.onSelectAll",e).isFunction(),void(this._onSelectAll=e))},onCustomSort:function(e){return void 0===e?this._onCustomSort:(jslet.Checker.test("DBTable.onCustomSort",e).isFunction(),void(this._onCustomSort=e))},onFillRow:function(e){return void 0===e?this._onFillRow:(jslet.Checker.test("DBTable.onFillRow",e).isFunction(),void(this._onFillRow=e))},onFillCell:function(e){return void 0===e?this._onFillCell:(jslet.Checker.test("DBTable.onFillCell",e).isFunction(),void(this._onFillCell=e))},hasFindDialog:function(e){var t=this;return void 0===e?t._hasFindDialog:void(t._hasFindDialog=e?!0:!1)},hasFilterDialog:function(e){var t=this;return void 0===e?t._hasFilterDialog:void(t._hasFilterDialog=e?!0:!1)},columns:function(e){if(void 0===e)return this._columns;jslet.Checker.test("DBTable.columns",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("DBTable.Column.field",t.field).isString(),jslet.Checker.test("DBTable.Column.label",t.label).isString(),jslet.Checker.test("DBTable.Column.colNum",t.colNum).isGTEZero(),jslet.Checker.test("DBTable.Column.displayOrder",t.displayOrder).isNumber(),jslet.Checker.test("DBTable.Column.width",t.width).isGTZero(),jslet.Checker.test("DBTable.Column.colSpan",t.colSpan).isGTZero(),t.disableHeadSort=t.disableHeadSort?!0:!1,t.field||(t.disableHeadSort=!0),t.mergeSame=t.mergeSame?!0:!1,t.noRefresh=t.noRefresh?!0:!1,jslet.Checker.test("DBTable.Column.cellRender",t.cellRender).isObject();this._columns=e},gotoField:function(e){jslet.Checker.test("DBTable.gotoField#fldName",e).required().isString();for(var t,l,i=this.innerColumns.length-1,a=0;i>=a;a++)t=this.innerColumns[a],l=t.field,l==e&&this.gotoColumn(t.colNum)},gotoColumn:function(e){jslet.Checker.test("DBTable.gotoColumn#colNum",e).required().isGTEZero();var t=this.innerColumns.length-1;e>t&&(e=t),this.currColNum(t),t>e&&this.currColNum(e)},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){var e=this;jslet.resizeEventBus.subscribe(e),jslet.ui.textMeasurer.setElement(e.el),e.charHeight=jslet.ui.textMeasurer.getHeight("M")+4,jslet.ui.textMeasurer.setElement(),e.charWidth=jslet.global.defaultCharWidth||12,e._widthStyleId=jslet.nextId(),e._initializeVm(),e.el.tabIndex&&(e._editorTabIndex=e.el.tabIndex+1),e.renderAll();var t=jQuery(e.el),l=t.attr("tabindex");e._readOnly&&!l&&t.attr("tabindex",0);var i="object"==typeof e.el.onmousewheel,a=i?"mousewheel":"DOMMouseScroll";t.on(a,function(t){var l=t.originalEvent,a=i?l.wheelDelta/-120:l.detail/3;e._readOnly||e._dataset.status()==jslet.data.DataSetStatus.BROWSE||e._dataset.confirm(),e.listvm.setVisibleStartRow(e.listvm.getVisibleStartRow()+a),t.preventDefault()}),t.on("mousedown",function(e){return e.shiftKey?(e.preventDefault(),e.stopImmediatePropagation(),!1):void 0}),t.on("click","button.jl-tbl-filter",function(t){e._filterPanel||(e._filterPanel=new jslet.ui.DBTableFilterPanel(e));var l=t.currentTarget,i=jQuery(l);jslet.ui.PopupPanel.excludedElement=l;var a=i.offset(),r=i.outerHeight(),n=a.left,s=a.top+r;jslet.locale.isRtl&&(n+=i.outerWidth()),e._filterPanel.showPopup(n,s,0,r),t.preventDefault(),t.stopImmediatePropagation()}),t.on("click","td.jl-tbl-cell",function(t){if(e.readOnly){var l=t.currentTarget,i=l.jsletColCfg;if(i){if(i.isSeqCol)e._processRowSelection(t.ctrlKey,t.shiftKey,t.altKey);else{var a=i.colNum;if(0!==a&&!a)return;e._doBeforeSelect(t.ctrlKey,t.shiftKey,t.altKey),e.currColNum(a),e._processSelection(t.ctrlKey,t.shiftKey,t.altKey)}e._doCellClick(i)}return t.shiftKey||t.ctrlKey?(t.preventDefault(),t.stopImmediatePropagation(),!1):void 0}}),t.on("keydown",function(t){var l=t.which;if(t.ctrlKey&&70==l){if(!e._hasFindDialog)return;if(e._findDialog||(e._findDialog=new jslet.ui.FindDialog(e)),!e._findDialog.findingField()){var i=e.innerColumns[e._currColNum];i.field&&e._findDialog.findingField(i.field)}return e._findDialog.show(0,e.headSectionHt),t.preventDefault(),t.stopImmediatePropagation(),!1}if(t.ctrlKey&&67==l){var a=e._dataset.selection.getSelectionText();return void(a&&(jslet.Clipboard.putText(a),window.setTimeout(function(){e.el.focus()},5)))}if(t.ctrlKey&&65==l){for(var i,r,n=[],s=0,o=e.innerColumns.length;o>s;s++)i=e.innerColumns[s],r=i.field,r&&n.push(r);return e._dataset.selection.selectAll(n,!0),e._refreshSelection(),t.preventDefault(),t.stopImmediatePropagation(),!1}if(37===l){if(!e._readOnly)return;var d;if(0===e._currColNum)return;d=e._currColNum-1,e._doBeforeSelect(t.ctrlKey,t.shiftKey,t.altKey),e.currColNum(d),e._processSelection(t.ctrlKey,t.shiftKey,t.altKey),t.preventDefault(),t.stopImmediatePropagation()}else if(39===l){if(!e._readOnly)return;var u=e.innerColumns.length-1,d=0;if(!(e._currColNum<u))return;d=e._currColNum+1,e._doBeforeSelect(t.ctrlKey,t.shiftKey,t.altKey),e.currColNum(d),e._processSelection(t.ctrlKey,t.shiftKey,t.altKey),t.preventDefault(),t.stopImmediatePropagation()}else 38==l?(e._doBeforeSelect(t.ctrlKey,t.shiftKey,t.altKey),e.listvm.priorRow(),e._processSelection(t.ctrlKey,t.shiftKey,t.altKey),t.preventDefault(),t.stopImmediatePropagation()):40==l?(e._doBeforeSelect(t.ctrlKey,t.shiftKey,t.altKey),e.listvm.nextRow(),e._processSelection(t.ctrlKey,t.shiftKey,t.altKey),t.preventDefault(),t.stopImmediatePropagation()):33==l?(e.listvm.priorPage(),t.preventDefault(),t.stopImmediatePropagation()):34==l&&(e.listvm.nextPage(),t.preventDefault(),t.stopImmediatePropagation())})},_initializeVm:function(){var e=this;e.listvm=new jslet.ui.ListViewModel(e._dataset,e._treeField?!0:!1),e.listvm.onTopRownoChanged=function(t){0>t||(e._fillData(),e._syncScrollBar(t),e._showCurrentRow())},e.listvm.onVisibleCountChanged=function(){e.renderAll()},e.listvm.onCurrentRownoChanged=function(t,l){if(0!==e._dataset.recordCount()){e._dataset.recno(e.listvm.getCurrentRecno()),e._currRow&&(e._currRow.fixed&&jQuery(e._currRow.fixed).removeClass(jslet.ui.htmlclass.TABLECLASS.currentrow),jQuery(e._currRow.content).removeClass(jslet.ui.htmlclass.TABLECLASS.currentrow));
var i,a=e._getTrByRowno(l);if(a&&(i=a.fixed,i&&jQuery(i).addClass(jslet.ui.htmlclass.TABLECLASS.currentrow),i=a.content,jQuery(i).addClass(jslet.ui.htmlclass.TABLECLASS.currentrow),e._currRow=a,!e._readOnly)){var r=e._editingField;if(r){var n=e._dataset.getField(r);!n||n.disabled()||n.readOnly()||e._dataset.focusEditControl(r)}}}}},renderAll:function(){var e=this;e.el.innerHTML="",e.listvm.fixedRows=e._fixedRows,e._calcParams(),e.listvm.refreshModel(),e._createFrame(),e._fillData(),e._showCurrentRow(),e._oldHeight=jQuery(e.el).height(),e._updateSortFlag(!0)},_doBeforeSelect:function(e,t,l){},_getSelectionFields:function(e,t){if(e>t){var l=e;e=t,t=l}for(var i,a,r,n=[],s=0,o=this.innerColumns.length;o>s;s++)a=this.innerColumns[s],r=a.colNum,r>=e&&t>=r&&(i=a.field,i&&n.push(i));return n},_processSelection:function(e,t,l){var i,a=this,r=a._dataset.recno();if(e||!a._autoClearSelection)return i=a.innerColumns[a._currColNum].field,i&&(a._dataset.selection.isSelected(r,i)?a._dataset.selection.remove(r,r,[i],!0):a._dataset.selection.add(r,r,[i],!0),a._refreshSelection()),a._preRecno=r,void(a._preColNum=a._currColNum);if(t){var n;a._preTmpRecno>=0&&a._preTmpColNum>=0&&(n=a._getSelectionFields(a._preColNum||0,a._preTmpColNum),a._dataset.selection.remove(a._preRecno||0,a._preTmpRecno,n,!1)),n=a._getSelectionFields(a._preColNum||0,a._currColNum),a._dataset.selection.add(a._preRecno||0,r,n,!0),a._refreshSelection(),a._preTmpRecno=r,a._preTmpColNum=a._currColNum}else a._preRecno=r,a._preColNum=a._currColNum,a._preTmpRecno=r,a._preTmpColNum=a._currColNum,a._autoClearSelection&&(a._dataset.selection.removeAll(),a._refreshSelection())},_processColumnSelection:function(e,t,l,i){if(t||l){var a=this,r=a._dataset.recordCount();if(0!==r){var n,s;if(l)a._preTmpColNum>=0&&(n=a._getSelectionFields(a._preColNum||0,a._preTmpColNum),a._dataset.selection.remove(0,r,n,!0)),s=e.colNum+e.colSpan-1,n=a._getSelectionFields(a._preColNum||0,s),a._dataset.selection.add(0,r,n,!0),a._preTmpColNum=s;else{if(!t&&a._autoClearSelection&&a._dataset.selection.removeAll(),e.colSpan>1){n=[];for(var o,d=e.colNum,u=e.colNum+e.colSpan,s=d;u>s;s++)o=a.innerColumns[s].field,n.push(o)}else n=[e.field];a._dataset.selection.add(0,r,n,!0),a._preColNum=e.colNum}a._refreshSelection()}}},_processRowSelection:function(e,t,l){if(e||t){var i=this,a=i._getSelectionFields(0,i.innerColumns.length-1),r=i._dataset.recno();if(t){var a;i._preTmpRecno>=0&&i._dataset.selection.remove(i._preRecno||0,i._preTmpRecno,a,!0),i._dataset.selection.add(i._preRecno||0,r,a,!0),i._preTmpColNum=r}else!e&&i._autoClearSelection&&i._dataset.selection.removeAll(),i._dataset.selection.add(r,r,a,!0),i._preRecno=r;i._refreshSelection()}},_prepareColumn:function(){function e(e){if(l._columns)for(var i=0,a=l._columns.length;a>i;i++)if(t=l._columns[i],t.field&&t.field==e)return t;return null}var t,l=this;l._sysColumns=[],l._hasSeqCol&&(t={label:"&nbsp;",width:l.seqColWidth,disableHeadSort:!0,isSeqCol:!0,cellRender:jslet.ui.DBTable.sequenceCellRender,widthCssName:l._widthStyleId+"-s0"},l._sysColumns.push(t)),l._hasSelectCol&&(t={label:'<input type="checkbox" />',width:l.selectColWidth,disableHeadSort:!0,isSelectCol:!0,cellRender:jslet.ui.DBTable.selectCellRender,widthCssName:l._widthStyleId+"-s1"},l._sysColumns.push(t)),l.subgroup&&l.subgroup.hasExpander&&(t={label:"&nbsp;",width:l.selectColWidth,disableHeadSort:!0,isSubgroup:!0,cellRender:jslet.ui.DBTable.subgroupCellRender,widthCssName:l._widthStyleId+"-s2"},l._sysColumns.push(t));var i=[];if(l._columns)for(var a=0,r=l._columns.length;r>a;a++){if(t=l._columns[a],t.field){var n=l._dataset.getField(t.field);if(!n)throw new Error("Not found Field: "+t.field);t.displayOrder=n.displayOrder()}else t.disableHeadSort=!0;i.push(t)}if(!l._onlySpecifiedCol){for(var n,s,o=l._dataset.getFields(),a=0,d=o.length;d>a;a++)n=o[a],s=n.name(),n.visible()&&(t=e(s),t||(t=new jslet.ui.TableColumn,t.field=n.name(),t.displayOrder=n.displayOrder(),i.push(t)));if(l._columns)for(var a=0,r=l._columns.length;r>a;a++)if(t=l._columns[a],t.field){if(n=l._dataset.getTopField(t.field),!n)throw new Error("Field: "+t.field+" doesn't exist!");var u=n.children();if(u&&u.length>0){s=n.name();var c=!0;if(t.field!=s)for(var h=0;h<i.length;h++)if(i[h].field==s){c=!1;break}c&&(t=new jslet.ui.TableColumn,t.field=s,t.displayOrder=n.displayOrder(),i.push(t))}}}i.sort(function(e,t){var l=e.displayOrder||0,i=t.displayOrder||0;return l===i?0:i>l?-1:1}),l.innerHeads=[],l.innerColumns=[];for(var f,s,v,p={lastColNum:0,depth:0},a=0,r=i.length;r>a;a++)t=i[a],s=t.field,s?(n=l._dataset.getField(s),l._convertField2Head(p,n)):(f=new jslet.ui.TableHead,v=t.label,f.label=v?v:"",f.level=0,f.colNum=p.lastColNum++,t.colNum=f.colNum,f.id=jslet.nextId(),f.widthCssName=l._widthStyleId+"-"+f.colNum,t.widthCssName=f.widthCssName,f.disableHeadSort=t.disableHeadSort,l.innerHeads.push(f),l.innerColumns.push(t));l.maxHeadRows=p.depth+1,l._calcHeadSpan();for(var r=0,_=0,g=l._fixedCols-l._sysColumns.length,a=1,m=l.innerHeads.length;m>a&&(f=l.innerHeads[a],r+=f.colSpan,!(_>=g||g==r));a++)r>g&&g>_&&(l._fixedCols=_+l._sysColumns.length),_=r},_calcHeadSpan:function(e){var t=this;e||(e=t.innerHeads);for(var l,i=0,a=0,r=e.length;r>a;a++)l=e[a],l.rowSpan=t.maxHeadRows-l.level,l.subHeads?(l.colSpan=t._calcHeadSpan(l.subHeads),i+=l.colSpan):(l.colSpan=1,i++);return i},_convertField2Head:function(e,t,l){var i=this;if(!t.visible())return!1;var a=0;l?(a=l.level+1,heads=l.subHeads):heads=i.innerHeads;var r,n=t.name();r=new jslet.ui.TableHead,r.label=t.label(),r.field=n,r.level=a,r.colNum=e.lastColNum,r.id=jslet.nextId(),heads.push(r),e.depth=Math.max(a,e.depth);var s=t.children();if(s&&s.length>0){r.subHeads=[];for(var o=0,d=s.length;d>o;o++)i._convertField2Head(e,s[o],r)}else{e.lastColNum++;for(var u,c=!1,h=i._columns?i._columns.length:0,o=0;h>o;o++)if(u=i._columns[o],u.field==n){c=!0;break}c||(u=new jslet.ui.TableColumn,u.field=n),u.label||(u.label=t.label()),u.mergeSame=t.mergeSame(),u.colNum=r.colNum,u.width||(maxWidth=t?t.displayWidth():0,!i._hideHead&&u.label&&(maxWidth=Math.max(maxWidth,u.label.length)),u.width=maxWidth?maxWidth*i.charWidth:10),u.cellRender||(t.getType()==jslet.data.DataType.BOOLEAN?i._isCellEditable(u)||(u.cellRender=jslet.ui.DBTable.boolCellRender):u.field==i._treeField&&(u.cellRender=jslet.ui.DBTable.treeCellRender)),r.widthCssName=i._widthStyleId+"-"+r.colNum,u.widthCssName=r.widthCssName,i.innerColumns.push(u)}return!0},_calcParams:function(){var e=this;if(e._currColNum=0,e._preTmpColNum=-1,e._preTmpRecno=-1,e._preRecno=-1,e._preColNum=-1,e._treeField&&(e._disableHeadSort=!0),e._hasSeqCol){e.seqColWidth=(""+e._dataset.recordCount()).length*e.charWidth+5;var t=jslet.ui.htmlclass.TABLECLASS.selectColWidth;e.seqColWidth=e.seqColWidth>t?e.seqColWidth:t}else e.seqColWidth=0;if(e._hasSelectCol?e.selectColWidth=jslet.ui.htmlclass.TABLECLASS.selectColWidth:e.selectColWidth=0,e._fixedRows>0?e.fixedSectionHt=e._fixedRows*e._rowHeight:e.fixedSectionHt=0,e.aggraded()&&e.dataset().checkAggraded()?e.footSectionHt=e._rowHeight:e.footSectionHt=0,e._prepareColumn(),e._fixedCols&&e._fixedCols>e.innerColumns.length&&(e._fixedCols=e.innerColumns.length),e.hasFixedCol=e._sysColumns.length>0||e._fixedCols>0,e.hasFixedCol){for(var l=0,i=0,a=e._sysColumns.length;a>i;i++)l+=e._sysColumns[i].width;for(var i=0;i<e._fixedCols;i++)l+=e.innerColumns[i].width;e.fixedColWidth=l+4}else e.fixedColWidth=0},_setScrollBarMaxValue:function(e){var t=this,l=e+t._repairHeight;t.jqVScrollBar.find("div").height(l),t.contentSectionHt+t.footSectionHt>=l?t.jqVScrollBar.parent().addClass("jl-scrollbar-hidden"):t.jqVScrollBar.parent().removeClass("jl-scrollbar-hidden")},_changeColWidthCssRule:function(e,t){var l=this,i=document.getElementById(l._widthStyleId),a=i.styleSheet||i.sheet,r=a.cssRules||a.rules,n=null,s=!1;e="."+e;for(var o=0,d=r.length;d>o;o++)if(n=r[o],n.selectorText==e){s=!0;break}return s&&(n.style.width=t+"px"),s},_changeColWidth:function(e,t){var l=this,i=l.innerColumns[e];if(!(i.width+t<=0)){if(i.width+=t,i.field){l._dataset.designMode(!0);try{l._dataset.getField(i.field).displayWidth(Math.round(i.width/l.charWidth))}finally{l._dataset.designMode(!1)}}l._changeColWidthCssRule(i.widthCssName,i.width)&&l._changeContentWidth(t)}},_refreshSeqColWidth:function(){var e=this;if(e._hasSeqCol){var t=e.seqColWidth;e.seqColWidth=(""+e._dataset.recordCount()).length*e.charWidth;var l=jslet.ui.htmlclass.TABLECLASS.selectColWidth;if(e.seqColWidth=e.seqColWidth>l?e.seqColWidth:l,e.seqColWidth!=t){for(var i,a=0,r=e._sysColumns.length;r>a&&(i=e._sysColumns[a],!i.isSeqCol);a++);i.width=e.seqColWidth,e._changeColWidthCssRule(i.widthCssName,e.seqColWidth);var n=e.seqColWidth-t;e._changeContentWidth(n,!0)}}},_changeContentWidth:function(e,t){var l=this,i=l.getTotalWidth(t),a=i+"px";t?(l.fixedColWidth=i,l.leftHeadTbl.parentNode.parentNode.style.width=l.fixedColWidth+1+"px",l.leftHeadTbl.parentNode.style.width=a,l.leftFixedTbl.parentNode.style.width=a,l.leftContentTbl.parentNode.style.width=a):(l.rightHeadTbl.parentNode.style.width=a,l.rightFixedTbl.parentNode.style.width=a,l.rightContentTbl.parentNode.style.width=a,l.footSectionHt&&(l.rightFootTbl.style.width=a)),l._checkHoriOverflow()},_createFrame:function(){function e(){for(var e,t=['<style type="text/css" id="'+l._widthStyleId+'">\n'],i=0,a=l._sysColumns.length;a>i;i++)e=l._sysColumns[i],t.push("."+e.widthCssName+"{width:"+e.width+"px}\n");for(var i=0,a=l.innerColumns.length;a>i;i++)e=l.innerColumns[i],t.push("."+e.widthCssName+"{width:"+e.width+"px}\n");return t.push("</style>"),t.join("")}function t(e){var t=e.jsletColCfg,i=dragTransfer.rowIndex,a=dragTransfer.cellIndex,r=e.parentNode.rowIndex,n=e.cellIndex,s=i==r&&n!=a;if(!s)return s;var o=dragTransfer.fieldName,d=t.field,u=l._dataset.getField(o).parent(),c=l._dataset.getField(d).parent();return s=u===c||c&&u.name()==c.name()}var l=this;l.el.style.position="relative";var i=jQuery(l.el);i.hasClass("jl-table")||i.addClass("jl-table jl-border-box jl-round5"),l._noborder&&i.addClass("jl-tbl-noborder");var a=['<div class="jl-tbl-splitter" style="display: none"></div>',e(),'<div class="jl-tbl-norecord">',jslet.locale.DBTable.norecord,"</div>",'<table class="jl-tbl-container"><tr>','<td><div class="jl-tbl-fixedcol"><table class="jl-tbl-data"><tbody /></table><table class="jl-tbl-data"><tbody /></table><div class="jl-tbl-content-div"><table class="jl-tbl-data"><tbody /></table></div><table><tbody /></table></div></td>','<td><div class="jl-tbl-contentcol"><div><table class="jl-tbl-data jl-tbl-content-table" border="0" cellpadding="0" cellspacing="0"><tbody /></table></div><div><table class="jl-tbl-data jl-tbl-content-table"><tbody /></table></div><div class="jl-tbl-content-div"><table class="jl-tbl-data jl-tbl-content-table"><tbody /></table></div><table class="jl-tbl-content-table jl-tbl-footer"><tbody /></table></div></td>','<td class="jl-scrollbar-col"><div class="jl-tbl-vscroll-head"></div><div class="jl-tbl-vscroll"><div /></div></td></tr></table>'];i.html(a.join(""));var r=i.find(".jl-tbl-fixedcol")[0].childNodes;l.leftHeadTbl=r[0],l.leftFixedTbl=r[1],l.leftContentTbl=r[2].firstChild,l.leftFootTbl=r[3],r=i.find(".jl-tbl-contentcol")[0].childNodes,l.rightHeadTbl=r[0].firstChild,l.rightFixedTbl=r[1].firstChild,l.rightContentTbl=r[2].firstChild,l.rightFootTbl=r[3],l.height=i.height(),l._hideHead&&(l.leftHeadTbl.style.display="none",l.rightHeadTbl.style.display="none",i.find(".jl-tbl-vscroll-head").css("display","none")),l._fixedRows<=0&&(l.leftFixedTbl.style.display="none",l.rightFixedTbl.style.display="none"),l.footSectionHt||(l.leftFootTbl.style.display="none",l.rightFootTbl.style.display="none"),l.leftHeadTbl.parentNode.parentNode.style.width=l.fixedColWidth+"px";var n=jQuery(l.rightHeadTbl);n.off();n.on("mousedown",l._doSplitHookDown),n.on("mouseup",l._doSplitHookUp);jQuery(l.leftHeadTbl).on("mousedown",".jl-tbl-header-cell",function(e){e=jQuery.event.fix(e||window.event);var t=e.target;if("jl-tbl-splitter-hook"!=t.className){var i=this.jsletColCfg;i.field&&l._processColumnSelection(i,e.ctrlKey,e.shiftKey,e.altKey)}}),n.on("mousedown",".jl-tbl-header-cell",function(e){e=jQuery.event.fix(e||window.event);var t=e.target;if("jl-tbl-splitter-hook"!=t.className){var i=this.jsletColCfg;i.field&&l._processColumnSelection(i,e.ctrlKey,e.shiftKey,e.altKey)}}),jQuery(l.leftHeadTbl).on("mouseup",".jl-focusable-item",function(e){e=jQuery.event.fix(e||window.event);e.target;if(!l.isDraggingColumn)return l._doHeadClick(this.parentNode.parentNode.parentNode.jsletColCfg,e.ctrlKey),l._head_label_cliecked=!0,e.stopImmediatePropagation(),e.preventDefault(),!1}),n.on("mouseup",".jl-focusable-item",function(e){e=jQuery.event.fix(e||window.event);e.target;if(!l.isDraggingColumn)return l._doHeadClick(this.parentNode.parentNode.parentNode.jsletColCfg,e.ctrlKey),l._head_label_cliecked=!0,e.stopImmediatePropagation(),e.preventDefault(),!1}),dragTransfer=null,n.on("dragstart",".jl-focusable-item",function(e){var t=this.parentNode.parentNode.parentNode,l=t.jsletColCfg,i=e.originalEvent,a=i.dataTransfer;return a.dropEffect="link",a.effectAllowed="link",dragTransfer={fieldName:l.field,rowIndex:t.parentNode.rowIndex,cellIndex:t.cellIndex},a.setData("fieldName",l.field),!0}),n.on("dragover",".jl-tbl-header-cell .jl-tbl-header-div",function(e){if(!dragTransfer)return!1;var l=this.parentNode,i=e.originalEvent,a=i.dataTransfer;return t(l)?(jQuery(e.currentTarget).addClass("jl-tbl-col-over"),a.dropEffect="link"):a.dropEffect="move",!1}),n.on("dragenter",".jl-tbl-header-cell .jl-tbl-header-div",function(e){if(!dragTransfer)return!1;var l=this.parentNode,i=e.originalEvent,a=i.dataTransfer;return t(l)?(jQuery(e.currentTarget).addClass("jl-tbl-col-over"),a.dropEffect="link"):a.dropEffect="move",!1}),n.on("dragleave",".jl-tbl-header-cell .jl-tbl-header-div",function(e){return dragTransfer?(jQuery(e.currentTarget).removeClass("jl-tbl-col-over"),!1):!1}),n.on("drop",".jl-tbl-header-cell .jl-tbl-header-div",function(e){if(!dragTransfer)return!1;jQuery(e.currentTarget).removeClass("jl-tbl-col-over");var i=this.parentNode,a=e.originalEvent,r=(a.dataTransfer,i.jsletColCfg,dragTransfer.rowIndex),n=dragTransfer.cellIndex,s=(i.parentNode.rowIndex,i.cellIndex);if(t(i)){var o=this.parentNode.jsletColCfg.field;if(o){dragTransfer.fieldName;return l._moveColumn(r,n,s),!1}}});var s=jQuery(l.leftFixedTbl),o=jQuery(l.rightFixedTbl),d=jQuery(l.leftContentTbl),u=jQuery(l.rightContentTbl);s.off(),s.on("mouseenter","tr",function(){jQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow),jQuery(o[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),s.on("mouseleave","tr",function(){jQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow),jQuery(o[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),o.off(),o.on("mouseenter","tr",function(){jQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow),jQuery(s[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),o.on("mouseleave","tr",function(){jQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow),jQuery(s[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),d.off(),d.on("mouseenter","tr",function(){jQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow),jQuery(u[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),d.on("mouseleave","tr",function(){jQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow),jQuery(u[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),u.off(),u.on("mouseenter","tr",function(){jQuery(this).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);var e=l._fixedRows>0||l._sysColumns.length>0;e&&jQuery(d[0].rows[this.rowIndex]).addClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),u.on("mouseleave","tr",function(){jQuery(this).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow);var e=l._fixedRows>0||l._sysColumns.length>0;e&&jQuery(d[0].rows[this.rowIndex]).removeClass(jslet.ui.htmlclass.TABLECLASS.hoverrow)}),l.jqVScrollBar=i.find(".jl-tbl-vscroll"),l.noRecordDiv=i.find(".jl-tbl-norecord")[0],l.jqVScrollBar.width(jslet.scrollbarSize()+1),l.jqVScrollBar.on("scroll",function(){if(!l._keep_silence_){l._readOnly||l._dataset.status()==jslet.data.DataSetStatus.BROWSE||l._dataset.confirm();var e=Math.round(this.scrollTop/l._rowHeight);if(e!=l.listvm.getVisibleStartRow()){l._keep_silence_=!0;try{l.listvm.setVisibleStartRow(e),l._showCurrentRow()}finally{l._keep_silence_=!1}}}}),i.find(".jl-tbl-contentcol").on("scroll",function(){l._isCurrCellInView()&&l._showCurrentCell()});var c=i.find(".jl-tbl-splitter")[0];c._doDragStart=function(){this.style.display="block"},c._doDragging=function(e,t,l,i,a,r){var n=parseInt(jQuery(document.body).css("margin-left")),s=c.parentNode.jslet,o=s.innerColumns[s.currColId];o.width+a<=40||(c.style.left=l-jQuery(c.parentNode).offset().left-n+"px")},c._doDragEnd=function(e,t,l,i,a,r){var n=c.parentNode.jslet;n._changeColWidth(n.currColId,a),c.style.display="none",c.parentNode.jslet.isDraggingColumn=!1},c._doDragCancel=function(){c.style.display="none",c.parentNode.jslet.isDraggingColumn=!1},l.footSectionHt&&(l.leftFootTbl.style.display="",l.rightFootTbl.style.display=""),l._renderHeader(),l._hideHead?l.headSectionHt=0:l.headSectionHt=l.maxHeadRows*l._headRowHeight,l._changeContentWidth(0),l.noRecordDiv.style.top=l.headSectionHt+"px",l.noRecordDiv.style.left=i.find(".jl-tbl-fixedcol").width()+5+"px",i.find(".jl-tbl-vscroll-head").height(l.headSectionHt+l.fixedSectionHt),l._renderBody()},_moveColumn:function(e,t,l){function i(e,t,l,i,a){for(var r,n=0,s=[],o=[],d=0,u=e.length;u>d;d++){if(r=e[d],n>=t&&l>=n)s.push(r);else if(n>=i&&a>=n)o.push(r);else if(n>l&&n>a)break;n+=r.colSpan||1}if(t>i)for(var c=o[0],d=0,u=s.length;u>d;d++)jQuery(s[d]).insertBefore(c);else for(var c=o[o.length-1],d=s.length;d>=0;d--)jQuery(s[d]).insertAfter(c)}function a(e,t,l,a,r,n){var s=e.length;if(0!==s&&s!==t)for(var o,d=(e[t].cells[l].jsletColCfg,t),u=e.length;u>d;d++)o=e[d],i(o.cells,l,a,r,n)}for(var r,n=this,s=n.rightHeadTbl.createTHead().rows,o=s[e],d=0,u=0,c=0,h=0,f=0,v=0,p=0,_=o.cells.length;_>p;p++)r=o.cells[p],f=v,v+=r.colSpan||1,p===t&&(d=f,u=v-1),p===l&&(c=f,h=v-1);var g=o.cells[t],m=o.cells[l],j=g.jsletColCfg,C=m.jsletColCfg,y=j.field,b=C.field;if(y&&b){n._dataset.designMode(!0);try{n._dataset.moveField(y,b)}finally{n._dataset.designMode(!1)}}var x=n.rightHeadTbl.createTHead().rows;n._changeColNum(x[x.length-1],d,u,c,h);var F=n.rightContentTbl.tBodies[0].rows;n._changeColNum(F[0],d,u,c,h),n._currColNum=0,a(x,e,d,u,c,h),a(n.rightFixedTbl.tBodies[0].rows,0,d,u,c,h),a(F,0,d,u,c,h),a(n.rightFootTbl.tBodies[0].rows,0,d,u,c,h),n._dataset.selection.removeAll(),n._refreshSelection()},_changeColNum:function(e,t,l,i,a){if(e){for(var r,n=0,s=[],o=[],d=e.cells,u=0,c=d.length;c>u;u++){if(r=d[u],n>=t&&l>=n)s.push(r);else if(n>=i&&a>=n)o.push(r);else if(n>l&&n>a)break;n+=r.colSpan||1}var h,f=s.length,v=o.length,p=o[0].jsletColCfg.colNum,_=0;if(t>i){for(var u=t;l>=u;u++)h=d[u].jsletColCfg,h.colNum=p+_++;for(var u=i;t>u;u++)h=d[u].jsletColCfg,h.colNum=h.colNum+f}else{for(var g=p-f+v,u=t;l>=u;u++)h=d[u].jsletColCfg,h.colNum=g+_++;for(var u=l+1;a>=u;u++)h=d[u].jsletColCfg,h.colNum=h.colNum-f}}},_calcAndSetContentHeight:function(){var e=this,t=jQuery(e.el);e.contentSectionHt=e.height-e.headSectionHt-e.fixedSectionHt-e.footSectionHt,e._isHoriOverflow&&(e.contentSectionHt-=jslet.ui.htmlclass.TABLECLASS.scrollBarWidth),e.listvm.setVisibleCount(Math.floor(e.contentSectionHt/e._rowHeight),!0),e._repairHeight=e.contentSectionHt-e.listvm.getVisibleCount()*e._rowHeight,t.find(".jl-tbl-contentcol").height(e.height),t.find(".jl-tbl-content-div").height(e.contentSectionHt),e.jqVScrollBar.height(e.contentSectionHt+e.footSectionHt),e._setScrollBarMaxValue(e.listvm.getNeedShowRowCount()*e._rowHeight)},_checkHoriOverflow:function(){var e=this,t=e.getTotalWidth();e._hideHead?e._isHoriOverflow=t>jQuery(e.rightContentTbl.parentNode.parentNode).innerWidth():e._isHoriOverflow=t>e.rightHeadTbl.parentNode.parentNode.clientWidth,e._calcAndSetContentHeight()},_refreshHeadCell:function(e){var t,l=this,i=jQuery(l.el),a=null;if(i.find(".jl-tbl-header-cell").each(function(l,i){return t=this.jsletColCfg,t&&t.field==e?(a=this,!1):void 0}),a){var r=l._dataset.getField(t.field);t.label=r.label();var n=a.childNodes[0],s=t.cellRender||l._defaultCellRender;if(s&&s.createHeader)n.html(""),s.createHeader.call(l,n,t);else{var o=t.label||"&nbsp;";t.field&&l._isCellEditable(t)&&r&&r.required()&&(o='<span class="jl-lbl-required">*</span>'+o),jQuery(a).find(".jl-focusable-item").html(o)}}},_createHeadCell:function(e,t){var l=this,i=0,a=0;t.subHeads?a=t.colSpan:i=l.maxHeadRows-(t.level?t.level:0);var r=document.createElement("th");r.className="jl-tbl-header-cell jl-unselectable",r.noWrap=!0,r.jsletColCfg=t,i&&i>1&&(r.rowSpan=i),a&&a>1&&(r.colSpan=a),r.innerHTML='<div style="position: relative" unselectable="on" class="jl-unselectable jl-tbl-header-div jl-border-box '+(t.widthCssName||"")+'">';var n=r.childNodes[0],s=t.cellRender||l._defaultCellRender;if(s&&s.createHeader)s.createHeader.call(l,n,t);else{var o=t.label||"&nbsp;";if(t.field&&l._isCellEditable(t)){var d=l._dataset.getField(t.field);d&&d.required()&&(o='<span class="jl-lbl-required">*</span>'+o)}n.innerHTML=[l._hasFilterDialog?'<button class="jl-tbl-filter"><i class="fa fa-filter"></i></button>':"",'<span id="',t.id,'" unselectable="on" style="width:100%;padding:0px 2px">',l._disableHeadSort||t.disableHeadSort?o:'<span class="jl-focusable-item" draggable="true">'+o+"</span>",'</span><span unselectable="on" class="jl-tbl-sorter" title="',jslet.locale.DBTable.sorttitle,'">&nbsp;</span><div  unselectable="on" class="jl-tbl-splitter-hook" colid="',t.colNum,'">&nbsp;</div>'].join("")}e.appendChild(r)},_renderHeader:function(){function e(l){for(var i,n,s=0,o=l.length;o>s;s++)i=l[s],n=i.colNum<t._fixedCols?a.rows[i.level]:r.rows[i.level],t._createHeadCell(n,i),i.subHeads&&e(i.subHeads)}var t=this;if(!t._hideHead){for(var l,i,a=t.leftHeadTbl.createTHead(),r=t.rightHeadTbl.createTHead(),n=0;n<t.maxHeadRows;n++)a.insertRow(-1),r.insertRow(-1);l=a.rows[0];for(var n=0,s=t._sysColumns.length;s>n;n++)i=t._sysColumns[n],i.rowSpan=t.maxHeadRows,t._createHeadCell(l,i);e(t.innerHeads);for(var o,d,u=t._headRowHeight,n=0;n<=t.maxHeadRows;n++)o=jQuery(a.rows[n]),d=jQuery(r.rows[n]),o.height(u),d.height(u);t.sortedCell=null,t.indexField=null}},getTotalWidth:function(e){var t=this,l=0;if(e){for(var i=0,a=t._sysColumns.length;a>i;i++)l+=t._sysColumns[i].width;for(var i=0,a=t._fixedCols;a>i;i++)l+=t.innerColumns[i].width}else for(var i=t._fixedCols,a=t.innerColumns.length;a>i;i++)l+=t.innerColumns[i].width;return l},_doSplitHookDown:function(e){e=jQuery.event.fix(e||window.event);var t=e.target;if("jl-tbl-splitter-hook"==t.className){var l=jslet.ui.findFirstParent(t,function(e){return"div"==e.tagName.toLowerCase()&&e.jslet&&e.jslet._dataset}),i=jQuery(l),a=jQuery(document.body),r=parseInt(a.css("margin-top")),n=parseInt(a.css("margin-left")),s=(i.position().top-r,jQuery(t)),o=i.height()-20,d=s.offset().left-i.offset().left-n,u=i.find(".jl-tbl-splitter")[0];u.style.left=d+"px",u.style.top="1px",u.style.height=o+"px",jslet.ui.dnd.bindControl(u),l.jslet.currColId=parseInt(s.attr("colid")),l.jslet.isDraggingColumn=!0}},_doSplitHookUp:function(e){e=jQuery.event.fix(e||window.event);var t=e.target.lastChild;if(t&&"jl-tbl-splitter-hook"==t.className){var l=jslet.ui.findFirstParent(t,function(e){return"div"==e.tagName.toLowerCase()&&e.jslet&&e.jslet._dataset}),i=jQuery(l),a=jQuery(document.body);a.css("cursor","auto");var r=i.find(".jl-tbl-splitter")[0];"none"!=r.style.display&&(r.style.display="none"),l.jslet.isDraggingColumn=!1}},_getColumnByField:function(e){var t=this;if(!t.innerColumns)return null;for(var l,i=0,a=t.innerColumns.length;a>i;i++)if(l=t.innerColumns[i],l.field==e)return l;return null},_doHeadClick:function(e,t){var l=this;l._disableHeadSort||e.disableHeadSort||l.isDraggingColumn||l._doSort(e.field,t)},_doSort:function(e,t){var l=this;l._dataset.confirm(),l._dataset.disableControls();try{l._onCustomSort?l._onCustomSort.call(l,e):l._dataset.toggleIndexField(e,!t),l.listvm.refreshModel()}finally{l._dataset.enableControls()}},_updateSortFlag:function(){var e=this;if(!e._hideHead){for(var t,l=e._dataset.mergedIndexFields(),i=e.leftHeadTbl.createTHead(),a=e.rightHeadTbl.createTHead(),r=i.rows[0].cells,n=a.rows[0].cells,s=[],o=0,d=r.length;d>o;o++)t=r[o],t.jsletColCfg&&(s[s.length]=t);for(var o=0,d=n.length;d>o;o++)t=n[o],t.jsletColCfg&&(s[s.length]=t);for(var u,c=l.length,h=s.length,o=0;h>o;o++)t=s[o],u=jQuery(t).find(".jl-tbl-sorter")[0],u&&(u.innerHTML="&nbsp;");for(var f,v,p,_=1,o=0;c>o;o++){p=l[o];for(var g=0;h>g;g++)if(t=s[g],f=t.jsletColCfg.field,f&&(u=jQuery(t).find(".jl-tbl-sorter")[0],v="&nbsp;",f==p.fieldName)){v=1===p.order?jslet.ui.htmlclass.TABLECLASS.sortAscChar:jslet.ui.htmlclass.TABLECLASS.sortDescChar,c>1&&(v+=_++);break}u.innerHTML=v}}},_doSelectBoxClick:function(e){var t=null;e?(e=jQuery.event.fix(e||window.event),t=e.target):t=this;var l=jslet.ui.getParentElement(t,2);try{jQuery(l).click()}finally{var i=jslet.ui.findFirstParent(l,function(e){return e.jslet?!0:!1}),a=i.jslet;if(a._onSelect){var r=a._onSelect.call(a,t.checked);if(void 0!==r&&!r)return void(t.checked=!t.checked)}a._dataset.select(t.checked?1:0,a._selectBy)}},_doCellClick:function(){var e=this;if(e._onCellClick){var t=e._currColNum;e._onCellClick.call(e,e.innerColumns[t])}},_doRowDblClick:function(e){var t=jslet.ui.findFirstParent(this,function(e){return e.jslet?!0:!1}),l=t.jslet;l._onRowDblClick&&l._onRowDblClick.call(l,e)},_doRowClick:function(e){var t=jslet.ui.findFirstParent(this,function(e){return e.jslet?!0:!1}),l=t.jslet,i=l.dataset();i.status()&&this.jsletrecno!==i.recno()&&i.confirm();var a=l.listvm.recnoToRowno(this.jsletrecno);l.listvm.setCurrentRowno(a),l._dataset.recno(l.listvm.getCurrentRecno()),l._onRowClick&&l._onRowClick.call(l,e)},_renderCell:function(e,t,l){var i=this,a=document.createElement("td");a.noWrap=!0,a.jsletColCfg=t,jQuery(a).addClass("jl-tbl-cell"),a.innerHTML='<div class="jl-tbl-cell-div '+(t.widthCssName||"")+'"></div>';var r=a.firstChild,n=t.cellRender||i._defaultCellRender;n&&n.createCell?n.createCell.call(i,r,t):i._isCellEditable(t)?(jslet.ui.DBTable.editableCellRender.createCell.call(i,r,t),t.editable=!0):(jslet.ui.DBTable.defaultCellRender.createCell.call(i,r,t),t.editable=!1),e.appendChild(a)},_renderRow:function(e,t){var l,i=this,a=0,r=null,n=i._fixedCols>0||i._sysColumns.length>0;switch(e){case 1:a=i._fixedRows,n&&(r=i.leftFixedTbl.tBodies[0]),l=i.rightFixedTbl.tBodies[0];break;case 2:a=i.listvm.getVisibleCount(),n&&(r=i.leftContentTbl.tBodies[0]),l=i.rightContentTbl.tBodies[0]}var s,o,d,u=0,c=i.innerColumns.length;t&&(u=l.rows.length);for(var h=u;a>h;h++){if(n){s=r.insertRow(-1),s.style.height=i._rowHeight+"px",s.ondblclick=i._doRowDblClick,s.onclick=i._doRowClick;for(var f=i._sysColumns.length,v=0;f>v;v++)o=i._sysColumns[v],i._renderCell(s,o,0===v);d=0===f;for(var v=0;v<i._fixedCols;v++)o=i.innerColumns[v],i._renderCell(s,o,d&&0===v)}d=!n,s=l.insertRow(-1),s.style.height=i._rowHeight+"px",s.ondblclick=i._doRowDblClick,s.onclick=i._doRowClick;for(var v=i._fixedCols;c>v;v++)o=i.innerColumns[v],i._renderCell(s,o,v==i._fixedCols)}},_renderBody:function(e){var t=this;e?t._renderRow(2,!0):(t._renderRow(1),t._renderRow(2),t._renderTotalSection())},_renderTotalSection:function(){function e(e){var t=document.createElement("td");return t.noWrap=!0,t.innerHTML='<div class="jl-tbl-footer-div '+(e.widthCssName||"")+'"></div>',t.jsletColCfg=e,t}var t=this;if(t.footSectionHt){var l,i,a,r,n=t._fixedCols>0||t._sysColumns.length>0;if(n&&(l=t.leftFootTbl.tBodies[0]),i=t.rightFootTbl.tBodies[0],n){a=l.insertRow(-1),a.style.height=t._rowHeight+"px";for(var s=0,o=t._sysColumns.length;o>s;s++)r=t._sysColumns[s],a.appendChild(e(r));for(var s=0;s<t._fixedCols;s++)r=t.innerColumns[s],a.appendChild(e(r))}a=i.insertRow(-1),a.style.height=t._rowHeight+"px";for(var s=t._fixedCols,o=t.innerColumns.length;o>s;s++)r=t.innerColumns[s],a.appendChild(e(r))}},_fillTotalSection:function(){var e=this,t=e._dataset.aggradedValues();if(e.footSectionHt&&t){var l,i,a=e._sysColumns.length,r=e._fixedCols>0||a>0;r&&(l=e.leftFootTbl.tBodies[0].rows[0]),i=e.rightFootTbl.tBodies[0].rows[0];var n,s,o,d,u,c,h=!1,f=!0;a>0&&(n=l.cells[a-1],n.innerHTML=jslet.locale.DBTable.totalLabel,f=!1);for(var v=0,p=e.innerColumns.length;p>v;v++)if(o=e.innerColumns[v],n=v<e._fixedCols?l.cells[v+a]:i.cells[v-e._fixedCols],n.style.textAlign="right",d=o.field,c=t[d]){f=!1,s=e._dataset.getField(d),u=s.getType()===jslet.data.DataType.NUMBER?c.sum:c.count;var _=u?jslet.formatNumber(u,s.displayFormat()):"";n.firstChild.innerHTML=_,n.firstChild.title=_}else if(f){var g;h?g="&nbsp;":(g=jslet.locale.DBTable.totalLabel,h=!0),n.firstChild.innerHTML=g}}},_fillData:function(){var e=this,t=(e._dataset.recno(),e.listvm.getNeedShowRowCount()),l=t*e._rowHeight+e.footSectionHt;e._setScrollBarMaxValue(l),e.noRecordDiv.style.display=0===t?"block":"none";var i=e._dataset.recnoSilence();try{e._fillRow(!0),e._fillRow(!1),e.footSectionHt&&e._fillTotalSection()}finally{e._dataset.recnoSilence(i)}e._refreshSeqColWidth()},_fillRow:function(e){var t,l=this,i=0,a=0,r=null,n=l._fixedCols>0||l._sysColumns.length>0;if(e){if(i=l._fixedRows,a=-1*l._fixedRows,0===i)return;n&&(r=l.leftFixedTbl.tBodies[0]),t=l.rightFixedTbl.tBodies[0]}else i=l.listvm.getVisibleCount(),a=l.listvm.getVisibleStartRow(),n&&(r=l.leftContentTbl.tBodies[0]),t=l.rightContentTbl.tBodies[0];for(var s,o,d,u,c=-1,h=(l.innerColumns.length,l.listvm.getNeedShowRowCount()-l.listvm.getVisibleStartRow()),f=n?r.rows:null,v=t.rows,p={},_=!0,g=Math.min(v.length,i),m=0;g>m;m++)if(m>=h)n&&(s=f[m],s.style.display="none"),s=v[m],s.style.display="none";else{if(l.listvm.setCurrentRowno(m+a,!0),c=l.listvm.getCurrentRecno(),l._dataset.recnoSilence(c),n){s=f[m],s.jsletrecno=c,s.style.display="",l._onFillRow&&l._onFillRow.call(l,s,l._dataset),o=s.childNodes,d=o.length;for(var j=0;d>j;j++)u=o[j],l._fillCell(c,u,p,_)}s=v[m],s.jsletrecno=c,s.style.display="",l._onFillRow&&l._onFillRow.call(l,s,l._dataset),s=v[m],o=s.childNodes,d=o.length;for(var j=0;d>j;j++)u=o[j],l._fillCell(c,u,p,_);_=0}},_fillCell:function(e,t,l,i){var a=this,r=t.jsletColCfg;if(r){var n=r.field,s=t.firstChild;if(a._onFillCell&&a._onFillCell.call(a,s,a._dataset,n),n&&r.mergeSame&&l)if(i||!a._dataset.isSameAsPrevious(n))l[n]={cell:t,count:1},jQuery(t).attr("rowspan",1),t.style.display="";else{var o=l[n];o.count++,t.style.display="none",jQuery(o.cell).attr("rowspan",o.count)}var d=r.cellRender||a._defaultCellRender;d&&d.refreshCell?d.refreshCell.call(a,s,r,e):r.editable?jslet.ui.DBTable.editableCellRender.refreshCell.call(a,s,r,e):jslet.ui.DBTable.defaultCellRender.refreshCell.call(a,s,r,e)}},refreshCurrentRow:function(){var e,t,l=this,i=l._fixedCols>0||l._hasSeqCol||l._hasSelectCol,a=null,r=l._dataset.recno();r<l._fixedRows?(i&&(a=l.leftFixedTbl.tBodies[0]),e=l.rightFixedTbl.tBodies[0],t=r):(i&&(a=l.leftContentTbl.tBodies[0]),e=l.rightContentTbl.tBodies[0],t=l.listvm.recnoToRowno(l._dataset.recno())-l.listvm.getVisibleStartRow());var n,s,o,d,u;if(i){if(n=a.rows[t],!n)return;s=n.childNodes,d=n.jsletrecno,l._onFillRow&&l._onFillRow.call(l,n,l._dataset);for(var c=0,h=s.length;h>c;c++)o=s[c],u=o.jsletColCfg,u&&u.isSeqCol?(o.firstChild.innerHTML=r+1,l._dataset.existRecordError(r)?jQuery(o).addClass("has-error"):jQuery(o).removeClass("has-error")):u&&u.isSelectCol?(ocheck=o.firstChild,ocheck.checked=l._dataset.selected()):l._fillCell(d,o)}if(n=e.rows[t]){d=n.jsletrecno,l._onFillRow&&l._onFillRow.call(l,n,l._dataset),s=n.childNodes;for(var c=0,h=s.length;h>c;c++)o=s[c],l._fillCell(d,o)}},_getLeftRowByRecno:function(e){var t=this;if(e<t._fixedRows)return t.leftFixedTbl.tBodies[0].rows[e];for(var l,i=t.leftContentTbl.tBodies[0].rows,a=0,r=i.length;r>a;a++)if(l=i[a],
l.jsletrecno==e)return l;return null},_showCurrentRow:function(e){var t=this,l=t.listvm.recnoToRowno(t._dataset.recno());t.listvm.setCurrentRowno(l,!1,e),t._showCurrentCell()},_getTrByRowno:function(e){var t,l,i,a,r=this,n=r._fixedCols>0||r._sysColumns.length>0;return 0>e?(l=r.rightFixedTbl.tBodies[0].rows,t=r._fixedRows+e,i=l[t],a=n?r.leftFixedTbl.tBodies[0].rows[t]:null,{fixed:a,content:i}):(l=r.rightContentTbl.tBodies[0].rows,t=e-r.listvm.getVisibleStartRow(),t>=0&&(i=l[t])?(a=n?r.leftContentTbl.tBodies[0].rows[t]:null,{fixed:a,content:i}):null)},_adjustCurrentCellPos:function(e){var t=this;if(t._readOnly){var l=jQuery(t.el),i=l.find(".jl-tbl-contentcol"),a=i[0],r=a.scrollLeft;if(t._currColNum<t._fixedCols)return void(a.scrollLeft=0);var n=t._noborder?0:2;if(e){if(0===r)return;var s=0,o=t._fixedCols;for(t.innerColumns.length;o<t._currColNum;o++)s+=t.innerColumns[o].width+n;r>s&&(a.scrollLeft=s)}else{for(var d=i.innerWidth()-20,u=i.find(".jl-tbl-content-div").width(),c=0,o=t.innerColumns.length-1;o>t._currColNum;o--)c+=t.innerColumns[o].width+n;s=u-c-d,s>r&&(a.scrollLeft=s>=0?s:0)}}},_isCurrCellInView:function(){var e=this;if(!e._readOnly)return!0;var t=jQuery(e.el),l=t.find(".jl-tbl-contentcol"),i=l[0],a=e._noborder?0:2,r=i.scrollLeft,n=0;if(e._currColNum<e._fixedCols)return!0;var s=e._fixedCols;for(e.innerColumns.length;s<e._currColNum;s++)n+=e.innerColumns[s].width+a;if(r>n)return!1;var o=l.innerWidth(),d=l.find(".jl-tbl-content-div").width();scrWidth=0;for(var s=e.innerColumns.length-1;s>e._currColNum;s--)scrWidth+=e.innerColumns[s].width+a;return n=d-scrWidth-o,n=n>=0?n:0,n>r?!1:!0},_showCurrentCell:function(){var e,t=this,l=t._currRow;if(l&&t._readOnly){e=t._currColNum>=t._fixedCols?l.content:l.fixed;var i=e.jsletrecno;if(i!==t._dataset.recno())return void(t.prevCell&&t.prevCell.removeClass("jl-tbl-curr-cell"));for(var a,r=e.cells,n=0,s=r.length;s>n;n++){a=r[n];var o=a.jsletColCfg;if(o&&o.colNum==t._currColNum){t.prevCell&&t.prevCell.removeClass("jl-tbl-curr-cell");var d=jQuery(a);d.addClass("jl-tbl-curr-cell"),t.prevCell=d}}}},_showSelected:function(e,t,l){var i=this,a=jQuery(e);void 0===l&&(l=i._dataset.recno());var r=i._dataset.selection.isSelected(l,t);r?a.addClass("jl-tbl-selected"):a.removeClass("jl-tbl-selected")},_refreshSelection:function(){var e=this;jQuery(e.el).find("td.jl-tbl-cell").each(function(t,l){var i=l.jsletColCfg,a=parseInt(l.parentNode.jsletrecno);if((a||0===a)&&i){var r=i.field;r&&e._showSelected(l,r,a)}})},_syncScrollBar:function(e){var t=this;if(!t._keep_silence_){var l=e*t._rowHeight;t._keep_silence_=!0;try{var i=t.jqVScrollBar[0];i.scrollTop!=l&&(i.scrollTop=l)}finally{t._keep_silence_=!1}}},expandAll:function(){var e=this;e.listvm.expandAll(function(){e._fillData()})},collapseAll:function(){var e=this;e.listvm.collapseAll(function(){e._fillData()})},_doMetaChanged:function(e,t){var l=this;return t?("label"!=e||l._hideHead)&&("required"!=e||l._readOnly||l._hideHead)?void 0:void l._refreshHeadCell(t):void l.renderAll()},refreshControl:function(e){var t=this,l=e.eventType;if(l==jslet.data.RefreshEvent.CHANGEMETA)t._doMetaChanged(e.metaName,e.fieldName);else if(l==jslet.data.RefreshEvent.AGGRADED)t._fillTotalSection();else if(l==jslet.data.RefreshEvent.BEFORESCROLL);else if(l==jslet.data.RefreshEvent.SCROLL){if(0===t._dataset.recordCount())return;t._showCurrentRow(!0)}else if(l==jslet.data.RefreshEvent.UPDATEALL)t.listvm.refreshModel(),t._updateSortFlag(!0),t._fillData(),t._showCurrentRow(!0),t._hasSelectCol&&(jQuery(t.el).find(".jl-tbl-select-all")[0].checked=!1);else if(l==jslet.data.RefreshEvent.UPDATERECORD)t.refreshCurrentRow();else if(l==jslet.data.RefreshEvent.UPDATECOLUMN)t._fillData();else if(l==jslet.data.RefreshEvent.INSERT){t.listvm.refreshModel();var i=t._dataset.recno(),a=e.preRecno;t._fillData(),t._keep_silence_=!0;try{t.refreshControl(jslet.data.RefreshEvent.scrollEvent(i,a))}finally{t._keep_silence_=!1}}else if(l==jslet.data.RefreshEvent.DELETE)t.listvm.refreshModel(),t._fillData();else if(l==jslet.data.RefreshEvent.SELECTRECORD){if(!t._hasSelectCol)return;var r=0;t._hasSeqCol&&r++;for(var n,s,o,d,i=e.recno,u=0,c=i.length;c>u;u++)n=t._getLeftRowByRecno(i[u]),n&&(s=n.cells[r],o=e.selected?!0:!1,d=jQuery(s).find("[type=checkbox]")[0],d.checked=o,d.defaultChecked=o)}else if(l==jslet.data.RefreshEvent.SELECTALL){if(!t._hasSelectCol)return;var r=0;t._hasSeqCol&&r++;var o,i,n,s,d,h=t.leftFixedTbl.tBodies[0],f=t.leftContentTbl.tBodies[0],v=t._dataset.recno();try{for(var u=0,c=h.rows.length;c>u&&(n=h.rows[u],"none"!=n.style.display);u++)t._dataset.recnoSilence(n.jsletrecno),o=t._dataset.selected()?!0:!1,s=n.cells[r],d=jQuery(s).find("[type=checkbox]")[0],d.checked=o,d.defaultChecked=o;for(var u=0,c=f.rows.length;c>u&&(n=f.rows[u],"none"!=n.style.display);u++)t._dataset.recnoSilence(n.jsletrecno),o=t._dataset.selected()?!0:!1,s=n.cells[r],d=jQuery(s).find("[type=checkbox]")[0],d.checked=o,d.defaultChecked=o}finally{t._dataset.recnoSilence(v)}}},_isCellEditable:function(e){var t=this;if(t._readOnly)return!1;var l=e.field;if(!l)return!1;var i=t._dataset.getField(l),a=i.fieldDisabled()||i.fieldReadOnly()?0:1;return a},_createEditControl:function(e){var t=this,l=e.field;if(!l)return null;var i=t._dataset.getField(l),a=i.fieldDisabled()||i.fieldReadOnly()?0:1;if(!a)return null;var r=i.editControl();r.dataset=t._dataset,r.field=l,r.inTableCtrl=!0;var n=jslet.ui.createControl(r);return n=n.el,n.id=jslet.nextId(),jQuery(n).addClass("jl-tbl-incell").on("editing",function(e,l){t._editingField=l}),n},checkSizeChanged:function(){var e=this,t=jQuery(e.el),l=t.height();l!=e._oldHeight&&(e.height=l,e.renderAll())},destroy:function(e){var t=this,l=jQuery(t.el);jslet.resizeEventBus.unsubscribe(t),l.off(),t.listvm.onTopRownoChanged=null,t.listvm.onVisibleCountChanged=null,t.listvm.onCurrentRownoChanged=null,t.listvm=null,t._currRow=null,t.leftHeadTbl=null,t.rightHeadTbl=null,jQuery(t.rightHeadTbl).off(),t.leftFixedTbl=null,t.rightFixedTbl=null,t.leftContentTbl=null,t.rightContentTbl=null,t.leftFootTbl=null,t.rightFootTbl=null,t.noRecordDiv=null,t.jqVScrollBar.off(),t.jqVScrollBar=null;var i=l.find(".jl-tbl-splitter")[0];i._doDragging=null,i._doDragEnd=null,i._doDragCancel=null,t.parsedHeads=null,l.find("tr").each(function(){this.ondblclick=null,this.onclick=null}),l.find(".jl-tbl-select-check").off(),e()}}),jslet.ui.DBTable=jslet.Class.create(jslet.ui.AbstractDBTable,{}),jslet.ui.register("DBTable",jslet.ui.DBTable),jslet.ui.DBTable.htmlTemplate="<div></div>",jslet.ui.CellRender=jslet.Class.create({createHeader:function(e,t){},createCell:function(e,t){},refreshCell:function(e,t,l){}}),jslet.ui.DefaultCellRender=jslet.Class.create(jslet.ui.CellRender,{createCell:function(e,t){var l=this,i=t.field,a=l._dataset.getField(i);e.parentNode.style.textAlign=a.alignment()},refreshCell:function(e,t,l){if(t&&!t.noRefresh){var i=this,a=t.field;if(a){var r,n=i._dataset.getField(a);try{r=i._dataset.getFieldTextByRecno(l,a)}catch(s){r="error: "+s.message,console.error(s)}if(n.urlExpr()){var o="<a href="+n.calcUrl(),d=n.urlTarget();d&&(o+=" target="+d),o+=">"+r+"</a>",r=o}(""===r||null===r||void 0===r)&&(r="&nbsp;");var u=jQuery(e);u.html(r),e.title=u.text(),i._showSelected(e.parentNode,a,l)}}}}),jslet.ui.EditableCellRender=jslet.Class.create(jslet.ui.CellRender,{createCell:function(e,t,l){var i=this,a=t.field,r=(i._dataset.getField(a),i._createEditControl(t));e.appendChild(r)},refreshCell:function(e,t,l){if(t&&e.firstChild){var i=e.firstChild.jslet;i.ctrlRecno(l)}}}),jslet.ui.SequenceCellRender=jslet.Class.create(jslet.ui.CellRender,{createHeader:function(e,t){e.innerHTML=this._seqColHeader||"&nbsp;"},createCell:function(e,t){jQuery(e.parentNode).addClass("jl-tbl-sequence")},refreshCell:function(e,t){if(t&&!t.noRefresh){var l,i=jQuery(e),a=this.listvm.getCurrentRecno();l=this._reverseSeqCol?this._dataset.recordCount()-a:a+1,this._dataset.existRecordError(a)?i.parent().addClass("has-error"):i.parent().removeClass("has-error"),e.title=l,i.html(l)}}}),jslet.ui.SelectCellRender=jslet.Class.create(jslet.ui.CellRender,{createHeader:function(e,t){e.style.textAlign="center";var l=document.createElement("input");l.type="checkbox";var i=this;jQuery(l).addClass("jl-tbl-select-check jl-tbl-select-all").on("click",function(e){i._dataset.selectAll(this.checked?1:0,i._onSelectAll)}),e.appendChild(l)},createCell:function(e,t){e.style.textAlign="center";var l=this,i=document.createElement("input"),a=jQuery(i);a.attr("type","checkbox").addClass("jl-tbl-select-check"),a.click(l._doSelectBoxClick),e.appendChild(i)},refreshCell:function(e,t,l){if(t&&!t.noRefresh){var i=this,a=e.firstChild;i._dataset.checkSelectable(l)?(a.checked=i._dataset.selectedByRecno(l),a.style.display=""):a.style.display="none"}}}),jslet.ui.SubgroupCellRender=jslet.Class.create(jslet.ui.CellRender,{createCell:function(e,t){}}),jslet.ui.BoolCellRender=jslet.Class.create(jslet.ui.DefaultCellRender,{refreshCell:function(e,t,l){if(t&&!t.noRefresh){e.style.textAlign="center";var i=jQuery(e);i.html("&nbsp;");var a=this,r=t.field;a._dataset.getField(r);a._dataset.getFieldValueByRecno(l,r)?(i.addClass("jl-tbl-checked"),i.removeClass("jl-tbl-unchecked")):(i.removeClass("jl-tbl-checked"),i.addClass("jl-tbl-unchecked")),a._showSelected(e.parentNode,r,l)}}}),jslet.ui.TreeCellRender=jslet.Class.create(jslet.ui.CellRender,{initialize:function(){},createCell:function(e,t,l){var i=this,a=document.createElement("div"),r=jQuery(a);a.style.height=i._rowHeight-2+"px",r.html('<span class="jl-tbltree-indent"></span><span class="jl-tbltree-node"></span><span class="jl-tbltree-icon"></span><span class="jl-tbltree-text"></span>');var n=a.childNodes[1];n.onclick=function(e){var t=jslet.ui.findFirstParent(this,function(e){return e.tagName&&"tr"==e.tagName.toLowerCase()});return e.stopImmediatePropagation(),e.preventDefault(),i._dataset.recno(t.jsletrecno),i._dataset.aborted()?!1:(this.expanded?i.listvm.collapse(function(){i._fillData()}):i.listvm.expand(function(){i._fillData()}),!1)},n.onmouseover=function(e){var t=jQuery(this);t.hasClass("jl-tbltree-collapse")?t.addClass("jl-tbltree-collapse-hover"):t.addClass("jl-tbltree-expand-hover")},n.onmouseout=function(e){var t=jQuery(this);t.removeClass("jl-tbltree-collapse-hover"),t.removeClass("jl-tbltree-expand-hover")},e.appendChild(a)},refreshCell:function(e,t,l){if(t&&!t.noRefresh){var i=e.firstChild,a=i.childNodes,r=this,n=r.listvm.getLevel(l);jslet.ui.TreeCellRender.iconWidth||(jslet.ui.TreeCellRender.iconWidth=parseInt(jslet.ui.getCssValue("jl-tbltree-indent","width")));var s=r.listvm.hasChildren(l),o=(s?n:n+1)*jslet.ui.TreeCellRender.iconWidth,d=a[0];d.style.width=o+"px";var u=a[1];if(u.style.display=s?"inline-block":"none",s){u.expanded=r._dataset.expandedByRecno(l);var c=jQuery(u);c.removeClass("jl-tbltree-expand"),c.removeClass("jl-tbltree-collapse"),c.addClass(u.expanded?"jl-tbltree-expand":"jl-tbltree-collapse")}if(t.getIconClass){var h=t.getIconClass(n,s);if(h){var f=jQuery(a[2]);f.addClass("jl-tbltree-icon "+h)}}var v,p=a[3],_=t.field,g=r._dataset.getField(_);try{v=r._dataset.getFieldTextByRecno(l,_)}catch(m){v="error: "+m.message}if(e.title=v,g.urlExpr()){var j="<a href="+g.calcUrl(),C=g.urlTarget();C&&(j+=" target="+C),j+=">"+v+"</a>",v=j}p.innerHTML=v,r._showSelected(e.parentNode,_,l)}}}),jslet.ui.DBTable.defaultCellRender=new jslet.ui.DefaultCellRender,jslet.ui.DBTable.editableCellRender=new jslet.ui.EditableCellRender,jslet.ui.DBTable.treeCellRender=new jslet.ui.TreeCellRender,jslet.ui.DBTable.boolCellRender=new jslet.ui.BoolCellRender,jslet.ui.DBTable.sequenceCellRender=new jslet.ui.SequenceCellRender,jslet.ui.DBTable.selectCellRender=new jslet.ui.SelectCellRender,jslet.ui.DBTable.subgroupCellRender=new jslet.ui.SubgroupCellRender,jslet.ui.Splitter=function(){if(!jslet.ui._splitDiv){var e=document.createElement("div");e.className="jl-split-column",e.style.display="none",jslet.ui._splitDiv=e,document.body.appendChild(e),e=null}this.isDragging=!1,this.attach=function(e,t,l,i){i||(i=jQuery(e).height());var a=jslet.ui._splitDiv;a.style.height=i+"px",a.style.left=t+"px",a.style.top=l+"px",a.style.display="block",jslet.ui.dnd.bindControl(this),this.isDragging=!1},this.unattach=function(){jslet.ui._splitDiv.style.display="none",this.onSplitEnd=null,this.onSplitCancel=null},this.onSplitEnd=null,this.onSplitCancel=null,this._doDragEnd=function(e,t,l,i,a,r){jslet.ui.dnd.unbindControl(),this.onSplitEnd&&this.onSplitEnd(l-e),this.unattach(),this.isDragging=!1},this._doDragging=function(e,t,l,i,a,r){this.isDragging=!0,jslet.ui._splitDiv.style.left=l+"px"},this._doDragCancel=function(){jslet.ui.dnd.unbindControl(),this.onSplitCancel&&this.onSplitCancel(),this.unattach(),this.isDragging=!1}},jslet.ui.DBTableFilterPanel=function(e,t){var l=this;l.popupWidth=200,l.popupHeight=200,l.fieldName=t,l.popup=new jslet.ui.PopupPanel,l.popup.onHidePopup=function(){l.jqFilterBtn.focus()}},jslet.ui.DBTableFilterPanel.prototype={showPopup:function(e,t,l,i){var a=this;a.panel||(a.panel=a._create()),a.popup.setContent(a.panel,"100%","100%"),a.popup.show(e,t,a.popupWidth,a.popupHeight,l,i),jQuery(a.panel).find(".jl-combopnl-head input").focus()},closePopup:function(){var e=this;e.popup.hide();var t=e.otree?e.otree:e.otable;t&&t.dataset().removeLinkedControl(t)},_create:function(){var e=this;return e.panel||(e.panel=document.createElement("div")),e.panel},destroy:function(){Z.popup=null,Z.panel=null}},jslet.ui.DBTreeView=jslet.Class.create(jslet.ui.DBControl,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,displayFields,hasCheckBox,correlateCheck,onlyCheckChildren,readOnly,expandLevel,codeField,codeFormat,onItemClick,onItemDblClick,beforeCheckBoxClick,iconClassField,onGetIconClass,onCreateContextMenu",i.requiredProperties="displayFields",i._displayFields=null,i._hasCheckBox=!1,i._readOnly=!1,i._correlateCheck=!1,i._onlyCheckChildren=!1,i._iconClassField=null,i._expandLevel=-1,i._onItemClick=null,i._onItemDblClick=null,i._beforeCheckBoxClick=null,i._onGetIconClass=null,i._onCreateContextMenu=null,i.iconWidth=null,e(t,l)},displayFields:function(e){return void 0===e?this._displayFields:(e=jQuery.trim(e),jslet.Checker.test("DBTreeView.displayFields",e).required().isString(),void(this._displayFields=e))},iconClassField:function(e){return void 0===e?this._iconClassField:(e=jQuery.trim(e),jslet.Checker.test("DBTreeView.iconClassField",e).isString(),void(this._iconClassField=e))},hasCheckBox:function(e){return void 0===e?this._hasCheckBox:void(this._hasCheckBox=e?!0:!1)},correlateCheck:function(e){return void 0===e?this._correlateCheck:void(this._correlateCheck=e?!0:!1)},onlyCheckChildren:function(e){return void 0===e?this._onlyCheckChildren:void(this._onlyCheckChildren=e?!0:!1)},readOnly:function(e){return void 0===e?this._readOnly:void(this._readOnly=e?!0:!1)},expandLevel:function(e){return void 0===e?this._expandLevel:(jslet.Checker.test("DBTreeView.expandLevel",e).isGTEZero(),void(this._expandLevel=parseInt(e)))},onItemClick:function(e){return void 0===e?this._onItemClick:(jslet.Checker.test("DBTreeView.onItemClick",e).isFunction(),void(this._onItemClick=e))},onItemDblClick:function(e){return void 0===e?this._onItemDblClick:(jslet.Checker.test("DBTreeView.onItemDblClick",e).isFunction(),void(this._onItemDblClick=e))},beforeCheckBoxClick:function(e){return void 0===e?this._beforeCheckBoxClick:(jslet.Checker.test("DBTreeView.beforeCheckBoxClick",e).isFunction(),void(this._beforeCheckBoxClick=e))},onGetIconClass:function(e){return void 0===e?this._onGetIconClass:(jslet.Checker.test("DBTreeView.onGetIconClass",e).isFunction(),void(this._onGetIconClass=e))},onCreateContextMenu:function(e){return void 0===e?this._onCreateContextMenu:(jslet.Checker.test("DBTreeView.onCreateContextMenu",e).isFunction(),void(this._onCreateContextMenu=e))},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){var e=this,t=jQuery(e.el);e.scrBarSize=jslet.scrollbarSize()+1,void 0===e._keyField&&(e._keyField=e._dataset.keyField());var l=t.attr("tabindex");e._readOnly&&!l&&t.attr("tabindex",0),t.keydown(function(t){e._doKeydown(t.which)&&t.preventDefault()}),t.on("mouseenter","td.jl-tree-text",function(e){jQuery(this).addClass("jl-tree-nodes-hover")}),t.on("mouseleave","td.jl-tree-text",function(e){jQuery(this).removeClass("jl-tree-nodes-hover")}),t.hasClass("jl-tree")||t.addClass("jl-tree"),e.renderAll(),e.refreshControl(jslet.data.RefreshEvent.scrollEvent(this._dataset.recno())),e._createContextMenu(),jslet.resizeEventBus.subscribe(e)},renderAll:function(){var e=this,t=jQuery(e.el);e.evaluator=new jslet.Expression(e._dataset,e._displayFields),t.html(""),e.oldWidth=t.width(),e.oldHeight=t.height(),e.nodeHeight=e.iconWidth=parseInt(jslet.ui.getCssValue("jl-tree","line-height")),e.treePanelHeight=t.height(),e.treePanelWidth=t.width(),e.nodeCount=Math.floor(e.treePanelHeight/e.nodeHeight),e._initVm(),e._initFrame()},_initFrame:function(){var e=this,t=jQuery(e.el);t.find(".jl-tree-container").off(),t.find(".jl-tree-scrollbar").off();for(var l=[],i=0;5>i;i++)l.push('<td class="jl-tree-lines" '),l.push(jslet.ui.DBTreeView.NODETYPE),l.push('="0"></td>');for(var a=l.join(""),r=['<table border="0" cellpadding="0" cellspacing="0" style="table-layout:fixed;width:100%;height:100%"><tr><td style="vertical-align:top"><div class="jl-tree-container">'],i=0,n=e.nodeCount;n>i;i++)r.push('<table class="jl-tree-nodes" cellpadding="0" cellspacing="0"><tr>'),r.push(a),r.push('<td class="jl-tree-expander" '),r.push(jslet.ui.DBTreeView.NODETYPE),r.push('="1"></td><td '),r.push(jslet.ui.DBTreeView.NODETYPE),r.push('="2"></td><td '),r.push(jslet.ui.DBTreeView.NODETYPE),r.push('="3"></td><td class="jl-tree-text" '),r.push(jslet.ui.DBTreeView.NODETYPE),r.push('="9" nowrap="nowrap"></td></tr></table>');r.push('</div></td><td class="jl-tree-scroll-col"><div class="jl-tree-scrollbar"><div class="jl-tree-tracker"></div></div></td></tr></table>'),t.html(r.join(""));var s=t.find(".jl-tree-container");s.on("click",function(t){e._doRowClick(t.target)}),s.on("dblclick",function(t){e._doRowDblClick(t.target)}),e.listvm.setVisibleCount(e.nodeCount);var o=t.find(".jl-tree-scrollbar");o.on("scroll",function(){var t=Math.floor(this.scrollTop/e.nodeHeight);if(t!=e.listvm.getVisibleStartRow()){e._skip_=!0;try{e.listvm.setVisibleStartRow(t)}finally{e._skip_=!1}}})},resize:function(){var e=this,t=jQuery(e.el),l=t.height(),i=t.width();i!=e.oldWidth&&(e.oldWidth=i,e.treePanelWidth=t.innerWidth(),e._fillData()),l!=e.oldHeight&&(e.oldHeight=l,e.treePanelHeight=t.innerHeight(),e.nodeCount=Math.floor(l/e.nodeHeight)-1,e._initFrame())},hasChildren:function(){return this.listvm.hasChildren()},_initVm:function(){var e=this;e.listvm=new jslet.ui.ListViewModel(e._dataset,!0),e.listvm.refreshModel(e._expandLevel),e.listvm.fixedRows=0,e.listvm.onTopRownoChanged=function(t){var t=e.listvm.getCurrentRowno();e._fillData(),e._doCurrentRowChanged(t),e._syncScrollBar(t)},e.listvm.onVisibleCountChanged=function(){e._fillData();var t=e.listvm.getNeedShowRowCount();jQuery(e.el).find(".jl-tree-tracker").height(e.nodeHeight*t)},e.listvm.onCurrentRownoChanged=function(t,l){e._doCurrentRowChanged(l)},e.listvm.onNeedShowRowsCountChanged=function(t){e._fillData(),jQuery(e.el).find(".jl-tree-tracker").height(e.nodeHeight*(t+2))},e.listvm.onCheckStateChanged=function(){e._fillData()}},_doKeydown:function(e){var t=this,l=!1;return 32==e?(t._doCheckBoxClick(),l=!0):38==e?(t.listvm.priorRow(),l=!0):40==e?(t.listvm.nextRow(),l=!0):37==e?(jslet.locale.isRtl?t.listvm.expand():t.listvm.collapse(),l=!0):39==e?(jslet.locale.isRtl?t.listvm.collapse():t.listvm.expand(),l=!0):33==e?(t.listvm.priorPage(),l=!0):34==e&&(t.listvm.nextPage(),l=!0),l},_getTrByRowno:function(e){for(var t,l=jQuery(this.el).find(".jl-tree-nodes"),i=0,a=l.length;a>i;i++)if(t=l[i].rows[0],t.jsletrowno==e)return t;return null},_doCurrentRowChanged:function(e){var t=this;t.prevRow&&jQuery(t._getTextTd(t.prevRow)).removeClass(jslet.ui.htmlclass.TREENODECLASS.selected);var l=t._getTrByRowno(e);l&&jQuery(t._getTextTd(l)).addClass(jslet.ui.htmlclass.TREENODECLASS.selected),t.prevRow=l},_getTextTd:function(e){return e.cells[e.cells.length-1]},_doExpand:function(){this.expand()},_doRowClick:function(e){var t=this,l=e.getAttribute(jslet.ui.DBTreeView.NODETYPE);if(l){if("0"!=l&&t._syncToDs(e),"1"==l||"2"==l){var i=t.listvm.getCurrentRow();"1"==l&&i.children&&i.children.length>0&&(i.expanded?t.collapse():t.expand()),"2"==l&&t._doCheckBoxClick()}"9"==l&&t._onItemClick&&t._onItemClick.call(t)}},_doRowDblClick:function(e){this._syncToDs(e);var t=e.getAttribute(jslet.ui.DBTreeView.NODETYPE);this._onItemDblClick&&"9"==t&&this._onItemDblClick.call(this)},_doCheckBoxClick:function(){var e=this;if(!e._readOnly&&(!e._beforeCheckBoxClick||e._beforeCheckBoxClick.call(e))){var t=e.listvm.getCurrentRow();e.listvm.checkNode(t.state?0:1,e._correlateCheck,e._onlyCheckChildren)}},_syncToDs:function(e){for(var t,l=-1;;){if(t=e.jsletrowno,0===t||t){l=t;break}if(e=e.parentNode,!e)break}0>l||(this.listvm.setCurrentRowno(l),this._dataset.recno(this.listvm.getCurrentRecno()))},_fillData:function(){var e,t=this,l=t.listvm.getVisibleCount(),i=t.listvm.getVisibleStartRow(),a=t.listvm.getNeedShowRowCount(),r=l+i,n=0,s=jQuery(t.el),o=s.find(".jl-tree-nodes");if(!t._isRendering){t._isRendering=!0,t._skip_=!0;var d,u=t._dataset.recnoSilence(),c=t.listvm.getCurrentRowno(),h=!0,f=0;try{if(r>a){for(var v=r-a;v>0;v--)e=o[l-v],e.style.display="none";h=!1}else a=r;for(var p=a-1,_=i;p>=_;_++)e=o[n++],d=t._fillNode(e,_),h&&f<t.treePanelWidth&&(_==p&&d<t.treePanelWidth?h=!1:f=Math.max(f,d)),_==p&&h?e.style.display="none":(e.style.display="",e.jsletrowno=_);var g=s.find(".jl-tree-scrollbar");h?g.height(t.treePanelHeight-t.scrBarSize-2):g.height(t.treePanelHeight-2)}finally{t.listvm.setCurrentRowno(c,!1),t._dataset.recnoSilence(u),t._isRendering=!1,t._skip_=!1}}},_getCheckClassName:function(e){return e?2==e?jslet.ui.htmlclass.TREECHECKBOXCLASS.mixedChecked:jslet.ui.htmlclass.TREECHECKBOXCLASS.checked:jslet.ui.htmlclass.TREECHECKBOXCLASS.unChecked},_fillNode:function(e,t){var l,i=e.rows[0],a=this,r=a.listvm.setCurrentRowno(t,!0),n=i.cells,s=n.length,o=r.level+4;if(a._dataset.recnoSilence(a.listvm.getCurrentRecno()),i.jsletrowno=t,o>s)for(var d=1,u=o-s;u>=d;d++)l=i.insertCell(0),jQuery(l).addClass("jl-tree-lines").attr("jsletline",1);if(s>=o){for(var d=0,u=s-o;u>d;d++)n[d].style.display="none";for(var d=s-o;o>d;d++)n[d].style.display=""}s=n.length;for(var c=r,h=1,f=a.iconWidth*r.level,d=r.level;d>0;d--)l=i.cells[s-4-h++],c=c.parent,c.islast?l.className=jslet.ui.htmlclass.TREELINECLASS.empty:l.className=jslet.ui.htmlclass.TREELINECLASS.line;var v=i.cells[s-4];v.noWrap=!0,v.style.display="",r.children&&r.children.length>0?r.islast?v.className=r.expanded?jslet.ui.htmlclass.TREELINECLASS.minusBottom:jslet.ui.htmlclass.TREELINECLASS.plusBottom:v.className=r.expanded?jslet.ui.htmlclass.TREELINECLASS.minus:jslet.ui.htmlclass.TREELINECLASS.plus:r.islast?v.className=jslet.ui.htmlclass.TREELINECLASS.joinBottom:v.className=jslet.ui.htmlclass.TREELINECLASS.join,f+=a.iconWidth;var p=a._hasCheckBox&&a._dataset.checkSelectable(),_=i.cells[s-3];p?(_.noWrap=!0,_.className=a._getCheckClassName(a._dataset.selected()),_.style.display="",f+=a.iconWidth):_.style.display="none";var g=i.cells[s-2],m="jl-tree-icon",j=null;if(a._iconClassField||a._onGetIconClass){if(a._iconClassField)j=a._dataset.getFieldValue(a._iconClassField);else if(a._onGetIconClass){var C=!(r.children&&r.children.length>0);j=a._onGetIconClass.call(a,a._dataset.keyValue(),r.level,C)}j&&(m+=" "+j),g.className!=m&&(g.className=m),g.style.display="",f+=a.iconWidth}else g.style.display="none";var y=a.evaluator.eval()||"      ";jslet.ui.textMeasurer.setElement(a.el);var b=Math.round(jslet.ui.textMeasurer.getWidth(y))+4*y.length;f+=b+10,jslet.ui.textMeasurer.setElement();var l=i.cells[s-1];l.style.width=b+"px";var x=jQuery(l);return x.html(y),r.isbold?x.addClass("jl-tree-child-checked"):x.removeClass("jl-tree-child-checked"),f},_updateCheckboxState:function(){var e,t,l,i=this,a=i._dataset.recnoSilence(),r=jQuery(i.el),n=r.find(".jl-tree-nodes");try{for(var s=0,o=n.length;o>s;s++)l=n[s].rows[0],t=l.cells.length,e=l.jsletrowno,e&&(i.listvm.setCurrentRowno(e,!0),i._dataset.recnoSilence(i.listvm.getCurrentRecno()),l.cells[t-3].className=i._getCheckClassName(i._dataset.selected()))}finally{i._dataset.recnoSilence(a)}},_syncScrollBar:function(){var e=this;e._skip_||jQuery(e.el).find(".jl-tree-scrollbar").scrollTop(e.nodeHeight*e.listvm.getVisibleStartRow())},expand:function(){this.listvm.expand()},collapse:function(){this.listvm.collapse()},expandAll:function(){this.listvm.expandAll()},collapseAll:function(){this.listvm.collapseAll()},_createContextMenu:function(){if(jslet.ui.Menu){var e=this,t={type:"Menu",onItemClick:e._menuItemClick,items:[{id:"expandAll",name:jslet.locale.DBTreeView.expandAll},{id:"collapseAll",name:jslet.locale.DBTreeView.collapseAll}]};e._hasCheckBox&&!e._correlateCheck&&(t.items.push({name:"-"}),t.items.push({id:"checkAll",name:jslet.locale.DBTreeView.checkAll}),t.items.push({id:"uncheckAll",name:jslet.locale.DBTreeView.uncheckAll})),e._onCreateContextMenu&&e._onCreateContextMenu.call(e,t.items),0!==t.items.length&&(e.contextMenu=jslet.ui.createControl(t),jQuery(e.el).on("contextmenu",function(t){var l=t.target,i=l.getAttribute(jslet.ui.DBTreeView.NODETYPE);i&&"0"!=i&&(e._syncToDs(l),e.contextMenu.showContextMenu(t,e))}))}},_menuItemClick:function(e,t){"expandAll"==e?this.expandAll():"collapseAll"==e?this.collapseAll():"checkAll"==e?this.listvm.checkChildNodes(!0,this._correlateCheck):"uncheckAll"==e&&this.listvm.checkChildNodes(!1,this._correlateCheck)},refreshControl:function(e){var t=this,l=e.eventType;l==jslet.data.RefreshEvent.CHANGEMETA||(l==jslet.data.RefreshEvent.UPDATEALL||l==jslet.data.RefreshEvent.INSERT||l==jslet.data.RefreshEvent.DELETE?(t.listvm.refreshModel(),l==jslet.data.RefreshEvent.INSERT&&t.listvm.syncDataset()):l==jslet.data.RefreshEvent.UPDATERECORD||l==jslet.data.RefreshEvent.UPDATECOLUMN?t._fillData():l==jslet.data.RefreshEvent.SELECTALL||l==jslet.data.RefreshEvent.SELECTRECORD?t._hasCheckBox&&t._updateCheckboxState():l==jslet.data.RefreshEvent.SCROLL&&t.listvm.syncDataset())},checkSizeChanged:function(){this.resize()},destroy:function(e){var t=this,l=jQuery(t.el);jslet.resizeEventBus.unsubscribe(t),l.find(".jl-tree-nodes").off(),t.listvm.destroy(),t.listvm=null,t.prevRow=null,e()}}),jslet.ui.htmlclass.TREELINECLASS={line:"jl-tree-lines jl-tree-line",join:"jl-tree-lines jl-tree-join",joinBottom:"jl-tree-lines jl-tree-join-bottom",minus:"jl-tree-lines jl-tree-minus",minusBottom:"jl-tree-lines jl-tree-minus-bottom",noLineMinus:"jl-tree-lines jl-tree-noline-minus",plus:"jl-tree-lines jl-tree-plus",plusBottom:"jl-tree-lines jl-tree-plus-bottom",noLinePlus:"jl-tree-lines jl-tree-noline-plus",empty:"jl-tree-empty"},jslet.ui.htmlclass.TREECHECKBOXCLASS={checked:"jl-tree-checkbox jl-tree-checked",unChecked:"jl-tree-checkbox jl-tree-unchecked",mixedChecked:"jl-tree-checkbox jl-tree-mixedchecked"},jslet.ui.htmlclass.TREENODECLASS={selected:"jl-tree-selected",childChecked:"jl-tree-child-checked",treeNodeLevel:"jl-tree-child-level"},jslet.ui.DBTreeView.NODETYPE="data-nodetype",jslet.ui.register("DBTreeView",jslet.ui.DBTreeView),jslet.ui.DBTreeView.htmlTemplate="<div></div>",jslet.ui.ListViewModel=function(e,t){var l=0,i=0,a=0,r=null,n=null,s=0,o=0;this.onTopRownoChanged=null,this.onVisibleCountChanged=null,this.onCurrentRownoChanged=null,this.onNeedShowRowsCountChanged=null,this.onCheckStateChanged=null,this.fixedRows=0;var d=function(){if(!t)return!1;var l=e;return l._parentField&&l._keyField?!0:!1};d(),this.refreshModel=function(l){if(t){void 0===l&&(l=-1);var i,a,r=e,s=(r.recordCount(),[]),o=r.recnoSilence();try{r.recnoSilence(this.fixedRows);for(var d,u,c,h,f,v,p=0,_=[],i=0,g=r.recordCount();g>i;i++){r.recnoSilence(i),keyValue=r.keyValue(),p=0,u=null,a=r.parentValue();for(var m=_.length-1;m>=0;m--)if(c=_[m],h=c.keyvalue,null!==h&&void 0!==h&&""!==h&&h==a){p=c.level+1,u=c;break}if(u)for(var j=_.length-1;j>m;j--)_.pop();f=r.getRecord(),v=r.selected(),v||(v=0);var C=!0;C=l>=0&&l>=p?!0:r.expanded(),d={parent:u,recno:i,keyvalue:keyValue,expanded:C,state:v,isbold:0,level:p},_.push(d),u?(u.children||(u.children=[]),u.children.push(d),this._updateParentNodeBoldByChecked(d)):s.push(d)}}finally{r.recnoSilence(o)}n=s,this._setLastFlag(s),this._refreshNeedShowRows()}},this._updateParentNodeBoldByChecked=function(e){if(e.state&&e.parent)for(var t=e.parent;;){if(t.isbold)return;if(t.isbold=1,t=t.parent,!t)return}},this._updateParentNodeBoldByNotChecked=function(e){if(!e.state&&e.parent)for(var t,l=e.parent;;){if(l.children){for(var i=0,a=l.children.length;a>i;i++)if(t=l.children[i],t.state)return;l.isbold=0}if(l=l.parent,!l)return}},this._setLastFlag=function(e){if(e&&0!==e.length){var t;e[e.length-1].islast=!0;for(var l=0,i=e.length;i>l;l++)t=e[l],t.children&&t.children.length>0&&this._setLastFlag(t.children);return null}},this._refreshNeedShowRows=function(e){if(t){if(!n)return void this.refreshModel();r?r.length:0;r=[],this._findVisibleNode(n);var l=r.length;!e&&this.onNeedShowRowsCountChanged&&this.onNeedShowRowsCountChanged(l)}},this.hasChildren=function(l){if(!t)return!1;l||(l=e.recno());var i=this._innerFindNode(n,l);if(null!==i)return i.children&&i.children.length>0},this.getLevel=function(l){if(!t)return!1;l||(l=e.recno());var i=this._innerFindNode(n,l);if(null!==i)return i.level},this._findVisibleNode=function(e){if(e)for(var t,l=0,i=e.length;i>l;l++)t=e[l],r.push(t),t.expanded&&this._findVisibleNode(t.children)},this.rownoToRecno=function(e){return t?0>e?(e+=this.fixedRows,e>=0?e:-1):e>=r.length?-1:r[e].recno:e+this.fixedRows},this.recnoToRowno=function(e){if(!t)return e-this.fixedRows;for(var l=0,i=r.length;i>l;l++)if(r[l].recno==e)return l;return-1},this.setVisibleStartRow=function(e,t){if(e>=0){var r=this.getNeedShowRowCount()-l;e>r&&(e=r)}0>e&&(e=0),i!=e&&(i=e,a=e+l-1,!t&&this.onTopRownoChanged&&this.onTopRownoChanged(e))},this.getVisibleStartRow=function(){return i},this.setVisibleEndRow=function(e){a=e},this.getVisibleEndRow=function(){return a},this.setVisibleCount=function(e,t){l!=e&&(l=e,a=i+e-1,!t&&this.onVisibleCountChanged&&this.onVisibleCountChanged(e))},this.getVisibleCount=function(){return l},this.getNeedShowRowCount=function(){return t?r.length:e.recordCount()-this.fixedRows},this.getCurrentRow=function(){return r[s]},this.skipSetCurrentRowno=function(){this._skipSetCurrentRowno=!0},this.setCurrentRowno=function(e,a,n){if(this._skipSetCurrentRowno)return this._skipSetCurrentRowno=!1,null;if(void 0===e)return null;var d=s,u=0,c=null;if(0>e){var h=-1*this.fixedRows;h>e&&(e=h),u=this.fixedRows+e}else{var f=this.getNeedShowRowCount();if(0===f)return null;e>=f&&(e=f-1),t?(c=r[e],u=c.recno):u=e+this.fixedRows,n&&(e>=0&&i>e?this.setVisibleStartRow(e):e>=i+l&&this.setVisibleStartRow(e-l+1))}return s=e,o=u,!a&&this.onCurrentRownoChanged&&this.onCurrentRownoChanged(d,s),c},this.getCurrentRowno=function(){return s},this.getCurrentRecno=function(){return o},this.nextRow=function(){e.confirm(),this.setCurrentRowno(s+1,!1,!0)},this.priorRow=function(t){e.confirm(),this.setCurrentRowno(s-1,!1,!0)},this.nextPage=function(){e.confirm(),this.setVisibleStartRow(i+l),this.setCurrentRowno(i)},this.priorPage=function(){e.confirm(),this.setVisibleStartRow(i-l),this.setCurrentRowno(i)},this._innerFindNode=function(e,t){for(var l,i=0,a=e.length-1;a>=i;i++){if(l=e[i],l.recno==t)return l;if(l.children){var r=this._innerFindNode(l.children,t);if(r)return r}}return null},this.expand=function(l){if(t){var i=this._innerFindNode(n,e.recno());if(null!==i){e.confirm();var a=e.recnoSilence();try{i.expanded=i.children?!0:!1,e.recnoSilence(i.recno),e.expanded(i.expanded);for(var r=i;;){if(r=r.parent,!r)break;r.expanded||(e.recnoSilence(r.recno),e.expanded(!0),r.expanded=!0)}}finally{e.recnoSilence(a)}this._refreshNeedShowRows(),
l&&l()}}},this.collapse=function(l){if(t){var i=this._innerFindNode(n,e.recno());if(null!==i){e.confirm();var a=e.recnoSilence();try{e.recnoSilence(i.recno),e.expanded(!1),i.expanded=!1}finally{e.recnoSilence(a)}this._refreshNeedShowRows(),l&&l()}}},this._iterateNode=function(e,t){for(var l,i=0,a=e.length;a>i;i++)l=e[i],l.children&&(t&&t(l),l.children&&l.children.length>0&&this._iterateNode(l.children,t));return null},this._callbackFn=function(t,l){var i=e.recnoSilence();try{e.recnoSilence(t.recno),e.expanded(l),t.expanded=l}finally{e.recnoSilence(i)}},this.expandAll=function(l){if(t){e.confirm();var i=this;i._iterateNode(n,function(e){i._callbackFn(e,!0)}),i._refreshNeedShowRows(),l&&l()}},this.collapseAll=function(l){if(t){e.confirm();var i=this;i._iterateNode(n,function(e){i._callbackFn(e,!1)}),i._refreshNeedShowRows(),l&&l()}},this.syncDataset=function(){var t=e.recno();if(!(0>t)){var l=this._innerFindNode(n,e.recno()),i=l.parent;if(i&&!i.expanded)for(;;){if(i.expanded)break;if(i.expanded=!0,i=i.parent,!i)break}this._refreshNeedShowRows();var a=this.recnoToRowno(t);this.setCurrentRowno(a,!1,!0)}},this.checkNode=function(t,l,i){var a=this.getCurrentRow();a.state=t?1:0,e.selected(a.state),l&&(a.children&&a.children.length>0&&this._updateChildState(a,t),a.parent&&!i&&this._updateParentState(a,t)),t?this._updateParentNodeBoldByChecked(a):this._updateParentNodeBoldByNotChecked(a),this.onCheckStateChanged&&this.onCheckStateChanged()},this.checkChildNodes=function(t,l){var i=this.getCurrentRow();i.state=t?1:0,e.selected(i.state),i.children&&i.children.length>0&&this._updateChildState(i,t),l&&i.parent&&this._updateParentState(i,t),t?this._updateParentNodeBoldByChecked(i):this._updateParentNodeBoldByNotChecked(i),this.onCheckStateChanged&&this.onCheckStateChanged()},this._updateChildState=function(t,l){var i,a=e.recnoSilence();try{for(var r=0,n=t.children.length;n>r;r++)i=t.children[r],i.state=l,e.recnoSilence(i.recno),e.selected(l),i.children&&i.children.length>0&&this._updateChildState(i,l)}finally{e.recnoSilence(a)}},this._updateParentState=function(t,l){var i=t.parent;if(i){var a,r;if(2!=l)for(var n=0,s=i.children.length;s>n;n++){if(a=i.children[n],2==a.state){r=2;break}if(0===n)r=a.state;else if(r!=a.state){r=2;break}}else r=l;if(i.state!=r){i.state=r;var o=e.recnoSilence();try{e.recnoSilence(i.recno),e.selected(r)}finally{e.recnoSilence(o)}}this._updateParentState(i,r)}},this.destroy=function(){e=null,n=null,this.onTopRownoChanged=null,this.onVisibleCountChanged=null,this.onCurrentRownoChanged=null,this.onNeedShowRowsCountChanged=null,this.onCheckStateChanged=null}},jslet.ui.DBAutoComplete=jslet.Class.create(jslet.ui.DBText,{MatchModes:["start","end","any"],initialize:function(e,t,l){var i=this;i.allProperties||(i.allProperties="dataset,field,lookupField,minChars,minDelay,displayTemplate,matchMode,beforePopup,onGetFilterField,filterFields"),i._lookupField=null,i._minChars=0,i._minDelay=0,i._beforePopup=null,i._filterFields=null,i._defaultFilterFields=null,i._onGetFilterField=null,i._matchMode="start",i._timeoutHandler=null,e(t,l)},lookupField:function(e){return void 0===e?this._lookupField:(jslet.Checker.test("DBAutoComplete.lookupField",e).isString(),void(this._lookupField=e))},minChars:function(e){return void 0===e?this._minChars:(jslet.Checker.test("DBAutoComplete.minChars",e).isGTEZero(),void(this._minChars=parseInt(e)))},minDelay:function(e){return void 0===e?this._minDelay:(jslet.Checker.test("DBAutoComplete.minDelay",e).isGTEZero(),void(this._minDelay=parseInt(e)))},matchMode:function(e){if(void 0===e)return this._matchMode;e=jQuery.trim(e);var t=jslet.Checker.test("DBAutoComplete.matchMode",e).isString();e=e.toLowerCase(),t.testValue(e).inArray(this.MatchModes),this._matchMode=e},beforePopup:function(e){return void 0===e?this._beforePopup:void(this._beforePopup=e)},filterFields:function(e){return void 0===e?Z._filterFields:(jslet.Checker.test("DBAutoComplete.filterFields",e).isString(),void(Z._filterFields=e))},onGetFilterField:function(e){return void 0===e?this._onGetFilterField:void(this._onGetFilterField=e)},isValidTemplateTag:function(e){return"input"==e.tagName.toLowerCase()&&"text"==e.type.toLowerCase()},doBlur:function(){var e=this;if(!e.el.disabled&&!e.el.readOnly){var t=e._dataset.getField(e._field);t.readOnly()||t.disabled()||(e.contentPanel&&e.contentPanel.isShowing()?window.setTimeout(function(){if(!e._isSelecting){var t=e.el.value,l=!0;if(!e._lookupField){var i=e._dataset.getField(e._field),a=i.lookup(),r=a.dataset();t.length>0&&0===r.recordCount()&&(l=!1)}e.contentPanel&&e.contentPanel.isShowing()&&e.contentPanel.closePopup(),e.updateToDataset(),e.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(e._field)),l||e.el.focus()}},200):(e.updateToDataset(),e.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(e._field))))}},doChange:null,doKeydown:function(e){if(!this.disabled&&!this.readOnly){e=jQuery.event.fix(e||window.event);var t=e.which,l=this.jslet;if(!(t>=112&&123>=t||16==t||17==t||18==t||20==t||45==t||35==t||36==t||34==t||33==t)){if((38==t||40==t)&&l.contentPanel&&l.contentPanel.isPop){var i=l._dataset.getField(l._lookupField||l._field),a=i.lookup(),r=a.dataset();return 38==t&&(r.prior(),e.preventDefault(),e.stopImmediatePropagation()),void(40==t&&(r.next(),e.preventDefault(),e.stopImmediatePropagation()))}return 8==t||46==t||229==t?void this.jslet._invokePopup():void(13!=t&&9!=t?l._invokePopup():l.contentPanel&&l.contentPanel.isShowing()&&l.contentPanel.confirmSelect())}}},doKeypress:function(e){this.disabled||this.readOnly},_invokePopup:function(){var e=this;e._timeoutHandler&&clearTimeout(e._timeoutHandler);var t=100;e._minDelay&&(t=parseInt(e._minDelay)),e._timeoutHandler=setTimeout(function(){e._populate(e.el.value)},t)},_getDefaultFilterFields:function(e){var t=this;if(t._defaultFilterFields)return t._defaultFilterFields;var l=e.codeField(),i=e.nameField(),a=e.dataset(),r=a.getField(l),n=a.getField(i),s=[];return r&&r.visible()&&s.push(l),l!=i&&n&&n.visible()&&s.push(i),t._defaultFilterFields=s,s},_getFilterFields:function(e,t){var l=this,i=null,a=jslet.getFunction(l._onGetFilterField);a&&(i=a.call(l,e.dataset(),t),jslet.Checker.test("DBAutoComplete.onGetFilterField#return",i).isString()),i=i||l._filterFields;var r;if(r=i?i.split(","):l._getDefaultFilterFields(e),0===r.length)throw new Error("Not specified [filter fields]!");var n=t;"start"==l._matchMode?n+="%":n="end"==l._matchMode?"%"+n:"%"+n+"%";for(var s,o="",d=0,u=r.length;u>d;d++)s=r[d],d>0&&(o+=" || "),o+="like(["+s+'],"'+n+'")';return o},_populate:function(e){var t=this;if(!(t._minChars>0&&e&&e.length<t._minChars)){var l=t._dataset.getField(t._lookupField||t._field),i=l.lookup();if(!i)return void console.error(t._field+" is NOT a lookup field!");var a=i.dataset(),r=jslet.getFunction(t._beforePopup);if(r)r.call(t,a,e);else if(e){var n=t._getFilterFields(i,e);a.filter(n),a.filtered(!0)}else a.filter(null);if(t._lookupField&&(t._dataset.getRecord()[t._lookupField]=null),t.contentPanel){if(t.contentPanel.isShowing())return}else t.contentPanel=new jslet.ui.DBAutoCompletePanel(t);jslet.ui.PopupPanel.excludedElement=t.el;var s=jQuery(t.el),o=s.offset(),d=s.outerHeight(),u=o.left,c=o.top+d;jslet.locale.isRtl&&(u=u+s.outerWidth()-t.contentPanel.dlgWidth),t.contentPanel.showPopup(u,c,0,d)}},destroy:function(e){var t=this;jQuery(t.el).off(),t.contentPanel&&(t.contentPanel.destroy(),t.contentPanel=null),e()}}),jslet.ui.DBAutoCompletePanel=function(e){var t=this;t.dlgWidth=320,t.dlgHeight=180;t.comboCfg=e,t.dataset=e.dataset(),t.field=e.lookupField()||e.field(),t.panel=null,t.lkDataset=null,t.popup=new jslet.ui.PopupPanel,t.isPop=!1,t.create=function(){t.panel||(t.panel=document.createElement("div"),t.panel.style.width="100%",t.panel.style.height="100%",jQuery(t.panel).on("mousedown",function(e){t.comboCfg._isSelecting=!0,e.stopPropagation()}));var e=t.dataset.getField(t.field),l=e.lookup(),i=l.dataset();t.lkDataset=i;for(var a=i.getNormalFields(),r=0,n=0,s=a.length;s>n;n++)e=a[n],e.visible()&&(r+=e.displayWidth());var o=r*(jslet.global.defaultCharWidth||12)+30;t.dlgWidth=o,t.dlgWidth<150&&(t.dlgWidth=150),t.dlgWidth>500&&(t.dlgWidth=500),t.panel.innerHTML="";var d=(t.dlgWidth-4,t.dlgHeight-4),u={type:"DBTable",dataset:i,readOnly:!0,noborder:!0,hasSelectCol:!1,hasSeqCol:!1,hideHead:!0};return u.onRowClick=t.confirmSelect,t.otable=jslet.ui.createControl(u,t.panel,"100%",d),t.otable.el.focus(),t.otable.el.style.border="0",t.panel},t.confirmSelect=function(){t.comboCfg._isSelecting=!0;var e=t.lkDataset.keyValue();if(e||0===e){t.dataset.setFieldValue(t.field,e,t.valueIndex);var l=t.dataset.getField(t.field),i=l.lookup(),a=i.returnFieldMap();if(a){var r=i.dataset();mainDs=t.dataset;var n,s;for(var n in a)s=a[n],mainDs.setFieldValue(n,r.getFieldValue(s))}t.comboCfg.el.focus()}t.comboCfg.afterSelect&&t.comboCfg.afterSelect(t.dataset,t.lkDataset),t.closePopup()},t.showPopup=function(e,l,i,a){t.panel||(t.panel=t.create()),t.comboCfg._isSelecting=!1,t.isPop=!0;var r=t.popup.getPopupPanel();r.style.padding="0",t.popup.setContent(t.panel),t.popup.onHidePopup=t.doClosePopup,t.popup.show(e,l,t.dlgWidth,t.dlgHeight,i,a)},t.doClosePopup=function(){t.isPop=!1;var e=t.lkDataset.recno()||0;try{t.lkDataset.filter(null)}finally{e>=0&&t.lkDataset.recno(e)}},t.closePopup=function(){t.popup.hide()},t.isShowing=function(){return t.popup?t.popup.isShowing:!1},t.destroy=function(){jQuery(t.panel).off(),t.otable.onRowClick=null,t.otable.destroy(),t.otable=null,t.panel=null,t.popup.destroy(),t.popup=null,t.comboCfg=null,t.dataset=null,t.field=null,t.lkDataset=null}},jslet.ui.register("DBAutoComplete",jslet.ui.DBAutoComplete),jslet.ui.DBAutoComplete.htmlTemplate='<input type="text"></input>',jslet.ui.DBBetweenEdit=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){this.allProperties="dataset,field",e(t,l)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this;e.renderAll()},refreshControl:function(e){},renderAll:function(){var e=this;e.removeAllChildControls(),jslet.ui.textMeasurer.setElement(e.el);var t=jslet.locale.Dataset.betweenLabel;t||(t="-"),t="&nbsp;"+t+"&nbsp;";var l=jslet.ui.textMeasurer.getWidth(t),i=['<table style="width:100%;margin:0px" cellspacing="0" cellpadding="0"><col /><col width="',l,'px" /><col /><tbody><tr><td></td><td>',t,"</td><td></td></tr></tbody></table>"];e.el.innerHTML=i.join("");var a=jQuery(e.el).find("td"),r=a[0],n=a[2],s=e._dataset.getField(e._field),o=s.editControl();o.dataset=e._dataset,o.field=e._field,o.valueIndex=0;var d=jslet.ui.createControl(o,r);d.el.style.width="98%",e.minElement=d,e.addChildControl(d),o.valueIndex=1,d=jslet.ui.createControl(o,n),d.el.style.width="98%",e.addChildControl(d)},focus:function(){this.minElement.focus()}}),jslet.ui.register("DBBetweenEdit",jslet.ui.DBBetweenEdit),jslet.ui.DBBetweenEdit.htmlTemplate="<div></div>",jslet.ui.DBCheckBox=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){var i=this;i.isCheckBox=!0,i.allProperties="dataset,field,beforeClick",i._beforeClick=null,i._skipRefresh=!1,e(t,l)},beforeClick:function(e){return void 0===e?this._beforeClick:(jslet.Checker.test("DBCheckBox.beforeClick",e).isFunction(),void(this._beforeClick=e))},isValidTemplateTag:function(e){return"input"==e.tagName.toLowerCase()&&"checkbox"==e.type.toLowerCase()},bind:function(){var e=this;e.renderAll();var t=jQuery(e.el);t.on("click",e._doClick),t.focus(function(l){t.trigger("editing",[e._field])}),t.addClass("checkbox-inline")},_doClick:function(e){var t=this.jslet,l=t.ctrlRecno();if(l>=0&&l!=t._dataset.recno()){t._skipRefresh=!0;try{t._dataset.recno(l)}finally{t._skipRefresh=!1}}if(t._beforeClick){var i=t._beforeClick.call(t,t.el);if(!i)return}t.updateToDataset()},doMetaChanged:function(e,t){e(t);var l=this,i=l._dataset.getField(l._field);if(!t||"disabled"==t||"readOnly"==t){var a=i.disabled()||i.readOnly();jslet.ui.setEditableStyle(l.el,a,a,!1,i.required()),l.setTabIndex()}t&&"tabIndex"!=t||l.setTabIndex()},doValueChanged:function(){var e=this;if(!e._skipRefresh){var t=(e._dataset.getField(e._field),e.getValue());t?e.el.checked=!0:e.el.checked=!1}},focus:function(){this.el.focus()},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},updateToDataset:function(){var e=this;if(!e._keep_silence_){var t=(e._dataset.getField(e._field),e.el.checked);e._keep_silence_=!0;try{e._dataset.setFieldValue(e._field,t,e._valueIndex)}finally{e._keep_silence_=!1}}},destroy:function(e){jQuery(this.el).off(),e()}}),jslet.ui.register("DBCheckBox",jslet.ui.DBCheckBox),jslet.ui.DBCheckBox.htmlTemplate='<input type="checkbox"></input>',jslet.ui.DBCheckBoxGroup=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,field,columnCount,hasSelectAllBox",i._columnCount=99999,i._itemIds=null,e(t,l)},columnCount:function(e){return void 0===e?this._columnCount:(jslet.Checker.test("DBCheckBoxGroup.columnCount",e).isGTEZero(),void(this._columnCount=parseInt(e)))},hasSelectAllBox:function(e){return void 0===e?this._hasSelectAllBox:void(this._hasSelectAllBox=e?!0:!1)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this;e.renderAll();var t=jQuery(e.el);t.on("click",'input[type="checkbox"]',function(e){var t=this;window.setTimeout(function(){e.delegateTarget.jslet.updateToDataset(t)},5)}),t.on("focus",'input[type="checkbox"]',function(l){t.trigger("editing",[e._field])}),t.addClass("form-control"),t.css("height","auto")},doMetaChanged:function(e,t){e(t);var l=this,i=l._dataset.getField(l._field);if(!t||"disabled"==t||"readOnly"==t||"tabIndex"==t){var a=i.disabled(),r=i.readOnly();a=a||r;for(var n,s=jQuery(l.el).find('input[type="checkbox"]'),o=i.tabIndex(),d=i.required(),u=0,c=s.length;c>u;u++)n=s[u],jslet.ui.setEditableStyle(n,a,r,!1,d),n.tabIndex=o}},doValueChanged:function(){var e=this;if(!e._keep_silence_){var t,l,i=jQuery(e.el).find('input[type="checkbox"]'),a=i.length;for(l=0;a>l;l++)t=i[l],jQuery(t).hasClass("jl-selectall")||(t.checked=!1);var r=e.getValue();if(r&&r.length>0){var n,s=r.length;for(l=0;a>l;l++){t=i[l];for(var o=0;s>o;o++)n=r[o],n==t.value&&(t.checked=!0)}}}},doLookupChanged:function(){var e=this,t=e._dataset.getField(e._field),l=t.lookup();if(!l)return void console.error(jslet.formatString(jslet.locale.Dataset.lookupNotFound,[t.name()]));t.valueStyle()!=jslet.data.FieldValueStyle.MULTIPLE&&t.valueStyle(jslet.data.FieldValueStyle.MULTIPLE);var i=l.dataset(),a=i.recordCount();if(0===a)return void(e.el.innerHTML=jslet.locale.DBCheckBoxGroup.noOptions);e._itemIds=[];var r=['<table cellpadding="0" cellspacing="0">'],n=!1,s=l.editFilter();e._innerEditFilterExpr=null;var o=l.editItemDisabled();s&&(e._innerEditFilterExpr=new jslet.Expression(i,s));var d=!1,u=jslet.nextId(),c=-1;e._hasSelectAllBox&&a>0&&(r.push("<tr>"),u=jslet.nextId(),r.push('<td style="white-space: nowrap; "><input type="checkbox" class="jl-selectall"'),r.push(' id="'),r.push(u),r.push('"/><label for="'),r.push(u),r.push('">'),r.push(jslet.locale.DBCheckBoxGroup.selectAll),r.push("</label></td>"),c=0);var h=i.recnoSilence();try{for(var f=0;a>f;f++){if(i.recnoSilence(f),d=!1,e._innerEditFilterExpr&&!e._innerEditFilterExpr.eval()){if(!o)continue;d=!0}c++,n=c%e._columnCount===0,n&&(c>0&&r.push("</tr>"),r.push("<tr>")),u=jslet.nextId(),r.push('<td style="white-space: nowrap; "><input type="checkbox" value="'),r.push(i.getFieldValue(l.keyField())),r.push('" id="'),r.push(u),r.push('" '+(d?" disabled":"")+'/><label for="'),r.push(u),r.push('">'),r.push(l.getCurrentDisplayValue()),r.push("</label></td>"),n=c%e._columnCount===0}a>0&&r.push("</tr>"),r.push("</table>"),e.el.innerHTML=r.join("")}finally{i.recnoSilence(h)}},updateToDataset:function(e){var t=this;if(!t._is_silence_){var l,i=jQuery(t.el).find('input[type="checkbox"]');if(jQuery(e).hasClass("jl-selectall"))for(var a=e.checked,r=0,n=i.length;n>r;r++)l=i[r],l!=e&&(l.disabled||(l.checked=a));for(var s=t._dataset.getField(t._field),o=s.valueCountLimit(),d=[],u=0,r=0,n=i.length;n>r;r++)l=i[r],jQuery(l).hasClass("jl-selectall")||l.checked&&(d.push(l.value),u++);if(o&&u>o)return e.checked=!e.checked,void jslet.showInfo(jslet.formatString(jslet.locale.DBCheckBoxGroup.invalidCheckedCount,[""+o]));t._is_silence_=!0;try{t._dataset.setFieldValue(t._field,d)}finally{t._is_silence_=!1}}},focus:function(){_itemIds&&_itemIds.length>0&&document.getElementById(_itemIds[0]).focus()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-checkboxgroup")||t.addClass("jl-checkboxgroup"),e.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},destroy:function(e){var t=jQuery(this.el);t.off(),e()}}),jslet.ui.register("DBCheckBoxGroup",jslet.ui.DBCheckBoxGroup),jslet.ui.DBCheckBoxGroup.htmlTemplate="<div></div>",jslet.ui.DBComboSelect=jslet.Class.create(jslet.ui.DBCustomComboBox,{showStyles:["auto","table","tree"],initialize:function(e,t,l){var i=this;i.allProperties="dataset,field,textField,searchField,popupHeight,popupWidth,showStyle,textReadOnly,onGetSearchField,correlateCheck",i._textField=null,i._showStyle="auto",i._popupWidth=300,i._popupHeight=300,i._contentPanel=null,i._pickupField=null,i._onGetSearchField=null,i._correlateCheck=!1,e(t,l)},textField:function(e){return void 0===e?this._textField:(jslet.Checker.test("DBComboSelect.textField",e).required().isString(),void(this._textField=e.trim()))},popupHeight:function(e){return void 0===e?this._popupHeight:(jslet.Checker.test("DBComboSelect.popupHeight",e).isGTEZero(),void(this._popupHeight=parseInt(e)))},popupWidth:function(e){return void 0===e?this._popupWidth:(jslet.Checker.test("DBComboSelect.popupWidth",e).isGTEZero(),void(this._popupWidth=parseInt(e)))},showStyle:function(e){if(void 0===e)return this._showStyle;e=jQuery.trim(e);var t=jslet.Checker.test("DBComboSelect.showStyle",e).isString();e=e.toLowerCase(),t.testValue(e).inArray(this.showStyles),this._showStyle=e},onGetSearchField:function(e){return void 0===e?this._onGetSearchField:void(this._onGetSearchField=e)},correlateCheck:function(e){return void 0===e?this._correlateCheck:void(this._correlateCheck=e)},isValidTemplateTag:function(e){return!0},afterBind:function(e){e(),this._contentPanel&&(this._contentPanel=null)},buttonClick:function(e){var t=this,l=t.el,i=t._dataset.getField(t._field),a=i.lookup(),r=jQuery(l);if(!i.readOnly()&&!i.disabled()){if(null===a&&void 0===a)throw new Error(t._field+" is NOT a lookup field!");var n=t._showStyle;"auto"==t._showStyle&&(n=a.parentField()?"tree":"table"),t._contentPanel||(t._contentPanel=new jslet.ui.DBComboSelectPanel(t),t._contentPanel.showStyle=n,t._contentPanel.customButtonLabel=t.customButtonLabel,t._contentPanel.onCustomButtonClick=t.onCustomButtonClick,t._popupWidth&&(t._contentPanel.popupWidth=t._popupWidth),t._popupHeight&&(t._contentPanel.popupHeight=t._popupHeight)),jslet.ui.PopupPanel.excludedElement=e;var s=r.offset(),o=r.outerHeight(),d=s.left,u=s.top+o;jslet.locale.isRtl&&(d+=r.outerWidth()),t._contentPanel.showPopup(d,u,0,o)}},closePopup:function(){this._contentPanel&&this._contentPanel.closePopup(),this._contentPanel=null},destroy:function(e){var t=this;t._contentPanel&&(t._contentPanel.destroy(),t._contentPanel=null),jslet.ui.PopupPanel.excludedElement=null,e()}}),jslet.ui.DBComboSelectPanel=function(e){var t=this;t.showStyle="auto",t.customButtonLabel=null,t.onCustomButtonClick=null,t.popupWidth=350,t.popupHeight=350;t.comboSelectObj=e,t.dataset=e._dataset,t.field=e._field,t.fieldObject=t.dataset.getField(t.field),t.panel=null,t.searchBoxEle=null,t.popup=new jslet.ui.PopupPanel,t.popup.onHidePopup=function(){t.comboSelectObj.focus()}},jslet.ui.DBComboSelectPanel.prototype={lookupDs:function(){return this.fieldObject.lookup().dataset()},isMultiple:function(){return this.fieldObject.valueStyle()==jslet.data.FieldValueStyle.MULTIPLE},showPopup:function(e,t,l,i){var a=this;a._initSelected();var r=a.showStyle.toLowerCase();if(a.panel){var n=a.otree?a.otree:a.otable;n.dataset().addLinkedControl(n),window.setTimeout(function(){n.renderAll()},1)}else a.panel=a._create();if("table"==r){for(var s,o=a.lookupDs().getNormalFields(),d=0,u=0,c=o.length;c>u;u++)s=o[u],s.visible()&&(d+=s.displayWidth());var h=d*(jslet.global.defaultCharWidth||12)+40;a.popupWidth=h,a.popupWidth<150&&(a.popupWidth=150),a.popupWidth>500&&(a.popupWidth=500)}a.popup.setContent(a.panel,"100%","100%"),a.popup.show(e,t,a.popupWidth,a.popupHeight,l,i),jQuery(a.panel).find(".jl-combopnl-head input").focus()},closePopup:function(){var e=this,t=e.dataset.getField(e.field),l=t.lookup();e.isMultiple()&&l.onlyLeafLevel()&&e.lookupDs().onCheckSelectable(null),e.popup.hide();var i=e.otree?e.otree:e.otable;i&&i.dataset().removeLinkedControl(i)},_create:function(){var e=this;e.panel||(e.panel=document.createElement("div"));var t=e.dataset.getField(e.field),l=t.lookup(),i=(l.parentField(),e.showStyle.toLowerCase()),a=e.lookupDs(),r=['<div class="jl-combopnl-head"><div class="col-xs-12 jl-nospacing">','<input class="form-control" type="text" size="20"></input></div></div>','<div class="jl-combopnl-content',e.isMultiple()?" jl-combopnl-multiselect":"",'"></div>','<div class="jl-combopnl-footer" style="display:none"><button class="jl-combopnl-footer-cancel btn btn-default btn-sm" >',jslet.locale.MessageBox.cancel,'</button><button class="jl-combopnl-footer-ok btn btn-default btn-sm" >',jslet.locale.MessageBox.ok,"</button></div>"];e.panel.innerHTML=r.join("");var n=jQuery(e.panel),s=n.find(".jl-combopnl-head");n.on("keydown",function(t){27===t.keyCode&&e.closePopup()}),e.searchBoxEle=s.find("input")[0],jQuery(e.searchBoxEle).on("keydown",jQuery.proxy(e._findData,e));var o=n.find(".jl-combopnl-content");if(e.isMultiple()){o.addClass("jl-combopnl-content-nofooter").removeClass("jl-combopnl-content-nofooter");var d=n.find(".jl-combopnl-footer")[0];d.style.display="block";var u=jQuery(d);u.find(".jl-combopnl-footer-cancel").click(jQuery.proxy(e.closePopup,e)),u.find(".jl-combopnl-footer-ok").click(jQuery.proxy(e._confirmSelect,e))}else o.addClass("jl-combopnl-content-nofooter");var c=o[0];if("tree"==i){var h={type:"DBTreeView",dataset:a,readOnly:!1,displayFields:l.displayFields(),hasCheckBox:e.isMultiple()};e.isMultiple()||(h.onItemDblClick=jQuery.proxy(e._confirmSelect,e)),h.correlateCheck=e.comboSelectObj.correlateCheck(),window.setTimeout(function(){e.otree=jslet.ui.createControl(h,c,"100%","100%")},1)}else{var f={type:"DBTable",dataset:a,readOnly:!0,hasSelectCol:e.isMultiple(),hasSeqCol:!1,hasFindDialog:!1};e.isMultiple()||(f.onRowDblClick=jQuery.proxy(e._confirmSelect,e)),window.setTimeout(function(){e.otable=jslet.ui.createControl(f,c,"100%","100%")},1)}return e.panel},_initSelected:function(){var e=this,t=e.comboSelectObj.getValue(),l=e.lookupDs(),i=e.dataset.getField(e.field),a=i.lookup();if(a.onlyLeafLevel()&&l.onCheckSelectable(function(){return!this.hasChildren()}),!e.isMultiple())return void(t&&l.findByKey(t));if(l.selectAll(!1),t){var r=t;jslet.isArray(t)||(r=t.split(jslet.global.valueSeparator));for(var n=0,s=r.length;s>n;n++)l.selectByKeyValue(!0,r[n])}},_findData:function(e){if(e=jQuery.event.fix(e||window.event),13==e.which){var t=this,l=t.comboSelectObj.searchField,i=this.searchBoxEle.value;if(i){var a=jslet.getFunction(t.comboSelectObj.onGetSearchField);a&&(l=a.call(i));var r=null;if(l)r=l.split(",");else{var n=t.fieldObject.lookup(),s=n.codeField(),o=n.nameField();r=[],s&&r.push(s),o&&s!=o&&r.push(o)}if(!r||0===r.length)return void console.warn("Search field NOT specified! Can't search data!");for(var d,u=t.lookupDs(),c=0,h=r.length;h>c;c++){if(l=r[c],d=u.getField(l),!d)return void console.warn("Field Name: "+l+" NOT exist!");if(u.find("like(["+l+'],"%'+i+'%")'))break}}}},_confirmSelect:function(){var e=this,t=e.comboSelectObj.getValue(),l=e.dataset.getField(e.field),i=l.lookup(),a=e.isMultiple(),r=e.lookupDs();if(r.checkSelectable()){if(t=a?r.selectedKeyValues():r.keyValue(),e.dataset.setFieldValue(e.field,t,e._valueIndex),!a&&e.comboSelectObj._afterSelect&&e.comboSelectObj._afterSelect(e.dataset,r),!a){var n=i.returnFieldMap();if(n){var s,o;e.dataset;for(var s in n)o=n[s],e.dataset.setFieldValue(s,r.getFieldValue(o))}}e.closePopup()}},destroy:function(){var e=this;e.otree&&(e.otree.destroy(),e.otree=null),e.otable&&(e.otable.destroy(),e.otable=null),e.comboSelectObj=null;var t=jQuery(e.panel),l=t.find(".jl-combopnl-footer");l.find(".jl-combopnl-footer-cancel").off(),l.find(".jl-combopnl-footer-ok").off(),jQuery(e.searchBoxEle).off(),e.fieldObject=null,e.searchBoxEle=null,e.popup=null,e.panel=null}},jslet.ui.register("DBComboSelect",jslet.ui.DBComboSelect),jslet.ui.DBComboSelect.htmlTemplate="<div></div>",jslet.ui.DBCustomComboBox=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,field,textReadOnly",i._textReadOnly=!1,i.enableInvalidTip=!1,e(t,l)},textReadOnly:function(e){return void 0===e?this._textReadOnly:void(this._textReadOnly=e?!0:!1)},afterBind:function(e){e(),this._textReadOnly&&(this.el.childNodes[0].readOnly=!0)},ctrlRecno:function(e,t){var l=e(t);return void 0!==t&&this.textCtrl.ctrlRecno(t),l},bind:function(){var e=this,t=jQuery(e.el);t.hasClass("input-group")||t.addClass("input-group");var l=e.comboButtonCls?e.comboButtonCls:"fa-caret-down",i='<input type="text" class="form-control"><div class="jl-comb-btn-group"><button class="btn btn-default btn-sm" tabindex="-1"><i class="fa '+l+'"></i></button></div>';t.html(i);var a=t.find('[type="text"]')[0];e.textCtrl=new jslet.ui.DBText(a,{type:"dbtext",dataset:e._dataset,field:e._textField||e._field,enableInvalidTip:!0,valueIndex:e._valueIndex}),jQuery(e.textCtrl.el).on("keydown",this.popupUp),e.addChildControl(e.textCtrl);var r=t.find("button");this.buttonClick&&(r.on("click",function(t){e.buttonClick(r[0])}),r.on("focus",function(l){t.trigger("editing",[e._field])}))},renderAll:function(){this.refreshControl()},popupUp:function(e){if(e.keyCode==jslet.ui.KeyCode.DOWN){var t=jslet(this);if(t.ctrlRecno()<0){t.doBlur(e);var l=jslet.ui.findJsletParent(this.parentNode);l.jslet.buttonClick()}}},focus:function(){this.textCtrl.focus()},forceRefreshControl:function(){this.textCtrl.forceRefreshControl()},doMetaChanged:function(e,t){e(t);var l=this;if(!t||"disabled"==t||"readOnly"==t){var i=l._dataset.getField(l._field),a=i.disabled()||i.readOnly(),r=jQuery(l.el);r.find("button").attr("disabled",a)}t&&"tabIndex"!=t||l.setTabIndex()},setTabIndex:function(e){var t=this;t.inTableCtrl()||(0===e||e||(fldObj=t._dataset.getField(t._field),fldObj&&(e=fldObj.tabIndex())),(0===e||e)&&(t.textCtrl.el.tabIndex=e))},destroy:function(e){var t=this,l=t.el.childNodes[1];l.onclick=null,jQuery(t.textCtrl.el).off("keydown",this.popupUp),t.textCtrl.destroy(),t.textCtrl=null,e()}}),jslet.ui.DBDataLabel=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){this.allProperties="dataset,field",e(t,l)},bind:function(){this.renderAll(),jQuery(this.el).addClass("form-control-static jl-datalabel")},isValidTemplateTag:function(e){return"label"==e.tagName.toLowerCase()},doValueChanged:function(){var e=this,t=(e._dataset.getField(e._field),e.getText());e.el.innerHTML=t,e.el.title=t},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)}}),jslet.ui.register("DBDataLabel",jslet.ui.DBDataLabel),jslet.ui.DBDataLabel.htmlTemplate="<label></label>",jslet.ui.DBDatePicker=jslet.Class.create(jslet.ui.DBCustomComboBox,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,field,textReadOnly,popupWidth, popupHeight",i._popupWidth=260,i._popupHeight=226,i.popup=new jslet.ui.PopupPanel,i.popup.onHidePopup=function(){i.focus()},i.comboButtonCls="fa-calendar",e(t,l)},popupHeight:function(e){return void 0===e?this._popupHeight:(jslet.Checker.test("DBDatePicker.popupHeight",e).isGTEZero(),void(this._popupHeight=parseInt(e)))},popupWidth:function(e){return void 0===e?this._popupWidth:(jslet.Checker.test("DBDatePicker.popupWidth",e).isGTEZero(),void(this._popupWidth=parseInt(e)))},isValidTemplateTag:function(e){return!0},buttonClick:function(e){var t=this.el,l=this,i=l._dataset.getField(l._field),a=jQuery(t);if(!i.readOnly()&&!i.disabled()){var r=l._popupWidth,n=l._popupHeight,s=l.getValue(),o=i.dataRange(),d=null,u=null;o&&(o.min&&(d=o.min),o.max&&(u=o.max)),l.contentPanel||(l.contentPanel=jslet.ui.createControl({type:"Calendar",value:s,minDate:d,maxDate:u,onDateSelected:function(e){l.popup.hide(),l.el.focus();var t=l.getValue();t?(t.setFullYear(e.getFullYear()),t.setMonth(e.getMonth()),t.setDate(e.getDate())):t=e,l._dataset.setFieldValue(l._field,new Date(t.getTime()),l._valueIndex)}},null,r+"px",n+"px",!0)),jslet.ui.PopupPanel.excludedElement=e;var c=a.offset(),h=a.outerHeight(),f=c.left,v=c.top+h;jslet.locale.isRtl&&(f+=a.outerWidth()),l.popup.setContent(l.contentPanel.el,"100%","100%"),l.contentPanel.el.style.display="block",l.contentPanel.setValue(s),l.popup.show(f,v,r+3,n+3,0,h),l.contentPanel.focus()}},destroy:function(e){var t=this;t.contentPanel&&(t.contentPanel.destroy(),t.contentPanel=null),t.popup.destroy(),t.popup=null,e()}}),jslet.ui.register("DBDatePicker",jslet.ui.DBDatePicker),jslet.ui.DBDatePicker.htmlTemplate="<div></div>",jslet.ui.DBHtml=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){this.allProperties="dataset,field",e(t,l)},bind:function(){this.renderAll(),jQuery(this.el).addClass("form-control")},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},doValueChanged:function(){var e=this.getText();this.el.innerHTML=e},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)}}),jslet.ui.register("DBHtml",jslet.ui.DBHtml),jslet.ui.DBHtml.htmlTemplate='<div style="width:200px;height:200px"></div>',jslet.ui.DBImage=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,field,locked,baseUrl,altField",i._locked=!1,i._baseUrl=null,i._altField=null,e(t,l)},baseUrl:function(e){return void 0===e?this._baseUrl:(e=jQuery.trim(e),jslet.Checker.test("DBImage.baseUrl",e).isString(),void(this._baseUrl=e))},altField:function(e){return void 0===e?this._altField:(e=jQuery.trim(e),jslet.Checker.test("DBImage.altField",e).isString(),void(this._altField=e))},locked:function(e){return void 0===e?this._locked:void(this._locked=e)},isValidTemplateTag:function(e){return"img"==e.tagName.toLowerCase()},bind:function(){this.renderAll(),jQuery(this.el).addClass("img-responsive img-rounded")},doValueChanged:function(){var e=this;e._dataset.getField(e._field);if(e._locked)return e.el.alt=jslet.locale.DBImage.lockedImageTips,void(e.el.src="");var t=e.getValue();if(t?e._baseUrl&&(t=e._baseUrl+t):t="",e.el.src!=t){var l=t;if(e._altField){var i=e.ctrlRecno();l=0>i?e._dataset.getFieldText(e._altField):e._dataset.getFieldTextByRecno(i,e._altField)}e.el.alt=l,e.el.src=t}},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)}}),jslet.ui.register("DBImage",jslet.ui.DBImage),jslet.ui.DBImage.htmlTemplate="<img></img>",jslet.ui.DBLabel=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){this.allProperties="dataset,field",this.isLabel=!0,e(t,l)},bind:function(){jQuery(this.el).addClass("control-label"),this.renderAll()},isValidTemplateTag:function(e){return"label"==e.tagName.toLowerCase()},doMetaChanged:function(e){if(!(e&&jslet.ui.DBLabel.METANAMES.indexOf(e)<0)){var t=this,l=t._fieldMeta,i=t._dataset.getField(t._field),a="";if(!i)throw new Error("Field: "+this._field+" NOT exist!");if(!(l&&"label"!=l||e&&"label"!=e&&"required"!=e))return i.required()&&(a+='<span class="jl-lbl-required">'+jslet.ui.DBLabel.REQUIREDCHAR+"</span>"),a+=i.label(),void(t.el.innerHTML=a||"");if(l&&"tip"==l&&(!e||e==l))return a=i.tip(),void(t.el.innerHTML=a||"");if(l&&"error"==l&&e&&e==l){var r=t.getFieldError(),a=r&&r.message;return void(t.el.innerHTML=a||"")}}},renderAll:function(){var e=jQuery(this.el),t=this.fieldMeta();
this.refreshControl(jslet.data.RefreshEvent.updateAllEvent()),"error"==t?e.hasClass("jl-lbl-error")||e.addClass("jl-lbl-error"):"tip"==t?e.hasClass("jl-lbl-tip")||e.addClass("jl-lbl-tip"):e.hasClass("jl-lbl")||e.addClass("jl-lbl")}}),jslet.ui.DBLabel.REQUIREDCHAR="*",jslet.ui.DBLabel.METANAMES=["label","required","tip","error"],jslet.ui.register("DBLabel",jslet.ui.DBLabel),jslet.ui.DBLabel.htmlTemplate="<label></label>",jslet.ui.DBLookupLabel=jslet.Class.create(jslet.ui.DBControl,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,lookupField,returnField,lookupValue",i.requiredProperties="lookupValue,lookupField,returnField",i.lookupField,i.lookupValue,i.returnField,e(t,l)},bind:function(){this.renderAll(),jQuery(this.el).addClass("form-control")},isValidTemplateTag:function(e){return"label"==e.tagName.toLowerCase()},refreshControl:function(e,t){if(e.eventType==jslet.data.RefreshEvent.UPDATEALL&&(t||l.isActiveRecord())){var l=this,i=l.dataset.lookup(l.lookupField,l.lookupValue,l.returnField);null==i&&(i="NOT found: "+l.lookupValue),l.el.innerHTML=i}},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent,!0)}}),jslet.ui.register("DBLookupLabel",jslet.ui.DBLookupLabel),jslet.ui.DBLookupLabel.htmlTemplate="<label></label>",jslet.ui.DBPlace=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){this.allProperties="dataset,field",this.editControl=null,e(t,l)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this;e.renderAll()},refreshControl:function(e){var t=this,l=e.eventType;return l==jslet.data.RefreshEvent.CHANGEMETA&&t._field==e.fieldName&&"editControl"==e.metaName?(t.renderAll(),!0):void 0},renderAll:function(){var e=this;e.removeAllChildControls();var t=e._dataset.getField(e._field),l=t.editControl();l.dataset=e._dataset,l.field=e._field;var i=jslet.ui.createControl(l,e.el);i.el.style.width="100%",e.addChildControl(i)}}),jslet.ui.register("DBPlace",jslet.ui.DBPlace),jslet.ui.DBPlace.htmlTemplate="<div></div>",jslet.ui.DBRadioGroup=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,field,columnCount",i._columnCount=99999,i._itemIds=null,e(t,l)},columnCount:function(e){return void 0===e?this._columnCount:(jslet.Checker.test("DBRadioGroup.columnCount",e).isGTEZero(),void(this._columnCount=parseInt(e)))},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this;e.renderAll();var t=jQuery(e.el);t.on("click",'input[type="radio"]',function(e){var t=this;window.setTimeout(function(){e.delegateTarget.jslet.updateToDataset(t)},5)}),t.on("focus",'input[type="radio"]',function(l){t.trigger("editing",[e._field])}),t.addClass("form-control"),t.css("height","auto")},doMetaChanged:function(e,t){e(t);var l=this,i=l._dataset.getField(l._field);if(!t||"disabled"==t||"readOnly"==t||"tabIndex"==t){var a=i.disabled(),r=i.readOnly();l.disabled=a||r,a=l.disabled;for(var n,s=jQuery(l.el).find('input[type="radio"]'),o=i.required(),d=i.tabIndex(),u=0,c=s.length;c>u;u++)n=s[u],jslet.ui.setEditableStyle(n,a,r,!1,o),n.tabIndex=d}},doValueChanged:function(){var e=this;if(!e._keep_silence_)for(var t,l=e.getValue(),i=jQuery(e.el).find('input[type="radio"]'),a=0,r=i.length;r>a;a++)t=i[a],t.checked=l==jQuery(t.parentNode).attr("value")},doLookupChanged:function(){var e=this,t=e._dataset.getField(e._field),l=t.lookup();if(!l)return void console.error(jslet.formatString(jslet.locale.Dataset.lookupNotFound,[t.name()]));var i=l.dataset(),a=i.recordCount();if(0===a)return void(e.el.innerHTML=jslet.locale.DBRadioGroup.noOptions);var r=i.recno();try{var n,s=['<table cellpadding="0" cellspacing="0">'],o=!1,d=l.editFilter();e._innerEditFilterExpr=null;var u=l.editItemDisabled();d&&(e._innerEditFilterExpr=new jslet.Expression(i,d));var c=!1,h=-1;e._itemIds=[];for(var f=0;a>f;f++){if(i.recnoSilence(f),c=!1,e._innerEditFilterExpr&&!e._innerEditFilterExpr.eval()){if(!u)continue;c=!0}h++,o=h%e._columnCount===0,o&&(h>0&&s.push("</tr>"),s.push("<tr>")),n=jslet.nextId(),e._itemIds.push(n),s.push('<td style="white-space: nowrap" value="'),s.push(i.getFieldValue(l.keyField())),s.push('"><input name="'),s.push(e._field),s.push('" type="radio"  id="'),s.push(n),s.push('" '+(c?" disabled":"")+'/><label for="'),s.push(n),s.push('">'),s.push(l.getCurrentDisplayValue()),s.push("</label></td>")}a>0&&s.push("</tr>"),s.push("</table>"),e.el.innerHTML=s.join("")}finally{i.recnoSilence(r)}},updateToDataset:function(e){var t=this;if(!t._keep_silence_&&!t.disabled){t._keep_silence_=!0;try{t._dataset.setFieldValue(t._field,jQuery(e.parentNode).attr("value")),e.checked=!0}finally{t._keep_silence_=!1}}},focus:function(){_itemIds&&_itemIds.length>0&&document.getElementById(_itemIds[0]).focus()},renderAll:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-radiogroup")||t.addClass("jl-radiogroup"),e.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},destroy:function(e){var t=jQuery(this.el);t.off(),e()}}),jslet.ui.register("DBRadioGroup",jslet.ui.DBRadioGroup),jslet.ui.DBRadioGroup.htmlTemplate="<div></div>",jslet.ui.DBRangeSelect=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,field,beginItem,endItem,step",i.requiredProperties||(i.requiredProperties="field,beginItem,endItem,step"),i._beginItem=0,i._endItem=10,i._step=1,e(t,l)},beginItem:function(e){return void 0===e?this._beginItem:(jslet.Checker.test("DBRangeSelect.beginItem",e).isNumber(),void(this._beginItem=parseInt(e)))},endItem:function(e){return void 0===e?this._endItem:(jslet.Checker.test("DBRangeSelect.endItem",e).isNumber(),void(this._endItem=parseInt(e)))},step:function(e){return void 0===e?this._step:(jslet.Checker.test("DBRangeSelect.step",e).isNumber(),void(this._step=parseInt(e)))},isValidTemplateTag:function(e){return"select"==e.tagName.toLowerCase()},bind:function(){var e=this,t=e._dataset.getField(e._field),l=t.valueStyle();e.el.multiple&&l!=jslet.data.FieldValueStyle.MULTIPLE?t.valueStyle(jslet.data.FieldValueStyle.MULTIPLE):l!=jslet.data.FieldValueStyle.MULTIPLE||e.el.multiple||(e.el.multiple="multiple"),e.renderAll();var i=jQuery(e.el);i.on("change",e._doChanged),i.focus(function(t){i.trigger("editing",[e._field])}),e.el.multiple&&i.on("click","option",function(){e._currOption=this}),i.addClass("form-control")},_doChanged:function(e){var t=this.jslet;if(t.el.multiple){t.inProcessing&&(t.inProcessing=!1);var l=t._dataset.getField(t._field),i=l.valueCountLimit();if(i){var a=t.getValue(),r=1;if(jslet.isArray(a)&&(r=a.length),r>=i)return jslet.showInfo(jslet.formatString(jslet.locale.DBCheckBoxGroup.invalidCheckedCount,[""+i])),void window.setTimeout(function(){t._currOption&&(t.inProcessing=!0,t._currOption.selected=!1)},10)}}this.jslet.updateToDataset()},renderOptions:function(){var e=this,t=[],l=e._dataset.getField(e._field);l.required()||(t.push('<option value="_null_">'),t.push(l.nullText()),t.push("</option>"));for(var i=e._beginItem;i<=e._endItem;i+=e._step)t.push('<option value="'),t.push(i),t.push('">'),t.push(i),t.push("</option>");jQuery(e.el).html(t.join(""))},doMetaChanged:function(e,t){e(t);var l=this,i=l._dataset.getField(l._field);if(!t||"disabled"==t||"readOnly"==t){var a=i.disabled()||i.readOnly();l.el.disabled=a,jslet.ui.setEditableStyle(l.el,a,a,!0,i.required())}t&&"tabIndex"!=t||l.setTabIndex()},doValueChanged:function(){var e=this;if(!e._keep_silence_)if(e.el.multiple){var t,l,i,a=e.getValue(),r=e.el.options.length;e._keep_silence_=!0;try{for(i=0;r>i;i++)t=e.el.options[i],t&&(t.selected=!1);var n=a.length-1;for(i=0;r>i;i++)for(t=e.el.options[i],j=n;j>=0;j--)l=a[j]==t.value,l&&(t.selected=l)}finally{e._keep_silence_=!1}}else{var s=e.getValue();null!==s?e.el.value=s:e.el.value=null}},focus:function(){this.el.focus()},renderAll:function(){this.renderOptions(),this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},updateToDataset:function(){var e=this;if(!e._keep_silence_){var t,l=e.el.multiple;if(l){var i=jQuery(e.el).find("option"),a=i.length-1;t=[];for(var r=0;a>=r;r++)opt=i[r],opt.selected&&t.push(opt.value)}else{t=e.el.value;var n=e._dataset.getField(e._field);"_null_"!=t||n.required()||(t=null)}e._keep_silence_=!0;try{l?e._dataset.setFieldValue(e._field,t):e._dataset.setFieldValue(e._field,t,e._valueIndex)}finally{e._keep_silence_=!1}}},destroy:function(e){jQuery(this.el).off(),e()}}),jslet.ui.register("DBRangeSelect",jslet.ui.DBRangeSelect),jslet.ui.DBRangeSelect.htmlTemplate="<select></select>",jslet.ui.DBRating=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,field,itemCount,splitCountitemWidth",i._itemCount=5,i._splitCount=1,i._itemWidth=20,i._required=!1,i._readOnly=!1,e(t,l)},itemCount:function(e){return void 0===e?this._itemCount:(jslet.Checker.test("DBRating.itemCount",e).isGTZero(),void(this._itemCount=parseInt(e)))},splitCount:function(e){return void 0===e?this._splitCount:(jslet.Checker.test("DBRating.splitCount",e).isGTZero(),void(this._splitCount=parseInt(e)))},itemWidth:function(e){return void 0===e?this._itemWidth:(jslet.Checker.test("DBRating.itemWidth",e).isGTZero(),void(this._itemWidth=parseInt(e)))},isValidTemplateTag:function(e){return"div"==e.tagName.toLowerCase()},bind:function(){var e=this;e.renderAll();var t=jQuery(e.el);t.on("mousedown","td",e._mouseDown),t.on("mousemove","td",e._mouseMove),t.on("mouseout","td",e._mouseOut),t.on("mouseup","td",e._mouseUp)},_mouseMove:function(e){e=jQuery.event.fix(e||window.event);var t=e.delegateTarget,l=t.jslet;if(!l._readOnly)for(var i=jQuery(t),a=e.pageX-i.offset().left,r=(Math.ceil(a/l.splitWidth),t.firstChild.rows[0]),n=r.cells.length,s=this.cellIndex+1,o=0;n>o;o++){var d=r.cells[o];l._setBackgroundPos(d,l._getPosX(o%l._splitCount,s>o?1:2))}},_mouseOut:function(e){e=jQuery.event.fix(e||window.event);var t=e.delegateTarget.jslet;t._readOnly||t.doValueChanged()},_mouseDown:function(e){e=jQuery.event.fix(e||window.event);var t=e.delegateTarget,l=t.jslet;if(!l._readOnly){var i=t.firstChild.rows[0],a=(i.cells.length,this.cellIndex+1);l._required||1!=a||(a=l.value*l._splitCount==1?0:1),l.value=a/l._splitCount,l._dataset.setFieldValue(l._field,l.value,l._valueIndex),l.doValueChanged()}},_mouseUp:function(e){e=jQuery.event.fix(e||window.event);var t=e.delegateTarget,l=t.firstChild.rows[0],i=t.jslet;if(!i._readOnly&&i._selectedItem>=0){var a=l.cells[i._selectedItem];i._setBackgroundPos(a,i._selectedPx)}},_getPosX:function(e,t){var l,i=this,a=jslet.locale.isRtl;return l=0-t*i._itemWidth,a?l+=(e+1)*i.splitWidth-i._itemWidth:l-=e*i.splitWidth,l},_setBackgroundPos:function(e,t){void 0!==e.style.backgroundPositionX?e.style.backgroundPositionX=t+"px":e.style.backgroundPosition=t+"px 0px"},doMetaChanged:function(e,t){e(t);var l=this,i=l._dataset.getField(l._field);t&&"disabled"!=t&&"readOnly"!=t||(l._readOnly=i.disabled()||i.readOnly()),t&&"required"!=t||(l._required=i.required())},doValueChanged:function(){var e,t=this,l=(t._dataset.getField(t._field),t.getValue()),i=t._itemCount*t._splitCount,a=Math.ceil(l*t._splitCount),r=t.el.firstChild.rows[0];2*t._itemWidth,jslet.locale.isRtl;t.value=l;for(var n=0;i>n;n++)e=r.childNodes[n],t._setBackgroundPos(e,t._getPosX(n%t._splitCount,a>n?0:2))},renderAll:function(){var e=this,t=(e._dataset.getField(e._field),jQuery(e.el));t.hasClass("jl-rating")||t.addClass("jl-rating"),t.html('<table border="0" cellspacing="0" cellpadding="0" style="table-layout:fixed;border-collapse:collapse"><tr></tr></table>');var l,i=e._itemCount*e._splitCount,a=e.el.firstChild.rows[0];e.splitWidth=parseInt(e._itemWidth/e._splitCount);for(var r=1;i>=r;r++)l=document.createElement("td"),l.className="jl-rating-item",l.style.width=e.splitWidth+"px",l.style.height=e._itemWidth+"px",l.title=r/e._splitCount,a.appendChild(l);t.width(e._itemCount*e._itemWidth),e.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},destroy:function(e){var t=jQuery(Z.el);t.off(),e()}}),jslet.ui.DBRating.CHECKED=0,jslet.ui.DBRating.UNCHECKED=1,jslet.ui.DBRating.FOCUS=2,jslet.ui.register("DBRating",jslet.ui.DBRating),jslet.ui.DBRating.htmlTemplate="<Div></Div>",jslet.ui.DBSelect=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,field,groupField,lookupDataset",i._groupField=null,i._lookupDataset=null,i._enableInvalidTip=!0,i._innerEditFilterExpr,e(t,l)},groupField:function(e){return void 0===e?this._groupField:(e=jQuery.trim(e),jslet.Checker.test("DBSelect.groupField",e).isString(),void(this._groupField=e))},lookupDataset:function(e){return void 0===e?this._lookupDataset:(jslet.isString(e)&&(e=jslet.data.dataModule.get(jQuery.trim(e))),jslet.Checker.test("DBSelect.lookupDataset",e).isClass(jslet.data.Dataset.className),void(this._lookupDataset=e))},isValidTemplateTag:function(e){return"select"==e.tagName.toLowerCase()},bind:function(){var e=this,t=e._dataset.getField(e._field),l=t.valueStyle();e.el.multiple&&l!=jslet.data.FieldValueStyle.MULTIPLE?t.valueStyle(jslet.data.FieldValueStyle.MULTIPLE):l!=jslet.data.FieldValueStyle.MULTIPLE||e.el.multiple||(e.el.multiple="multiple"),e.renderAll();var i=jQuery(e.el);i.on("change",e._doChanged),i.on("mousedown",e._doMouseDown),i.focus(function(t){i.trigger("editing",[e._field])}),e.el.multiple&&i.on("click","option",e._doCheckLimitCount),i.addClass("form-control"),e.doMetaChanged("required")},_doMouseDown:function(e){var t=this.jslet,l=t.ctrlRecno();if(l>=0&&l!=t._dataset.recno()){t._skipRefresh=!0;try{t._dataset.recno(l)}finally{t._skipRefresh=!1}}},_doChanged:function(e){var t=this.jslet;if(t.el.multiple){t.inProcessing&&(t.inProcessing=!1);var l=t._dataset.getField(t._field),i=l.valueCountLimit();if(i){var a=t._dataset.getFieldValue(t._field),r=1;if(jslet.isArray(a)&&(r=a.length),r>=i)return jslet.showInfo(jslet.formatString(jslet.locale.DBCheckBoxGroup.invalidCheckedCount,[""+i])),void window.setTimeout(function(){t._currOption&&(t.inProcessing=!0,t._currOption.selected=!1)},10)}}this.jslet.updateToDataset()},_doCheckLimitCount:function(e){var t=e.delegateTarget.jslet;t._currOption=this},_setDefaultValue:function(e,t){if(t&&e.required()){var l=e.defaultValue();if(l){var i=e.lookup().dataset(),a=i.findByKey(l);if(a)return;l=null}l||e.defaultValue(t),this._dataset.changedStatus()&&!e.getValue()&&e.setValue(t)}},doLookupChanged:function(){var e=this,t=e._dataset.getField(e._field),l=t.lookup();if(e._lookupDataset)l=new jslet.data.FieldLookup,l.dataset(e._lookupDataset);else if(!l)return;var i,a,r,n=l.dataset(),s=!1;if(e._groupField){if(a=n.getField(e._groupField),null===a)throw"NOT found field: "+e._groupField+" in "+n.name();i=a.lookup(),s=null!==i,r=s?e._groupField+"."+i.codeField():e._groupField;var o=n.indexFields();o?n.indexFields(r+";"+o):n.indexFields(r)}var d,u,c=null,h=[];e.el.multiple||t.required()||(h.push('<option value="_null_">'),h.push(t.nullText()),h.push("</option>"));var f,v=n.recno(),p=null,_=l.editFilter();e._innerEditFilterExpr=null;var g=l.editItemDisabled();_&&(e._innerEditFilterExpr=new jslet.Expression(n,_));var m=!1;try{for(var j=0,C=n.recordCount();C>j;j++){if(n.recnoSilence(j),m=!1,e._innerEditFilterExpr&&!e._innerEditFilterExpr.eval()){if(!g)continue;m=!0}if(e._groupField&&(d=n.getFieldValue(e._groupField),d!=c)){if(null!==c&&h.push("</optgroup>"),s){if(!i.dataset().findByField(i.keyField(),d))throw"Not found: ["+d+"] in Dataset: ["+i.dataset().name()+"]field: ["+i.keyField()+"]";u=i.getCurrentDisplayValue()}else u=d;h.push('<optgroup label="'),h.push(u),h.push('">'),c=d}h.push('<option value="'),f=n.getFieldValue(l.keyField()),null===p&&(p=f),h.push(f),h.push('"'+(m?" disabled":"")+">"),h.push(l.getCurrentDisplayValue()),h.push("</option>")}null!==c&&h.push("</optgroup>"),jQuery(e.el).html(h.join("")),e._setDefaultValue(t,p),e.doValueChanged()}finally{n.recnoSilence(v)}},doMetaChanged:function(e,t){e(t);var l=this,i=l._dataset.getField(l._field);if(!t||"disabled"==t||"readOnly"==t){var a=i.disabled()||i.readOnly();l.el.disabled=a,jslet.ui.setEditableStyle(l.el,a,a,!0,i.required())}if(t&&"required"==t){var r=jQuery(l.el);i.required()?r.addClass("jl-ctrl-required"):r.removeClass("jl-ctrl-required")}t&&"tabIndex"!=t||l.setTabIndex()},doValueChanged:function(){var e=this;if(!e._skipRefresh){var t=e.getFieldError();if(t&&t.message)return e.el.value=t.inputText,void e.renderInvalid(t);e.renderInvalid(null);var l=e.getValue();if(e.el.multiple||l!==e.el.value){var i,a,r=e.el.options.length;for(a=0;r>a;a++)i=e.el.options[a],i&&(i.selected=!1);var n=e._dataset.getField(e._field);if(e.el.multiple){var s=l;if(null===s||0===s.length)return;var o,d=s.length-1;e._skipRefresh=!0;try{for(a=0;r>a;a++)for(i=e.el.options[a],j=d;j>=0;j--)o=s[j]==i.value,o&&(i.selected=o)}finally{e._skipRefresh=!1}}else e._checkOptionEditable(n,l)||(l=null),null===l&&(n.required()||(l="_null_")),e.el.value=l}}},_checkOptionEditable:function(e,t){var l=this;if(!l._innerEditFilterExpr||null===t||void 0===t||""===t)return!0;var i=e.lookup().dataset();return i.findByKey(t)&&!l._innerEditFilterExpr.eval()?!1:!0},focus:function(){this.el.focus()},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},updateToDataset:function(){var e=this;if(!e._skipRefresh){var t,l,i=e.el.multiple;if(i){var a=jQuery(e.el).find("option"),r=a.length-1;l=[];for(var n=0;r>=n;n++)t=a[n],t.selected&&l.push(t.value?t.value:t.innerHTML)}else l=e.el.value,l||(t=e.el.options[e.el.selectedIndex],l=t.innerHTML);e._skipRefresh=!0;try{if(i)e._dataset.setFieldValue(e._field,l);else{var s=e._dataset.getField(e._field);"_null_"!=l||s.required()||(l=null),e._dataset.setFieldValue(e._field,l,e._valueIndex);var o=s.lookup(),d=o.returnFieldMap();if(d){var u=o.dataset();if(mainDs=e._dataset,u.findByKey(l)){var c,h;for(var c in d)h=d[c],mainDs.setFieldValue(c,u.getFieldValue(h))}}}}finally{e._skipRefresh=!1}}},destroy:function(e){this._currOption=null,jQuery(this.el).off(),e()}}),jslet.ui.register("DBSelect",jslet.ui.DBSelect),jslet.ui.DBSelect.htmlTemplate="<select></select>",jslet.ui.DBSpinEdit=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,field,step",i._step=1,e(t,l)},step:function(e){return void 0===e?this._step:(jslet.Checker.test("DBSpinEdit.step",e).isNumber(),void(this._step=e))},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-spinedit")||t.addClass("input-group jl-spinedit"),e._createControl(),e.renderAll()},_createControl:function(){var e=this,t=jQuery(e.el),l='<input type="text" class="form-control"><div class="jl-spinedit-btn-group"><button class="btn btn-default jl-spinedit-up" tabindex="-1"><i class="fa fa-caret-up"></i></button><button class="btn btn-default jl-spinedit-down" tabindex="-1"><i class="fa fa-caret-down"></i></button>';t.html(l);var i=t.find("input")[0],a=t.find(".jl-spinedit-up")[0],r=t.find(".jl-spinedit-down")[0];e.editor=i,jQuery(e.editor).on("keydown",function(t){if(!e._isDisabled()){var l=t.keyCode;return l==jslet.ui.KeyCode.UP?(e.decValue(),void t.preventDefault()):l==jslet.ui.KeyCode.DOWN?(e.incValue(),void t.preventDefault()):void 0}}),new jslet.ui.DBText(i,{dataset:e._dataset,field:e._field,beforeUpdateToDataset:e.beforeUpdateToDataset,valueIndex:e._valueIndex}),jQuery(a).on("click",function(){e.incValue()}),jQuery(a).on("focus",function(){t.trigger("editing",[e._field])}),jQuery(r).on("click",function(){e.decValue()}),jQuery(r).on("focus",function(){t.trigger("editing",[e._field])})},setTabIndex:function(e){var t=this;t.inTableCtrl()||(0===e||e||(fldObj=t._dataset.getField(t._field),fldObj&&(e=fldObj.tabIndex())),(0===e||e)&&(t.textCtrl.el.tabIndex=e))},_isDisabled:function(){var e=this,t=e._dataset.getField(e._field);return t.disabled()||t.readOnly()},beforeUpdateToDataset:function(){var e=this,t=e.el.value,l=e._dataset.getField(e._field),i=l.dataRange(),a=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;return i&&(i.min&&(a=parseFloat(i.min)),i.max&&(r=parseFloat(i.max))),t&&(t=parseFloat(t)),jQuery(e.el).attr("aria-valuenow",t),e.el.value=t,!0},setValueToDataset:function(e){var t=this;if(!t.silence){t.silence=!0,void 0===e&&(e=t.value);try{t._dataset.setFieldValue(t._field,e,t._valueIndex)}finally{t.silence=!1}}},incValue:function(){var e=this,t=e.getValue();t||(t=0);var l=e._getRange().maxValue;t!=l&&(l>t?t+=e._step:t=l,t>l&&(value=l),jQuery(e.el).attr("aria-valuenow",t),e.setValueToDataset(t))},_getRange:function(){var e=this,t=e._dataset.getField(e._field),l=t.dataRange(),i=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY;return l&&(l.min&&(i=parseFloat(l.min)),l.max&&(a=parseFloat(l.max))),{minValue:i,maxValue:a}},decValue:function(){var e=this,t=e.getValue();t||(t=0);var l=e._getRange().minValue;t!=l&&(t>l?t-=e._step:t=l,l>t&&(t=l),jQuery(e.el).attr("aria-valuenow",t),e.setValueToDataset(t))},focus:function(){Z._isDisabled()||this.editor.focus()},doMetaChanged:function(e,t){e(t);var l=this,i=jQuery(this.el),a=l._dataset.getField(l._field);if(!t||"disabled"==t||"readOnly"==t){var r=a.disabled()||a.readOnly(),n=i.find(".jl-spinedit-up"),s=i.find(".jl-spinedit-down");r?(n.attr("disabled","disabled"),s.attr("disabled","disabled")):(n.attr("disabled",!1),s.attr("disabled",!1))}t&&"dataRange"!=t||(range=a.dataRange(),i.attr("aria-valuemin",range&&(range.min||0===range.min)?range.min:""),i.attr("aria-valuemin",range&&(range.max||0===range.max)?range.max:"")),t&&"tabIndex"!=t||l.setTabIndex()},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},destroy:function(){var e=jQuery(this.el);jQuery(this.editor).off(),this.editor=null,e.find(".jl-upbtn-up").off(),e.find(".jl-downbtn-up").off()}}),jslet.ui.register("DBSpinEdit",jslet.ui.DBSpinEdit),jslet.ui.DBSpinEdit.htmlTemplate="<div></div>",jslet.ui.DBText=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,field,beforeUpdateToDataset,enableInvalidTip,onKeyDown,autoSelectAll",i._beforeUpdateToDataset=null,i._enableInvalidTip=!0,i._enterProcessed=!1,i._autoSelectAll=!0,i.oldValue=null,i.editMask=null,i._position,e(t,l)},beforeUpdateToDataset:function(e){return void 0===e?this._beforeUpdateToDataset:(jslet.Checker.test("DBText.beforeUpdateToDataset",e).isFunction(),void(this._beforeUpdateToDataset=e))},enableInvalidTip:function(e){return void 0===e?this._enableInvalidTip:void(this._enableInvalidTip=e?!0:!1)},autoSelectAll:function(e){return void 0===e?this._autoSelectAll:void(this._autoSelectAll=e?!0:!1)},isValidTemplateTag:function(e){return"input"==e.tagName.toLowerCase()&&"text"==e.type.toLowerCase()},bind:function(){var e=this;e.renderAll();var t=jQuery(e.el);t.addClass("form-control"),e.doFocus&&t.on("focus",jQuery.proxy(e.doFocus,e)),e.doBlur&&t.on("blur",jQuery.proxy(e.doBlur,e)),e.doKeydown&&t.on("keydown",e.doKeydown),e.doKeypress&&t.on("keypress",e.doKeypress),e.doMetaChanged("required")},doFocus:function(){var e=this;if(!e._skipFocusEvent){var t=e.ctrlRecno();t>=0&&t!=e._dataset.recno()&&!e._dataset.recno(t)||(e.doValueChanged(),e.oldValue=e.el.value,e._autoSelectAll&&jslet.ui.textutil.selectText(e.el),jQuery(e.el).trigger("editing",[e._field]))}},doBlur:function(){var e=this,t=e._dataset.getField(e._field);if(e._position=jslet.ui.textutil.getCursorPos(e.el),!t.readOnly()&&!t.disabled()){var l=jQuery(this);if(!l.attr("readOnly")&&!l.attr("disabled")){e.updateToDataset(),e._isBluring=!0;try{e.doValueChanged()}finally{e._isBluring=!1}}}},doKeydown:function(e){e=jQuery.event.fix(e||window.event);var t=e.which,l=this.jslet;13==t&&(l._enterProcessed=!0,l.updateToDataset());var i=l.ctrlRecno()>=0&&l._dataset.status()>0;!i||38!=t&&40!=t&&33!=t&&34!=t||(l._enterProcessed=!0,l.updateToDataset());var a=l._dataset.getField(l._field);a.readOnly()||a.disabled()||8!=t&&46!=t||l._dataset.editRecord()},doKeypress:function(e){var t=this.jslet,l=t._dataset.getField(t._field);if(!l.readOnly()&&!l.disabled()){e=jQuery.event.fix(e||window.event);var i=e.which,a=jslet.getRemainingString(t.el.value,jslet.ui.textutil.getSelectedText(t.el)),r=jslet.ui.textutil.getCursorPos(t.el);t._dataset.fieldValidator().checkInputChar(l,String.fromCharCode(i),a,r.begin)||e.preventDefault(),t._dataset.editRecord(),13==i&&(t._enterProcessed?t._enterProcessed=!1:t.updateToDataset())}},focus:function(){var e=jQuery(this.el);e.attr("disabled")||this.el.focus()},selectText:function(e,t){jslet.ui.textutil.selectText(this.el,e,t)},inputText:function(e){if(e){jslet.Checker.test("DBText.inputText#text",e).isString();var t=this,l=t._dataset.getField(t._field);if(l.getType()!==jslet.data.DataType.STRING)return void console.warn("Only String Field can be input!");for(var i,a=[],r=0,n=e.length;n>r;r++)i=e[r],t._dataset.fieldValidator().checkInputChar(l,i)&&a.push(i);t._position||(t._position=jslet.ui.textutil.getCursorPos(t.el));var s=(a.join(""),t.el.value),o=t._position.begin,d=t._position.end,u=s.substring(0,o),c=s.substring(d);t.el.value=u+e+c,t._position=jslet.ui.textutil.getCursorPos(t.el),t.updateToDataset()}},refreshControl:function(e,t,l){e(t,l)&&this.afterRefreshControl&&this.afterRefreshControl(t)},doMetaChanged:function(e,t){e(t);var l=this,i=l._dataset.getField(l._field);if(t&&"disabled"!=t&&"readOnly"!=t||jslet.ui.setEditableStyle(l.el,i.disabled(),i.readOnly(),!1,i.required()),t&&"required"==t){var a=jQuery(l.el);i.required()?a.addClass("jl-ctrl-required"):a.removeClass("jl-ctrl-required")}if(!t||"editMask"==t){var r=i.editMask();r?(l.editMask||(l.editMask=new jslet.ui.EditMask,l.editMask.attach(l.el)),mask=r.mask,keepChar=r.keepChar,transform=r.transform,l.editMask.setMask(mask,keepChar,transform)):l.editMask&&(l.editMask.detach(),l.editMask=null)}t&&"tabIndex"!=t||l.setTabIndex(),l.el.maxLength=i.getEditLength()},doValueChanged:function(){var e=this;if(!e._keep_silence_){var t=e.getFieldError();if(t&&t.message)return e.el.value=t.inputText||"",void e.renderInvalid(t);e.renderInvalid(null);var l=e._dataset.getField(e._field),i=l.alignment();jslet.locale.isRtl&&(i="left"==i?"right":"left"),e.el.style.textAlign=i;var a;e.editMask?(a=e.getValue(),e.editMask.setValue(a)):(a=document.activeElement!=e.el||e.el.readOnly||e._isBluring?e.getText(!1):e.getText(!0),l.getType()===jslet.data.DataType.STRING&&l.antiXss()&&(a=jslet.htmlDecode(a)),e.el.value=a),e.oldValue=e.el.value}},renderAll:function(){this.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},updateToDataset:function(){var e=this;if(e._keep_silence_)return!0;var t=e.el.value;if(e.oldValue==t)return!0;var l=e.ctrlRecno();if(l>=0){var i=e._dataset.recnoSilence();e._dataset.recnoSilence(e.ctrlRecno())}try{if(e._dataset.editRecord(),this.editMask&&!this.editMask.validateValue())return!1;if(e._beforeUpdateToDataset&&!e._beforeUpdateToDataset.call(e))return!1;e._keep_silence_=!0;try{e.editMask&&(t=e.editMask.getValue()),e._dataset.setFieldText(e._field,t,e._valueIndex)}finally{e._keep_silence_=!1}}finally{l>=0&&e._dataset.recnoSilence(i)}return e.refreshControl(jslet.data.RefreshEvent.updateRecordEvent(e._field)),!0},destroy:function(e){var t=this;jQuery(t.el).off(),t.editMask&&(t.editMask.detach(),t.editMask=null),t._beforeUpdateToDataset=null,t.onKeyDown=null,e()}}),jslet.ui.register("DBText",jslet.ui.DBText),jslet.ui.DBText.htmlTemplate='<input type="text"></input>',jslet.ui.DBPassword=jslet.Class.create(jslet.ui.DBText,{initialize:function(e,t,l){e(t,l)},isValidTemplateTag:function(e){return"input"==e.tagName.toLowerCase()&&"password"==e.type.toLowerCase()}}),jslet.ui.register("DBPassword",jslet.ui.DBPassword),jslet.ui.DBPassword.htmlTemplate='<input type="password"></input>',jslet.ui.DBTextArea=jslet.Class.create(jslet.ui.DBText,{initialize:function(e,t,l){e(t,l)},isValidTemplateTag:function(e){return"textarea"==e.tagName.toLowerCase()}}),jslet.ui.register("DBTextArea",jslet.ui.DBTextArea),jslet.ui.DBTextArea.htmlTemplate="<textarea></textarea>",jslet.ui.DBTimePicker=jslet.Class.create(jslet.ui.DBFieldControl,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,field,is12Hour,hasSecond",i._is12Hour=!1,i._hasSecond=!1,e(t,l)},is12Hour:function(e){return void 0===e?this._is12Hour:void(this._is12Hour=e?!0:!1)},hasSecond:function(e){return void 0===e?this._hasSecond:void(this._hasSecond=e?!0:!1)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t||"span"==t},bind:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-timepicker")||t.addClass("form-control jl-timepicker"),e.renderAll(),t.on("change","select",function(t){e.updateToDataset()})},renderAll:function(){var e=this,t=jQuery(e.el),l=e._dataset.getField(e._field),i=l.dataRange(),a={hour:0,minute:0,second:0},r={hour:23,minute:59,second:59};i&&(i.min&&(a=e._splitTime(i.min)),i.max&&(r=e._splitTime(i.max)));var n=[];if(n.push('<select class="jl-time-hour">'),e._is12Hour){for(var s,o=a.hour,d=r.hour,u=100,c=0,h=o;d>h;h++)s=h,h>11&&(s=h-12),u=Math.min(u,s),c=Math.max(c,s);n.push(e._getOptions(u,c))}else n.push(e._getOptions(a.hour,r.hour||23));n.push("</select>"),n.push('<select class="jl-time-minute">'),n.push(e._getOptions(0,59)),n.push("</select>"),e._hasSecond&&(n.push('<select class="jl-time-second">'),n.push(e._getOptions(0,59)),n.push("</select>")),e._is12Hour&&n.push('<select class="jl-time-ampm"><option value="am">AM</option><option value="pm">PM</option></select>'),t.html(n.join("")),e.refreshControl(jslet.data.RefreshEvent.updateAllEvent(),!0)},_getOptions:function(e,t){for(var l,i=[],a=e;t>=a;a++)l=10>a?"0"+a:""+a,i.push('<option value="'),i.push(a),i.push('">'),i.push(l),i.push("</option>");return i.join("")},doMetaChanged:function(e,t){e(t);var l=this,i=l._dataset.getField(l._field);if(!t||"disabled"==t||"readOnly"==t||"tabIndex"==t)for(var a,r=i.disabled()||i.readOnly(),n=jQuery(l.el).find("select"),s=i.required(),o=i.tabIndex(),d=0,u=n.length;u>d;d++)a=n[d],a.disabled=r,jslet.ui.setEditableStyle(a,r,r,!0,s),a.tabIndex=o},doValueChanged:function(){var e=this;if(!e._keep_silence_){var t=e.getValue(),l=e._splitTime(t),i=l.hour,a=jQuery(e.el),r=a.find(".jl-time-hour"),n=a.find(".jl-time-minute");e._is12Hour&&(jqAmPm=a.find(".jl-time-ampm"),jqAmPm.prop("selectedIndex",12>i?0:1),i>11&&(i-=12)),r.val(i),n.val(l.minute),e._hasSecond&&(n=a.find(".jl-time-second"),n.val(l.second))}},_splitTime:function(e){var t=0,l=0,i=0;if(e)if(jslet.isDate(e))t=e.getHours(),l=e.getMinutes(),i=e.getSeconds();else if(jslet.isString(e)){var a=e.split(":");t=parseInt(a[0]),a.length>1&&(l=parseInt(a[1])),a.length>2&&(i=parseInt(a[2]))}return{hour:t,minute:l,second:i}},_prefix:function(e){return parseInt(e)<10?"0"+e:e},updateToDataset:function(){var e=this;if(e._keep_silence_)return!0;e._keep_silence_=!0;try{var t,l=jQuery(e.el),i=e._dataset.getField(e._field),a=null;if(i.getType()!=jslet.data.DataType.DATE)a=[],e._is12Hour&&l.find(".jl-time-ampm").prop("selectedIndex")>0?(t=parseInt(l.find(".jl-time-hour").val())+12,a.push(t)):a.push(e._prefix(l.find(".jl-time-hour").val())),a.push(":"),a.push(e._prefix(l.find(".jl-time-minute").val())),e._hasSecond&&(a.push(":"),a.push(e._prefix(l.find(".jl-time-second").val()))),a=a.join("");else{a=e.getValue(),a||(a=new Date),t=parseInt(l.find(".jl-time-hour").val()),e._is12Hour&&l.find(".jl-time-ampm").prop("selectedIndex")>0&&(t+=12);var r=parseInt(l.find(".jl-time-minute").val()),n=0;e._hasSecond&&(n=parseInt(l.find(".jl-time-second").val())),a.setHours(t),a.setMinutes(r),a.setSeconds(n)}e._dataset.setFieldValue(e._field,a,e._valueIndex)}finally{e._keep_silence_=!1}return!0},destroy:function(e){jQuery(this.el).off(),e()}}),jslet.ui.register("DBTimePicker",jslet.ui.DBTimePicker),jslet.ui.DBTimePicker.htmlTemplate="<div></div>",jslet.ui.DBError=jslet.Class.create(jslet.ui.DBControl,{initialize:function(e,t,l){this.allProperties="dataset",e(t,l)},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this,t=jQuery(e.el);
t.hasClass("jl-errorpanel")||t.addClass("jl-errorpanel"),e.renderAll()},refreshControl:function(e){e&&e.eventType==jslet.data.RefreshEvent.ERROR&&(this.el.innerHTML=e.message||"")},renderAll:function(){this.refreshControl()},destroy:function(e){e()}}),jslet.ui.register("DBError",jslet.ui.DBError),jslet.ui.DBError.htmlTemplate="<div></div>",jslet.ui.DBPageBar=jslet.Class.create(jslet.ui.DBControl,{initialize:function(e,t,l){var i=this;i.allProperties="dataset,showPageSize,showGotoButton,pageSizeList",i._showPageSize=!0,i._showGotoButton=!0,i._pageSizeList=[100,200,500],e(t,l)},showPageSize:function(e){return void 0===e?this._showPageSize:void(this._showPageSize=e?!0:!1)},showGotoButton:function(e){return void 0===e?this._showGotoButton:void(this._showGotoButton=e?!0:!1)},pageSizeList:function(e){if(void 0===e)return this._pageSizeList;jslet.Checker.test("DBPageBar.pageSizeList",e).isArray();for(var t,l=0,i=e.length;i>l;l++)t=e[l],jslet.Checker.test("DBPageBar.pageSizeList",t).isGTZero();this._pageSizeList=e},isValidTemplateTag:function(e){var t=e.tagName.toLowerCase();return"div"==t},bind:function(){var e=this,t=jQuery(e.el);t.hasClass("jl-pagebar")||t.addClass("jl-pagebar");var l=['<select class="jl-pb-item"></select><label class="jl-pb-item jl-pb-label">',jslet.locale.DBPageBar.pageSizeLabel,'</label><a class="jl-pb-item jl-pb-button jl-pb-first" href="javascript:;"></a><a class="jl-pb-item jl-pb-button jl-pb-prior" href="javascript:;"></a><label class="jl-pb-item jl-pb-label">',jslet.locale.DBPageBar.pageNumLabel,'</label><input class="jl-pb-item jl-pb-pagenum" value="1" size="2" ></input><a class="jl-pb-item jl-pb-button jl-pb-goto" href="javascript:;"></a><label class="jl-pb-item jl-pb-label">',jslet.formatString(jslet.locale.DBPageBar.pageCountLabel,[0]),'</label><a class="jl-pb-item jl-pb-button jl-pb-next" href="javascript:;"></a><a class="jl-pb-item jl-pb-button jl-pb-last" href="javascript:;"></a></div>'];t.html(l.join(""));var i=e.el.childNodes[0];if(e._showPageSize){for(var a=e._pageSizeList,r=a.length,n="",s=0;r>s;s++)n+="<option value="+a[s]+">"+a[s]+"</option>";i.innerHTML=n,e._dataset.pageSize(parseInt(i.value))}jQuery(i).on("change",function(e){var t=this.parentElement.jslet.dataset();t.pageNo(1),t.pageSize(parseInt(this.value)),t.requery()}),e._firstBtn=e.el.childNodes[2],e._priorBtn=e.el.childNodes[3],e._pageNoTxt=e.el.childNodes[5],e._gotoBtn=e.el.childNodes[6],e._pageCountLbl=e.el.childNodes[7],e._nextBtn=e.el.childNodes[8],e._lastBtn=e.el.childNodes[9],jQuery(e._firstBtn).on("click",function(e){if(!this.disabled){var t=this.parentElement.jslet.dataset();t.pageNo(1),t.requery()}}),jQuery(e._priorBtn).on("click",function(e){if(!this.disabled){var t=this.parentElement.jslet.dataset(),l=t.pageNo();1!=l&&(t.pageNo(l-1),t.requery())}}),jQuery(e._gotoBtn).on("click",function(e){var t=this.parentElement.jslet,l=t.dataset(),i=parseInt(t._pageNoTxt.value);1>i&&(i=1),i>l.pageCount()&&(i=l.pageCount()),l.pageNo(i),l.requery()}),jQuery(e._nextBtn).on("click",function(e){if(!this.disabled){var t=this.parentElement.jslet,l=t.dataset(),i=l.pageNo();i>=l.pageCount()||(l.pageNo(++i),l.requery())}}),jQuery(e._lastBtn).on("click",function(e){if(!this.disabled){var t=this.parentElement.jslet,l=t.dataset();l.pageCount()<1||(l.pageNo(l.pageCount()),l.requery())}}),jQuery(e._pageNoTxt).on("keypress",function(e){e=jQuery.event.fix(e||window.event);var t=e.which,l=new Array("0","1","2","3","4","5","6","7","8","9");l.indexOf(String.fromCharCode(t))<0&&e.preventDefault()}),e.renderAll()},refreshControl:function(e){if(!e||e.eventType==jslet.data.RefreshEvent.CHANGEPAGE){var t=this,l=t._dataset.pageNo(),i=t._dataset.pageCount();t._pageNoTxt.value=l,t._pageCountLbl.innerHTML=jslet.formatString(jslet.locale.DBPageBar.pageCountLabel,[i]),t._refreshButtonStatus()}},_refreshButtonStatus:function(){var e=this,t=e._dataset,l=t.pageNo(),i=t.pageCount(),a=!0,r=!0;l>1&&(a=!1),i>l&&(r=!1),a?(jQuery(e._firstBtn).addClass("jl-pb-first-disabled jl-pb-button-disabled"),jQuery(e._priorBtn).addClass("jl-pb-prior-disabled jl-pb-button-disabled")):(jQuery(e._firstBtn).removeClass("jl-pb-first-disabled jl-pb-button-disabled"),jQuery(e._priorBtn).removeClass("jl-pb-prior-disabled jl-pb-button-disabled")),r?(jQuery(e._nextBtn).addClass("jl-pb-next-disabled jl-pb-button-disabled"),jQuery(e._lastBtn).addClass("jl-pb-last-disabled jl-pb-button-disabled")):(jQuery(e._nextBtn).removeClass("jl-pb-next-disabled jl-pb-button-disabled"),jQuery(e._lastBtn).removeClass("jl-pb-last-disabled jl-pb-button-disabled")),e._firstBtn.disabled=a,e._priorBtn.disabled=a,e._nextBtn.disabled=r,e._lastBtn.disabled=r},renderAll:function(){var e=this._showPageSize?"inline":"none",t=this.el;t.childNodes[0].style.display=e,t.childNodes[1].style.display=e,this.refreshControl()},destroy:function(e){var t=this;jQuery(t._firstBtn).off(),jQuery(t._priorBtn).off(),jQuery(t._pageNoTxt).off(),jQuery(t._gotoBtn).off(),jQuery(t._pageCountLbl).off(),jQuery(t._nextBtn).off(),jQuery(t._lastBtn).off(),t._firstBtn=null,t._priorBtn=null,t._pageNoTxt=null,t._gotoBtn=null,t._pageCountLbl=null,t._nextBtn=null,t._lastBtn=null,e()}}),jslet.ui.register("DBPageBar",jslet.ui.DBPageBar),jslet.ui.DBPageBar.htmlTemplate="<div></div>"},function(e,t,l){var i={};i.isRtl=!1,i.Common={jsonParseError:"JSON\u683c\u5f0f\u9519\u8bef\uff0c\u65e0\u6cd5\u89e3\u6790\uff1a{0}",ConnectError:"\u8fde\u63a5\u8d85\u65f6\u6216\u8005\u65e0\u6cd5\u8fde\u63a5\u670d\u52a1\u5668!"},i.Date={format:"yyyy-MM-dd"},i.Dataset={invalidDateFieldValue:"\u5b57\u6bb5: [{0}]\u662f\u65e5\u671f\u5b57\u6bb5, \u4f46\u503c\u4e0d\u662f\u65e5\u671f\u578b\u7684!",fieldNotFound:"\u5b57\u6bb5: {0} \u672a\u5b9a\u4e49!",valueNotFound:"\u627e\u4e0d\u5230\u6307\u5b9a\u7684\u503c!",lookupNotFound:"\u5b57\u6bb5: {0} \u6ca1\u6709\u8bbe\u7f6e\u67e5\u627e\u5b57\u6bb5, \u4e0d\u80fd\u4f7f\u7528\u5b57\u6bb5\u94fe!",datasetFieldNotBeSetValue:"\u4e0d\u80fd\u7ed9\u6570\u636e\u96c6\u5b57\u6bb5: {0} \u8bbe\u7f6e\u503c!",datasetFieldNotBeCalculated:"\u6570\u636e\u96c6\u5b57\u6bb5: {0} \u4e0d\u80fd\u53c2\u4e0e\u8ba1\u7b97!",insertMasterFirst:"\u4e3b\u6570\u636e\u96c6\u6ca1\u6709\u6570\u636e\uff0c\u8bf7\u5148\u5728\u4e3b\u6570\u636e\u96c6\u4e2d\u65b0\u589e\u6570\u636e!",lookupFieldExpected:"\u5b57\u6bb5: {0} \u5fc5\u987b\u662f\u67e5\u627e\u5b57\u6bb5!",invalidLookupField:"\u5b57\u6bb5: {0} \u7684\u662f\u4e00\u4e2a\u65e0\u6548\u7684\u67e5\u627e\u5b57\u6bb5\uff0c\u8bf7\u68c0\u67e5\u53c2\u6570!",invalidContextRule:"\u5b57\u6bb5: [{0}]\u7684\u4e0a\u4e0b\u6587\u89c4\u5219\u7684\u6761\u4ef6\u4e2d\u5fc5\u987b\u8981\u6709\u5b57\u6bb5!\u5982\u679c\u662f\u56fa\u5b9a\u6761\u4ef6\uff0c\u8bf7\u76f4\u63a5\u8bbe\u7f6e\u8fc7\u6ee4\u6761\u4ef6!",fieldValueRequired:"[{0}]\u4e0d\u80fd\u4e3a\u7a7a!",invalidFieldTranslate:"\u5b57\u6bb5: {0}\u91cc\u7684\u5c5e\u6027: displayValueField \u548c inputValueField\u4e0d\u80fd\u4e3a\u7a7a!",translateListenerRequired:"\u5fc5\u987b\u8bbe\u7f6e\u4e8b\u4ef6\u76d1\u542c\u5668: translateListener!",minMaxValueError:"[{0}] \u7684\u6700\u5c0f\u503c\u5fc5\u987b\u8981\u5c0f\u4e8e\u6216\u8005\u7b49\u4e8e\u6700\u5927\u503c!",invalidDate:"\u65e0\u6548\u65e5\u671f!",invalidInt:"\u53ea\u5141\u8bb8:0-9,-",invalidFloat:"\u53ea\u5141\u8bb8:0-9,-,.",invalidIntegerPart:"\u6574\u6570\u90e8\u5206\u8d85\u957f\uff0c\u5141\u8bb8\uff1a{0}\u4f4d\uff0c\u5b9e\u9645\uff1a{1}\u4f4d\uff01",invalidDecimalPart:"\u5c0f\u6570\u90e8\u5206\u8d85\u957f\uff0c\u5141\u8bb8\uff1a{0}\u4f4d\uff0c\u5b9e\u9645\uff1a{1}\u4f4d\uff01",cannotConfirm:"\u6570\u636e\u5f55\u5165\u6709\u8bef\uff0c\u8bf7\u5148\u68c0\u67e5!",notInRange:"\u5f55\u5165\u7684\u503c\u5fc5\u987b\u5728:{0}\u548c{1}\u4e4b\u95f4",lessThanValue:"\u5f55\u5165\u7684\u503c\u5fc5\u987b\u5c0f\u4e8e: {0}",moreThanValue:"\u5f55\u5165\u7684\u503c\u5fc5\u987b\u5927\u4e8e: {0}",cannotDelParent:"\u8be5\u7b14\u6570\u636e\u4e0b\u8fd8\u6709\u4e0b\u7ea7\u6570\u636e,\u4e0d\u80fd\u5220\u9664!",notUnique:"\u6570\u636e\u4e0d\u80fd\u91cd\u590d!",LookupDatasetNotSameAsHost:"\u67e5\u627e\u6570\u636e\u6e90\u4e0d\u80fd\u4e3a\u4e3b\u6570\u636e\u96c6!",betweenLabel:" - ",betwwenInvalid:"\u6700\u5c0f\u503c\u4e0d\u5f97\u5927\u4e8e\u6700\u5927\u503c",value:"\u503c",nullText:"(\u7a7a)",noDataSubmit:"\u65e0\u6570\u636e\u53ef\u63d0\u4ea4!",trueText:"\u662f",falseText:""},i.DBControl={datasetNotFound:"\u627e\u4e0d\u5230\u6570\u636e\u96c6\uff1a {0}, \u8bf7\u5148\u5b9a\u4e49\u5e76\u8bbe\u7f6e\u5176\u540d\u79f0!",expectedProperty:"\u8bf7\u5148\u8bbe\u7f6e\u5c5e\u6027\u503c: {0}!",propertyValueMustBeInt:"\u5c5e\u6027: {0} \u7684\u503c\u5fc5\u987b\u662f\u6570\u5b57!",jsletPropRequired:"HTML\u6a21\u677f\u4e0a\u7f3a\u5c11jslet\u5c5e\u6027!",invalidHtmlTag:"\u6240\u9644\u52a0HTML\u6807\u7b7e\u65e0\u6548\uff0c\u53ef\u53c2\u8003: {0} !",invalidJsletProp:"jslet\u63a7\u4ef6\u53c2\u6570\u4e0d\u7b26\u5408JSON\u89c4\u8303: {0}"},i.DBImage={lockedImageTips:"\u56fe\u7247\u88ab\u9501\u5b9a "},i.DBChart={onlyNumberFieldAllowed:"\u56fe\u8868\u5b57\u6bb5\u5fc5\u987b\u4e3aNumber\u7c7b\u578b!"},i.DBCheckBoxGroup={invalidCheckedCount:"\u6700\u5927\u53ef\u9009\u62e9\u7684\u4e2a\u6570\u4e0d\u80fd\u8d85\u8fc7: {0}!",noOptions:"\u65e0\u53ef\u9009\u9879",selectAll:"\u5168\u90e8"},i.DBRadioGroup={noOptions:"\u65e0\u53ef\u9009\u9879"},i.DBBetweenEdit={betweenLabel:"-"},i.DBPageBar={pageSizeLabel:"/\u9875 ",pageNumLabel:"\u7b2c ",pageCountLabel:"\u5171:{0}\u9875 "},i.DBComboSelect={find:"\u67e5\u627e"},i.MessageBox={ok:"\u786e\u5b9a",cancel:"\u53d6\u6d88",yes:"\u662f",no:"\u5426",info:"\u63d0\u793a",error:"\u9519\u8bef",warn:"\u8b66\u544a",confirm:"\u786e\u8ba4",prompt:"\u8bf7\u8f93\u5165"},i.Calendar={yearPrev:"\u524d\u4e00\u5e74",monthPrev:"\u524d\u4e00\u6708",yearNext:"\u4e0b\u4e00\u5e74",monthNext:"\u4e0b\u4e00\u6708",Sun:"\u65e5",Mon:"\u4e00",Tue:"\u4e8c",Wed:"\u4e09",Thu:"\u56db",Fri:"\u4e94",Sat:"\u516d",today:"\u4eca\u65e5",monthNames:["\u4e00\u6708","\u4e8c\u6708","\u4e09\u6708","\u56db\u6708","\u4e94\u6708","\u516d\u6708","\u4e03\u6708","\u516b\u6708","\u4e5d\u6708","\u5341\u6708","\u5341\u4e00\u6708","\u5341\u4e8c\u6708"],firstDayOfWeek:0},i.DBTreeView={expandAll:"\u5168\u90e8\u5c55\u5f00",collapseAll:"\u5168\u90e8\u6536\u7f29",checkAll:"\u5168\u90e8\u9009\u62e9",uncheckAll:"\u5168\u90e8\u4e0d\u9009"},i.TabControl={close:"\u5173\u95ed",closeOther:"\u5173\u95ed\u5176\u5b83"},i.DBTable={norecord:"\u6ca1\u6709\u6570\u636e",sorttitle:"\u6309Ctrl\u53ef\u591a\u5217\u6392\u5e8f",totalLabel:"\u5408\u8ba1"},i.findDialog={caption:"\u67e5\u627e - {0}",matchFirst:"\u5339\u914d\u5f00\u5934",matchLast:"\u5339\u914d\u7ed3\u5c3e",matchAny:"\u4efb\u610f\u5339\u914d"},(void 0===window.jslet||void 0===jslet)&&(jslet=window.jslet=function(e){var t=jQuery(e)[0];return t&&t.jslet?t.jslet:null}),jslet.locale=i,l(11),l(12),e.exports=jslet},function(e,t,l){function i(e){this.tpl=e}function a(e,t){var i=l(6),a=i(e),r=(document.createDocumentFragment(),document.createElement("div"));r.innerHTML=a,t.appendChild(r.firstChild)}l(16),i.prototype.parse=function(){for(var e,t,l=0,i=this.tpl,r=i.controls.length,n=i.root?document.getElementById(i.root):document.body;r>l;l++){e=i.controls[l],a(e.panel,n),t=e.bind;for(var s=0,o=t.length;o>s;s++)jslet.ui.bindControl(document.getElementById(t[s].el),t[s].jsletParams)}},e.exports=i},function(e,t,l){function i(e,t){for(var l=0;l<e.length;l++){var i=e[l],a=u[i.id];if(a){a.refs++;for(var r=0;r<a.parts.length;r++)a.parts[r](i.parts[r]);for(;r<i.parts.length;r++)a.parts.push(n(i.parts[r],t))}else{for(var s=[],r=0;r<i.parts.length;r++)s.push(n(i.parts[r],t));u[i.id]={id:i.id,refs:1,parts:s}}}}function a(e){for(var t=[],l={},i=0;i<e.length;i++){var a=e[i],r=a[0],n=a[1],s=a[2],o=a[3],d={css:n,media:s,sourceMap:o};l[r]?l[r].parts.push(d):t.push(l[r]={id:r,parts:[d]})}return t}function r(){var e=document.createElement("style"),t=f();return e.type="text/css",t.appendChild(e),e}function n(e,t){var l,i,a;if(t.singleton){var n=p++;l=v||(v=r()),i=o.bind(null,l,n,!1),a=o.bind(null,l,n,!0)}else l=r(),i=d.bind(null,l),a=function(){l.parentNode.removeChild(l)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else a()}}function s(e,t,l){var i=["/** >>"+t+" **/","/** "+t+"<< **/"],a=e.lastIndexOf(i[0]),r=l?i[0]+l+i[1]:"";if(e.lastIndexOf(i[0])>=0){var n=e.lastIndexOf(i[1])+i[1].length;return e.slice(0,a)+r+e.slice(n)}return e+r}function o(e,t,l,i){var a=l?"":i.css;if(e.styleSheet)e.styleSheet.cssText=s(e.styleSheet.cssText,t,a);else{var r=document.createTextNode(a),n=e.childNodes;n[t]&&e.removeChild(n[t]),n.length?e.insertBefore(r,n[t]):e.appendChild(r)}}function d(e,t){var l=t.css,i=t.media,a=t.sourceMap;if(a&&"function"==typeof btoa)try{l+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(JSON.stringify(a))+" */",l='@import url("data:text/css;base64,'+btoa(l)+'")'}catch(r){}if(i&&e.setAttribute("media",i),e.styleSheet)e.styleSheet.cssText=l;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(l))}}var u={},c=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},h=c(function(){return/msie 9\b/.test(window.navigator.userAgent.toLowerCase())}),f=c(function(){return document.head||document.getElementsByTagName("head")[0]}),v=null,p=0;e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=h());var l=a(e);return i(l,t),function(e){for(var r=[],n=0;n<l.length;n++){var s=l[n],o=u[s.id];o.refs--,r.push(o)}if(e){var d=a(e);i(d,t)}for(var n=0;n<r.length;n++){var o=r[n];if(0===o.refs){for(var c=0;c<o.parts.length;c++)o.parts[c]();delete u[o.id]}}}}},function(e,t,l){var i=l(5);"string"==typeof i&&(i=[[e.id,i,""]]);l(15)(i,{})},function(e,t){var l,i,a={},r=jslet.data.createEnumDataset("gender","F:Female,M:Male,U:Unknown"),n=jslet.data.createEnumDataset("position","0:Senior Manger,1:Junior Manger,2:Team Leader,3:Employee"),s=a.dsProvince=jslet.data.createEnumDataset("province","01:Anhui,02:Beijing,03:Fujian,04:Gansu,05:Guangdong,06:Guangxi,07:Guizhou,08:Hainan,09:Hebei,10:Henan,11:Hei Nongjiang,12:Hubei,13:Hunan,14:Jilin,15:Jiangsu,16:Jiangxi,17:Liaoning,18:Neimenggu,19:Ningxia,20:Qinghai,21:Shangdong,22:Shangxi,23:Shanxi,24:Shanghai,25:Sichuan,26:Tianjing,27:Xizang,28:Xinjiang,29:Yunnan,30:Zhejiang,31:Chongqing"),o=[{name:"deptid",type:"S",length:6,label:"Dept Code"},{name:"name",type:"S",length:15,label:"Dept. Name"},{name:"address",type:"S",length:20,label:"Address"},{name:"parentid",type:"S",length:6,visible:!1,label:"ParentID"}],d=jslet.data.createDataset("department",o,{keyField:"deptid",codeField:"deptid",nameField:"name",parentField:"parentid",autoRefreshHostDataset:!0}),u=[{deptid:"00",name:"Admin Dept.",address:"Shenzhen",parentid:""},{deptid:"01",name:"Marketing Dept.",address:"Beijing",parentid:""},{deptid:"0101",name:"Chengdu Branch.",address:"Chengdu",parentid:"01"},{deptid:"0102",name:"Shanghai Branch ",address:"Shanghai",parentid:"01"},{deptid:"02",name:"Dev. Dept.",address:"Shenzhen",parentid:""},{deptid:"0201",name:"Dev. Branch 1",address:"Shenzhen",parentid:"02"},{deptid:"0202",name:"Dev. Branch 2",address:"Shenzhen",parentid:"02"},{deptid:"03",name:"QA",address:"Shenzhen",parentid:""},{deptid:"04",name:"FA Dept.",address:"Shenzhen",parentid:""}];d.dataList(u);var c=a.dsEmployee=new jslet.data.Dataset("employee"),h=jslet.data.createNumberField("workerid");h.label("ID"),h.required(!0),h.displayWidth(6),h.tip("Employee ID must be unique!"),c.addField(h),h=jslet.data.createStringField("name",12),h.label("Name"),h.required(!0),h.unique(!0),h.aggraded(!0),h.tip("Name is required and unique"),c.addField(h),h=jslet.data.createStringField("department",6),h.label("Department"),h.required(!1),h.displayWidth(16),h.nullText("(Empty)"),l=new jslet.data.FieldLookup,l.dataset(d),h.lookup(l),c.addField(h),h=jslet.data.createStringField("gender",1),h.label("Gender"),l=new jslet.data.FieldLookup,l.dataset(r),h.lookup(l),h.displayWidth(16),c.addField(h),h=jslet.data.createNumberField("age",5,0),h.label("Age"),h.displayWidth(6),h.dataRange({min:18,max:60}),c.addField(h),h=jslet.data.createBooleanField("married"),h.label("Married"),h.trueValue(1),h.falseValue(0),h.displayWidth(10),c.addField(h),h=jslet.data.createDateField("birthday"),h.label("Birthday"),h.displayFormat("yyyy-MM-dd"),h.dataRange({min:new Date(1960,1,1)}),c.addField(h),h=jslet.data.createStringField("position",10),h.label("Position"),l=new jslet.data.FieldLookup,l.dataset(n),h.lookup(l),c.addField(h),h=jslet.data.createNumberField("salary",16,2),h.label("Salary"),h.displayFormat("\uffe5#,##0.##"),h.aggraded(!0),c.addField(h),h=jslet.data.createStringField("university",20),h.label("University"),h.displayWidth(20),c.addField(h),h=jslet.data.createStringField("province",10),h.label("Province"),l=new jslet.data.FieldLookup,l.dataset(s),h.lookup(l),c.addField(h),h=jslet.data.createStringField("city",8),h.label("City"),h.visible(!1),c.addField(h),h=jslet.data.createStringField("photo",10),h.label("Photo"),h.visible(!0),c.addField(h),h=jslet.data.createStringField("officephone",12),h.label("Office Phone"),h.regularExpr(/(\(\d{3,4}\)|\d{3,4}-|\s)?\d{8}/gi,"Invalid phone number!"),h.tip("Format:999-99999999"),c.addField(h),h=jslet.data.createStringField("cellphone",12),h.label("Cell Phone"),h.regularExpr(/1\d{10}/gi,"Invalid cell phone number!"),h.tip('"1"+10 digits'),c.addField(h),h=jslet.data.createStringField("email",20),h.label("Email"),h.regularExpr(/^[a-zA-Z_0-9-'\+~]+(\.[a-zA-Z_0-9-'\+~]+)*@([a-zA-Z_0-9-]+\.)+[a-zA-Z]{2,7}$/gi,"Invalid email address!"),h.tip("foo@foo.com"),c.addField(h),h=jslet.data.createStringField("idcard",18),h.label("ID Card"),h.regularExpr(/\d{18}/gi,"Invalid IDCard number, 18 digits allowed!"),h.tip("18 digits"),c.addField(h),h=jslet.data.createStringField("summary",200),h.label("Summary"),h.displayWidth(10),h.visible(!1),c.addField(h),c.keyField("workerid"),c.codeField("workerid"),c.nameField("name");var i=[{workerid:1,name:"Tom",department:"0101",gender:"M",age:48,birthday:new Date(1961,1,23),province:"01",city:"0110",position:"1",married:1,university:"Peking University",photo:"1.jpg",salary:1e3},{workerid:2,name:"Marry",department:"03",gender:"F",age:26,birthday:new Date(1983,8,23),province:"02",city:"0201",position:"2",married:0,university:"Harvard University",photo:"2.jpg",salary:2e3},{workerid:3,name:"Jerry",department:"0201",gender:"M",age:32,birthday:new Date(1977,5,22),province:"13",city:"1305",position:"3",married:1,university:"TsingHua University",photo:"3.jpg",salary:3200},{workerid:4,name:"John",department:"00",gender:"M",age:48,birthday:new Date(1961,1,6),province:"13",city:"1311",position:"0",married:1,university:"Peking University",photo:"4.jpg",salary:7800},{workerid:5,name:"Monica",department:"04",gender:"F",age:38,birthday:new Date(1971,8,23),province:"06",city:"0605",position:"1",married:0,university:"Cambridge University",photo:"5.jpg",salary:5e3},{workerid:6,name:"Ted",department:"02",gender:"U",age:26,birthday:new Date(1983,7,12),province:"06",city:"0606",position:"3",married:0,university:"Cambridge University",photo:"6.jpg",salary:3e3},{workerid:7,name:"Jack",department:"02",gender:"M",age:26,birthday:new Date(1983,9,12),province:"06",city:"0606",position:"3",married:0,university:"MIT",photo:"6.jpg",salary:3e3},{workerid:8,name:"Mike",department:"02",gender:"M",age:26,birthday:new Date(1983,8,12),province:"06",city:"0606",position:"3",married:0,university:"MIT",photo:"6.jpg",salary:3e3},{workerid:9,name:"Jessica",department:"03",gender:"F",age:25,birthday:new Date(1984,8,23),province:"03",city:"0307",position:"3",married:1,university:"Harvard University",photo:"7.jpg",salary:8e3}];c.dataList(i),e.exports=a},,,,,,,,,function(e,t,l){var i=(l(13),l(14)),a=l(17),r=(a.dsEmployee,{root:"root",masterDataset:"",controls:[{panel:{title:"lookupField",bodyTpl:'<div id="tablePanel"></div><hr>',toolbar:[]},bind:[{el:"tablePanel",jsletParams:{type:"DBTable",dataset:"employee"}}]}]}),n=new i(r);n.parse()}]);